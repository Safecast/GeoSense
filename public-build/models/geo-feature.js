define(["jquery","underscore","backbone","deepextend","deepmodel"],function(e,t,n){var r=n.DeepModel.extend({idAttribute:"_id",initialize:function(){},getNumericVal:function(){var e=this.collection.mapLayer.getOption("attrMap",{});return e.numeric?this.get(e.numeric):undefined},getCenter:function(){var e=this.getSize();return[this.attributes.bbox[0]+e[0]/2,this.attributes.bbox[1]+e[1]/2]},getSize:function(){return[this.attributes.bbox[2]-this.attributes.bbox[0],this.attributes.bbox[3]-this.attributes.bbox[1]]},getBox:function(){var e=this.getSize(),t=e[0]/2,n=e[1]/2,r=this.getCenter(),i=r[0]-t,s=r[1]-n,o=r[0]+t,u=r[1]+n;return[[o,s],[i,s],[i,u],[o,u]]},getRenderAttributes:function(){var e=this.collection.mapLayer,t=e.getLayerOptions(),n=e.getMappedExtremes(),r=e.getCounts(),i=this.getNumericVal(),s=n.numeric?n.numeric.max:NaN,o=n.numeric?n.numeric.min:NaN;i&&i.avg!=null&&(i=i.avg);var u=this.attributes.count||1,a=(i-o)/(s-o),f=u/r.max,l,c=i!=undefined?t.colorType:ColorType.SOLID,h;switch(c){case ColorType.SOLID:l=e.colorAt(0);break;case ColorType.LINEAR_GRADIENT:case ColorType.PALETTE:var p;switch(t.attrMap.featureColor){case"count":l=e.colorAt(f);break;default:case"val.avg":l=e.colorAt(a)}}switch(t.attrMap?t.attrMap.featureSize:null){default:case"count":h=f;break;case"$numeric.avg":h=a}return{color:l,darkerColor:multRGB(l,.75),model:this,data:{val:i,normVal:a,count:u},size:h}}});return r});
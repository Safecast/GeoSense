define(["jquery","underscore","backbone","config","utils","text!templates/data-inspector.html","views/data-view-base"],function(e,t,n,r,i,s,o){var u=o.extend({className:"data-inspector",events:{"click #removeData":"removeDataClicked","click #editData":"editDataClicked","click #updateData":"updateDataClicked","click .color-type":"colorTypeChanged","click .feature-type":"featureTypeChanged","click .legend-button":"visibilityChanged","click .visibility":"visibilityChanged","click #colorInput":"colorInputClicked"},initialize:function(e){u.__super__.initialize.call(this,e),this.template=t.template(s),this.histogramColors=[{color:"#666666"}]},setParameters:function(){u.__super__.setParameters.call(this),this.initGradientEditor(),this.initPaletteEditor(),this.featureTypeChanged(),this.colorTypeChanged(),this.initColorPicker(this.$("#colorInput"))},initColorPicker:function(t,n){var r=this;e(t).miniColors("value",n),e(t).miniColors({change:function(e,t){r.enableUpdateButton()}}),n||(n="#0aa5ff")},initGradientEditor:function(){var e=[],t=this;for(var n=0;n<this.colors.length;n++)e[n]={color:this.colors[n].color,position:this.colors[n].position||0};e.length==1&&(e[1]={color:e[0].color,position:1}),this.$("#gradientEditor").gradientEditor({width:220,height:30,stopWidth:12,stopHeight:10,initialColor:"#ff00ff",onChange:function(e){t.colors=e,t.enableUpdateButton()},colors:e})},initPaletteEditor:function(){var t=[],n=this,r=this.$(".color-palette tbody"),i=this.$(".color-palette tr.template").clone();i.removeClass("template"),i.show();for(var s=0;s<this.colors.length;s++){var o={color:this.colors[s].color,absPosition:this.colors[s].absPosition||0,interpolation:this.colors[s].interpolation||""},u=i.clone();this.initColorPicker(e(".color-picker",u),o.color),e("[name=absPosition]",u).val(o.absPosition),e("[name=interpolation] option",u).each(function(){e(this).attr("selected",e(this).val()==o.interpolation||o.interpolation==""&&e(this).val()==ColorGradient.prototype.interpolation.default)}),r.append(u)}},getColorsFromPaletteEditor:function(){var t=[];return this.$(".color-palette tbody tr").each(function(){if(e(this).is(".template"))return;var n={color:e(".color-picker",this).val(),absPosition:parseFloat(e("[name=absPosition]",this).val()),interpolation:e("[name=interpolation]",this).val()};t.push(n)}),t}});return u});
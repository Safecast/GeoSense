define(["jquery","underscore","backbone","config","utils","text!templates/data-library.html","collections/geo-feature-collections"],function(e,t,n,r,i,s,o){var u=n.View.extend({tagName:"div",className:"data-library",events:{"click #closeDatalibrary":"closeButtonClicked"},initialize:function(e){this.template=t.template(s)},render:function(){var t=this;return e(this.el).html(this.template()),this.fetchDataCollections(),e(this.el).animate({left:-350},1,function(){e(t.el).css("display","block"),e(t.el).animate({left:0},"fast","easeOutCubic",function(){})}),e("body").append('<div class="drop-zone" id="dropZone"><h3 class="instruction">DROP HERE</h3></div>'),this},show:function(){e(this.el).addClass("visible")},fetchDataCollections:function(){var t=this;(new o).fetch({success:function(n,r,i){n.each(function(e){t.drawDataSource(e)}),t.$(".data-item").draggable({revert:!0,stack:"#dragLabel",start:function(t,n){e("#dropZone").addClass("visible"),e(this).css("opacity",".9")},stop:function(t,n){e("#dropZone").removeClass("visible")}}),e("#dropZone").droppable({accept:".data-item",hoverClass:"",drop:t.dataDrop})},error:function(e,t,n){console.error("failed to fetch collections")}})},drawDataSource:function(e){var t=e.attributes,n='<div class="data-item" data-id="'+t._id+'">'+'<div class="clearfix"><div class="data-icon"></div><h4 class="data-title">'+t.title+"</h4></div>"+(t.count?'<p class="data-count micro">'+formatLargeNumber(t.count)+"</p>":"")+(t.description?'<p class="data-description micro">'+t.description+"</p>":"")+(t.source?'<h5 class="data-source micro">Source: '+t.source+"</p>":"")+"</div>";this.$(".data-container").append(n)},dataDrop:function(t,n){var r=n.draggable;app.saveNewMapLayer(r.attr("data-id")),e(n.draggable).css("display","none")},closeButtonClicked:function(){this.remove()},remove:function(){var t=this;e(t.el).animate({left:-350},"fast","easeInCubic",function(){return e("#dropZone").remove(),app.dataLibraryVisible=!1,e(window).unbind(),e(t.el).remove(),this})}});return u});
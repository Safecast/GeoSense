define(["jquery","underscore","backbone","config","utils","text!templates/data-library.html"],function(e,t,n,r,i,s){var o=n.View.extend({tagName:"div",className:"data-library",events:{"click #closeDatalibrary":"closeButtonClicked"},initialize:function(e){this.template=t.template(s)},render:function(){var t=this;return e(this.el).html(this.template()),this.fetchDataCollections(),e(this.el).animate({left:-350},1,function(){e(t.el).css("display","block"),e(t.el).animate({left:0},400,"easeOutQuad",function(){})}),e("body").append('<div class="drop-zone" id="dropZone"><h3 class="instruction">DROP HERE</h3></div>'),this},show:function(){e(this.el).addClass("visible")},fetchDataCollections:function(){var t=this;e.ajax({type:"GET",url:"/api/pointcollections",success:function(n){e.each(n,function(e,n){app.pointCollections[n._id]||t.drawDataSource(n)}),t.$(".data-item").draggable({revert:!0,stack:"#dragLabel",start:function(t,n){var r="blah";e("#dropZone").addClass("visible"),e(this).css("opacity",".9")},stop:function(t,n){e("#dropZone").removeClass("visible")}}),e("#dropZone").droppable({accept:".data-item",hoverClass:"",drop:t.dataDrop})},error:function(){console.error("failed to fetch collections")}})},drawDataSource:function(e){dataDiv='<div class="data-item" data-id="'+e._id+'">'+'<div class="clearfix"><div class="data-icon"></div><h4 class="data-title">'+e.title+"</h4></div>"+(e.fullCount?'<p class="data-count micro">'+formatLargeNumber(e.fullCount)+"</p>":"")+(e.description?'<p class="data-description micro">'+e.description+"</p>":"")+(e.source?'<h5 class="data-source micro">Source: '+e.source+"</p>":"")+"</div>",this.$(".data-container").append(dataDiv)},dataDrop:function(t,n){var r=n.draggable;app.saveNewMapLayer(r.attr("data-id")),e(n.draggable).css("display","none")},closeButtonClicked:function(){this.remove()},remove:function(){var t=this;e(t.el).animate({left:-350},400,"easeOutQuad",function(){return e("#dropZone").remove(),app.dataLibraryVisible=!1,e(window).unbind(),e(t.el).remove(),this})}});return o});
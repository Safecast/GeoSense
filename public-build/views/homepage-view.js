define(["jquery","underscore","backbone","config","utils","text!templates/homepage.html"],function(e,t,n,r,i,s){var o=n.View.extend({tagName:"div",className:"homepage",events:{"click #createMap":"createMapButtonClicked","click #nextMapSet":"nextMapSetClicked"},initialize:function(e){this.template=t.template(s),this.fetchFeaturedMaps(),this.featuredMaps=[],this.featuredMapSet=0,this.numberOfMapsDisplay=5},render:function(){return e(this.el).html(this.template()),this},fetchFeaturedMaps:function(){var t=this;e.ajax({type:"GET",url:"/api/maps/featured",success:function(e){for(var n=0;n<e.length;n++){var r=genMapURL(e[n]);t.featuredMaps.push("<tr><td>"+e[n].title+'</td><td><a target="_self" href="'+r+'">'+r+"</a></td><tr>")}app.setUIReady(),t.showRecentMaps()},error:function(){app.setUIReady(),console.error("failed to fetch unique map")}})},showRecentMaps:function(){this.featuredMapSet+this.numberOfMapsDisplay>=this.featuredMaps.length&&this.$("#nextMapSet").fadeOut("fast");var e=this;e.$("#mapTable").fadeOut("fast",function(){e.$("#mapTable").empty();for(var t=e.featuredMapSet;t<e.numberOfMapsDisplay+e.featuredMapSet;t++)e.$("#mapTable").append(e.featuredMaps[t]);e.$("#mapTable").fadeIn("fast")})},nextMapSetClicked:function(){this.featuredMapSet+=this.numberOfMapsDisplay,this.showRecentMaps()},createMapButtonClicked:function(){var t=this,n={title:this.$("#appendedPrependedInput").val()};!n.title||n.title==""?this.$("#errorMessage").show():(console.log("creating map",n),e.ajax({type:"POST",url:"/api/map",data:n,success:function(e){window.location.href="/admin/"+e.publicslug+"/setup"},error:function(){console.error("failed to create a new map")}}))}});return o});
define(["jquery","underscore","backbone","config","utils","text!templates/layers-panel.html","views/panel-view-base"],function(e,t,n,r,i,s,o){var u=o.extend({className:"panel panel-draggable layer-panel",events:{},initialize:function(e){u.__super__.initialize.call(this,e),this.template=t.template(s),this.sortableItemsSelector=".map-layer",this.sortableHandleSelector=".drag-handle"},render:function(){return u.__super__.render.call(this),this.initSortable(),this},getSortableItemIndex:function(e){return this.$(this.sortableItemsSelector).index(e)},initSortable:function(){var t=this;this.layerSortable=this.$(".panel-body").sortable({items:this.sortableItemsSelector,handle:this.sortableHandleSelector,start:function(n,r){e(r.item).data("previousIndex",t.getSortableItemIndex(r.item))},stop:function(n,r){e(r.item).data("previousIndex")!=t.getSortableItemIndex(r.item)&&t.layerMoved(n,r)}})},layerMoved:function(t,n){var r=app.getMapLayer(e(n.item).attr("data-id"));r.set({position:this.getSortableItemIndex(n.item)},{silent:!1}),app.isMapAdmin()&&r.save()}});return u});
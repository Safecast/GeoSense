define(["jquery","underscore","backbone","config","utils","permissions","text!templates/user-maps.html","views/map-list-view-base"],function(e,t,n,r,i,s,o,u){var a=n.View.extend({tagName:"tr",events:{},initialize:function(e){this.template=t.template(e.templateHtml),this.listenTo(this.model,"sync",this.populateFromModel)},sharingToggleClicked:function(t){return this.$(".sharing-status").attr("disabled",!0),this.model.save({sharing:e(t.currentTarget).attr("data-value")},{patch:!0}),this.hidePopovers(),!1},hidePopovers:function(){this.superView.$el.parent().find(".sharing-status").popover("hide"),this.superView.$el.parent().find(".popover").remove()},setSuperView:function(e){this.superView=e},render:function(){return this.$el.html(this.template()),this.populateFromModel(),this},populateFromModel:function(){var t=this,n=this.$el,r=this.model.publicUrl();e(".map-title",n).text(this.model.attributes.title),e(".map-created-at",n).text(moment(this.model.attributes.createdAt).format(locale.formats.DATE_SHORT)),e(".admin-link",n).attr("href",this.model.adminUrl()),e(".map-link",n).attr("href",r),this.model.attributes.previewImage?e(".preview-image",n).attr("src",this.model.attributes.previewImage):e(".preview-image-container",n).hide(),e(".has-tooltip",n).tooltip();if(!s.canAdminModel(this.model))this.$(".admin-control").remove();else{var i,o;switch(this.model.attributes.sharing){case SharingType.PRIVATE:this.$(".is-public").hide(),this.$(".is-private").show(),i=__("This map is private."),o='<p class="micro">'+__("You are the only one who can edit it, but people with the secret link can view it.")+"</p>"+__('<a href="#" class="btn btn-warning btn-sm sharing-toggle" data-value="'+SharingType.WORLD+'"><span class="glyphicon glyphicon-i"></span> Allow everybody to view this map</a>');break;case SharingType.WORLD:this.$(".is-private").hide(),this.$(".is-public").show(),i=__("This map is public."),o='<p class="micro">'+__("You are the only one who can edit it, but everyone can view it.")+"</p>"+__('<a href="#" class="btn btn-danger btn-sm sharing-toggle make-private" data-value="'+SharingType.PRIVATE+'""><span class="glyphicon glyphicon-lock"></span> Make this map private</a>')}var u=this.$(".sharing-status");u.popover("destroy").attr("disabled",!1).popover({animation:!1,content:o,html:o,title:i,placement:function(){return e(window).innerWidth()-t.superView.$el.outerWidth()<300?"left":"right"}}).on("show.bs.popover",function(e){t.hidePopovers()}).on("shown.bs.popover",function(n){e(".sharing-toggle").click(function(e){return t.sharingToggleClicked(e)}),n.stopPropagation()})}}}),f=u.extend({initialize:function(e){this.template=t.template(o),this.mapType="user"},render:function(){return f.__super__.render.apply(this,arguments),this.itemTemplateHtml=this.$(".element-template").remove().clone().removeClass("element-template").html(),this},createSubView:function(e){return new a(t.extend({templateHtml:this.itemTemplateHtml},e))}});return f});
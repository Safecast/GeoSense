define(["jquery","underscore","backbone","config","utils","text!templates/data-detail.html","views/panel-view-base"],function(e,t,n,r,i,s,o){var u=o.extend({className:"panel data-detail",events:{},initialize:function(e){u.__super__.initialize.call(this,e),this.template=t.template(s)},setModel:function(e){this.model&&this.stopListening(this.model),this.model=e,this.populateFromModel(),this.listenTo(e.collection.mapLayer,"toggle:valFormatter",this.populateFromModel)},populateFromModel:function(){var t=this.model,n=this.compileDetailDataForModel(t)||{data:{},metadata:{}},r=this.$(".panel-body"),i=function(e){return e.label&&e.value!=null?'<tr><th class="value-label">'+e.label+'</th><td class="value">'+e.value+"</td></tr>":e.label?'<tr><td colspan="2" class="value-label single"><h5 class="box">'+e.label+"</h5></td></tr>":e.value!=undefined?'<tr><td colspan="2" class="value single">'+e.value+"</td></tr>":e.body!=undefined?'<tr><td colspan="2" class="body"><div class="meta box">'+e.body+"</div></td></tr>":""},s=e(".detail-data",r),o="";for(var u=0;u<n.data.length;u++)o+=i(n.data[u]);s.html(o),s.toggle(o!="");var s=e(".detail-metadata",r),o="";for(var u=0;u<n.metadata.length;u++)o+=i(n.metadata[u]);s.html(o),s.toggle(o!="")},compileDetailDataForModel:function(e){if(!e.collection)return;var t=e.collection.mapLayer,n=t.pointCollection,r=t.getLayerOptions(),i=t.getValFormatter(),s=e.get("val"),o=e.get("altVal"),u=e.get("label"),a=e.get("datetime"),f=e.get("count"),l=e.get("description"),l=l?typeof l=="object"?l.min:l:null,c,h;this.$(".model-title").text(t.getDisplay("title"));if(a){var p=typeof a=="object"?a.max:a,d=typeof a=="object"?a.min:a;c=p?(new Date(p)).format(r.datetimeFormat||locale.formats.DATE_SHORT):null,h=d?(new Date(d)).format(r.datetimeFormat||locale.formats.DATE_SHORT):null}var v=[];if(h)var m=h!=c?__("%(minDate)sâ€“%(maxDate)s",{minDate:h,maxDate:c}):h;else var m="";u?v.push({label:u.min+"<br />"+m}):v.push({label:m}),t.isNumeric()&&v.push({label:i.unit,value:i.format(typeof s=="object"?s.avg:s)}),l&&l.length&&v.push({body:l});var g=t.attributes.pointCollection.reduce?[{label:__("no. of ")+(r.itemTitlePlural||"samples"),value:formatLargeNumber(f)}]:[];return f>1&&(g=g.concat([{label:__("peak",{unit:i.unit}),value:i.format(s.max)},{label:__("minimum",{unit:i.unit}),value:i.format(s.min)},{label:__("average",{unit:i.unit}),value:i.format(s.avg)}])),{data:v,metadata:g}}});return u});
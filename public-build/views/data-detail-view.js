define(["jquery","underscore","backbone","config","utils","text!templates/data-detail.html","views/panel-view-base"],function(e,t,n,r,i,s,o){var u=o.extend({className:"panel data-detail",events:{},initialize:function(e){u.__super__.initialize.call(this,e),this.template=t.template(s)},setModel:function(e){this.model&&this.stopListening(this.model),this.model=e,this.populateFromModel(),this.listenTo(e.collection.mapLayer,"toggle:valFormatter",this.populateFromModel)},populateFromModel:function(){var t=this.model,n=this.compileDetailDataForModel(t)||{data:{},metadata:{}},r=this.$(".panel-body"),i=function(e){return e.label&&e.value!=null?'<tr><th class="value-label">'+e.label+'</th><td class="value">'+e.value+"</td></tr>":e.label?'<tr><td colspan="2" class="value-label single"><h5 class="box">'+e.label+"</h5></td></tr>":e.value!=undefined?'<tr><td colspan="2" class="value single">'+e.value+"</td></tr>":e.body!=undefined?'<tr><td colspan="2" class="body"><div class="meta box">'+e.body+"</div></td></tr>":""},s=e(".detail-data",r),o="";for(var u=0;u<n.data.length;u++)o+=i(n.data[u]);s.html(o),s.toggle(o!="");var s=e(".detail-metadata",r),o="";for(var u=0;u<n.metadata.length;u++)o+=i(n.metadata[u]);s.html(o),s.toggle(o!="")},compileDetailDataForModel:function(e){if(!e.collection)return;var t=e.collection.mapLayer,n=t.pointCollection,r=t.getLayerOptions(),i=t.getValFormatter(),s=e.get("val"),o=s&&s.avg!=null,u=e.get("altVal"),a=e.get("label"),f=e.get("datetime"),l=e.get("count"),c=e.get("description"),c=c?o?c.min:c:null,h,p;this.$(".model-title").text(t.getDisplay("title"));if(f){var d=o?f.max:f,v=o?f.min:f;h=d?(new Date(d)).format(r.datetimeFormat||locale.formats.DATE_SHORT):null,p=v?(new Date(v)).format(r.datetimeFormat||locale.formats.DATE_SHORT):null}var m=[];if(p)var g=p!=h?__("%(minDate)sâ€“%(maxDate)s",{minDate:p,maxDate:h}):p;else var g="";a?m.push({label:a.min+"<br />"+g}):m.push({label:g}),t.isNumeric()&&m.push({label:i.unit,value:i.format(o?s.avg:s)}),c&&c.length&&m.push({body:c});var y=t.attributes.pointCollection.reduce?[{label:__("no. of ")+(r.itemTitlePlural||"samples"),value:formatLargeNumber(l)}]:[];return l>1&&(y=y.concat([{label:__("peak",{unit:i.unit}),value:i.format(s.max)},{label:__("minimum",{unit:i.unit}),value:i.format(s.min)},{label:__("average",{unit:i.unit}),value:i.format(s.avg)}])),{data:m,metadata:y}}});return u});
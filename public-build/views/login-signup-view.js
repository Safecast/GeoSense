define(["jquery","underscore","backbone","config","utils","permissions","views/modal-view"],function(e,t,n,r,i,s,o){var u=o.extend({className:"modal fade modal-inverse login-signup",events:{"click .modal-body a":"linkClicked","submit .modal-body form":"formSubmitted"},initialize:function(){u.__super__.initialize.apply(this,arguments),this.startUrl=BASE_URL+"signup"},showSignup:function(){this.render().getPage(BASE_URL+"signup"),this.show()},showLogin:function(){this.render().getPage(BASE_URL+"login"),this.show()},render:function(){var e=this;return u.__super__.render.apply(this,arguments),this.$el.on("shown.bs.modal",function(){e.focusFirstInput()}),this},getPage:function(t){var n=this;e.get(t,function(e){n.renderBody(e)})},focusFirstInput:function(){var e=this.$("input");e.length&&e[0].focus()},renderBody:function(t){var n=e(t);this.setTitle(n.find("h2").remove().text()),this.$(".modal-body").html(n),this.focusFirstInput()},linkClicked:function(t){return this.getPage(e(t.currentTarget).attr("href")),!1},formSubmitted:function(t){var n=this,r=e(t.currentTarget),i=e[r.attr("method").toLowerCase()],o={};return this.$(".modal-body input").each(function(){o[e(this).attr("name")]=e(this).val()}),i(r.attr("action"),o,function(e){if(typeof e=="object"&&e._id){s.setUser(e),n.close();return}n.renderBody(e)}),!1}});return u});
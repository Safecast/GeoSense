define(["jquery","underscore","backbone","config","utils","text!templates/header.html"],function(e,t,n,r,i,s){var o=n.View.extend({tagName:"div",className:"header-view",events:{"click #aboutMap":"aboutMapClicked","click #aboutGeoSense":"aboutGeoSenseClicked","click #shareLink":"shareLinkClicked","click #postFacebook":"postFacebookClicked","click #postTwitter":"postTwitterClicked","click #setupButton":"setupButtonClicked","click #graphButton":"graphButtonClicked","click #mapView a":"mapViewToggleClicked","click #viewBase .dropdown-menu a":"viewBaseToggleClicked","click #viewStyle .dropdown-menu a":"viewStyleToggleClicked","keypress input":"keyEvent"},initialize:function(e){this.template=t.template(s),this.vent=e.vent,this.mapInfo=e.mapInfo,t.bindAll(this,"setStateType"),this.vent.bind("setStateType",this.setStateType),t.bindAll(this,"updateMapInfo"),e.vent.bind("updateMapInfo",this.updateMapInfo)},render:function(){return e(this.el).html(this.template()),this.updateMapInfo(),app.isMapAdmin()||(this.$("#setupButton").remove(),this.$("#graphButton").css("right",270)),this},keyEvent:function(t){if(t.keyCode==13&&this.$("#search").is(":focus")){this.$("#search").blur();var n=e("#search").val();n!=""&&this.vent.trigger("geocodeAndSetMapLocation",n)}},updateMapInfo:function(e){e&&(this.mapInfo=e),this.$(".brand").attr("href",app.genPublicURL()),this.$(".brand").click(function(){return app.mapView.setVisibleMapArea(app.getDefaultVisibleMapArea()),!1}),this.mapInfo.linkURL?(this.$("#authorLink").show(),this.$("#authorLink a").attr("href",this.mapInfo.linkURL),this.$("#authorLink .text").text(this.mapInfo.linkTitle||this.mapInfo.title)):this.$("#authorLink").hide(),this.$(".brand").html("<h1>GeoSense</h1><h3>"+this.mapInfo.title+"</h3>")},mapViewToggleClicked:function(e){var t=e.currentTarget,n=t.href.split("#")[1];n!=app.mapViewName&&app.navigate(app.genMapURI(n),{trigger:!0}),e.preventDefault()},viewBaseToggleClicked:function(e){var t=e.currentTarget,n=t.href.split("#")[1];app.setViewBase(n),e.preventDefault()},viewStyleToggleClicked:function(e){var t=e.currentTarget,n=t.href.split("#")[1];app.setViewStyle(n),e.preventDefault()},graphButtonClicked:function(t){app.graphVisible==1?(app.graphVisible=!1,e(".graph-view").removeClass("visible"),e(".header-view .graph").removeClass("active")):(app.graphVisible=!0,e(".graph-view").addClass("visible"),e(".header-view .graph").addClass("active"),this.vent.trigger("drawGraph")),t.preventDefault()},setupButtonClicked:function(e){app.showSetupView(),e.preventDefault()},aboutGeoSenseClicked:function(e){app.showAbout(),e.preventDefault()},aboutMapClicked:function(e){app.showMapInfo(),e.preventDefault()},shareLinkClicked:function(e){app.showShareLink(),e.preventDefault()},postTwitterClicked:function(t){var n={},r=app.genPublicURL(!0);n.url=r,n.text=__("Check out the %(title)s map:",{url:r,title:this.mapInfo.title}),this.mapInfo.twitter&&(n.via=this.mapInfo.twitter);var r="https://twitter.com/share?"+e.param(n);window.open(r,__("Tweet this post"),"width=650,height=251,toolbar=0,scrollbars=0,status=0,resizable=0,location=0,menuBar=0"),t.preventDefault()},postFacebookClicked:function(e){var t="http://www.facebook.com/sharer.php?u=";t+=encodeURIComponent(app.genPublicURL(!0)),t+="&t="+encodeURIComponent(__("Check out the %(title)s map",{title:this.mapInfo.title})),window.open(""+t,__("Share it on Facebook"),"width=650,height=251,toolbar=0,scrollbars=0,status=0,resizable=0,location=0,menuBar=0"),e.preventDefault()},setStateType:function(e,t){var n=this.$("#stateIndicator"),r=this.$("#stateIndicatorMessage")},remove:function(){return e(window).unbind(),e(this.el).remove(),this}});return o});
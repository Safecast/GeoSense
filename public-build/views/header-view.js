define(["jquery","underscore","backbone","config","utils","text!templates/header.html"],function(e,t,n,r,i,s){var o=n.View.extend({tagName:"div",className:"header-view",events:{"click #aboutMap":"aboutMapClicked","click #aboutGeoSense":"aboutGeoSenseClicked","click #shareLink":"shareLinkClicked","click #postFacebook":"postFacebookClicked","click #postTwitter":"postTwitterClicked","click .map-tool.setup":"setupButtonClicked","click .map-tool.add-data":"addDataButtonClicked","click .map-tool.upload":"uploadButtonClicked","click .map-tool.timeline":"timelineButtonClicked","click #mapView a":"mapViewToggleClicked","click #viewBase .dropdown-menu a":"viewBaseToggleClicked","click #viewStyle .dropdown-menu a":"viewStyleToggleClicked","keypress input":"keyEvent"},initialize:function(e){this.template=t.template(s),this.vent=e.vent,this.listenTo(this.model,"sync",this.populateFromModel)},render:function(){e(this.el).html(this.template()),this.populateFromModel(),this.$(".search-query").click(function(){e(this).select()}),app.isMapAdmin()||this.$(".admin-tool").remove(),this.$(".base-options").click(function(e){e.stopPropagation()});var t=this.model.attributes.viewOptions||{},n=t.baselayerOpacity||1,r=t.backgroundColor,i=this.$(".baselayer-opacity .slider"),s=this.$("input[name=baselayerOpacity]");i.slider({min:0,max:1,range:"min",step:.025,value:n,slide:function(e,t){app.setViewOptions({baselayerOpacity:t.value}),s.val(t.value)}}),s.val(t.baselayerOpacity),s.change(function(){var t=parseFloat(e(this).val());if(isNaN(t)||t>1)t=1;t<0&&(t=0),e(this).val(t),i.slider("value",t),app.setViewOptions({baselayerOpacity:t})});var o=this.$("input[name=backgroundColor]");return r!=undefined&&e(o).miniColors("value",r),e(o).miniColors({change:function(e,t){app.setViewOptions({backgroundColor:e})}}),e(o).change(function(){app.setViewOptions({backgroundColor:e(this).val()})}),this},keyEvent:function(t){if(t.keyCode==13&&this.$("#search").is(":focus")){var n=e("#search").val();n!=""&&app.zoomToAddress(n)}},populateFromModel:function(){var t=this.model.attributes,n=e("<a>");n.text(t.title),n.attr("href",app.genPublicURL()),n.click(function(){return console.log(app.getDefaultVisibleMapArea()),app.mapView.setVisibleMapArea(app.getDefaultVisibleMapArea()),!1}),this.$(".brand h1").html(n),t.linkURL?(this.$("#authorLink").show(),this.$("#authorLink a").attr("href",t.linkURL),this.$("#authorLink .text").text(t.linkTitle||t.title)):this.$("#authorLink").hide()},mapViewToggleClicked:function(e){var t=e.currentTarget,n=t.href.split("#")[1];n!=app.mapViewName&&app.navigate(app.genMapURI(n),{trigger:!0}),e.preventDefault()},viewBaseToggleClicked:function(e){var t=e.currentTarget,n=t.href.split("#")[1];app.setViewBase(n),e.preventDefault()},viewStyleToggleClicked:function(e){var t=e.currentTarget,n=t.href.split("#")[1];app.setViewStyle(n),e.preventDefault()},timelineButtonClicked:function(e){e.preventDefault()},setupButtonClicked:function(e){app.showSetupView(),e.preventDefault()},addDataButtonClicked:function(e){app.toggleDataLibrary(),e.preventDefault()},uploadButtonClicked:function(e){app.toggleDataImport(),e.preventDefault()},aboutGeoSenseClicked:function(e){app.showAbout(),e.preventDefault()},aboutMapClicked:function(e){app.showMapInfo(),e.preventDefault()},shareLinkClicked:function(e){app.showShareLink(),e.preventDefault()},postTwitterClicked:function(t){var n=this.model.attributes,r={},i=app.genPublicURL(!0);r.url=i,r.text=__("Check out the %(title)s map:",{url:i,title:n.title}),n.twitter&&(r.via=n.twitter);var i="https://twitter.com/share?"+e.param(r);window.open(i,__("Tweet this post"),"width=650,height=251,toolbar=0,scrollbars=0,status=0,resizable=0,location=0,menuBar=0"),t.preventDefault()},postFacebookClicked:function(e){var t=this.model.attributes,n="http://www.facebook.com/sharer.php?u=";n+=encodeURIComponent(app.genPublicURL(!0)),n+="&t="+encodeURIComponent(__("Check out the %(title)s map",{title:t.title})),window.open(""+n,__("Share it on Facebook"),"width=650,height=251,toolbar=0,scrollbars=0,status=0,resizable=0,location=0,menuBar=0"),e.preventDefault()},remove:function(){return e(window).unbind(),e(this.el).remove(),this}});return o});
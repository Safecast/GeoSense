define(["jquery","underscore","backbone","config","utils","text!templates/header.html"],function(e,t,n,r,i,s){var o=n.View.extend({tagName:"div",className:"header-view",events:{"click #aboutMap":"aboutMapClicked","click #aboutGeoSense":"aboutGeoSenseClicked","click #shareLink":"shareLinkClicked","click #postFacebook":"postFacebookClicked","click #postTwitter":"postTwitterClicked","click .map-tool.setup":"setupButtonClicked","click .map-tool.add-data":"addDataButtonClicked","click .map-tool.upload":"uploadButtonClicked","click .map-tool.timeline":"timelineButtonClicked","click #mapView a":"mapViewToggleClicked","click #viewBase .dropdown-menu a":"viewBaseToggleClicked","click #viewStyle .dropdown-menu a":"viewStyleToggleClicked","keypress input":"keyEvent"},initialize:function(e){this.template=t.template(s),this.vent=e.vent,this.listenTo(this.model,"sync",this.populateFromModel)},render:function(){return e(this.el).html(this.template()),this.populateFromModel(),app.isMapAdmin()||this.$(".admin-tool").remove(),this},keyEvent:function(t){if(t.keyCode==13&&this.$("#search").is(":focus")){this.$("#search").blur();var n=e("#search").val();n!=""&&this.vent.trigger("geocodeAndSetMapLocation",n)}},populateFromModel:function(){var e=this.model.attributes;this.$(".brand").attr("href",app.genPublicURL()),this.$(".brand").click(function(){return app.mapView.setVisibleMapArea(app.getDefaultVisibleMapArea()),!1}),e.linkURL?(this.$("#authorLink").show(),this.$("#authorLink a").attr("href",e.linkURL),this.$("#authorLink .text").text(e.linkTitle||e.title)):this.$("#authorLink").hide(),this.$(".brand").html("<h1>GeoSense</h1><h3>"+e.title+"</h3>")},mapViewToggleClicked:function(e){var t=e.currentTarget,n=t.href.split("#")[1];n!=app.mapViewName&&app.navigate(app.genMapURI(n),{trigger:!0}),e.preventDefault()},viewBaseToggleClicked:function(e){var t=e.currentTarget,n=t.href.split("#")[1];app.setViewBase(n),e.preventDefault()},viewStyleToggleClicked:function(e){var t=e.currentTarget,n=t.href.split("#")[1];app.setViewStyle(n),e.preventDefault()},timelineButtonClicked:function(e){e.preventDefault()},setupButtonClicked:function(e){app.showSetupView(),e.preventDefault()},addDataButtonClicked:function(e){app.toggleDataLibrary(),e.preventDefault()},uploadButtonClicked:function(e){app.toggleDataImport(),e.preventDefault()},aboutGeoSenseClicked:function(e){app.showAbout(),e.preventDefault()},aboutMapClicked:function(e){app.showMapInfo(),e.preventDefault()},shareLinkClicked:function(e){app.showShareLink(),e.preventDefault()},postTwitterClicked:function(t){var n=this.model.attributes,r={},i=app.genPublicURL(!0);r.url=i,r.text=__("Check out the %(title)s map:",{url:i,title:n.title}),n.twitter&&(r.via=n.twitter);var i="https://twitter.com/share?"+e.param(r);window.open(i,__("Tweet this post"),"width=650,height=251,toolbar=0,scrollbars=0,status=0,resizable=0,location=0,menuBar=0"),t.preventDefault()},postFacebookClicked:function(e){var t=this.model.attributes;url="http://www.facebook.com/sharer.php?u=",url+=encodeURIComponent(app.genPublicURL(!0)),url+="&t="+encodeURIComponent(__("Check out the %(title)s map",{title:t.title})),window.open(""+url,__("Share it on Facebook"),"width=650,height=251,toolbar=0,scrollbars=0,status=0,resizable=0,location=0,menuBar=0"),e.preventDefault()},setStateType:function(e,t){var n=this.$("#stateIndicator"),r=this.$("#stateIndicatorMessage")},remove:function(){return e(window).unbind(),e(this.el).remove(),this}});return o});
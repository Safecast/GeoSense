//     (c) 2010-2013 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

/**
 * @license RequireJS text 2.0.4 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

// moment.js
// version : 2.1.0
// author : Tim Wood
// license : MIT
// momentjs.com

/*!prev || !prev.length*/

/*! jQuery UI - v1.10.3 - 2013-08-26
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.position.js, jquery.ui.draggable.js, jquery.ui.droppable.js, jquery.ui.resizable.js, jquery.ui.selectable.js, jquery.ui.sortable.js, jquery.ui.slider.js, jquery.ui.effect.js, jquery.ui.effect-blind.js, jquery.ui.effect-bounce.js, jquery.ui.effect-clip.js, jquery.ui.effect-drop.js, jquery.ui.effect-explode.js, jquery.ui.effect-fade.js, jquery.ui.effect-fold.js, jquery.ui.effect-highlight.js, jquery.ui.effect-pulsate.js, jquery.ui.effect-scale.js, jquery.ui.effect-shake.js, jquery.ui.effect-slide.js, jquery.ui.effect-transfer.js
* Copyright 2013 jQuery Foundation and other contributors Licensed MIT */

/**
* bootstrap.js v3.0.0 by @fat and @mdo
* Copyright 2013 Twitter Inc.
* http://www.apache.org/licenses/LICENSE-2.0
*/

/*
 * jQuery Color Animations
 * Copyright 2007 John Resig
 * Released under the MIT and GPL licenses.
 */

/**
 *
 * Color picker
 * Author: Stefan Petre www.eyecon.ro
 *
 * Dual licensed under the MIT and GPL licenses
 *
 */

function formatLargeNumber(e){if(e>=1e6)e=Math.round(e/1e6*10)/10+"M";else if(e>5e3)e=Math.round(e/1e3)+"K";else if(e>1e3)return parseInt(e);return e}function formatDecimalNumber(e,t){if(e<10){t==null&&(t=2);var n=Math.pow(10,t);return Math.round(e*n)/n}return Math.round(e)}function autoFormatNumber(e){return e>1e3?formatLargeNumber(e):e%1!=0?formatDecimalNumber(e):e}function genQueryString(e,t){var n="";if(e instanceof Array)for(var r=0;r<e.length;r++)n+=(n!=""?"&":"")+t+"="+e[r];else for(var t in e)e[t]instanceof Array?n+=(n!=""?"&":"")+genQueryString(e[t],t):n+=(n!=""?"&":"")+t+"="+e[t];return n}function nl2p(e){return"<p>"+e.split(/(\s*\n\s*){2,}/).join("</p><p>")+"</p>"}function mathEval(exp){var reg=/(?:[a-z$_][a-z0-9$_]*)|(?:[;={}\[\]"'!&<>^\\?:])/ig,valid=!0,evalExp=exp.replace(reg,function(e){if(Math.hasOwnProperty(e))return"Math."+e;valid=!1});if(!valid){var msg="Invalid arithmetic expression: "+exp;console.error(msg);if(DEV)throw new Error(msg);return!1}try{return eval(evalExp)}catch(e){var msg="Eval error: "+evalExp;console.error(msg);if(DEV)throw e;return!1}}function ValFormatter(e){this.eq=e.eq,this.formatStr=e.formatStr,this.unit=e.unit}function __(e,t){var n=locale.strings[e]||e;return t?n.format(t):n}function zeroPad(e,t){return(new Array(e.length<t?t+1-e.length:0)).join("0")+e}function getRGBChannels(e){var t=colorToInt(e);return channels=[(t&16711680)>>16,(t&65280)>>8,t&255]}function rgb2int(e){return e[0]<<16^e[1]<<8^e[2]}function colorToInt(e){return typeof e=="string"?parseInt(e.replace("#","0x")):e}function intToColor(e){return"#"+zeroPad(e.toString(16),6)}function multRGB(e,t){var n=colorToInt(e),r=getRGBChannels(n);for(var i=r.length-1;i>=0;i--)r[i]=Math.min(255,Math.round(r[i]*t));return n=(r[0]<<16)+(r[1]<<8)+r[2],intToColor(n)}function rgb2hsb(e){var t,n,r,i,s,o,u=[e[0]/255,e[1]/255,e[2]/255];return t=Math.min(Math.min(u[0],u[1]),u[2]),o=Math.max(Math.max(u[0],u[1]),u[2]),t==o?new Array(0,0,o):(n=u[0]==t?u[1]-u[2]:u[1]==t?u[2]-u[0]:u[0]-u[1],r=u[0]==t?3:u[1]==t?5:1,i=Math.floor((r-n/(o-t))*60)%360,s=(o-t)/o,o=o,new Array(i,s,o))}function hsb2rgb(e){var t,n,r,i,s,o,u,a,f=[e[0],e[1],e[2]];return f[0]%=360,f[2]==0?new Array(0,0,0):(f[0]/=60,i=Math.floor(f[0]),s=f[0]-i,o=f[2]*(1-f[1]),u=f[2]*(1-f[1]*s),a=f[2]*(1-f[1]*(1-s)),i==0?(t=f[2],n=a,r=o):i==1?(t=u,n=f[2],r=o):i==2?(t=o,n=f[2],r=a):i==3?(t=o,n=u,r=f[2]):i==4?(t=a,n=o,r=f[2]):i==5&&(t=f[2],n=o,r=u),t=Math.floor(t*255),n=Math.floor(n*255),r=Math.floor(r*255),new Array(t,n,r))}function circleToGeoJSON(e,t,n,r,i,s){var o=[],u=2*Math.PI/r;for(var a=0;a<Math.PI*2;a+=u){var f=e.x+Math.cos(a)*t,l=e.y+Math.sin(a)*n;if(i&&s){var c=new OpenLayers.Geometry.Point(f,l);c.transform(i,s),f=c.x,l=c.y}o.push([f,l])}return o.push(o[0]),{type:"LineString",coordinates:o}}function maxWords(e,t){var n=e.split(" ");return n.length>t?n.splice(0,t).join(" ")+"…":e}(function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){return e instanceof x?e:this instanceof x?(this._wrapped=e,void 0):new x(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.4";var T=x.each=x.forEach=function(e,t,r){if(null!=e)if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;s>i;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return null==e?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);if(T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)}),!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}if(T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)}),!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){return t.call(n,e,i,s)?(r=e,!0):void 0}),r},x.filter=x.select=function(e,t,n){var r=[];return null==e?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return null==e?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){return(i=i&&t.call(r,e,s,o))?void 0:n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return null==e?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){return i||(i=t.call(r,e,s,o))?n:void 0}),!!i)};x.contains=x.include=function(e,t){return null==e?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?null:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-1/0;var r={computed:-1/0,value:-1/0};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return 1/0;var r={computed:1/0,value:1/0};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;r.computed>o&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(r>n||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t||x.identity);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=null==n?x.identity:k(n);for(var i=n.call(r,t),s=0,o=e.length;o>s;){var u=s+o>>>1;i>n.call(r,e[u])?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return null==e?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:u.call(e,0,t)},x.initial=function(e,t,n){return u.call(e,0,e.length-(null==t||n?1:t))},x.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,null==t||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){(t?r&&o[o.length-1]===n:x.contains(o,n))||(o.push(n),s.push(e[r]))}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){for(var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=Array(t),r=0;t>r;r++)n[r]=x.pluck(e,""+r);return n},x.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;i>r;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var i=r?n:e.length;i--;)if(e[i]===t)return i;return-1},x.range=function(e,t,n){1>=arguments.length&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=Array(r);r>i;)s[i++]=e,e+=n;return s},x.bind=function(e,t){if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));var n=u.call(arguments,2);return function(){return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);return 0===t.length&&(t=x.functions(e)),T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,0>=f?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return 0>=e?t():function(){return 1>--e?t.apply(this,arguments):void 0}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)null==e[n]&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var O=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==t+"";case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=n.length;s--;)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if("[object Array]"==i){if(o=e.length,u=o==t.length)for(;o--&&(u=O(e[o],t[o],n,r)););}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)&&(o++,!(u=x.has(t,c)&&O(e[c],t[c],n,r))))break;if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return O(e,t,[],[])},x.isEmpty=function(e){if(null==e)return!0;if(x.isArray(e)||x.isString(e))return 0===e.length;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&1===e.nodeType},x.isArray=w||function(e){return"[object Array]"==f.call(e)},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),"function"!=typeof /./&&(x.isFunction=function(e){return"function"==typeof e}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==f.call(e)},x.isNull=function(e){return null===e},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){for(var r=Array(e),i=0;e>i;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=x.invert(M.escape);var _={escape:RegExp("["+x.keys(M.escape).join("")+"]","g"),unescape:RegExp("("+x.keys(M.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return null==t?"":(""+t).replace(_[e],function(t){return M[e][t]})}}),x.result=function(e,t){if(null==e)return null;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),j.call(this,n.apply(x,e))}})};var D=0;x.uniqueId=function(e){var t=++D+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=RegExp([(n.escape||P).source,(n.interpolate||P).source,(n.evaluate||P).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(B,function(e){return"\\"+H[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var j=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],j.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return j.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this),define("underscore",function(e){return function(){var t,n;return t||e._}}(this)),function(){var e=this,t=e.Backbone,n=[],r=n.push,i=n.slice,s=n.splice,o;typeof exports!="undefined"?o=exports:o=e.Backbone={},o.VERSION="0.9.10";var u=e._;!u&&typeof require!="undefined"&&(u=require("underscore")),o.$=e.jQuery||e.Zepto||e.ender,o.noConflict=function(){return e.Backbone=t,this},o.emulateHTTP=!1,o.emulateJSON=!1;var a=/\s+/,f=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(a.test(n)){var s=n.split(a);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},l=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t)}},c=o.Events={on:function(e,t,n){if(!f(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!f(this,"once",e,[t,n])||!t)return this;var r=this,i=u.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n)},off:function(e,t,n){var r,i,s,o,a,l,c,h;if(!this._events||!f(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;o=e?[e]:u.keys(this._events);for(a=0,l=o.length;a<l;a++){e=o[a];if(s=this._events[e]){this._events[e]=r=[];if(t||n)for(c=0,h=s.length;c<h;c++)i=s[c],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&r.push(i);r.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=i.call(arguments,1);if(!f(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&l(n,t),r&&l(r,arguments),this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return this;var i=!t&&!n;typeof t=="object"&&(n=this),e&&((r={})[e._listenerId]=e);for(var s in r)r[s].off(t,n,this),i&&delete this._listeners[s];return this}},h={listenTo:"on",listenToOnce:"once"};u.each(h,function(e,t){c[t]=function(t,n,r){var i=this._listeners||(this._listeners={}),s=t._listenerId||(t._listenerId=u.uniqueId("l"));return i[s]=t,typeof n=="object"&&(r=this),t[e](n,r,this),this}}),c.bind=c.on,c.unbind=c.off,u.extend(o,c);var p=o.Model=function(e,t){var n,r=e||{};this.cid=u.uniqueId("c"),this.attributes={},t&&t.collection&&(this.collection=t.collection),t&&t.parse&&(r=this.parse(r,t)||{});if(n=u.result(this,"defaults"))r=u.defaults({},r,n);this.set(r,t),this.changed={},this.initialize.apply(this,arguments)};u.extend(p.prototype,c,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return u.clone(this.attributes)},sync:function(){return o.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return u.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,i,s,o,a,f,l;if(e==null)return this;typeof e=="object"?(i=e,n=t):(i={})[e]=t,n||(n={});if(!this._validate(i,n))return!1;s=n.unset,o=[],a=this._changing,this._changing=!0,a||(this._previousAttributes=u.clone(this.attributes),this.changed={}),l=this.attributes,f=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(r in i)t=i[r],u.isEqual(l[r],t)||o.push(r),u.isEqual(f[r],t)?delete this.changed[r]:this.changed[r]=t,s?delete l[r]:l[r]=t;o.length&&(this._pending=!0);for(var c=0,h=o.length;c<h;c++)this.trigger("change:"+o[c],this,l[o[c]],n);if(a)return this;while(this._pending)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,u.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,u.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!u.isEmpty(this.changed):u.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?u.clone(this.changed):!1;var t,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var i in e){if(u.isEqual(r[i],t=e[i]))continue;(n||(n={}))[i]=t}return n},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return u.clone(this._previousAttributes)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r){if(!t.set(t.parse(r,e),e))return!1;n&&n(t,r,e),t.trigger("sync",t,r,e)},D(this,e),this.sync("read",this,e)},save:function(e,t,n){var r,i,s,o=this.attributes;e==null||typeof e=="object"?(r=e,n=t):(r={})[e]=t;if(r&&(!n||!n.wait)&&!this.set(r,n))return!1;n=u.extend({validate:!0},n);if(!this._validate(r,n))return!1;r&&n.wait&&(this.attributes=u.extend({},o,r)),n.parse===void 0&&(n.parse=!0);var a=this,f=n.success;return n.success=function(e){a.attributes=o;var t=a.parse(e,n);n.wait&&(t=u.extend(r||{},t));if(u.isObject(t)&&!a.set(t,n))return!1;f&&f(a,e,n),a.trigger("sync",a,e,n)},D(this,n),i=this.isNew()?"create":n.patch?"patch":"update",i==="patch"&&(n.attrs=r),s=this.sync(i,this,n),r&&n.wait&&(this.attributes=o),s},destroy:function(e){e=e?u.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(i){(e.wait||t.isNew())&&r(),n&&n(t,i,e),t.isNew()||t.trigger("sync",t,i,e)};if(this.isNew())return e.success(),!1;D(this,e);var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=u.result(this,"urlRoot")||u.result(this.collection,"url")||_();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(e){return!this.validate||!this.validate(this.attributes,e)},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=u.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,t||{}),!1):!0}});var d=o.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,u.extend({silent:!0},t))};u.extend(d.prototype,c,{model:p,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return o.sync.apply(this,arguments)},add:function(e,t){e=u.isArray(e)?e.slice():[e],t||(t={});var n,i,o,a,f,l,c,h,p,d;c=[],h=t.at,p=this.comparator&&h==null&&t.sort!==!1,d=u.isString(this.comparator)?this.comparator:null;var v={};for(n=0,i=e.length;n<i;n++){if(!(o=this._prepareModel(a=e[n],t)))continue;if(f=this.get(o)){v[f.cid]=!0,t.merge&&(f.set(a===o?o.attributes:a,t),p&&!l&&f.hasChanged(d)&&(l=!0));continue}if(t.add===!1)continue;c.push(o),o.on("all",this._onModelEvent,this),this._byId[o.cid]=o,o.id!=null&&(this._byId[o.id]=o)}if(t.remove){var m=[];for(n=0,i=this.length;n<i;++n)v[(o=this.models[n]).cid]||m.push(o);m.length&&this.remove(m,t)}c.length&&(p&&(l=!0),this.length+=c.length,h!=null?s.apply(this.models,[h,0].concat(c)):r.apply(this.models,c)),l&&this.sort({silent:!0});if(t.silent)return this;for(n=0,i=c.length;n<i;n++)(o=c[n]).trigger("add",o,this,t);return l&&this.trigger("sort",this,t),this},remove:function(e,t){e=u.isArray(e)?e.slice():[e],t||(t={});var n,r,i,s;for(n=0,r=e.length;n<r;n++){s=this.get(e[n]);if(!s)continue;delete this._byId[s.id],delete this._byId[s.cid],i=this.indexOf(s),this.models.splice(i,1),this.length--,t.silent||(t.index=i,s.trigger("remove",s,this,t)),this._removeReference(s)}return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e.cid||e]},at:function(e){return this.models[e]},where:function(e,t){return u.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),u.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(u.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return u.invoke(this.models,"get",e)},update:function(e,t){return t=u.extend({merge:!0,remove:!0},t),t.parse&&(e=this.parse(e,t)),this.add(e,t),this},reset:function(e,t){t=t?u.clone(t):{},t.parse&&(e=this.parse(e,t));for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),e&&this.add(e,u.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,n=this;return e.success=function(r){var i=e.update?"update":"reset";n[i](r,e),t&&t(n,r,e),n.trigger("sync",n,r,e)},D(this,e),this.sync("read",this,e)},create:function(e,t){t=t?u.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(i){t.wait&&n.add(e,t),r&&r(e,i,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof p)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:(this.trigger("invalid",this,e,t),!1)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)},sortedIndex:function(e,t,n){t||(t=this.comparator);var r=u.isFunction(t)?t:function(e){return e.get(t)};return u.sortedIndex(this.models,e,r,n)}});var v=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];u.each(v,function(e){d.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.models),u[e].apply(u,t)}});var m=["groupBy","countBy","sortBy"];u.each(m,function(e){d.prototype[e]=function(t,n){var r=u.isFunction(t)?t:function(e){return e.get(t)};return u[e](this.models,r,n)}});var g=o.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},y=/\((.*?)\)/g,b=/(\(\?)?:\w+/g,w=/\*\w+/g,E=/[\-{}\[\]+?.,\\\^$|#\s]/g;u.extend(g.prototype,c,{initialize:function(){},route:function(e,t,n){return u.isRegExp(e)||(e=this._routeToRegExp(e)),n||(n=this[t]),o.history.route(e,u.bind(function(r){var i=this._extractParameters(e,r);n&&n.apply(this,i),this.trigger.apply(this,["route:"+t].concat(i)),this.trigger("route",t,i),o.history.trigger("route",this,t,i)},this)),this},navigate:function(e,t){return o.history.navigate(e,t),this},_bindRoutes:function(){if(!this.routes)return;var e,t=u.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(E,"\\$&").replace(y,"(?:$1)?").replace(b,function(e,t){return t?e:"([^/]+)"}).replace(w,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var S=o.History=function(){this.handlers=[],u.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},x=/^[#\/]|\s+$/g,T=/^\/+|\/+$/g,N=/msie [\w.]+/,C=/\/$/;S.started=!1,u.extend(S.prototype,c,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(C,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(x,"")},start:function(e){if(S.started)throw new Error("Backbone.history has already been started");S.started=!0,this.options=u.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),n=document.documentMode,r=N.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);this.root=("/"+this.root+"/").replace(T,"/"),r&&this._wantsHashChange&&(this.iframe=o.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?o.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?o.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var i=this.location,s=i.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!s)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&s&&i.hash&&(this.fragment=this.getHash().replace(x,""),this.history.replaceState({},document.title,this.root+this.fragment+i.search));if(!this.options.silent)return this.loadUrl()},stop:function(){o.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),S.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=u.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return n},navigate:function(e,t){if(!S.started)return!1;if(!t||t===!0)t={trigger:t};e=this.getFragment(e||"");if(this.fragment===e)return;this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),o.history=new S;var k=o.View=function(e){this.cid=u.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},L=/^(\S+)\s*(.*)$/,A=["model","collection","el","id","attributes","className","tagName","events"];u.extend(k.prototype,c,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof o.$?e:o.$(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=u.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var n=e[t];u.isFunction(n)||(n=this[e[t]]);if(!n)throw new Error('Method "'+e[t]+'" does not exist');var r=t.match(L),i=r[1],s=r[2];n=u.bind(n,this),i+=".delegateEvents"+this.cid,s===""?this.$el.on(i,n):this.$el.on(i,s,n)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(e){this.options&&(e=u.extend({},u.result(this,"options"),e)),u.extend(this,u.pick(e,A)),this.options=e},_ensureElement:function(){if(!this.el){var e=u.extend({},u.result(this,"attributes"));this.id&&(e.id=u.result(this,"id")),this.className&&(e["class"]=u.result(this,"className"));var t=o.$("<"+u.result(this,"tagName")+">").attr(e);this.setElement(t,!1)}else this.setElement(u.result(this,"el"),!1)}});var O={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};o.sync=function(e,t,n){var r=O[e];u.defaults(n||(n={}),{emulateHTTP:o.emulateHTTP,emulateJSON:o.emulateJSON});var i={type:r,dataType:"json"};n.url||(i.url=u.result(t,"url")||_()),n.data==null&&t&&(e==="create"||e==="update"||e==="patch")&&(i.contentType="application/json",i.data=JSON.stringify(n.attrs||t.toJSON(n))),n.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=i.data?{model:i.data}:{});if(n.emulateHTTP&&(r==="PUT"||r==="DELETE"||r==="PATCH")){i.type="POST",n.emulateJSON&&(i.data._method=r);var s=n.beforeSend;n.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r);if(s)return s.apply(this,arguments)}}i.type!=="GET"&&!n.emulateJSON&&(i.processData=!1);var a=n.xhr=o.ajax(u.extend(i,n));return t.trigger("request",t,a,n),a},o.ajax=function(){return o.$.ajax.apply(o.$,arguments)};var M=function(e,t){var n=this,r;e&&u.has(e,"constructor")?r=e.constructor:r=function(){return n.apply(this,arguments)},u.extend(r,n,t);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,e&&u.extend(r.prototype,e),r.__super__=n.prototype,r};p.extend=d.extend=g.extend=k.extend=S.extend=M;var _=function(){throw new Error('A "url" property or function must be specified')},D=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}}}.call(this),define("backbone",["underscore","jquery"],function(e){return function(){var t,n;return t||e.Backbone}}(this));var IS_BROWSER=this.Document&&!0;IS_BROWSER&&define("config",[],function(){var e={MAP_VIEW_MODULES:["views/maps/openlayers-map-view"]};return e});var DEV=IS_BROWSER&&window.location.href.indexOf(":3000")!=-1,DEBUG=DEV,CLOUDMADE_KEY="0a77f5f7d290465f9fe419f4ee788c50",MapStatus={PRIVATE:"P",PUBLIC:"A"},NOTIFICATION_VISIBLE_TIME=2e3,SHOW_DETAIL_DATA_ON_MAP=!0,DEFAULT_COLOR_EDITOR_COLOR="#999999",DEFAULT_COLOR_EDITOR_POSITION="100%",COLOR_BAR_INVERT_CUTOFF=102,DataStatus={IMPORTING:"I",IMPORTING_INC:"II",UNREDUCED:"U",UNREDUCED_INC:"UI",REDUCING:"R",REDUCING_INC:"RI",COMPLETE:"C"},FeatureType={POINTS:"P",SQUARE_TILES:"ST",BUBBLES:"B",SHAPES:"S"};FeatureType.DEFAULT=FeatureType.POINTS;var LayerType={POINTS:"PL",SHAPES:"SL"},ColorType={SOLID:"S",LINEAR_GRADIENT:"L",PALETTE:"P"};ColorType.DEFAULT=ColorType.SOLID;var UnitFormat={LEGEND:"%(value)s"},SharingType={PRIVATE:"P",WORLD:"W"},GraphScope={OVERALL:"overall",CURRENT_VIEW:"current-view"};SharingType.DEFAULT=SharingType.PRIVATE;var COLOR_GRADIENT_STEP=null,highlightForColor=function(e){return multRGB(e,1.15)},strokeForColor=function(e){return multRGB(e,.75)},DEFAULT_FEATURE_OPACITY=.75,MIN_BUBBLE_SIZE=8,MAX_BUBBLE_SIZE=60,DEFAULT_POINT_RADIUS=7,DEFAULT_FEATURE_STROKE_WIDTH=1,CROP_DISTRIBUTION_RATIO=.1,DEFAULT_MAP_VIEW_BASE="gm",DEFAULT_MAP_STYLE="dark",DEFAULT_MAP_AREA={center:[0,0],zoom:0},MAP_NUM_ZOOM_LEVELS=20,INITIAL_POLL_INTERVAL=3e3,POLL_INTERVAL=6e3;if(!IS_BROWSER)module.exports={MapStatus:MapStatus,FeatureType:FeatureType,ColorType:ColorType,SharingType:SharingType};else if(!DEBUG||typeof console=="undefined"||typeof console.log=="undefined")var console={log:function(){},error:function(){}};define("text",["module"],function(e){var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,o=typeof location!="undefined"&&location.href,u=o&&location.protocol&&location.protocol.replace(/\:/,""),a=o&&location.hostname,f=o&&(location.port||undefined),l=[],c=e.config&&e.config()||{};t={version:"2.0.4",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:c.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,c.isBuild&&(l[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}c.isBuild=i.isBuild;var s=t.parseName(e),l=s.moduleName+(s.ext?"."+s.ext:""),h=n.toUrl(l),p=c.useXhr||t.useXhr;!o||p(h,u,a,f)?t.get(h,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([l],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(l.hasOwnProperty(n)){var s=t.jsEscape(l[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(c.env==="node"||!c.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("﻿")===0&&(r=r.substring(1)),t(r)};else if(c.env==="xhr"||!c.env&&t.createXhr())t.get=function(e,n,r){var i=t.createXhr();i.open("GET",e,!0),c.onXhr&&c.onXhr(i,e),i.onreadystatechange=function(t){var s,o;i.readyState===4&&(s=i.status,s>399&&s<600?(o=new Error(e+" HTTP status: "+s),o.xhr=i,r(o)):n(i.responseText))},i.send(null)};else if(c.env==="rhino"||!c.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};return t}),define("text!templates/notification-bubble.html",[],function(){return'<div class="message micro">Notification message</div>'}),define("views/notification-bubble-view",["jquery","underscore","backbone","config","text!templates/notification-bubble.html"],function(e,t,n,r,i){var s=["success","info","warn","error"],o=n.View.extend({events:{},levels:s,className:"notification-bubble",initialize:function(e){this.template=t.template(i)},render:function(){return e(this.el).html(this.template()),this},setLevel:function(e){var n=this;return t.each(this.levels,function(t){n.$el.toggleClass(t,e==t)}),this},setMessage:function(e){return this.$(".message").text(e),this},appear:function(e){var t=this;return this.$el.hide().fadeIn("fast",function(){(e||e==undefined)&&setTimeout(function(){t.disappear()},NOTIFICATION_VISIBLE_TIME)}),this},disappear:function(e){var t=this;return this.$el.fadeOut("fast",function(){(e||e==undefined)&&t.destroy()}),this},destroy:function(){this.remove(),this.unbind()},notify:function(t,n){this.render().setLevel(n).setMessage(t),e("body").append(this.appear().$el)}});return t.each(s,function(e){o[e]=function(t){(new o).notify(t,e)}}),o}),define("utils",["jquery","views/notification-bubble-view"],function(e,t){return{initAjaxErrorNotification:function(){e(document).ajaxError(function(n,r,i,s){var o="A network error occured. Please try again later.";if(r&&r.responseText&&r.responseText!=""){o=r.responseText;try{var u=e.parseJSON(r.responseText);u.message&&(o=u.message)}catch(a){}}else s&&s!=""&&(o=s);console.error(s),t.error(o)})}}});var getAttr=function(e,t){var n=function(e,t){if(!e)return undefined;var r=e[t.shift()];return t.length?n(r,t):r};return n(e,t.split("."))},setAttr=function(e,t,n){var r=function(e,t){if(t.length==1){e[t[0]]=n;return}var i=t.shift();e[i]==undefined&&(e[i]={}),r(e[i],t)};r(e,t.split("."))},expandObj=function(e){var t={};for(var n in e)setAttr(t,n,e[n]);return t};$.fn.uiToggle=function(e){var e=e||{},t=!0;e.duration==undefined&&(e.duration="fast");var n=this.each(function(){var n=this;$(this).slideToggle(e),t=t&&$._data(this,"fxshow")&&$._data(this,"fxshow").hidden});return!t&&e.show&&e.show(),e.activate&&$(e.activate).toggleClass(e.activeClass||"active",!t),n};var lpad=function(e,t,n){var r=new String(e);while(r.length<n)r=t+r;return r};ValFormatter.prototype.convert=function(e){var t=e;if(this.eq&&this.eq!=""){var n=this.eq.format({val:t});t=mathEval(n)}return t},ValFormatter.prototype.format=function(e){var t=this.convert(e);return this.formatStr?this.formatStr.format({val:t}):autoFormatNumber(t)},String.prototype.format=function(e){return this.replace(/\%\(([a-z0-9_]+)\)([sif])/ig,function(t,n,r){return typeof e[n]=="function"?e[n].apply(this):typeof e[n]!="undefined"?e[n]:t})},Array.isArray||(Array.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"}),define("permissions",[],function(){var e,t=function(){return e},n=function(t){e=t,app&&app.trigger(t?"user:login":"user:logout")},r=function(e,t){if(!e||!t)return!1;var n=e._id!=undefined?e._id:e,r=t._id!=undefined?t._id:t;return n.toString()==r.toString()},i=function(e){return r(t()||{},e.attributes.createdBy)};return{currentUser:t,sameUser:r,canAdminModel:i,setUser:n}}),define("text!templates/modal.html",[],function(){return'<div class="modal-dialog">\n  <div class="modal-content">\n      <div class="modal-header">\n          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n          <h4 class="modal-title"></h4>\n      </div>\n      <div class="modal-body">\n\n\n      </div>\n      <div class="modal-footer">\n          <button id="cancelButton" data-dismiss="modal" class="btn btn-default btn-cancel pull-right">Close</button>\n      </div>\n    </div><!-- /.modal-content -->\n</div><!-- /.modal-dialog -->\n'}),define("views/modal-view",["jquery","underscore","backbone","config","utils","text!templates/modal.html"],function(e,t,n,r,i,s){var o=n.View.extend({tagName:"div",className:"modal fade",events:{},initialize:function(e){this.template||(this.template=t.template(s)),this.modalOptions=t.extend({keyboard:!0,show:!1},e?e.modalOptions:{})},render:function(){return this.$el.html(this.template()).attr("tabindex",-1).modal(this.modalOptions),this},setTitle:function(e){this.$(".modal-title").html(e)},setBody:function(e){this.$(".modal-body").html(e)},show:function(){var t=this;e(this.el).modal("show"),e(this.el).on("hidden",function(){t.remove()})},close:function(){e(this.el).modal("hide")}});return o}),define("views/login-signup-view",["jquery","underscore","backbone","config","utils","permissions","views/modal-view"],function(e,t,n,r,i,s,o){var u=o.extend({className:"modal fade modal-inverse login-signup",events:{"click .modal-body a":"linkClicked","submit .modal-body form":"formSubmitted"},initialize:function(){u.__super__.initialize.apply(this,arguments),this.startUrl=BASE_URL+"signup"},showSignup:function(){this.render().getPage(BASE_URL+"signup"),this.show()},showLogin:function(){this.render().getPage(BASE_URL+"login"),this.show()},render:function(){var e=this;return u.__super__.render.apply(this,arguments),this.$el.on("shown.bs.modal",function(){e.focusFirstInput()}),this},getPage:function(t){var n=this;e.get(t,function(e){n.renderBody(e)})},focusFirstInput:function(){var e=this.$("input");e.length&&e[0].focus()},renderBody:function(t){var n=e(t);this.setTitle(n.find("h2").remove().text()),this.$(".modal-body").html(n),this.focusFirstInput()},linkClicked:function(t){return this.getPage(e(t.currentTarget).attr("href")),!1},formSubmitted:function(t){var n=this,r=e(t.currentTarget),i=e[r.attr("method").toLowerCase()],o={};return this.$(".modal-body input").each(function(){o[e(this).attr("name")]=e(this).val()}),i(r.attr("action"),o,function(e){if(typeof e=="object"&&e._id){s.setUser(e),n.close();return}n.renderBody(e)}),!1}});return u}),define("text!templates/header.html",[],function(){return'<header class="navbar navbar-inverse navbar-fixed-top bs-docs-nav" role="banner">\n\n  <!-- Brand and toggle get grouped for better mobile display -->\n  <div class="navbar-header">\n    <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">\n      <span class="sr-only">Toggle navigation</span>\n      <span class="icon-bar"></span>\n      <span class="icon-bar"></span>\n      <span class="icon-bar"></span>\n    </button>\n    <div class="navbar-brand">\n	    <a class="app-title" href="#"><span class="app-title">GeoSense</a> <a class="map-title"></a>\n	  </div>\n  </div>\n\n  <!-- Collect the nav links, forms, and other content for toggling -->\n  <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">\n    <ul class="nav navbar-nav">\n      <li class="dropdown">\n        <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>\n        <ul class="dropdown-menu">\n					<li id="aboutMap"><a href="#">About this map</a></li>\n					<li id="authorLink"><a href="#"><span class="text"></span> <span class="glyphicon glyphicon-chevron-right half-opacity" /></span></a></li>\n					<li class="divider"></li>\n					<li id="aboutGeoSense"><a href="#">About GeoSense</a></li>\n					<li><a href="http://www.media.mit.edu/" target="_blank">MIT Media Lab <span class="glyphicon glyphicon-chevron-right half-opacity" /></a></li>\n        </ul>\n      </li>\n      <li class="dropdown">\n        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Share <b class="caret"></b></a>\n        <ul class="dropdown-menu">\n					<li id="shareLink"><a href="#">Link or embed</a></li>\n					<li id="postTwitter"><a href="#">Post to Twitter</a></li>\n					<li id="postFacebook"><a href="#">Share on Facebook</a></li>\n        </ul>\n      </li>\n    </ul>\n		<ul id="mapView" class="nav navbar-nav">\n			<li class="map-view-toggle map">\n		    	<a href="#map">Map</a>\n		  	</li>\n		</ul>\n\n		<ul class="nav navbar-nav">\n			<li id="viewBase" class="dropdown">\n				<a href="#" class="dropdown-toggle" data-toggle="dropdown">Base: <span id="viewBaseCurrent"></span>	<b class="caret"></b></a>\n				<ul class="dropdown-menu">\n          <li>\n          	<ul class="base-choices"></ul>\n          </li>\n				</ul>\n			</li>\n      <li id="viewStyle" class="dropdown">\n        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Style: <span id="viewStyleCurrent"></span> <b class="caret"></b></a>\n        <ul class="dropdown-menu">\n          <li>\n            <ul id="viewStyleChoices" class="style-choices"></ul>\n          </li>\n          <li class="divider"></li>\n          <li><a id="customizeViewOptions" href="#">Customize…</a></li>\n        </ul>\n      </li>\n		</ul>\n\n    <ul class="nav navbar-nav navbar-right user-nav">\n      <li class="dropdown">\n        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-user"></span> <b class="caret"></b></a>\n        <ul class="dropdown-menu">\n          <li class="logged-in"><a href="#" disabled><strong class="user-name"></strong></a></li>\n          <li class="logged-in divider"></li>\n          <li class="logged-in"><a href="<%= BASE_URL %>dashboard" class="user-dashboard">Dashboard</a></li>\n          <li class=""><a href="#" class="public-map">Show public map</a></li>\n          <li class=""><a href="#" class="admin-map">Edit this map</a></li>\n          <li class="logged-in"><a href="<%= BASE_URL %>logout" class="user-logout">Log out</a></li>\n          <li class="logged-out"><a href="<%= BASE_URL %>signup" class="user-signup">Sign up</a></li>\n          <li class="logged-out"><a href="<%= BASE_URL %>login" class="user-login">Log in</a></li>\n        </ul>\n      </li>\n    </ul>\n\n    <form class="navbar-form navbar-right search-form" role="search">\n      <div class="input-group">\n        <input type="text" class="form-control search-query" placeholder="Search address">\n        <span class="input-group-btn">\n          <button type="submit" class="btn btn-inverse"><span class="glyphicon glyphicon-search" /></button>\n        </span>\n      </div>\n    </form>\n\n    <form class="nav navbar-form navbar-right admin-tools">\n			<button type="submit" class="btn btn-inverse admin-tool map-tool setup"><span class="glyphicon glyphicon-cog"></span><span class="caption"> Setup</span></button>\n			<button type="submit" class="btn btn-inverse admin-tool map-tool data-import"><span class="glyphicon glyphicon-cloud-upload"></span><span class="caption"> Import</span></button>\n			<button type="submit" class="btn btn-inverse admin-tool map-tool data-library"><span class="glyphicon glyphicon-th-list"></span><span class="caption"> Library</span></button>\n    </form>\n\n  </nav><!-- /.navbar-collapse -->\n</header>\n'}),define("views/header-view",["jquery","underscore","backbone","config","utils","permissions","text!templates/header.html"],function(e,t,n,r,i,s,o){var u=n.View.extend({tagName:"div",className:"header-view",events:{"click #aboutMap":"aboutMapClicked","click #aboutGeoSense":"aboutGeoSenseClicked","click #shareLink":"shareLinkClicked","click #postFacebook":"postFacebookClicked","click #postTwitter":"postTwitterClicked","click .map-tool.setup":"setupButtonClicked","click .map-tool.data-library":"dataLibraryButtonClicked","click .map-tool.data-import":"dataImportButtonClicked","click .map-tool.timeline":"timelineButtonClicked","click #mapView a":"mapViewToggleClicked","click #viewBase .dropdown-menu a":"viewBaseToggleClicked","click .view-style a":"viewStyleToggleClicked","click #customizeViewOptions":"customizeViewOptionsClicked","click .search-form button":"searchClicked","click .map-title":"mapTitleClicked","click .user-signup":"userSignupClicked","click .user-login":"userLoginClicked","click .user-logout":"userLogoutClicked"},initialize:function(e){this.template=t.template(o),this.listenTo(this.model,"sync",this.populateFromModel),this.listenTo(app,"user:login",this.populateFromModel),this.listenTo(app,"user:logout",this.populateFromModel)},render:function(){return e(this.el).html(this.template({config:{BASE_URL:BASE_URL}})),this.populateFromModel(),this.$(".search-query").click(function(){e(this).select()}),app.isMapAdmin()||this.$(".admin-tool").remove(),this.updateUser(),this.$(".nav").each(function(){e("li, button",this).length==0&&e(this).remove()}),this},updateUser:function(){var e=s.currentUser();e?(this.$(".user-name").text(e.email),this.$(".logged-out").addClass("hidden"),this.$(".logged-in").removeClass("hidden")):(this.$(".logged-in").addClass("hidden"),this.$(".logged-out").removeClass("hidden"))},searchClicked:function(e){var t=this.$(".search-query").val();return t!=""&&app.zoomToAddress(t),!1},mapTitleClicked:function(e){return app.resetMap(),!1},populateFromModel:function(){var e=this.$(".app-title"),t=this.model.attributes,n=this.$(".map-title"),r=app.isMapAdmin()?app.map.adminUrl():app.map.publicUrl();e.attr("href",BASE_URL),n.text(t.title),n.attr("href",r),t.linkURL?(this.$("#authorLink").show(),this.$("#authorLink a").attr("href",t.linkURL),this.$("#authorLink .text").text(t.linkTitle||t.title)):this.$("#authorLink").hide(),this.$("a.admin-map").attr("href",this.model.adminUrl()).parent().toggleClass("hidden",app.isMapAdmin()||!s.canAdminModel(this.model)&&this.model.attributes.createdBy!=undefined),this.$("a.public-map").attr("href",this.model.publicUrl()).parent().toggleClass("hidden",!app.isMapAdmin())},mapViewToggleClicked:function(e){var t=e.currentTarget,n=t.href.split("#")[1];n!=app.mapViewName&&app.navigate(app.map.publicUri({viewName:n}),{trigger:!0}),e.preventDefault()},viewBaseToggleClicked:function(e){var t=e.currentTarget,n=t.href.split("#")[1];app.setViewBase(n),e.preventDefault()},viewStyleToggleClicked:function(e){var t=e.currentTarget,n=t.href.split("#")[1];app.setViewStyle(n),e.preventDefault()},customizeViewOptionsClicked:function(e){app.showBaselayerEditor(),e.preventDefault()},timelineButtonClicked:function(e){e.preventDefault()},setupButtonClicked:function(e){app.showSetupView(),e.preventDefault()},dataImportButtonClicked:function(e){app.toggleDataImport(),e.preventDefault()},dataLibraryButtonClicked:function(e){app.toggleDataLibrary(),e.preventDefault()},aboutGeoSenseClicked:function(e){app.showAbout(),e.preventDefault()},aboutMapClicked:function(e){app.showMapInfo(),e.preventDefault()},shareLinkClicked:function(e){app.showShareLink(),e.preventDefault()},postTwitterClicked:function(t){var n=this.model.attributes,r={},i=app.map.publicUrl(!0);r.url=i,r.text=__("Check out the %(title)s map:",{url:i,title:n.title}),n.twitter&&(r.via=n.twitter);var i="https://twitter.com/share?"+e.param(r);window.open(i,__("Tweet this post"),"width=650,height=251,toolbar=0,scrollbars=0,status=0,resizable=0,location=0,menuBar=0"),t.preventDefault()},postFacebookClicked:function(e){var t=this.model.attributes,n="http://www.facebook.com/sharer.php?u=";n+=encodeURIComponent(window.location.href),n+="&t="+encodeURIComponent(__("Check out the %(title)s map",{title:t.title})),window.open(""+n,__("Share it on Facebook"),"width=650,height=251,toolbar=0,scrollbars=0,status=0,resizable=0,location=0,menuBar=0"),e.preventDefault()},userSignupClicked:function(e){app.showSignup(),e.preventDefault()},userLoginClicked:function(e){app.showLogin(),e.preventDefault()},userLogoutClicked:function(t){return window.location.href=e(t.currentTarget).attr("href")+"?next="+this.model.publicUrl(),t.preventDefault()}});return u}),define("text!templates/setup.html",[],function(){return'<div class="modal-dialog">\n    <div class="modal-content">\n        <div class="modal-header">\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n            <h4 class="modal-title">Map Setup</h4>\n        </div>\n        <div class="modal-body">\n\n            <ul class="nav nav-tabs">\n                <li class="active"><a id="tab-setup-sharing" href="#setup-sharing" data-toggle="tab">Sharing</a></li>\n                <li><a id="tab-setup-info" href="#setup-info" data-toggle="tab">Map Info</a></li>\n                <li><a id="tab-setup-author" href="#setup-author" data-toggle="tab">Author Info</a></li>\n                <li><a id="tab-setup-settings" href="#setup-settings" data-toggle="tab">Map Settings</a></li>\n                <li><a id="tab-setup-custom-domain" href="#setup-custom-domain" data-toggle="tab">Custom domain</a></li>\n            </ul>\n\n            <form class="map-setup">\n                <div class="tab-content">\n                    <div class="tab-pane active" id="setup-sharing">\n\n                        <div class="well">\n                            \n                            <div class="is-private">\n                                <button class="btn btn-danger btn-lg btn-block" disabled="disabled"><span class="glyphicon glyphicon-lock"></span> This map is private.</button>\n                                <div class="help-block">\n                                    You are the only one who can edit it, but it will be visible to people who have the following <strong>secret link</strong>. You should only share this URL with people who are supposed to see the map:\n                                </div>\n                                <div class="form-group urls has-error">\n                                    <input class="form-control input-md large secret-url" readonly="readonly"></input>\n                                </div>\n                                <hr >\n                                <button class="btn btn-warning btn-block sharing-toggle" data-value="W"><span class="glyphicon glyphicon-globe"></span> Allow everybody to see this map</button>\n                            </div>\n\n                            <div class="is-public">\n                                <button class="btn btn-success btn-lg btn-block" disabled="disabled"><span class="glyphicon glyphicon-globe"></span> This map is public.</button>\n                                <div class="help-block">\n                                    You are the only one who can edit it, but it will be <strong>publicly visible</strong> on the web, and it can be accessed by everybody under the following URL:\n                                </div>\n                                <div class="form-group urls has-warning">\n                                    <input class="form-control input-md large public-url" readonly="readonly"></input>\n                                </div>\n                                <hr >\n                                <button class="btn btn-danger btn-block sharing-toggle" data-value="P"><span class="glyphicon glyphicon-lock"></span> Make this map private</button>\n                            </div>\n\n                            <input type="hidden" class="model-input" name="sharing">\n\n                        </div>\n\n                    </div>\n                    <div class="tab-pane" id="setup-info">\n                        <div class="form-group">\n                            <label>Map Title</label>\n                            <input class="form-control model-input" name="title"></input>\n                        <div class="form-group">\n                        </div>\n                            <label>Description</label>\n                            <textarea class="form-control model-input" name="description" rows="5"></textarea>\n                        </div>\n                    </div>\n                    <div class="tab-pane" id="setup-author">\n                        <div class="form-group row">\n                            <div class="col-md-6">\n                                <label>Author Info</label>\n                                <input class="form-control model-input" name="author"></input>\n                            </div>\n                            <div class="col-md-6">\n                                <label>Twitter handle</label>\n                                <input class="form-control model-input" name="twitter"></input>\n                            </div>\n                        </div>\n                        <div class="form-group row">\n                            <div class="col-md-6">\n                                <label>Link URL</label>\n                                <input class="form-control model-input" name="linkURL"></input>\n                            </div>\n                            <div class="col-md-6">\n                                <label>Link Text</label>\n                                <input class="form-control model-input" name="linkTitle"></input>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class="tab-pane" id="setup-custom-domain">\n                        <div class="form-group">\n                            <label>Your custom domain name</label>\n                            <input class="form-control model-input" name="host" placeholder="Example: your-domain.com"></input>\n                            <p class="help-block">If you would like to have your custom domain point to this map, you can enter the domain name here. Please notice that you will have to set up your domain and point it to this application for this setting to have any effect.</p>\n                        </div>\n                    </div>\n\n                    <div class="tab-pane" id="setup-settings">\n                        <div class="form-group">\n                            <p>\n                                <button class="btn btn-default btn-block" id="savePositionButton">Save current map position as default</button>\n                            </p>\n                            <p>\n                                <button class="btn btn-default btn-block" id="saveViewOptionsButton">Save current view and style as default</button>\n                            </p>\n                        </div>\n                    </div>\n\n                </div>\n            </form>\n\n        </div>\n        <div class="modal-footer">\n            <button id="deleteMapButton" class="btn btn-danger delete pull-left">Delete Map</button>\n            <button id="saveCloseButton" type="submit" class="btn btn-primary pull-right">Save Map</button>\n            <button id="cancelButton" class="btn btn-default btn-cancel pull-right">Cancel</button>\n        </div>\n    </div><!-- /.modal-content -->\n</div><!-- /.modal-dialog -->\n'}),define("views/setup-view",["jquery","underscore","backbone","config","utils","text!templates/setup.html","views/modal-view"],function(e,t,n,r,i,s,o){var u=o.extend({tagName:"div",className:"setup-view modal fade",events:{"click #deleteMapButton":"deleteMapClicked","click #saveCloseButton":"saveClicked","click #cancelButton":"cancelClicked","click #savePositionButton":"savePositionClicked","click #saveViewOptionsButton":"saveViewClicked","click .sharing-toggle":"sharingToggleClicked"},initialize:function(e){this.template=t.template(s),u.__super__.initialize.apply(this,arguments),this.mapInfoChanged=!1,this.initialAreaChanged=this.viewOptionsChanged=!0,this.listenTo(this.model,"sync",this.populateFromModel)},populateFromModel:function(){var t=this,n=this.model.attributes;this.$(".map-name").html(n.title+" Setup"),this.modelFieldInputs.each(function(){e(this).removeClass("error");var t=this.name.split(".");t.length==2?n[t[0]]&&e(this).val(n[t[0]][t[1]]):e(this).val(n[this.name])}),this.updateSharingToggles(this.model.attributes.sharing),this.$(".public-url").val(this.model.publicUrl({secret:!1})),this.$(".secret-url").val(this.model.publicUrl({secret:!0})),t.setMapInfoChanged(!1)},updateSharingToggles:function(e){switch(e){case SharingType.PRIVATE:this.$(".is-private").show(),this.$(".is-public").hide();break;case SharingType.WORLD:this.$(".is-public").show(),this.$(".is-private").hide()}this.$(".model-input[name=sharing]").val(e)},sharingToggleClicked:function(t){return this.updateSharingToggles(e(t.currentTarget).attr("data-value")),this.setMapInfoChanged(!0),!1},focusTab:function(t){self.$(t).trigger("click");var n=self.$(".tab-pane.active").find("input, textarea");for(var r=0;r<n.length;r++)if(!e(n[r]).val()){e(n[r]).focus();return}},render:function(){var t=this;return u.__super__.render.call(this),this.$(".urls input").click(function(){e(this).select()}),this.$(".enter-email").click(function(){return t.focusEmail(),!1}),this.modelFieldInputs=this.$("form.map-setup .model-input"),this.modelFieldInputs.each(function(){e(this).on("change keydown",function(){t.setMapInfoChanged(!0)})}),this.$("#map-sharing button").on("click",function(){t.setMapInfoChanged(!0)}),e(this.el).on("hidden.bs.modal",function(){app.navigate(app.currentMapUri(null))}),this.populateFromModel(),this},setMapInfoChanged:function(e){var t=this;t.mapInfoChanged=e,e?t.$("#cancelButton").text(__("Cancel")):t.$("#cancelButton").text(__("Close")),t.$("#saveCloseButton").attr("disabled",!e),this.$("#saveCloseButton").attr("disabled",!e)},saveClicked:function(n){if(!this.mapInfoChanged)return this.close(),!1;var r={};this.modelFieldInputs.each(function(){r[this.name]=e(this).val()});var i=this;return this.$("#saveCloseButton").attr("disabled",!0),i.modelFieldInputs.removeClass("has-error"),this.model.save(r,{patch:!0,success:function(e,t,n){i.close(),i.trigger("map:saved"),i.setMapInfoChanged(!1)},error:function(n,r,s){var o=e.parseJSON(r.responseText);console.error("failed to update map: "+i.model.id),o&&o.errors&&t.each(o.errors,function(e){var t='input[name="'+e.path+'"]',n=i.$(t);n.addClass("has-error")}),i.$("#saveCloseButton").attr("disabled",!1)}}),!1},savePositionClicked:function(t){if(!this.initialAreaChanged)return;var n={initialArea:this.getInitialMapArea()},r=this;return this.$("#savePositionButton").attr("disabled",!0),this.model.save(n,{patch:!0,success:function(e,t,n){},error:function(t,n,i){var s=e.parseJSON(n.responseText);console.error("failed to update map: "+r.model.id),s&&s.errors&&console.error("errors:",s.errors),r.$("#savePositionButton").attr("disabled",!1)}}),!1},saveViewClicked:function(t){if(!this.viewOptionsChanged)return;var n={viewOptions:app.getCurrentViewOptions()},r=this;return this.$("#saveViewOptionsButton").attr("disabled",!0),this.model.save(n,{patch:!0,success:function(e,t,n){},error:function(t,n,i){var s=e.parseJSON(n.responseText);console.error("failed to update map: "+r.model.id),s&&s.errors&&console.error("errors:",s.errors),r.$("#saveViewOptionsButton").attr("disabled",!1)}}),!1},cancelClicked:function(e){return this.close(),!1},deleteMapClicked:function(e){var t=this,n=this.model.id;return window.confirm(__("Are you sure you want to delete this map? This action cannot be reversed!"))&&this.model.destroy({success:function(e,t,r){console.log("deleted map: "+n),window.location=BASE_URL},error:function(e,t,r){console.error("failed to delete map: "+n,t)}}),!1},getInitialMapArea:function(){var e=app.mapView.getVisibleMapArea();return delete e.bounds,e},show:function(){this.populateFromModel(),this.initialAreaChanged=app.mapView&&!t.isEqual(this.model.attributes.initialArea,this.getInitialMapArea()),this.viewOptionsChanged=app.mapView&&!t.isEqual(this.model.attributes.viewOptions,app.getCurrentViewOptions()),this.$("#savePositionButton").attr("disabled",!this.initialAreaChanged),this.$("#saveViewOptionsButton").attr("disabled",!this.viewOptionsChanged),u.__super__.show.call(this)}});return u}),define("text!templates/help-panel.html",[],function(){return'<div class="panel-heading">\n	Help\n    <div class="btn-toolbar">\n	    <div class="btn-group btn-group-xs">\n			<button type="button" class="btn btn-default panel-collapse"><span class="glyphicon glyphicon-minus-sign"></span></button>\n	        <button type="button" class="btn btn-default panel-close"><span class="glyphicon glyphicon-remove-sign"></span></button>\n		</div>\n	</div>\n</div>\n<div class="panel-body">\n	<div class="panel-scrollable-container">\n		<div class="panel-scrollable-content text">\n		</div>\n	</div>\n</div>\n'}),define("text!templates/help/index.html",[],function(){return'<h1>Your next steps</h1>\n<p class="hidden">Please tell users what your map is about.</p>\n<p class="step-setup">\n	<button class="btn btn-primary btn-lg admin-tool map-tool setup info">\n		<span class="glyphicon glyphicon-cog"></span><span class="caption"> Enter map information</span>\n		<span class="glyphicon glyphicon-ok half-opacity pull-right"></span>\n	</button>\n</p>\n<p class="step-signup">\n	<button class="btn btn-danger btn-lg admin-tool map-tool signup">\n		<span class="glyphicon glyphicon-cog"></span><span class="caption">Sign up so you can edit your map later</span>\n		<span class="glyphicon glyphicon-ok half-opacity pull-right"></span>\n	</button>\n</p>\n<p class="hidden">You are probably going to want to visualize some data. Either use your own data file and see it come alive on your new map:</p>\n<p>\n	<button class="btn btn-primary btn-lg admin-tool map-tool data-import">\n		<span class="glyphicon glyphicon-cloud-upload"></span><span class="caption"> Import your own data</span>\n		<span class="glyphicon glyphicon-ok half-opacity pull-right"></span>\n	</button>\n</p>\n<p class="hidden">You can also visualize data that has already been prepared. Browse the library and just drag a collection onto the map.</p>\n<p>\n	<button class="btn btn-primary btn-lg admin-tool map-tool data-library">\n		<span class="glyphicon glyphicon-th-list"></span><span class="caption"> Try out data from the library</span>\n		<span class="glyphicon glyphicon-ok half-opacity pull-right"></span>\n	</button>\n</p>\n<p class="hidden">Your map is private by default. Share it with the world!</p>\n<p>\n	<button class="btn btn-primary btn-lg admin-tool map-tool sharing">\n		<span class="glyphicon glyphicon-globe"></span><span class="caption"> Share your map!</span>\n		<span class="glyphicon glyphicon-ok half-opacity pull-right"></span>\n	</button>\n</p>'}),define("views/panel-view-base",["jquery","underscore","backbone","config","utils"],function(e,t,n,r,i){var s=n.View.extend({className:"panel panel-default",draggable:!0,subViewContainer:".panel-body",showEffect:"fadeIn",hideEffect:"fadeOut",initialize:function(e){var e=e||{};this.subViews=[]},updatePanelState:function(t){var n=this;return t==null&&(t=e(n.el).is(".collapsed")),n.$el.toggleClass("collapsed",!t),n.$el.is(".collapsed")?(n.$(".panel-body").slideUp("fast"),n.$(".panel-footer").slideUp("fast")):(n.$(".panel-body").slideDown("fast"),n.$(".panel-footer").slideDown("fast")),this},setTitle:function(e){this.$("h3").html(e)},snapToView:function(t,n,r){switch(n){case"right":this.$el.css("left",t.$el.position().left+t.$el.outerWidth()+"px");break;case"left":this.$el.css("right",e(t.el.parentNode).innerWidth()-t.$el.position().left+"px")}return r&&this.$el.css("top",t.$el.position().top+"px"),this},isVisible:function(){return this.$el.is(":visible")},isDraggable:function(){return this.draggable==undefined?this.$el.is(".panel-draggable"):this.draggable},show:function(e,t){var n=this,r=function(){n.trigger("panel:shown",this),t&&t()};return this.trigger("panel:show",this),e?this.$el.is(".panel-anchor-left")?(this.$el.hide().toggle("slide",e,r),this):(this.$el[this.showEffect](e,r),this):(this.$el.show(),r(),this)},hide:function(e,t){var n=this,r=function(){n.trigger("panel:hidden",this),t&&t()};return this.trigger("panel:hide",this),e?this.$el.is(".panel-anchor-left")?(this.$el.show().toggle("slide",e,r),this):(this.$el[this.hideEffect](e,r),this):(this.$el.hide(),r(),this)},close:function(e,t){var n=this,r=function(){n.trigger("panel:closed"),n.detach(),t&&t()};this.trigger("panel:close",n),this.hide(e,r)},attachTo:function(t){return e(t).append(this.el),this.isDraggable()&&this.$el.draggable("option","containment",t),this.$el.is(".panel-center")&&this.$el.css({left:Math.max(15,e(t).innerWidth()/2-this.$el.outerWidth()/2)+"px",top:Math.max(15,e(t).innerHeight()/2-this.$el.outerHeight()/2*1.5)+"px"}),this.isAttached=!0,this},render:function(){this.$el.html(this.template());var t=this;if(this.isDraggable()){var n=this.$(".panel-heading");n.addClass("drag-handle"),this.$el.addClass("panel-draggable"),this.$el.draggable({start:function(){e(this).css("bottom","auto")},drag:function(){},handle:n,stop:function(){var t=e(this),n=t.position();n.right=n.left+e(this).outerWidth(),n.top<0&&t.css("top","0px"),e(".snap.right").each(function(){n.right==e(this).position().left&&t.css("left","")})},snap:".snap, .panel",snapMode:"outer",snapTolerance:10}),this.$el.css("position","absolute")}return this.$(".panel-extend").click(function(){e(t.el).toggleClass("extended"),e(t.el).is(".extended")&&t.expand(),t.trigger("panel:resize",t)}),this.$(".panel-collapse").click(function(){t.collapse()}),this.$(".panel-close").click(function(){t.close("fast")}),this.windowResized=function(){t.$el.is(".panel-anchor-left, .panel-anchor-bottom")&&t.trigger("panel:resize",t)},e(window).on("resize",this.windowResized),this},expand:function(){return this.updatePanelState(!0)},collapse:function(){return this.updatePanelState()},remove:function(){e(window).off("resize",this.windowResized),s.__super__.remove.apply(this,arguments)},detach:function(){this.isAttached=!1,this.$el.detach()},getContainer:function(e){return this.$(e||this.subViewContainer)},appendSubView:function(e,t){return this.getContainer(t).append(e.el),e.setSuperView&&e.setSuperView(this),this.subViews.push(e),e},removeSubViews:function(){while(this.subViews.length)var e=this.subViews.pop().remove()}});return s}),define("views/help-panel-view",["jquery","underscore","backbone","config","utils","permissions","text!templates/help-panel.html","text!templates/help/index.html","views/panel-view-base"],function(e,t,n,r,i,s,o,u,a){var f=a.extend({className:"panel panel-default extended panel-scrollable panel-center help-panel",subViewContainer:".text",events:{"click .map-tool.signup":"signupButtonClicked","click .map-tool.setup":"setupButtonClicked","click .map-tool.data-library":"dataLibraryButtonClicked","click .map-tool.data-import":"dataImportButtonClicked","click .map-tool.sharing":"sharingButtonClicked"},initialize:function(e){var n=this;this.template=t.template(o),this.listenTo(app.setupView,"map:saved",function(e){n.updateButtonStates()}),this.listenTo(app,"user:login",function(e){n.updateButtonStates()}),this.listenTo(app,"mapLayer:added",function(e){n.updateButtonStates()})},updateButtonStates:function(){var e=this;this.$(".map-tool.signup .glyphicon-ok").toggle(this.hasUserAccount()),this.$(".map-tool.info .glyphicon-ok").toggle(this.hasDescription()&&this.hasUserAccount()),this.$(".map-tool.sharing .glyphicon-ok").toggle(!app.map.isPrivate()),this.$(".map-tool.data-import .glyphicon-ok").hide(),this.$(".map-tool.data-library .glyphicon-ok").hide(),t.each(app.mapLayersById,function(t){s.canAdminModel(t.featureCollection)?e.$(".map-tool.data-import .glyphicon-ok").show():e.$(".map-tool.data-library .glyphicon-ok").show()}),e.hasUserAccount()?(e.$(".step-signup button").removeClass("btn-danger").addClass("btn-primary"),(e.$(".step-setup").is(":visible")||!e.$el.is(":visible"))&&e.$(".step-signup").hide()):(e.$(".step-setup").toggle(!this.hasDescription()),e.$(".step-signup").toggle(this.hasDescription()))},hasUserAccount:function(){return s.canAdminModel(app.map)},hasDescription:function(){return app.map.attributes.description&&app.map.attributes.description!=""?!0:!1},render:function(){var e=this;return f.__super__.render.call(this),this.getContainer().html(u),this.updateButtonStates(),this},signupButtonClicked:function(e){app.showSignup(),e.preventDefault()},setupButtonClicked:function(e){app.showSetupView("#tab-setup-info"),e.preventDefault()},dataImportButtonClicked:function(e){app.toggleDataImport(),e.preventDefault()},dataLibraryButtonClicked:function(e){app.toggleDataLibrary(),e.preventDefault()},sharingButtonClicked:function(e){app.showSetupView("#tab-setup-sharing"),e.preventDefault()}});return f}),define("text!templates/layers-panel.html",[],function(){return'<div class="panel-heading">\n	Layers\n    <div class="btn-toolbar">\n	    <div class="btn-group btn-group-xs">\n			<button type="button" class="btn btn-default panel-collapse"><span class="glyphicon glyphicon-minus-sign"></span></button>\n			<button type="button" class="btn btn-default panel-extend"><span class="glyphicon glyphicon-plus-sign"></span></button>\n		</div>\n	</div>\n</div>\n<div class="panel-body">\n	<div class="panel-scrollable-container">\n		<div class="panel-scrollable-content layers-container">\n		</div>\n	</div>\n</div>\n'}),define("views/layers-panel-view",["jquery","underscore","backbone","config","utils","text!templates/layers-panel.html","views/panel-view-base"],function(e,t,n,r,i,s,o){var u=o.extend({className:"panel panel-default layers-panel",subViewContainer:".layers-container",events:{},initialize:function(e){u.__super__.initialize.call(this,e),this.template=t.template(s),this.sortableItemsSelector=".map-layer",this.sortableHandleSelector=".collapsible-heading"},render:function(){return u.__super__.render.call(this),this.initSortable(),this},getSortableItemIndex:function(e){return this.$(this.sortableItemsSelector).index(e)},initSortable:function(){var t=this;this.layerSortable=this.$(".panel-body").sortable({items:this.sortableItemsSelector,handle:this.sortableHandleSelector,start:function(n,r){e(r.item).data("previousIndex",t.getSortableItemIndex(r.item))},stop:function(n,r){e(r.item).data("previousIndex")!=t.getSortableItemIndex(r.item)&&t.layerMoved(n,r)}})},layerMoved:function(t,n){var r=app.getMapLayer(e(n.item).attr("data-id"));r.set({position:this.getSortableItemIndex(n.item)},{silent:!1}),app.isMapAdmin()&&r.save()}});return u}),define("text!templates/data-detail.html",[],function(){return'<div class="panel-heading">\n    Details: <span class="model-title"></span>\n    <div class="btn-toolbar">\n        <div class="btn-group btn-group-xs">\n            <button type="button" class="btn btn-default panel-collapse"><span class="glyphicon glyphicon-minus-sign"></span></button>\n            <!--<button type="button" class="btn btn-default panel-extend"><span class="glyphicon glyphicon-plus-sign"></span></button>-->\n            <button type="button" class="btn btn-default panel-close"><span class="glyphicon glyphicon-remove-sign"></span></button>\n        </div>\n    </div>\n</div>\n<div class="panel-body">\n	<div class="detail">\n		<table class="detail-data"></table>\n	</div>\n</div>\n<div class="arrow-down-center">\n    <div class="arrow-down"></div>\n</div>\n'}),!function(e){function t(e,t){return function(n){return a(e.call(this,n),t)}}function n(e,t){return function(n){return this.lang().ordinal(e.call(this,n),t)}}function r(){}function i(e){o(this,e)}function s(e){var t=e.years||e.year||e.y||0,n=e.months||e.month||e.M||0,r=e.weeks||e.week||e.w||0,i=e.days||e.day||e.d||0,s=e.hours||e.hour||e.h||0,o=e.minutes||e.minute||e.m||0,u=e.seconds||e.second||e.s||0,a=e.milliseconds||e.millisecond||e.ms||0;this._input=e,this._milliseconds=a+1e3*u+6e4*o+36e5*s,this._days=i+7*r,this._months=n+12*t,this._data={},this._bubble()}function o(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function u(e){return 0>e?Math.ceil(e):Math.floor(e)}function a(e,t){for(var n=e+"";n.length<t;)n="0"+n;return n}function f(e,t,n,r){var i,s,o=t._milliseconds,u=t._days,a=t._months;o&&e._d.setTime(+e._d+o*n),(u||a)&&(i=e.minute(),s=e.hour()),u&&e.date(e.date()+u*n),a&&e.month(e.month()+a*n),o&&!r&&D.updateOffset(e),(u||a)&&(e.minute(i),e.hour(s))}function l(e){return"[object Array]"===Object.prototype.toString.call(e)}function c(e,t){var n,r=Math.min(e.length,t.length),i=Math.abs(e.length-t.length),s=0;for(n=0;r>n;n++)~~e[n]!==~~t[n]&&s++;return s+i}function h(e){return e?it[e]||e.toLowerCase().replace(/(.)s$/,"$1"):e}function p(e,t){return t.abbr=e,j[e]||(j[e]=new r),j[e].set(t),j[e]}function d(e){if(!e)return D.fn._lang;if(!j[e]&&F)try{require("./lang/"+e)}catch(t){return D.fn._lang}return j[e]}function v(e){return e.match(/\[.*\]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function m(e){var t,n,r=e.match(R);for(t=0,n=r.length;n>t;t++)r[t]=at[r[t]]?at[r[t]]:v(r[t]);return function(i){var s="";for(t=0;n>t;t++)s+=r[t]instanceof Function?r[t].call(i,e):r[t];return s}}function g(e,t){function n(t){return e.lang().longDateFormat(t)||t}for(var r=5;r--&&U.test(t);)t=t.replace(U,n);return st[t]||(st[t]=m(t)),st[t](e)}function y(e,t){switch(e){case"DDDD":return X;case"YYYY":return V;case"YYYYY":return $;case"S":case"SS":case"SSS":case"DDD":return W;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return J;case"a":case"A":return d(t._l)._meridiemParse;case"X":return G;case"Z":case"ZZ":return K;case"T":return Q;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return z;default:return new RegExp(e.replace("\\",""))}}function b(e){var t=(K.exec(e)||[])[0],n=(t+"").match(tt)||["-",0,0],r=+(60*n[1])+~~n[2];return"+"===n[0]?-r:r}function w(e,t,n){var r,i=n._a;switch(e){case"M":case"MM":i[1]=null==t?0:~~t-1;break;case"MMM":case"MMMM":r=d(n._l).monthsParse(t),null!=r?i[1]=r:n._isValid=!1;break;case"D":case"DD":case"DDD":case"DDDD":null!=t&&(i[2]=~~t);break;case"YY":i[0]=~~t+(~~t>68?1900:2e3);break;case"YYYY":case"YYYYY":i[0]=~~t;break;case"a":case"A":n._isPm=d(n._l).isPM(t);break;case"H":case"HH":case"h":case"hh":i[3]=~~t;break;case"m":case"mm":i[4]=~~t;break;case"s":case"ss":i[5]=~~t;break;case"S":case"SS":case"SSS":i[6]=~~(1e3*("0."+t));break;case"X":n._d=new Date(1e3*parseFloat(t));break;case"Z":case"ZZ":n._useUTC=!0,n._tzm=b(t)}null==t&&(n._isValid=!1)}function E(e){var t,n,r=[];if(!e._d){for(t=0;7>t;t++)e._a[t]=r[t]=null==e._a[t]?2===t?1:0:e._a[t];r[3]+=~~((e._tzm||0)/60),r[4]+=~~((e._tzm||0)%60),n=new Date(0),e._useUTC?(n.setUTCFullYear(r[0],r[1],r[2]),n.setUTCHours(r[3],r[4],r[5],r[6])):(n.setFullYear(r[0],r[1],r[2]),n.setHours(r[3],r[4],r[5],r[6])),e._d=n}}function S(e){var t,n,r=e._f.match(R),i=e._i;for(e._a=[],t=0;t<r.length;t++)n=(y(r[t],e).exec(i)||[])[0],n&&(i=i.slice(i.indexOf(n)+n.length)),at[r[t]]&&w(r[t],n,e);i&&(e._il=i),e._isPm&&e._a[3]<12&&(e._a[3]+=12),e._isPm===!1&&12===e._a[3]&&(e._a[3]=0),E(e)}function x(e){var t,n,r,s,u,a=99;for(s=0;s<e._f.length;s++)t=o({},e),t._f=e._f[s],S(t),n=new i(t),u=c(t._a,n.toArray()),n._il&&(u+=n._il.length),a>u&&(a=u,r=n);o(e,r)}function T(e){var t,n=e._i,r=Y.exec(n);if(r){for(e._f="YYYY-MM-DD"+(r[2]||" "),t=0;4>t;t++)if(et[t][1].exec(n)){e._f+=et[t][0];break}K.exec(n)&&(e._f+=" Z"),S(e)}else e._d=new Date(n)}function N(t){var n=t._i,r=I.exec(n);n===e?t._d=new Date:r?t._d=new Date(+r[1]):"string"==typeof n?T(t):l(n)?(t._a=n.slice(0),E(t)):t._d=n instanceof Date?new Date(+n):new Date(n)}function C(e,t,n,r,i){return i.relativeTime(t||1,!!n,e,r)}function k(e,t,n){var r=B(Math.abs(e)/1e3),i=B(r/60),s=B(i/60),o=B(s/24),u=B(o/365),a=45>r&&["s",r]||1===i&&["m"]||45>i&&["mm",i]||1===s&&["h"]||22>s&&["hh",s]||1===o&&["d"]||25>=o&&["dd",o]||45>=o&&["M"]||345>o&&["MM",B(o/30)]||1===u&&["y"]||["yy",u];return a[2]=t,a[3]=e>0,a[4]=n,C.apply({},a)}function L(e,t,n){var r,i=n-t,s=n-e.day();return s>i&&(s-=7),i-7>s&&(s+=7),r=D(e).add("d",s),{week:Math.ceil(r.dayOfYear()/7),year:r.year()}}function A(e){var t=e._i,n=e._f;return null===t||""===t?null:("string"==typeof t&&(e._i=t=d().preparse(t)),D.isMoment(t)?(e=o({},t),e._d=new Date(+t._d)):n?l(n)?x(e):S(e):N(e),new i(e))}function O(e,t){D.fn[e]=D.fn[e+"s"]=function(e){var n=this._isUTC?"UTC":"";return null!=e?(this._d["set"+n+t](e),D.updateOffset(this),this):this._d["get"+n+t]()}}function M(e){D.duration.fn[e]=function(){return this._data[e]}}function _(e,t){D.duration.fn["as"+e]=function(){return+this/t}}for(var D,P,H="2.1.0",B=Math.round,j={},F="undefined"!=typeof module&&module.exports,I=/^\/?Date\((\-?\d+)/i,q=/(\-)?(\d*)?\.?(\d+)\:(\d+)\:(\d+)\.?(\d{3})?/,R=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,U=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,z=/\d\d?/,W=/\d{1,3}/,X=/\d{3}/,V=/\d{1,4}/,$=/[+\-]?\d{1,6}/,J=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,K=/Z|[\+\-]\d\d:?\d\d/i,Q=/T/i,G=/[\+\-]?\d+(\.\d{1,3})?/,Y=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,Z="YYYY-MM-DDTHH:mm:ssZ",et=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],tt=/([\+\-]|\d\d)/gi,nt="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),rt={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},it={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",w:"week",M:"month",y:"year"},st={},ot="DDD w W M D d".split(" "),ut="M D H h m s w W".split(" "),at={M:function(){return this.month()+1},MMM:function(e){return this.lang().monthsShort(this,e)},MMMM:function(e){return this.lang().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.lang().weekdaysMin(this,e)},ddd:function(e){return this.lang().weekdaysShort(this,e)},dddd:function(e){return this.lang().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return a(this.year()%100,2)},YYYY:function(){return a(this.year(),4)},YYYYY:function(){return a(this.year(),5)},gg:function(){return a(this.weekYear()%100,2)},gggg:function(){return this.weekYear()},ggggg:function(){return a(this.weekYear(),5)},GG:function(){return a(this.isoWeekYear()%100,2)},GGGG:function(){return this.isoWeekYear()},GGGGG:function(){return a(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return a(~~(this.milliseconds()/10),2)},SSS:function(){return a(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+a(~~(e/60),2)+":"+a(~~e%60,2)},ZZ:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+a(~~(10*e/6),4)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()}};ot.length;)P=ot.pop(),at[P+"o"]=n(at[P],P);for(;ut.length;)P=ut.pop(),at[P+P]=t(at[P],2);for(at.DDDD=t(at.DDD,3),r.prototype={set:function(e){var t,n;for(n in e)t=e[n],"function"==typeof t?this[n]=t:this["_"+n]=t},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e){var t,n,r;for(this._monthsParse||(this._monthsParse=[]),t=0;12>t;t++)if(this._monthsParse[t]||(n=D([2e3,t]),r="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[t]=new RegExp(r.replace(".",""),"i")),this._monthsParse[t].test(e))return t},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var t,n,r;for(this._weekdaysParse||(this._weekdaysParse=[]),t=0;7>t;t++)if(this._weekdaysParse[t]||(n=D([2e3,1]).day(t),r="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[t]=new RegExp(r.replace(".",""),"i")),this._weekdaysParse[t].test(e))return t},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},isPM:function(e){return"p"===(e+"").toLowerCase()[0]},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t){var n=this._calendar[e];return"function"==typeof n?n.apply(t):n},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,n,r){var i=this._relativeTime[n];return"function"==typeof i?i(e,t,n,r):i.replace(/%d/i,e)},pastFuture:function(e,t){var n=this._relativeTime[e>0?"future":"past"];return"function"==typeof n?n(t):n.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",preparse:function(e){return e},postformat:function(e){return e},week:function(e){return L(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6}},D=function(e,t,n){return A({_i:e,_f:t,_l:n,_isUTC:!1})},D.utc=function(e,t,n){return A({_useUTC:!0,_isUTC:!0,_l:n,_i:e,_f:t})},D.unix=function(e){return D(1e3*e)},D.duration=function(e,t){var n,r,i=D.isDuration(e),o="number"==typeof e,u=i?e._input:o?{}:e,a=q.exec(e);return o?t?u[t]=e:u.milliseconds=e:a&&(n="-"===a[1]?-1:1,u={y:0,d:~~a[2]*n,h:~~a[3]*n,m:~~a[4]*n,s:~~a[5]*n,ms:~~a[6]*n}),r=new s(u),i&&e.hasOwnProperty("_lang")&&(r._lang=e._lang),r},D.version=H,D.defaultFormat=Z,D.updateOffset=function(){},D.lang=function(e,t){return e?(t?p(e,t):j[e]||d(e),D.duration.fn._lang=D.fn._lang=d(e),void 0):D.fn._lang._abbr},D.langData=function(e){return e&&e._lang&&e._lang._abbr&&(e=e._lang._abbr),d(e)},D.isMoment=function(e){return e instanceof i},D.isDuration=function(e){return e instanceof s},D.fn=i.prototype={clone:function(){return D(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){return g(D(this).utc(),"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return null==this._isValid&&(this._isValid=this._a?!c(this._a,(this._isUTC?D.utc(this._a):D(this._a)).toArray()):!isNaN(this._d.getTime())),!!this._isValid},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(e){var t=g(this,e||D.defaultFormat);return this.lang().postformat(t)},add:function(e,t){var n;return n="string"==typeof e?D.duration(+t,e):D.duration(e,t),f(this,n,1),this},subtract:function(e,t){var n;return n="string"==typeof e?D.duration(+t,e):D.duration(e,t),f(this,n,-1),this},diff:function(e,t,n){var r,i,s=this._isUTC?D(e).zone(this._offset||0):D(e).local(),o=6e4*(this.zone()-s.zone());return t=h(t),"year"===t||"month"===t?(r=432e5*(this.daysInMonth()+s.daysInMonth()),i=12*(this.year()-s.year())+(this.month()-s.month()),i+=(this-D(this).startOf("month")-(s-D(s).startOf("month")))/r,i-=6e4*(this.zone()-D(this).startOf("month").zone()-(s.zone()-D(s).startOf("month").zone()))/r,"year"===t&&(i/=12)):(r=this-s,i="second"===t?r/1e3:"minute"===t?r/6e4:"hour"===t?r/36e5:"day"===t?(r-o)/864e5:"week"===t?(r-o)/6048e5:r),n?i:u(i)},from:function(e,t){return D.duration(this.diff(e)).lang(this.lang()._abbr).humanize(!t)},fromNow:function(e){return this.from(D(),e)},calendar:function(){var e=this.diff(D().startOf("day"),"days",!0),t=-6>e?"sameElse":-1>e?"lastWeek":0>e?"lastDay":1>e?"sameDay":2>e?"nextDay":7>e?"nextWeek":"sameElse";return this.format(this.lang().calendar(t,this))},isLeapYear:function(){var e=this.year();return 0===e%4&&0!==e%100||0===e%400},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?"string"==typeof e&&(e=this.lang().weekdaysParse(e),"number"!=typeof e)?this:this.add({d:e-t}):t},month:function(e){var t,n=this._isUTC?"UTC":"";return null!=e?"string"==typeof e&&(e=this.lang().monthsParse(e),"number"!=typeof e)?this:(t=this.date(),this.date(1),this._d["set"+n+"Month"](e),this.date(Math.min(t,this.daysInMonth())),D.updateOffset(this),this):this._d["get"+n+"Month"]()},startOf:function(e){switch(e=h(e)){case"year":this.month(0);case"month":this.date(1);case"week":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e&&this.weekday(0),this},endOf:function(e){return this.startOf(e).add(e,1).subtract("ms",1)},isAfter:function(e,t){return t="undefined"!=typeof t?t:"millisecond",+this.clone().startOf(t)>+D(e).startOf(t)},isBefore:function(e,t){return t="undefined"!=typeof t?t:"millisecond",+this.clone().startOf(t)<+D(e).startOf(t)},isSame:function(e,t){return t="undefined"!=typeof t?t:"millisecond",+this.clone().startOf(t)===+D(e).startOf(t)},min:function(e){return e=D.apply(null,arguments),this>e?this:e},max:function(e){return e=D.apply(null,arguments),e>this?this:e},zone:function(e){var t=this._offset||0;return null==e?this._isUTC?t:this._d.getTimezoneOffset():("string"==typeof e&&(e=b(e)),Math.abs(e)<16&&(e=60*e),this._offset=e,this._isUTC=!0,t!==e&&f(this,D.duration(t-e,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},daysInMonth:function(){return D.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(e){var t=B((D(this).startOf("day")-D(this).startOf("year"))/864e5)+1;return null==e?t:this.add("d",e-t)},weekYear:function(e){var t=L(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==e?t:this.add("y",e-t)},isoWeekYear:function(e){var t=L(this,1,4).year;return null==e?t:this.add("y",e-t)},week:function(e){var t=this.lang().week(this);return null==e?t:this.add("d",7*(e-t))},isoWeek:function(e){var t=L(this,1,4).week;return null==e?t:this.add("d",7*(e-t))},weekday:function(e){var t=(this._d.getDay()+7-this.lang()._week.dow)%7;return null==e?t:this.add("d",e-t)},isoWeekday:function(e){return null==e?this.day()||7:this.day(this.day()%7?e:e-7)},lang:function(t){return t===e?this._lang:(this._lang=d(t),this)}},P=0;P<nt.length;P++)O(nt[P].toLowerCase().replace(/s$/,""),nt[P]);O("year","FullYear"),D.fn.days=D.fn.day,D.fn.months=D.fn.month,D.fn.weeks=D.fn.week,D.fn.isoWeeks=D.fn.isoWeek,D.fn.toJSON=D.fn.toISOString,D.duration.fn=s.prototype={_bubble:function(){var e,t,n,r,i=this._milliseconds,s=this._days,o=this._months,a=this._data;a.milliseconds=i%1e3,e=u(i/1e3),a.seconds=e%60,t=u(e/60),a.minutes=t%60,n=u(t/60),a.hours=n%24,s+=u(n/24),a.days=s%30,o+=u(s/30),a.months=o%12,r=u(o/12),a.years=r},weeks:function(){return u(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+2592e6*(this._months%12)+31536e6*~~(this._months/12)},humanize:function(e){var t=+this,n=k(t,!e,this.lang());return e&&(n=this.lang().pastFuture(t,n)),this.lang().postformat(n)},add:function(e,t){var n=D.duration(e,t);return this._milliseconds+=n._milliseconds,this._days+=n._days,this._months+=n._months,this._bubble(),this},subtract:function(e,t){var n=D.duration(e,t);return this._milliseconds-=n._milliseconds,this._days-=n._days,this._months-=n._months,this._bubble(),this},get:function(e){return e=h(e),this[e.toLowerCase()+"s"]()},as:function(e){return e=h(e),this["as"+e.charAt(0).toUpperCase()+e.slice(1)+"s"]()},lang:D.fn.lang};for(P in rt)rt.hasOwnProperty(P)&&(_(P,rt[P]),M(P.toLowerCase()));_("Weeks",6048e5),D.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},D.lang("en",{ordinal:function(e){var t=e%10,n=1===~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n}}),F&&(module.exports=D),"undefined"==typeof ender&&(this.moment=D),"function"==typeof define&&define.amd&&define("moment",[],function(){return D})}.call(this),define("views/data-detail-view",["jquery","underscore","backbone","config","utils","text!templates/data-detail.html","views/panel-view-base","moment"],function(e,t,n,r,i,s,o,u){var a=o.extend({className:"panel panel-default data-detail",draggable:!1,events:{},initialize:function(e){a.__super__.initialize.call(this,e),this.template=t.template(s),this.defaultLayout=[{fields:["properties.icon"],label:!1,formatter:"icon","class":"icon muted"},{fields:["%(label)s","%(datetime)s"],label:!1,"class":"box heading"},{fields:["%(numeric)s"],label:"%(numeric)s","class":"large"},{fields:["properties.description","properties.summary"],label:!1,"class":"box text-body muted"},{fields:["properties.$other"],label:"%(field)s","class":"text-body muted"},{fields:["properties.count"],label:__("no. of %(itemTitlePlural)s"),formatter:"numeric","class":"micro muted"},{fields:["%(numeric)s.max"],label:__("peak"),"class":"micro muted"},{fields:["%(numeric)s.min"],label:__("minimum"),"class":"micro muted"},{fields:["%(numeric)s.avg"],label:__("average"),"class":"micro muted"},{fields:["%(numeric)s.stddev"],label:__("std. deviation"),"class":"micro muted"}]},setModel:function(e){this.model&&(this.stopListening(this.model),this.model.collection&&this.model.collection.mapLayer&&this.stopListening(this.model.collection.mapLayer)),this.model=e,this.populateFromModel(),this.listenTo(e.collection.mapLayer,"change",this.populateFromModel),this.listenTo(e.collection.mapLayer,"toggle:valFormatter",this.populateFromModel)},populateFromModel:function(){var t=this.model,n=this.compileDetailDataForModel(t),r=this.$(".panel-body"),i=function(e){var t=e.class?'<span class="'+e.class+'">':"<span>";return e.label!=undefined&&e.value!=undefined?'<tr><th class="detail-label">'+t+e.label+'</span></th><td class="detail-value">'+t+e.value+"</span></td></tr>":e.label!=undefined?'<tr><td colspan="2" class="detail-label single">'+t+e.label+"</span></td></tr>":e.value!=undefined?'<tr><td colspan="2" class="detail-value single">'+t+e.value+"</span></td></tr>":""},s=e(".detail-data",r),o=[];for(var u=0;u<n.length;u++)o.push(i(n[u]));s.html(o.join("\n")),this.model.collection&&this.model.collection.mapLayer&&this.$(".model-title").text(this.model.collection.mapLayer.getDisplay("title"))},compileDetailDataForModel:function(e){if(!e.collection)return[];var n=e.collection.mapLayer,r=n.getLayerOptions(),i=n.getDisplay("detailLayout")||this.defaultLayout,s=n.getValFormatter(),o=function(e){return e instanceof Date},a=function(e){return!o(e)&&(typeof e=="object"&&t.isEmpty(e)||!e&&e!=0||e==="")},f=function(e,t){if(o(e)||typeof e!="object")return t?t.format(e):e;if(e.avg!=undefined)return f(e.avg,t);if(Array.isArray(e))return e.join(", ");var n=f(e.min,t),r=f(e.max,t);if(n==r)return n;var i=t.minMaxFormat||__("%(min)s to %(max)s");return __(i).format({min:n,max:r})},l={date:{format:function(e){var e=u(e);return e.format(r.datetimeFormat||locale.formats.DATE_SHORT)}},numeric:s,icon:{format:function(e){return'<img class="icon" src="'+e+'" />'}}};l.icon.minMaxFormat=__("%(min)s %(max)s"),l.date.minMaxFormat=l.numeric.minMaxFormat=__("%(min)s – %(max)s");var c=r.attrMap?{numeric:r.attrMap.numeric,datetime:r.attrMap.datetime,label:r.attrMap.label}:{},h=n.getFeatureCollectionAttr("fields"),p={numeric:a(s.unit)?c.numeric&&h?h.reduce(function(e,t){return t.name==c.numeric?t.label:e}):__("Value"):s.unit,unit:s.unit,itemTitlePlural:n.getDisplay("itemTitlePlural")},d=[],v=i.reduce(function(e,n){return t.each(n.fields,function(t){e[t]=!0}),e},{});return t.each(i,function(n){var r=[],i=function(t,n,r,i){var s=e.get(n),o=i.formatter?l[i.formatter]:!1;v[n]=!0;if(!o)switch(r.split(".")[0]){case"%(datetime)s":o=l.date;break;case"%(numeric)s":o=l.numeric}return a(s)||t.push(f(s,o)),t},s=function(e,t){if(e.length){var n=e.join(t.join||"<br />");t.label?d.push({label:t.label.format(p),value:n,"class":t.class}):d.push({value:n,"class":t.class})}};t.each(n.fields,function(o){var u=o.format(c);u=="properties.$other"?t.each(e.get("properties"),function(e,r){if(!v["properties."+r]){var u={label:n.label?n.label.format(t.extend(c,{field:r})):!1,"class":n.class,formatter:n.formatter};s(i([],"properties."+r,o,u),u)}}):i(r,u,o,n)}),s(r,n)}),d}});return a}),define("text!templates/map-info-modal.html",[],function(){return'<div class="modal-dialog">\n    <div class="modal-content">\n        <div class="modal-header">\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n            <h4 class="modal-title">Map Info</h4>\n        </div>\n        <div class="modal-body">\n			<div class="panel-body">\n				<div class="description"></div>\n				<p class="author"><span class="content"></span></p>\n				<p class="linkURL"><a class="content" href="#"></a></p>\n			  	<p class="twitter"><a class="content" href="#"></a></p>\n			</div>\n		</div>\n        <div class="modal-footer">\n			<button data-dismiss="modal" class="btn btn-default">Close</button>\n        </div>\n    </div><!-- /.modal-content -->\n</div><!-- /.modal-dialog -->\n'}),define("views/map-info-view",["jquery","underscore","backbone","config","utils","text!templates/map-info-modal.html","views/modal-view"],function(e,t,n,r,i,s,o){var u=o.extend({events:{},initialize:function(e){this.template=t.template(s),u.__super__.initialize.call(this,e),this.listenTo(this.model,"sync",this.populateFromModel)},populateFromModel:function(){var t=this.model.attributes;this.setTitle(t.title);var n=["description","author","linkURL","twitter"];for(var r=n.length-1;r>=0;r--){var i=this.$("."+n[r]),s=e(".content",i);s.length||(s=i);var o=t[n[r]];o&&o!=""?(n[r]=="description"&&(o=nl2p(o)),n[r]=="twitter"&&(o="https://twitter.com/"+o),s.html(o),s[0].tagName=="A"&&s.attr("href",o),i.show()):i.hide()}},render:function(){return u.__super__.render.call(this),this.populateFromModel(),this}});return u}),define("text!templates/baselayer-editor.html",[],function(){return'<div class="panel-heading">\n    Baselayer Style\n    <div class="btn-toolbar">\n	    <div class="btn-group btn-group-xs">\n	        <button type="button" class="btn btn-default panel-collapse"><span class="glyphicon glyphicon-minus-sign"></span></button>\n	        <!--<button type="button" class="btn btn-default panel-extend"><span class="glyphicon glyphicon-plus-sign"></span></button>-->\n	        <button type="button" class="btn btn-default panel-close"><span class="glyphicon glyphicon-remove-sign"></span></button>\n	    </div>\n	</div>\n</div>\n<div class="panel-body">\n	<form role="form">\n	    <div class="form-group row opacity">\n	        <div class="col-md-12">\n	            <label for="">Opacity</label>  \n	            <div class="row">\n	                <div class="col-md-3">\n	                    <input class="form-control input-sm number model-input" name="viewOptions.baselayerOpacity" type="text" placeholder="auto" />\n	                </div>\n	                <div class="col-md-9">\n	                    <span class="slider pull-left" data-field="viewOptions.baselayerOpacity"></span>\n	                </div>\n	            </div>\n	        </div>\n	    </div>\n        <div class="form-group">\n            <label>Background color</label>\n            <div>\n                <input class="form-control color-picker model-input input-sm" name="viewOptions.backgroundColor" type="text" placeholder="auto" />\n            </div>\n        </div>\n	</form>\n</div>'}),define("mixins/model-editor-mixin",["jquery","underscore","backbone"],function(e,t,n){var r={initModelInputs:function(){var t=this;this.modelInputs={},this.$(".model-input").each(function(){var n=e(this).attr("data-name")||e(this).attr("name");t.modelInputs[n]||(t.modelInputs[n]=[]),t.modelInputs[n].push(this)}),this.customInitModelInputs&&t.customInitModelInputs()},populateModelInputs:function(){this.savedModelAttributes=t.deepClone(this.model.attributes);for(var e in this.modelInputs){var n=this.model.get(e);this.populateModelInput(e,n)}this.isChanged=!1},populateModelInput:function(t,n){var r=this;e(r.modelInputs[t]).each(function(){e(this).is(".btn-group")?e(".btn",this).each(function(){e(this).val()!=n?e(this).removeClass("active"):e(this).addClass("active")}):e(this).is("input[type=checkbox], input[type=radio]")?e(this).attr("checked",n==1):e(this).val(n)})},populateFromModel:function(){this.populateModelInputs(),this.customPopulateFromModel&&this.customPopulateFromModel()},getValueFromModelInput:function(t){var n=e(this.modelInputs[t][0]),r;return e(n).is("input[type=checkbox], input[type=radio]")?r=n.is(":checked"):r=n.val(),r},getValuesFromModelInputs:function(){var e={};for(var t in this.modelInputs)e[t]=this.getValueFromModelInput(t);return this.customGetValuesFromModelInputs&&(e=this.customGetValuesFromModelInputs(e)),e},updateModelFromInputs:function(e){var t=this.getValuesFromModelInputs();this.model.set(t,e||{})},handleValidationErrors:function(t){try{var n=e.parseJSON(t.responseText);n&&n.errors&&console.error("errors:",n.errors)}catch(r){}}};return r}),define("mixins/editor-widgets-mixin",["jquery","underscore","backbone"],function(e,t,n){var r={initSliders:function(){var t=this,n=function(e,t){return isNaN(e)?t:e};this.$(".slider").each(function(){var r=e(this).attr("data-field"),i=n(parseFloat(e(this).attr("data-min")),0),s=n(parseFloat(e(this).attr("data-max")),1);e(this).slider({min:i,max:s,range:"min",step:s==1?.01:1,slide:function(n,i){e(t.modelInputs[r][0]).val(i.value),e(t.modelInputs[r][0]).trigger("change")}}),e(t.modelInputs[r][0]).change(function(){t.updateSliders()}),t.updateSlider(this)})},updateSlider:function(t){var n=e(t).attr("data-field");e(t).slider("value",e(this.modelInputs[n][0]).val())},updateSliders:function(){var e=this;this.$(".slider").each(function(){e.updateSlider(this)})},initColorPicker:function(t,n){var r=this;n!=undefined&&e(t).miniColors("value",n),e(t).miniColors({change:function(n,r){e(t).trigger("change")}})}};return r}),define("views/baselayer-editor-view",["jquery","underscore","backbone","config","utils","text!templates/baselayer-editor.html","views/panel-view-base","mixins/model-editor-mixin","mixins/editor-widgets-mixin"],function(e,t,n,r,i,s,o,u,a){var f=o.extend({className:"panel panel-default baselayer-editor",events:{"change .model-input":"modelInputChanged"},initialize:function(e){f.__super__.initialize.call(this,e),this.template=t.template(s)},render:function(){var e=this,t=this.model.attributes.featureCollection;return f.__super__.render.call(this),this.initModelInputs(),this.populateFromModel(),this.initSliders(),this.initColorPicker(this.$(".model-input.color-picker")),this},customPopulateFromModel:function(){var e=this.$('.model-input[name="viewOptions.baselayerOpacity"]');e.val()==""&&e.val("1")},modelInputChanged:function(e){app.setViewOptions(expandObj(this.getValuesFromModelInputs()).viewOptions)}});return t.extend(f.prototype,u),t.extend(f.prototype,a),f}),define("text!templates/map-layer-editor.html",[],function(){return'<div class="panel-heading">\n    Layer: <span class="model-title"></span>\n    <div class="btn-toolbar">\n        <div class="btn-group btn-group-xs">\n            <button type="button" class="btn btn-default panel-collapse"><span class="glyphicon glyphicon-minus-sign"></span></button>\n            <!--<button type="button" class="btn btn-default panel-extend"><span class="glyphicon glyphicon-plus-sign"></span></button>-->\n            <button type="button" class="btn btn-default panel-close"><span class="glyphicon glyphicon-remove-sign"></span></button>\n        </div>\n    </div>\n</div>\n<div class="panel-body">\n\n    <form class="tabbable"> \n        <ul class="nav nav-tabs nav-justified">\n            <li class="active"><a href="#layer-features" data-toggle="tab" class="has-tooltip" data-original-title="Map Features"><span class="icon-large icon-map-marker half-opacity"></span></a></li>\n            <li><a href="#layer-colors" data-toggle="tab" class="has-tooltip" data-original-title="Colors"><span class="icon-large icon-brush half-opacity"></span></a></li>\n            <li><a href="#layer-stroke" data-toggle="tab" class="has-tooltip" data-original-title="Stroke"><span class="icon-large icon-vector-path-curve half-opacity"></span></a></li>\n            <li><a href="#layer-data" data-toggle="tab" class="has-tooltip" data-original-title="Data"><span class="icon-large icon-table half-opacity"></span></a></li>\n            <li><a href="#layer-info" data-toggle="tab" class="has-tooltip" data-original-title="Layer Info"><span class="icon-large icon-info-sign half-opacity"></span></a></li>\n        </ul>\n\n        <div class="tab-content">\n\n            <fieldset class="tab-pane active" id="layer-features">\n                <input class="model-input" name="layerOptions.featureType" type="hidden" />\n                <div class="features">\n                    <div class="form-group">\n                        <label data-for="">Feature Type</label>\n                        <div class="btn-group model-input" data-name="layerOptions.featureType" data-toggle="buttons-radio">\n                            <button class="btn btn-default feature-type points" value="P"><i class="icon icon-feature-type has-tooltip" data-original-title="Points" data-placement="bottom"></i></button>\n                            <button class="btn btn-default feature-type square-tiles" value="ST"><i class="icon icon-feature-type has-tooltip" data-original-title="Tiles" data-placement="bottom"></i></button>\n                            <button class="btn btn-default feature-type bubbles" value="B"><i class="icon icon-feature-type has-tooltip" data-original-title="Bubbles" data-placement="bottom"></i></button>\n                            <button class="btn btn-default feature-type shapes" value="S"><i class="icon icon-feature-type has-tooltip" data-original-title="Shapes" data-placement="bottom"></i></button>\n                        </div>\n                    </div>\n                    <div class="form-group row">\n                        <div class="col-md-12">\n                            <label data-for="">Opacity</label>  \n                            <div class="row">\n                                <div class="col-md-3">\n                                    <input class="form-control input-sm number model-input" name="layerOptions.opacity" type="text" placeholder="auto" />\n                                </div>\n                                <div class="col-md-9">\n                                    <span class="slider pull-left" data-field="layerOptions.opacity"></span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="feature-settings ST advanced">\n                        <div class="form-group">\n                            <label class="checkbox">\n                                <input class="model-input" name="layerOptions.featureTypeFallback" type="checkbox" checked="checked"> Fall back to original shape if not tiled\n                            </label>\n                        </div>\n                    </div>\n                    <div class="feature-settings B clearfix">\n                        <div class="form-group row">\n                            <div class="col-md-12">\n                                <label data-for="">Minimum feature size</label>  \n                                <div class="row">\n                                    <div class="col-md-3">\n                                        <input class="form-control input-sm number model-input" name="layerOptions.minFeatureSize" type="text" placeholder="auto" />\n                                    </div>\n                                    <div class="col-md-9">\n                                        <span class="slider pull-left" data-field="layerOptions.minFeatureSize" data-min="1" data-max="300"></span>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="feature-settings B P clearfix">\n                        <div class="form-group row">\n                            <div class="col-md-12">\n                                <label data-for="">Feature size</label>  \n                                <div class="row">\n                                    <div class="col-md-3">\n                                        <input class="form-control input-sm number model-input" name="layerOptions.featureSize" type="text" placeholder="auto" />\n                                    </div>\n                                    <div class="col-md-9">\n                                        <span class="slider pull-left" data-field="layerOptions.featureSize" data-min="1" data-max="300"></span>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="feature-settings B">\n                        <div class="form-group">\n                            <label data-for="">Size relative to</label>\n                            <select class="form-control model-input input-sm" name="layerOptions.attrMap.featureSize">\n                                <option value="count">sample size</option>\n                                <option value="$numeric.avg">average value</option>\n                            </select>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="advanced">\n                    <div class="divider"></div>\n                    <div class="form-group">\n                        <label data-for="">Renderer</label>\n                        <select class="form-control model-input input-sm" name="layerOptions.htmlRenderer">\n                            <option value="SVG">SVG (recommended)</option>\n                            <option value="Canvas">Canvas</option>\n                        </select>\n                    </div>\n                </div>\n            </fieldset>\n\n            <fieldset class="tab-pane" id="layer-colors">\n\n                <div class="form-group color-schemes input-append input-group">\n                    <input class="form-control color-scheme-name" type="text">\n                    <div class="input-group-btn">\n                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>\n                        <ul class="dropdown-menu pull-right">\n                            <li class="add-color-scheme"><a href="#"><i class="glyphicon glyphicon-plus"></i> Add new color scheme</a></li>\n                            <li class="delete-color-scheme"><a href="#"><i class="glyphicon glyphicon-trash"></i> Delete this color scheme</a></li>\n                            <li class="divider"></li>\n                        </ul>\n                    </div>\n                </div>\n\n                <div class="color-scheme">\n                    <table class="color-palette form-group">\n                        <thead>\n                            <th><label data-for="">Color</label></th>\n                            <th><label data-for="">Position <a href="#" class="hint-toggle half-opacity" data-target="position"><i class="glyphicon glyphicon-question-sign"></i></a></label></th>\n                            <th class="advanced"><label data-for="">Interpolation</label></th>\n                        </thead>\n                        <tbody>\n                            <tr class="element-template" data-id="">\n                                <td class="color"><input name="color" type="text" class="form-control color-picker input-sm" size="7" placeholder="hex color" value="" /></td>\n                                <td class="position"><input name="position" type="text" class="form-control number input-sm" size="6" placeholder="position" value="" /></td>\n                                <td class="advanced">\n                                    <select name="form-control interpolation input-sm" class="min-width">\n                                        <option value="lerpRGB">linear</option>\n                                        <option value="threshold">threshold</option>\n                                    </select>\n                                </td>\n                                <td class="controls">\n                                    <button class="btn btn-default btn-sm muted remove-color" href="#"><span class="glyphicon glyphicon-remove"></span></button>\n                                </td>\n                            </tr>\n                        </tbody>\n                    </table>\n\n                    <div class="form-group">\n                        <button class="btn btn-default add-color"><i class="glyphicon glyphicon-plus"></i> Add</button>\n                        <div class="pull-right">\n                            <button data-content-selector=".popover-color-generator" data-title="Color Scheme Generator" data-placement="right" class="btn btn-default show-color-generator has-popover pull-right">Generate…</button>\n                        </div>\n                        <div class="pull-right">\n                            <a href="#" class="hint-toggle half-opacity button-height" data-target="color-generator" data-placement="left"><i class="glyphicon glyphicon-question-sign"></i></a>&nbsp;\n                        </div>\n                    </div>\n\n                    <p class="help-block hint position">\n                        The position of a color determines which values it will be used for. You can use both <strong>absolute values</strong> for positions; or you can use <strong>percentages</strong> to define values in relation to your value range (for instance <strong>50%</strong> meaning your median value.)\n                    </p>\n                    <p class="help-block hint color-generator">\n                        Generates intermediate colors automatically. You can either start with <strong>one base color</strong>; or start with <strong>two colors</strong> to define the start and end of your color scheme.\n                    </p>\n                    <p class="help-block hint datetimeFormat">\n                        <a href="http://momentjs.com/docs/#/displaying/format/">See documentation</a> on how to format dates.\n                    </p>\n\n                    <div class="popover-color-generator">\n                        <div class="row">\n                            <div class="col-md-6 form-group">\n                                <label class="radio">\n                                    <input type="radio" name="colorSchemeType" value="sequential" checked> sequential\n                                </label>\n                                <label class="radio">\n                                    <input type="radio" name="colorSchemeType" value="diverging"> diverging\n                                </label>\n                                <label class="radio">\n                                    <input type="radio" name="colorSchemeType" value="qualitative"> qualitative\n                                </label>\n                            </div>\n                            <div class="col-md-6 form-group">\n                                <label data-for="">Steps</label>  \n                                <input class="form-control input-sm number" name="colorSchemeSteps" type="text" value="5" />\n                            </div>\n                        </div>\n                        <div class="clearfix">\n                            <button class="btn btn-default hide-color-generator pull-left">Cancel</button>\n                            <button class="btn btn-warning generate-colors pull-right">Generate</button>\n                        </div>\n                    </div>\n\n                </div>\n\n                <div class="advanced">\n                    <div class="divider"></div>\n                    <div class="form-group">\n                        <label data-for="">Map color to</label>\n                        <select class="form-control model-input input-sm" name="layerOptions.attrMap.featureColor">\n                            <option value="">(default)</option>\n                            <option value="count">Sample size</option>\n                            <option value="$numeric.avg">Numeric average</option>\n                        </select>\n                    </div>\n                    <div class="divider"></div>\n                    <div class="form-group">\n                        <label data-for="">Label color</label>\n                        <div>\n                            <input class="form-control color-picker model-input input-sm" name="layerOptions.colorLabelColor" type="text" placeholder="auto" />\n                        </div>\n                    </div>\n                </div>\n\n            </fieldset>\n\n            <fieldset class="tab-pane" id="layer-stroke">\n                <div class="form-group">\n                    <label data-for="">Stroke color</label>\n                    <div>\n                        <input class="form-control color-picker model-input input-sm" name="layerOptions.strokeColor" type="text" placeholder="auto" />\n                    </div>\n                </div>\n                <div class="form-group row">\n                    <div class="col-md-12">\n                        <label data-for="">Stroke width</label>  \n                        <div class="row">\n                            <div class="col-md-3">\n                                <input class="form-control input-sm number model-input" name="layerOptions.strokeWidth" type="text" placeholder="auto" />\n                            </div>\n                            <div class="col-md-9">\n                                <span class="slider pull-left" data-field="layerOptions.strokeWidth" data-min="1" data-max="30"></span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="form-group row">\n                    <div class="col-md-12">\n                        <label data-for="">Stroke opacity</label>  \n                        <div class="row">\n                            <div class="col-md-3">\n                                <input class="form-control input-sm number model-input" name="layerOptions.strokeOpacity" type="text" placeholder="auto" />\n                            </div>\n                            <div class="col-md-9">\n                                <span class="slider pull-left" data-field="layerOptions.strokeOpacity"></span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="form-group advanced">\n                    <label data-for="">Line cap (requires SVG)</label>\n                    <select class="form-control model-input input-sm" name="layerOptions.strokeLinecap">\n                        <option value="round">round</option>\n                        <option value="square">square</option>\n                        <option value="butt">butt</option>\n                    </select>\n                </div>\n                <div class="form-group advanced">\n                    <label data-for="">Dash style (requires SVG)</label>\n                    <select class="form-control model-input input-sm" name="layerOptions.strokeDashstyle">\n                        <option value="solid">solid</option>\n                        <option value="dot">dot</option>\n                        <option value="dash">dash</option>\n                        <option value="dashdot">dashdot</option>\n                        <option value="longdash">longdash</option>\n                        <option value="longdashdot">longdashdot</option>\n                    </select>\n                </div>\n            </fieldset>\n\n            <fieldset class="tab-pane" id="layer-data">\n                <div class="form-group">\n                    <label data-for="">Use numeric values from</label>\n                    <select class="form-control model-input input-sm field-names" name="layerOptions.attrMap.numeric" data-type="Number">\n                        <option value="">(pick a number field)</option>\n                    </select>\n                </div>\n                <div class="form-group">\n                    <label data-for="">Use date/time values from</label>\n                    <select class="form-control model-input input-sm field-names" name="layerOptions.attrMap.datetime" data-type="Date">\n                        <option value="">(pick a date field)</option>\n                    </select>\n                </div>\n                <div class="form-group">\n                    <label data-for="">Date/time format <a href="#" class="hint-toggle half-opacity" data-target="datetimeFormat"><i class="glyphicon glyphicon-question-sign"></i></a></label>\n                    <input class="form-control model-input input-sm" name="layerOptions.datetimeFormat" type="text" placeholder="for instance: YYYY-MM-DD HH:mm" />\n                </div>\n                <div class="form-group">\n                    <label data-for="">Label features using</label>\n                    <select class="form-control model-input input-sm field-names" name="layerOptions.attrMap.label" data-type="">\n                        <option value="">(pick a field)</option>\n                    </select>\n                </div>\n                <div class="form-group">\n                    <label data-for="">Group features by</label>\n                    <select class="form-control model-input input-sm field-names" name="layerOptions.attrMap.group" data-type="">\n                        <option value="">(pick a field)</option>\n                    </select>\n                </div>\n            </fieldset>\n\n            <fieldset class="tab-pane" id="layer-info">\n                <div class="form-group">\n                    <label class="checkbox">\n                        <input class="model-input layer-toggle" name="layerOptions.enabled" type="checkbox" checked="checked"> This layer is switched on by default\n                    </label>\n                </div>\n                <div class="row">\n                    <div class="col-md-8">\n                        <div class="form-group">\n                            <label data-for="">Title</label> \n                            <input class="form-control model-input" name="layerOptions.title" type="text" />\n                        </div>\n                    </div>\n                    <div class="col-md-4">\n                        <div class="form-group">\n                            <label data-for="">Unit</label> \n                            <input class="form-control model-input" name="layerOptions.unit" type="text" />\n                        </div>\n                    </div>\n                </div>\n                <div class="form-group">\n                    <label data-for="">Description</label> \n                    <textarea class="form-control model-input" name="layerOptions.description" rows="4"></textarea>\n                </div>\n                <div class="form-group model-numeric">\n                    <label class="checkbox">\n                        <input class="model-input" name="layerOptions.histogram" type="checkbox" checked="checked"> Display histogram for this layer\n                    </label>\n                </div>\n                <div class="divider"></div>\n                <div class="pull-left">\n                    <button class="btn btn-danger destroy">Remove Layer</button>\n                </div>\n                <div class="advanced pull-right">\n                    <button data-content-selector=".settings-export" data-title="Export or Import Settings" data-placement="right" class="btn btn-default import-export has-popover">Export/Import…</button>\n                </div>\n\n                <div class="settings-export">\n                    <div class="form-group">\n                        <textarea name="settings-json" class="form-control"></textarea>\n                    </div>\n                    <div class="clearfix">\n                        <button class="import-settings btn btn-warning generate-colors pull-right">Import</button>\n                    </div>\n                </div>\n\n            </fieldset>\n\n        </div>\n    </form>\n\n    <div class="element-template select-dropdown form-group input-append input-group">\n        <input class="form-control" type="text" readonly style="cursor: pointer">\n        <div class="input-group-btn">\n            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>\n            <ul class="dropdown-menu pull-right">\n            </ul>\n        </div>\n    </div>\n\n</div>\n\n<div class="panel-footer">\n\n<div class="btn-group" data-toggle="buttons-checkbox">\n  <button type="button" class="btn btn-default btn-sm show-preview">Preview</button>\n  <button type="button" class="btn btn-default btn-sm show-advanced"><i class="glyphicon glyphicon-cog half-opacity has-tooltip" data-original-title="Advanced Settings"></i></button>\n</div>    \n\n    <div class="pull-right main-buttons">\n        <button class="btn btn-default undo">Undo</button>\n        <button class="btn save btn-primary">Save Layer</button>\n    </div>\n</div>\n'}),define("lib/color-gradient/color-gradient",[],function(){var e=function(e,t){this.colors=[],this.gradientCache={};var t=t||{};if(e)for(var n=e.length-1;n>=0;n--){var r=parseInt(e[n].color[0]=="#"?e[n].color.replace("#","0x"):e[n].color),i=parseFloat(e[n].position);this.colors[n]={position:e[n].position,color:r,interpolation:t.interpolation||e[n].interpolation,channels:this.getChannels(r)}}this.colors.sort(function(e,t){return e.position-t.position})};e.prototype.getChannels=function(e){return[(e&16711680)>>16,(e&65280)>>8,e&255]};var t=function(e,t,n){return Math.round(t+(n-t)*e)};return e.prototype.interpolation={lerpRGB:function(n,r,i){var s=r.channels||e.prototype.getChannels(r.color),o=i.channels||e.prototype.getChannels(i.color);return(t(n,s[0],o[0])<<16)+(t(n,s[1],o[1])<<8)+t(n,s[2],o[2])},threshold:function(e,t,n){return e<1?t.color:n.color}},e.prototype.interpolation.default="lerpRGB",e.prototype.intColorAt=function(e,t){if(t){e=(e-e%t)/1;if(!this.gradientCache[t])this.gradientCache[t]={};else if(this.gradientCache[t][e]!=null)return this.gradientCache[t][e]}for(var n=this.colors.length-1;n>0;n--)if(this.colors[n].position<e)break;var r=n,i=n+1>=this.colors.length||this.colors[r].position>e?n:n+1,s=this.colors[i].position==this.colors[r].position?0:(e-this.colors[r].position)/(this.colors[i].position-this.colors[r].position),o=this.colors[r].interpolation;o?f=this.interpolation[o]:f=this.interpolation[this.interpolation.default];var u=f(s,this.colors[r],this.colors[i]);return t&&(this.gradientCache[t][e]=u),u},e.prototype.zeroPad=function(e,t){return(new Array(e.length<t?t+1-e.length:0)).join("0")+e},e.prototype.intToHexColor=function(e){return"#"+this.zeroPad(e.toString(16),6)},e.prototype.colorAt=function(e,t){return this.intToHexColor(this.intColorAt(e,t))},e}),define("views/map-layer-editor-view",["jquery","underscore","backbone","config","utils","text!templates/map-layer-editor.html","views/panel-view-base","mixins/model-editor-mixin","mixins/editor-widgets-mixin","lib/color-gradient/color-gradient"],function(e,t,n,r,i,s,o,u,a,f){var l=o.extend({className:"panel panel-default map-layer-editor",events:{"click .btn.save":"saveButtonClicked","click .btn.undo":"undoButtonClicked","click .btn.destroy":"destroyButtonClicked","click .btn.feature-type":"featureTypeClicked","change .model-input.layer-toggle":"layerToggled","change .model-input, .color-palette input, .color-palette select":"modelInputChanged","click .show-preview":"previewChanged","click .show-advanced":"showAdvancedChanged","click .generate-colors":"generateColorsClicked","click .import-export":"importExportClicked","click .import-settings":"importSettingsClicked","change textarea[name=settings-json]":"importSettingsChanged","click textarea[name=settings-json]":function(t){return e(t.currentTarget).select(),!1},"click .hide-color-generator":"hideColorGenerator","click .remove-color":"removeColorClicked","click .add-color":"addColorClicked","click .color-schemes .color-scheme a":"toggleColorScheme","click .add-color-scheme a":"addColorScheme","click .delete-color-scheme a":"deleteColorScheme","change .color-scheme-name":"colorSchemeNameChanged","keydown input[type=text]":function(t){if(t.which==13)return e(t.currentTarget).select(),e(t.currentTarget).trigger("change"),!1}},initialize:function(e){l.__super__.initialize.call(this,e),this.template=t.template(s),this.listenTo(this.model,"change",this.updateFromModel),this.listenTo(this.model,"sync",this.modelSynced),this.listenTo(this.model,"destroy",this.remove),this.colorSchemeIndex=this.model.getLayerOptions().colorSchemeIndex||0},modelSynced:function(e,t,n){if(n.poll||n.complete)return;this.model.hasChanged("layerOptions")&&this.populateFromModel()},render:function(){var t=this,n=this.model.attributes.featureCollection;return l.__super__.render.call(this),this.colorRowTemplate=this.$(".color-palette tr.element-template").remove().clone().removeClass("element-template"),this.initModelInputs(),this.$(".dropdown-toggle").dropdown(),this.$(".has-popover").each(function(){var n=e(this),r=n.attr("data-content-selector");if(r){var i=t.$(r).remove();e(this).popover({content:i,html:!0}),e(this).on("shown",function(e,t){n.addClass("active")}),e(this).on("hidden",function(e,t){n.removeClass("active")}),n.click(function(e){e.preventDefault()})}else e(this).popover({})}),this.$(".hint-toggle").each(function(){var n=t.$(".hint."+e(this).attr("data-target")).remove();e("a",n).click(function(){return window.open(e(this).attr("href")),!1}),e(this).popover({content:n,html:!0,placement:e(this).attr("data-placement")||"right"}),e(this).click(function(){return!1})}),this.initSliders(),this.populateFromModel(),this.initColorPicker(this.$(".model-input.color-picker")),this.$(".color-palette tbody tr").addClass("drag-handle"),this.$(".color-palette tbody").sortable({stop:function(e,n){t.modelInputChanged(e)}}),this.initColorPicker(this.$(".model-input.color-picker")),this.$(".has-tooltip").tooltip({delay:0,container:"body"}),this.model.canDisplayValues()&&this.$(".show-preview").addClass("active"),this},updateFromModel:function(e,t){this.$(".model-title").text(this.model.getDisplay("title")),this.$(".model-numeric").toggle(this.model.isNumeric()),this.$(".show-preview").attr("disabled",!this.model.canDisplayValues()),t&&t.complete&&this.model.canDisplayValues()&&this.$(".show-preview").addClass("active")},customInitModelInputs:function(){var n=this,r=this.model.getFeatureCollectionAttr("fields",[]);this.$("select.field-names").each(function(){var n=e(this).attr("data-type"),i=['<option value="">('+__("none")+")</option>"];t.each(r,function(e){e.name.match(/^properties\./)&&(!n||n==e.type)&&i.push('<option value="%(name)s">%(label)s</option>'.format(e))}),e(this).html(i.join("\n"))})},customPopulateFromModel:function(){this.updateFromModel(),this.$(".panel-header .title").text(this.model.get("layerOptions.title")),this.populateColorSchemes(),this.setButtonState(!1,!1),this.updateSliders()},customGetValuesFromModelInputs:function(e){var n=this,r=t.deepClone(this.model.get("layerOptions.colorSchemes"))||[{}];return r[this.colorSchemeIndex].colors=this.getColorsFromTable(),e["layerOptions.colorSchemes"]=r,e["layerOptions.colorSchemeIndex"]=this.colorSchemeIndex,e},undoButtonClicked:function(e){return this.colorSchemeIndex=this.savedModelAttributes.layerOptions.colorSchemeIndex||0,this.model.setColorScheme(this.colorSchemeIndex),this.model.set(this.savedModelAttributes),this.populateFromModel(),!1},saveButtonClicked:function(e){var t=this;return this.isChanged?(this.setButtonState(!1),this.updateModelFromInputs(),this.model.save({},{success:function(e,n,r){t.trigger("mapLayer:saved",t.model)},error:function(e,n,r){t.setButtonState(!0),t.handleValidationErrors(n)}}),!1):!1},destroyButtonClicked:function(e){var t=this;return window.confirm(__("Are you sure you want to delete this layer? This action cannot be reversed!"))&&this.model.destroy({success:function(e,n,r){t.trigger("mapLayer:destroyed",t.model)},error:function(e,t,n){}}),!1},featureTypeClicked:function(t){return this.populateModelInput("layerOptions.featureType",e(t.currentTarget).val()),this.modelInputChanged(t),!1},modelInputChanged:function(e){this.isChanged=!0,this.updateModel()},updateModel:function(){this.setButtonState(this.isChanged,!1),this.isPreviewEnabled()&&this.model.setColorScheme(this.colorSchemeIndex),this.updateModelFromInputs({silent:!this.isPreviewEnabled()})},previewChanged:function(e){return this.$(".show-preview").toggleClass("active"),this.isPreviewEnabled()&&this.updateModel(),!1},showAdvancedChanged:function(e){return this.$(".show-advanced").toggleClass("active"),this.setButtonState(null,!0),!1},isPreviewEnabled:function(){return this.$(".show-preview").is(".active")},hideColorGenerator:function(e){return this.$(".show-color-generator").popover("hide"),!1},setButtonState:function(t,n){t!=undefined&&(this.$(".btn.undo").attr("disabled",!t),this.$(".btn.save").attr("disabled",!t)),this.$(".remove-color").attr("disabled",this.$(".color-palette tbody tr").length<2),this.$(".color-palette tbody tr").length<=2?this.$(".show-color-generator").attr("disabled",!1):this.$(".show-color-generator").attr("disabled",!0),this.hideColorGenerator();var r=n?"fast":null,i=this.$(".show-advanced").is(".active");this.$(".advanced").each(function(){e(this).hasClass("feature-settings")||(i?e(this).show(r):e(this).hide(r))});var s=this.getValueFromModelInput("layerOptions.featureType");this.$(".feature-settings").each(function(){var t=e(this).hasClass(s)&&(i||!e(this).hasClass("advanced"));t?e(this).show(r):e(this).hide(r)})},addColorRow:function(t){var t=t||{},n=this.colorRowTemplate.clone();return n.attr("data-id",t._id),e("[name=position]",n).val(t.position||DEFAULT_COLOR_EDITOR_POSITION),this.initColorPicker(e(".color-picker",n),t.color||DEFAULT_COLOR_EDITOR_COLOR),e("[name=interpolation] option",n).each(function(){e(this).attr("selected",e(this).val()==t.interpolation||t.interpolation==""&&e(this).val()==f.prototype.interpolation.default)}),this.$(".color-palette tbody").append(n),n},populateColorSchemes:function(e){var n=this,r=this.model.get("layerOptions.colorSchemes");this.$(".color-schemes .dropdown-menu .color-scheme").remove();var i=[];t.map(r,function(e,t){i.push('<li class="color-scheme"><a class="toggle-color-scheme" data-index="'+t+'" href="#">'+e.name+"</a></li>")}),this.$(".color-schemes .dropdown-menu").append(i.join("\n")),(e||e==undefined)&&this.toggleColorScheme(),this.$(".delete-color-scheme").toggle(r!=undefined&&r.length>1),this.$(".color-scheme").toggle(r!=undefined&&r.length>0)},addColorScheme:function(e){e.preventDefault();var t=this,n=this.model.get("layerOptions.colorSchemes"),r={name:__("color scheme %(i)s",{i:n?n.length+1:1}),colors:[{color:DEFAULT_COLOR_EDITOR_COLOR,position:DEFAULT_COLOR_EDITOR_POSITION}]};n?n.push(r):(n=[r],this.model.set({"layerOptions.colorSchemes":n},{silent:!0})),this.colorSchemeIndex=n.length-1,this.populateColorSchemes(),this.modelInputChanged(),this.$(".color-scheme-name").select().focus()},deleteColorScheme:function(){event.preventDefault();var e=this,t=this.model.get("layerOptions.colorSchemes");if(t.length<2)return;t.splice(this.colorSchemeIndex,1),this.colorSchemeIndex=0,this.populateColorSchemes(),this.modelInputChanged()},colorSchemeNameChanged:function(t){var n=e(t.currentTarget),r=this.getCurrentColorScheme();n.val()==""?n.val(r.name):(r.name=n.val(),this.modelInputChanged(),this.populateColorSchemes(!1))},getCurrentColorScheme:function(){return this.model.get("layerOptions.colorSchemes")[this.colorSchemeIndex]},populateColorTable:function(e){var t=this;this.$(".color-palette tbody").empty();var e=e||this.getCurrentColorScheme().colors;for(var n=0;n<e.length;n++)var r=this.addColorRow(e[n])},toggleColorScheme:function(t){var n=this,r=this.model.get("layerOptions.colorSchemes");t&&(this.getCurrentColorScheme().colors=this.getColorsFromTable(),this.colorSchemeIndex=e(t.currentTarget).attr("data-index"),t.preventDefault());var i=this.model.getColorScheme(this.colorSchemeIndex),s=this.$(".color-schemes .dropdown-menu .color-scheme");s.removeClass("active"),e(s[this.colorSchemeIndex]).addClass("active"),this.$(".color-scheme-name").val(i.name),this.populateColorTable(i.colors),this.setButtonState(),t&&this.modelInputChanged()},getColorsFromTable:function(){var t=[];return this.$(".color-palette tbody tr").each(function(){if(e(this).is(".element-template"))return;var n={_id:e(this).attr("data-id"),color:e(".color-picker",this).val(),position:e("[name=position]",this).val(),interpolation:e("[name=interpolation]",this).val()};n._id.length||delete n._id,t.push(n)}),t},removeColorClicked:function(t){return e(t.currentTarget).attr("disabled")?!1:(e(t.currentTarget).closest("tr").remove(),this.modelInputChanged(),!1)},addColorClicked:function(e){return this.addColorRow(),this.modelInputChanged(),!1},importExportClicked:function(e){var n=t.extend({},this.model.getLayerOptions());for(var r in n)r[0]=="_"&&delete n[r];this.$("textarea[name=settings-json]").val(JSON.stringify(n)),this.$(".import-settings").attr("disabled",!0)},importSettingsChanged:function(e){try{var t=JSON.parse(this.$("textarea[name=settings-json]").val())}catch(n){}self.$(".import-settings").attr("disabled",!t)},importSettingsClicked:function(e){this.$(".import-export").popover("hide");var n=t.deepClone(this.model.attributes);this.model.setLayerOptions(JSON.parse(this.$("textarea[name=settings-json]").val())),this.populateFromModel(),this.setButtonState(!0,!1),this.isChanged=!0,this.savedModelAttributes=n},generateColorsClicked:function(t){var n=e("input[name=colorSchemeType]:checked").val(),r=parseInt(e("input[name=colorSchemeSteps]").val()),i=this.getColorsFromTable();this.$(".show-color-generator").popover("hide");if(r&&!isNaN(r)){var s=getRGBChannels(i[0].color),o=rgb2hsb(s),u=o[0],a=o[1],f=o[2],l=Math.min(.3,f),c=1,h=0,p=.3,d=.1,v=.75,m;switch(n){case"sequential":m=i.length>1?rgb2hsb(getRGBChannels(i[i.length-1].color)):[u,a,f<v?c:l];break;case"qualitative":case"diverging":m=i.length>1?rgb2hsb(getRGBChannels(i[i.length-1].color)):[(u+180)%360,a,f]}var g=m[0],y=m[1],b=m[2],w=hsb2rgb(m),E=function(e,t,n){return t+(n-t)*e},S=[],x=r>1?1/(r-1):0;for(var T=0;T<r;T++){var N=x*T,C=1-Math.abs(.5-N)/.5,k;switch(n){case"qualitative":var L=N+(T?T%2?x:-x:0),A=[(u+(g-u)*L)%360,E(N,a,y),E(N,f,b)];k=hsb2rgb(A);break;case"sequential":k=[E(N,s[0],w[0]),E(N,s[1],w[1]),E(N,s[2],w[2])];break;case"diverging":k=[E(N,s[0],w[0]),E(N,s[1],w[1]),E(N,s[2],w[2])];var A=rgb2hsb(k);A[2]=E(N,f,b),A[2]=Math.min(c,A[2]*(1+C*d)),A[1]=Math.max(h,A[1]-C*p),k=hsb2rgb(A)}var O=intToColor(rgb2int(k));S.push({color:O,position:Math.round(N*100)+"%",interpolation:"threshold"})}for(var T=0;T<S.length;T++)this.addColorRow(S[T]);this.populateColorTable(S),this.modelInputChanged()}return!1},layerToggled:function(t){this.model.toggleEnabled(e(t.currentTarget).is(":checked"))}});return t.extend(l.prototype,u),t.extend(l.prototype,a),l}),define("text!templates/map-layer.html",[],function(){return'\n    <div class="collapsible-heading">\n        <a class="collapse-toggle model-editable" data-toggle="collapse" data-text=".model-title" data-name="title" href="#">\n            <span class="icon in-out"></span><span class="heading model-title"></span>\n        </a>\n\n        <div class="btn-group btn-group-xs layer-tools">\n            <button type="button" class="btn btn-default admin-control map-tool show-layer-editor has-tooltip" data-title="Edit layer"><span class="glyphicon glyphicon-wrench"></span></button>\n            <!--<button type="button" class="btn btn-default move-layer drag-handle"><span class="glyphicon glyphicon-move"></span></button>-->\n            <button type="button" class="btn btn-default map-tool show-layer-details has-tooltip" data-title="About this layer"><span class="glyphicon glyphicon-question-sign"></span></button>\n            <button type="button" class="btn btn-default map-tool show-layer-extents has-tooltip" data-title="Zoom to extents"><span class="glyphicon glyphicon-zoom-in"></span></button>\n            <button type="button" class="btn btn-default map-tool show-layer-graphs has-tooltip" data-toggle="tooltip" data-title="Show graphs"><span class="glyphicon glyphicon-stats"></span></button>\n            <button type="button" class="btn btn-default map-tool toggle-layer has-tooltip" data-title="Toggle layer"><span class="glyphicon glyphicon-eye-open"></span></button>\n\n            <button type="button" class="btn btn-default admin-control library-tool edit-collection has-tooltip" data-title="Edit information"><span class="glyphicon glyphicon-pencil"></span></button>\n            <button type="button" class="btn btn-default library-tool toggle-layer has-tooltip" data-title="About this collection"><span class="glyphicon glyphicon-eye-open"></span></button>\n            <button type="button" class="btn btn-default admin-control library-tool sharing-status has-tooltip" data-title="Sharing"><span class="glyphicon glyphicon-globe is-public"></span><span class="glyphicon glyphicon-lock is-private"></span></button>\n            <button type="button" class="btn btn-default library-tool library-map-tool add-layer has-tooltip" data-title="Add to map"><span class="glyphicon glyphicon-map-marker"></span></button>\n\n        </div>\n    </div>\n\n    <div class="status muted">\n        <div class="text">status text</div>\n        <div class="state-indicator"></div>\n    </div>\n    <div class="progress progress-striped active" style="display: none">\n        <div class="bar" style="width: 40%;"></div>\n    </div>\n    <a class="legend-button toggle"></a>\n\n    <div class="collapse">\n        <div class="collapse-content">\n            <div class="graphs"></div>\n            <div class="legend"></div>\n            <div class="details">\n                <div class="box description text-body muted micro">description</div>\n            </div>\n            <div class="source micro muted text">source</div>\n        </div>\n    </div>\n\n'}),define("text!templates/histogram.html",[],function(){return"<!-- histogram -->"}),define("views/graphs/graph-view-base",["jquery","underscore","backbone","config","utils"],function(e,t,n,r,i){var s=n.View.extend({className:"graph",scopes:[GraphScope.OVERALL],initialize:function(e){var t=this;this.renderAxes=e.renderAxes,this.renderAxes?this.graphMargins={top:20,right:30,bottom:20,left:50}:this.graphMargins={top:0,right:0,bottom:0,left:0},this.viewWidth=undefined,this.viewHeight=undefined,this.graphRendered=!1,this.collection&&this.listenTo(this.collection,"reset",function(){t.redrawGraphIfVisible()})},setScope:function(e){this.scopes[e]&&(this.scope=e,this.collection.fetch())},fillExtents:function(){var e=this.$el.parent().innerWidth();return e&&this.$el.css({width:this.$el.parent().innerWidth()+"px"}),this.setViewSize(this.$el.innerWidth(),this.$el.innerHeight()),this},setViewSize:function(e,t){this.viewWidth=e,this.viewHeight=t,this.graphWidth=this.viewWidth-this.graphMargins.left-this.graphMargins.right,this.graphHeight=this.viewHeight-this.graphMargins.top-this.graphMargins.bottom},appendSVG:function(){return d3.select(this.el).append("svg").attr("width",this.viewWidth).attr("height",this.viewHeight).append("g").attr("transform","translate("+this.graphMargins.left+","+this.graphMargins.top+")")},getXRange:function(){return[0,this.graphWidth]},getYRange:function(){return[this.graphHeight,0]},appendXAxis:function(e,t){return this.svg.append("g").attr("class","axis").attr("transform","translate(0, "+this.graphHeight+")").call(e).append("text").attr("class","label contrast").attr("x",this.graphWidth).attr("y",-6).style("text-anchor","end").text(t)},appendYAxis:function(e,t){return this.svg.append("g").attr("class","axis").call(e).append("text").attr("class","label contrast").attr("x",10).attr("y",-6).style("text-anchor","left").text(t)},showTooltip:function(t,n){var r=this;e(t).tooltip({title:n,container:r.$el}).tooltip("show").on("hidden.bs.tooltip",function(){e(t).off().tooltip("destroy")})},render:function(){return e(this.el).html(this.template()),this},renderGraph:function(){return this.__suppressLog||console.log("Rendering graph for ",this.model.id,this.model.getDisplay("title")),this.trigger("graph:render"),this.graphRendered=!0,this.viewWidth||this.fillExtents(),this.$el.empty(),this.svg=this.appendSVG(),this},redrawGraph:function(){return console.log("Redrawing graph for ",this.model.id,this.model.getDisplay("title")),this.trigger("graph:redraw"),this.__suppressLog=!0,this.renderGraph(),this.__suppressLog=!1,this},graphVisible:function(){return this.$el.is(":visible")},redrawGraphIfVisible:function(){return this.graphVisible()&&this.redrawGraph(),this},show:function(){this.collection.visibleMapAreaFetched||this.collection.fetch(),this.$el.show(),this.redrawGraph()},hide:function(){this.$el.hide()}});return s}),function(){function e(e,t){try{for(var n in t)Object.defineProperty(e.prototype,n,{value:t[n],enumerable:!1})}catch(r){e.prototype=t}}function t(e){var t=-1,n=e.length,r=[];while(++t<n)r.push(e[t]);return r}function n(e){return Array.prototype.slice.call(e)}function r(){}function i(){return this}function s(e,t,n){return function(){var r=n.apply(t,arguments);return arguments.length?e:r}}function o(e){return e!=null&&!isNaN(e)}function u(e){return e.length}function a(e){return e==null}function f(e){return e.replace(/(^\s+)|(\s+$)/g,"").replace(/\s+/g," ")}function l(e){var t=1;while(e*t%1)t*=10;return t}function c(){}function h(e){function t(){var t=n,r=-1,i=t.length,s;while(++r<i)(s=t[r].on)&&s.apply(this,arguments);return e}var n=[],i=new r;return t.on=function(t,r){var s=i.get(t),o;return arguments.length<2?s&&s.on:(s&&(s.on=null,n=n.slice(0,o=n.indexOf(s)).concat(n.slice(o+1)),i.remove(t)),r&&n.push(i.set(t,{on:r})),e)},t}function p(e,t){return t-(e?1+Math.floor(Math.log(e+Math.pow(10,1+Math.floor(Math.log(e)/Math.LN10)-t))/Math.LN10):1)}function v(e){return e+""}function m(e){var t=e.lastIndexOf("."),n=t>=0?e.substring(t):(t=e.length,""),r=[];while(t>0)r.push(e.substring(t-=3,t+3));return r.reverse().join(",")+n}function g(e,t){return{scale:Math.pow(10,(8-t)*3),symbol:e}}function y(e){return function(t){return t<=0?0:t>=1?1:e(t)}}function b(e){return function(t){return 1-e(1-t)}}function w(e){return function(t){return.5*(t<.5?e(2*t):2-e(2-2*t))}}function E(e){return e}function S(e){return function(t){return Math.pow(t,e)}}function x(e){return 1-Math.cos(e*Math.PI/2)}function T(e){return Math.pow(2,10*(e-1))}function N(e){return 1-Math.sqrt(1-e*e)}function C(e,t){var n;return arguments.length<2&&(t=.45),arguments.length<1?(e=1,n=t/4):n=t/(2*Math.PI)*Math.asin(1/e),function(r){return 1+e*Math.pow(2,10*-r)*Math.sin((r-n)*2*Math.PI/t)}}function k(e){return e||(e=1.70158),function(t){return t*t*((e+1)*t-e)}}function L(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}function A(){d3.event.stopPropagation(),d3.event.preventDefault()}function O(){var e=d3.event,t;while(t=e.sourceEvent)e=t;return e}function M(e){var t=new c,n=0,r=arguments.length;while(++n<r)t[arguments[n]]=h(t);return t.of=function(n,r){return function(i){try{var s=i.sourceEvent=d3.event;i.target=e,d3.event=i,t[i.type].apply(n,r)}finally{d3.event=s}}},t}function _(e){return e=="transform"?d3.interpolateTransform:d3.interpolate}function D(e,t){return t=t-(e=+e)?1/(t-e):0,function(n){return(n-e)*t}}function P(e,t){return t=t-(e=+e)?1/(t-e):0,function(n){return Math.max(0,Math.min(1,(n-e)*t))}}function H(e,t,n){return new B(e,t,n)}function B(e,t,n){this.r=e,this.g=t,this.b=n}function j(e){return e<16?"0"+Math.max(0,e).toString(16):Math.min(255,e).toString(16)}function F(e,t,n){var r=0,i=0,s=0,o,u,a;o=/([a-z]+)\((.*)\)/i.exec(e);if(o){u=o[2].split(",");switch(o[1]){case"hsl":return n(parseFloat(u[0]),parseFloat(u[1])/100,parseFloat(u[2])/100);case"rgb":return t(q(u[0]),q(u[1]),q(u[2]))}}return(a=Ui.get(e))?t(a.r,a.g,a.b):(e!=null&&e.charAt(0)==="#"&&(e.length===4?(r=e.charAt(1),r+=r,i=e.charAt(2),i+=i,s=e.charAt(3),s+=s):e.length===7&&(r=e.substring(1,3),i=e.substring(3,5),s=e.substring(5,7)),r=parseInt(r,16),i=parseInt(i,16),s=parseInt(s,16)),t(r,i,s))}function I(e,t,n){var r=Math.min(e/=255,t/=255,n/=255),i=Math.max(e,t,n),s=i-r,o,u,a=(i+r)/2;return s?(u=a<.5?s/(i+r):s/(2-i-r),e==i?o=(t-n)/s+(t<n?6:0):t==i?o=(n-e)/s+2:o=(e-t)/s+4,o*=60):u=o=0,R(o,u,a)}function q(e){var t=parseFloat(e);return e.charAt(e.length-1)==="%"?Math.round(t*2.55):t}function R(e,t,n){return new U(e,t,n)}function U(e,t,n){this.h=e,this.s=t,this.l=n}function z(e,t,n){function r(e){return e>360?e-=360:e<0&&(e+=360),e<60?s+(o-s)*e/60:e<180?o:e<240?s+(o-s)*(240-e)/60:s}function i(e){return Math.round(r(e)*255)}var s,o;return e%=360,e<0&&(e+=360),t=t<0?0:t>1?1:t,n=n<0?0:n>1?1:n,o=n<=.5?n*(1+t):n+t-n*t,s=2*n-o,H(i(e+120),i(e),i(e-120))}function W(e){return ki(e,Ji),e}function X(e){return function(){return zi(e,this)}}function V(e){return function(){return Wi(e,this)}}function $(e,t){function n(){if(t=this.classList)return t.add(e);var t=this.className,n=t.baseVal!=null,r=n?t.baseVal:t;s.lastIndex=0,s.test(r)||(r=f(r+" "+e),n?t.baseVal=r:this.className=r)}function r(){if(t=this.classList)return t.remove(e);var t=this.className,n=t.baseVal!=null,r=n?t.baseVal:t;r=f(r.replace(s," ")),n?t.baseVal=r:this.className=r}function i(){(t.apply(this,arguments)?n:r).call(this)}var s=new RegExp("(^|\\s+)"+d3.requote(e)+"(\\s+|$)","g");if(arguments.length<2){var o=this.node();if(u=o.classList)return u.contains(e);var u=o.className;return s.lastIndex=0,s.test(u.baseVal!=null?u.baseVal:u)}return this.each(typeof t=="function"?i:t?n:r)}function J(e){return{__data__:e}}function K(e){return function(){return $i(this,e)}}function Q(e){return arguments.length||(e=d3.ascending),function(t,n){return e(t&&t.__data__,n&&n.__data__)}}function G(e){return ki(e,Gi),e}function Y(e,t,n){ki(e,Zi);var i=new r,s=d3.dispatch("start","end"),o=us;return e.id=t,e.time=n,e.tween=function(t,n){return arguments.length<2?i.get(t):(n==null?i.remove(t):i.set(t,n),e)},e.ease=function(t){return arguments.length?(o=typeof t=="function"?t:d3.ease.apply(d3,arguments),e):o},e.each=function(t,n){return arguments.length<2?tt.call(e,t):(s.on(t,n),e)},d3.timer(function(r){return e.each(function(u,a,f){function l(e){return y.active>t?h():(y.active=t,i.forEach(function(e,t){(tween=t.call(v,u,a))&&p.push(tween)}),s.start.call(v,u,a),c(e)||d3.timer(c,0,n),1)}function c(e){if(y.active!==t)return h();var n=(e-m)/g,r=o(n),i=p.length;while(i>0)p[--i].call(v,r);if(n>=1)return h(),ts=t,s.end.call(v,u,a),ts=0,1}function h(){return--y.count||delete v.__transition__,1}var p=[],v=this,m=e[f][a].delay,g=e[f][a].duration,y=v.__transition__||(v.__transition__={active:0,count:0});++y.count,m<=r?l(r):d3.timer(l,m,n)}),1},0,n),e}function Z(e,t,n){return n!=""&&Yi}function et(e,t){function n(e,n,r){var s=t.call(this,e,n);return s==null?r!=""&&Yi:r!=s&&i(r,s)}function r(e,n,r){return r!=t&&i(r,t)}var i=_(e);return typeof t=="function"?n:t==null?Z:(t+="",r)}function tt(e){var t=ts,n=us,r=ss,i=os;ts=this.id,us=this.ease();for(var s=0,o=this.length;s<o;s++)for(var u=this[s],a=0,f=u.length;a<f;a++){var l=u[a];l&&(ss=this[s][a].delay,os=this[s][a].duration,e.call(l=l.node,l.__data__,a,s))}return ts=t,us=n,ss=r,os=i,this}function nt(){var e,t=Date.now(),n=as;while(n)e=t-n.then,e>=n.delay&&(n.flush=n.callback(e)),n=n.next;var r=rt()-t;r>24?(isFinite(r)&&(clearTimeout(ls),ls=setTimeout(nt,r)),fs=0):(fs=1,cs(nt))}function rt(){var e=null,t=as,n=Infinity;while(t)t.flush?t=e?e.next=t.next:as=t.next:(n=Math.min(n,t.then+t.delay),t=(e=t).next);return n}function it(e){var t=[e.a,e.b],n=[e.c,e.d],r=ot(t),i=st(t,n),s=ot(ut(n,t,-i))||0;t[0]*n[1]<n[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,i*=-1),this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-n[0],n[1]))*hs,this.translate=[e.e,e.f],this.scale=[r,s],this.skew=s?Math.atan2(i,s)*hs:0}function st(e,t){return e[0]*t[0]+e[1]*t[1]}function ot(e){var t=Math.sqrt(st(e,e));return t&&(e[0]/=t,e[1]/=t),t}function ut(e,t,n){return e[0]+=n*t[0],e[1]+=n*t[1],e}function at(e,t){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();if(ps<0&&(window.scrollX||window.scrollY)){n=d3.select(document.body).append("svg").style("position","absolute").style("top",0).style("left",0);var i=n[0][0].getScreenCTM();ps=!i.f&&!i.e,n.remove()}return ps?(r.x=t.pageX,r.y=t.pageY):(r.x=t.clientX,r.y=t.clientY),r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}var s=e.getBoundingClientRect();return[t.clientX-s.left-e.clientLeft,t.clientY-s.top-e.clientTop]}function ft(){}function lt(e){var t=e[0],n=e[e.length-1];return t<n?[t,n]:[n,t]}function ct(e){return e.rangeExtent?e.rangeExtent():lt(e.range())}function ht(e,t){var n=0,r=e.length-1,i=e[n],s=e[r],o;s<i&&(o=n,n=r,r=o,o=i,i=s,s=o);if(o=s-i)t=t(o),e[n]=t.floor(i),e[r]=t.ceil(s);return e}function pt(){return Math}function dt(e,t,n,r){function i(){var i=Math.min(e.length,t.length)>2?Et:wt,a=r?P:D;return o=i(e,t,a,n),u=i(t,e,a,d3.interpolate),s}function s(e){return o(e)}var o,u;return s.invert=function(e){return u(e)},s.domain=function(t){return arguments.length?(e=t.map(Number),i()):e},s.range=function(e){return arguments.length?(t=e,i()):t},s.rangeRound=function(e){return s.range(e).interpolate(d3.interpolateRound)},s.clamp=function(e){return arguments.length?(r=e,i()):r},s.interpolate=function(e){return arguments.length?(n=e,i()):n},s.ticks=function(t){return yt(e,t)},s.tickFormat=function(t){return bt(e,t)},s.nice=function(){return ht(e,mt),i()},s.copy=function(){return dt(e,t,n,r)},i()}function vt(e,t){return d3.rebind(e,t,"range","rangeRound","interpolate","clamp")}function mt(e){return e=Math.pow(10,Math.round(Math.log(e)/Math.LN10)-1),{floor:function(t){return Math.floor(t/e)*e},ceil:function(t){return Math.ceil(t/e)*e}}}function gt(e,t){var n=lt(e),r=n[1]-n[0],i=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),s=t/r*i;return s<=.15?i*=10:s<=.35?i*=5:s<=.75&&(i*=2),n[0]=Math.ceil(n[0]/i)*i,n[1]=Math.floor(n[1]/i)*i+i*.5,n[2]=i,n}function yt(e,t){return d3.range.apply(d3,gt(e,t))}function bt(e,t){return d3.format(",."+Math.max(0,-Math.floor(Math.log(gt(e,t)[2])/Math.LN10+.01))+"f")}function wt(e,t,n,r){var i=n(e[0],e[1]),s=r(t[0],t[1]);return function(e){return s(i(e))}}function Et(e,t,n,r){var i=[],s=[],o=0,u=Math.min(e.length,t.length)-1;e[u]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());while(++o<=u)i.push(n(e[o-1],e[o])),s.push(r(t[o-1],t[o]));return function(t){var n=d3.bisect(e,t,1,u)-1;return s[n](i[n](t))}}function St(e,t){function n(n){return e(t(n))}var r=t.pow;return n.invert=function(t){return r(e.invert(t))},n.domain=function(i){return arguments.length?(t=i[0]<0?Tt:xt,r=t.pow,e.domain(i.map(t)),n):e.domain().map(r)},n.nice=function(){return e.domain(ht(e.domain(),pt)),n},n.ticks=function(){var n=lt(e.domain()),i=[];if(n.every(isFinite)){var s=Math.floor(n[0]),o=Math.ceil(n[1]),u=r(n[0]),a=r(n[1]);if(t===Tt){i.push(r(s));for(;s++<o;)for(var f=9;f>0;f--)i.push(r(s)*f)}else{for(;s<o;s++)for(var f=1;f<10;f++)i.push(r(s)*f);i.push(r(s))}for(s=0;i[s]<u;s++);for(o=i.length;i[o-1]>a;o--);i=i.slice(s,o)}return i},n.tickFormat=function(e,i){arguments.length<2&&(i=ds);if(arguments.length<1)return i;var s=e/n.ticks().length,o=t===Tt?(u=-1e-12,Math.floor):(u=1e-12,Math.ceil),u;return function(e){return e/r(o(t(e)+u))<s?i(e):""}},n.copy=function(){return St(e.copy(),t)},vt(n,e)}function xt(e){return Math.log(e<0?0:e)/Math.LN10}function Tt(e){return-Math.log(e>0?0:-e)/Math.LN10}function Nt(e,t){function n(t){return e(r(t))}var r=Ct(t),i=Ct(1/t);return n.invert=function(t){return i(e.invert(t))},n.domain=function(t){return arguments.length?(e.domain(t.map(r)),n):e.domain().map(i)},n.ticks=function(e){return yt(n.domain(),e)},n.tickFormat=function(e){return bt(n.domain(),e)},n.nice=function(){return n.domain(ht(n.domain(),mt))},n.exponent=function(e){if(!arguments.length)return t;var s=n.domain();return r=Ct(t=e),i=Ct(1/t),n.domain(s)},n.copy=function(){return Nt(e.copy(),t)},vt(n,e)}function Ct(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function kt(e,t){function n(t){return o[((s.get(t)||s.set(t,e.push(t)))-1)%o.length]}function i(t,n){return d3.range(e.length).map(function(e){return t+n*e})}var s,o,u;return n.domain=function(i){if(!arguments.length)return e;e=[],s=new r;var o=-1,u=i.length,a;while(++o<u)s.has(a=i[o])||s.set(a,e.push(a));return n[t.t](t.x,t.p)},n.range=function(e){return arguments.length?(o=e,u=0,t={t:"range",x:e},n):o},n.rangePoints=function(r,s){arguments.length<2&&(s=0);var a=r[0],f=r[1],l=(f-a)/(e.length-1+s);return o=i(e.length<2?(a+f)/2:a+l*s/2,l),u=0,t={t:"rangePoints",x:r,p:s},n},n.rangeBands=function(r,s){arguments.length<2&&(s=0);var a=r[1]<r[0],f=r[a-0],l=r[1-a],c=(l-f)/(e.length+s);return o=i(f+c*s,c),a&&o.reverse(),u=c*(1-s),t={t:"rangeBands",x:r,p:s},n},n.rangeRoundBands=function(r,s){arguments.length<2&&(s=0);var a=r[1]<r[0],f=r[a-0],l=r[1-a],c=Math.floor((l-f)/(e.length+s)),h=l-f-(e.length-s)*c;return o=i(f+Math.round(h/2),c),a&&o.reverse(),u=Math.round(c*(1-s)),t={t:"rangeRoundBands",x:r,p:s},n},n.rangeBand=function(){return u},n.rangeExtent=function(){return lt(t.x)},n.copy=function(){return kt(e,t)},n.domain(e)}function Lt(e,t){function n(){var n=0,s=e.length,o=t.length;i=[];while(++n<o)i[n-1]=d3.quantile(e,n/o);return r}function r(e){return isNaN(e=+e)?NaN:t[d3.bisect(i,e)]}var i;return r.domain=function(t){return arguments.length?(e=t.filter(function(e){return!isNaN(e)}).sort(d3.ascending),n()):e},r.range=function(e){return arguments.length?(t=e,n()):t},r.quantiles=function(){return i},r.copy=function(){return Lt(e,t)},n()}function At(e,t,n){function r(t){return n[Math.max(0,Math.min(o,Math.floor(s*(t-e))))]}function i(){return s=n.length/(t-e),o=n.length-1,r}var s,o;return r.domain=function(n){return arguments.length?(e=+n[0],t=+n[n.length-1],i()):[e,t]},r.range=function(e){return arguments.length?(n=e,i()):n},r.copy=function(){return At(e,t,n)},i()}function Ot(e){function t(e){return+e}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=n.map(t),t):e},t.ticks=function(t){return yt(e,t)},t.tickFormat=function(t){return bt(e,t)},t.copy=function(){return Ot(e)},t}function Mt(e){return e.innerRadius}function _t(e){return e.outerRadius}function Dt(e){return e.startAngle}function Pt(e){return e.endAngle}function Ht(e){function t(t){return t.length<1?null:"M"+s(e(Bt(this,t,n,r)),o)}var n=jt,r=Ft,i=Es,s=Ss.get(i),o=.7;return t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(r=e,t):r},t.interpolate=function(e){return arguments.length?(Ss.has(e+="")||(e=Es),s=Ss.get(i=e),t):i},t.tension=function(e){return arguments.length?(o=e,t):o},t}function Bt(e,t,n,r){var i=[],s=-1,o=t.length,u=typeof n=="function",a=typeof r=="function",f;if(u&&a)while(++s<o)i.push([n.call(e,f=t[s],s),r.call(e,f,s)]);else if(u)while(++s<o)i.push([n.call(e,t[s],s),r]);else if(a)while(++s<o)i.push([n,r.call(e,t[s],s)]);else while(++s<o)i.push([n,r]);return i}function jt(e){return e[0]}function Ft(e){return e[1]}function It(e){var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];while(++t<n)i.push("L",(r=e[t])[0],",",r[1]);return i.join("")}function qt(e){var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];while(++t<n)i.push("V",(r=e[t])[1],"H",r[0]);return i.join("")}function Rt(e){var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];while(++t<n)i.push("H",(r=e[t])[0],"V",r[1]);return i.join("")}function Ut(e,t){return e.length<4?It(e):e[1]+Xt(e.slice(1,e.length-1),Vt(e,t))}function zt(e,t){return e.length<3?It(e):e[0]+Xt((e.push(e[0]),e),Vt([e[e.length-2]].concat(e,[e[1]]),t))}function Wt(e,t,n){return e.length<3?It(e):e[0]+Xt(e,Vt(e,t))}function Xt(e,t){if(t.length<1||e.length!=t.length&&e.length!=t.length+2)return It(e);var n=e.length!=t.length,r="",i=e[0],s=e[1],o=t[0],u=o,a=1;n&&(r+="Q"+(s[0]-o[0]*2/3)+","+(s[1]-o[1]*2/3)+","+s[0]+","+s[1],i=e[1],a=2);if(t.length>1){u=t[1],s=e[a],a++,r+="C"+(i[0]+o[0])+","+(i[1]+o[1])+","+(s[0]-u[0])+","+(s[1]-u[1])+","+s[0]+","+s[1];for(var f=2;f<t.length;f++,a++)s=e[a],u=t[f],r+="S"+(s[0]-u[0])+","+(s[1]-u[1])+","+s[0]+","+s[1]}if(n){var l=e[a];r+="Q"+(s[0]+u[0]*2/3)+","+(s[1]+u[1]*2/3)+","+l[0]+","+l[1]}return r}function Vt(e,t){var n=[],r=(1-t)/2,i,s=e[0],o=e[1],u=1,a=e.length;while(++u<a)i=s,s=o,o=e[u],n.push([r*(o[0]-i[0]),r*(o[1]-i[1])]);return n}function $t(e){if(e.length<3)return It(e);var t=1,n=e.length,r=e[0],i=r[0],s=r[1],o=[i,i,i,(r=e[1])[0]],u=[s,s,s,r[1]],a=[i,",",s];Yt(a,o,u);while(++t<n)r=e[t],o.shift(),o.push(r[0]),u.shift(),u.push(r[1]),Yt(a,o,u);t=-1;while(++t<2)o.shift(),o.push(r[0]),u.shift(),u.push(r[1]),Yt(a,o,u);return a.join("")}function Jt(e){if(e.length<4)return It(e);var t=[],n=-1,r=e.length,i,s=[0],o=[0];while(++n<3)i=e[n],s.push(i[0]),o.push(i[1]);t.push(Gt(Ns,s)+","+Gt(Ns,o)),--n;while(++n<r)i=e[n],s.shift(),s.push(i[0]),o.shift(),o.push(i[1]),Yt(t,s,o);return t.join("")}function Kt(e){var t,n=-1,r=e.length,i=r+4,s,o=[],u=[];while(++n<4)s=e[n%r],o.push(s[0]),u.push(s[1]);t=[Gt(Ns,o),",",Gt(Ns,u)],--n;while(++n<i)s=e[n%r],o.shift(),o.push(s[0]),u.shift(),u.push(s[1]),Yt(t,o,u);return t.join("")}function Qt(e,t){var n=e.length-1,r=e[0][0],i=e[0][1],s=e[n][0]-r,o=e[n][1]-i,u=-1,a,f;while(++u<=n)a=e[u],f=u/n,a[0]=t*a[0]+(1-t)*(r+f*s),a[1]=t*a[1]+(1-t)*(i+f*o);return $t(e)}function Gt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Yt(e,t,n){e.push("C",Gt(xs,t),",",Gt(xs,n),",",Gt(Ts,t),",",Gt(Ts,n),",",Gt(Ns,t),",",Gt(Ns,n))}function Zt(e,t){return(t[1]-e[1])/(t[0]-e[0])}function en(e){var t=0,n=e.length-1,r=[],i=e[0],s=e[1],o=r[0]=Zt(i,s);while(++t<n)r[t]=o+(o=Zt(i=s,s=e[t+1]));return r[t]=o,r}function tn(e){var t=[],n,r,i,s,o=en(e),u=-1,a=e.length-1;while(++u<a)n=Zt(e[u],e[u+1]),Math.abs(n)<1e-6?o[u]=o[u+1]=0:(r=o[u]/n,i=o[u+1]/n,s=r*r+i*i,s>9&&(s=n*3/Math.sqrt(s),o[u]=s*r,o[u+1]=s*i));u=-1;while(++u<=a)s=(e[Math.min(a,u+1)][0]-e[Math.max(0,u-1)][0])/(6*(1+o[u]*o[u])),t.push([s||0,o[u]*s||0]);return t}function nn(e){return e.length<3?It(e):e[0]+Xt(e,tn(e))}function rn(e){var t,n=-1,r=e.length,i,s;while(++n<r)t=e[n],i=t[0],s=t[1]+bs,t[0]=i*Math.cos(s),t[1]=i*Math.sin(s);return e}function sn(e){function t(t){if(t.length<1)return null;var o=Bt(this,t,n,i),l=Bt(this,t,n===r?on(o):r,i===s?un(o):s);return"M"+u(e(l),f)+"L"+a(e(o.reverse()),f)+"Z"}var n=jt,r=jt,i=0,s=Ft,o,u,a,f=.7;return t.x=function(e){return arguments.length?(n=r=e,t):r},t.x0=function(e){return arguments.length?(n=e,t):n},t.x1=function(e){return arguments.length?(r=e,t):r},t.y=function(e){return arguments.length?(i=s=e,t):s},t.y0=function(e){return arguments.length?(i=e,t):i},t.y1=function(e){return arguments.length?(s=e,t):s},t.interpolate=function(e){return arguments.length?(Ss.has(e+="")||(e=Es),u=Ss.get(o=e),a=u.reverse||u,t):o},t.tension=function(e){return arguments.length?(f=e,t):f},t.interpolate("linear")}function on(e){return function(t,n){return e[n][0]}}function un(e){return function(t,n){return e[n][1]}}function an(e){return e.source}function fn(e){return e.target}function ln(e){return e.radius}function cn(e){return e.startAngle}function hn(e){return e.endAngle}function pn(e){return[e.x,e.y]}function dn(e){return function(){var t=e.apply(this,arguments),n=t[0],r=t[1]+bs;return[n*Math.cos(r),n*Math.sin(r)]}}function vn(){return 64}function mn(){return"circle"}function gn(e){var t=Math.sqrt(e/Math.PI);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+ -t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function yn(e,t){e.attr("transform",function(e){return"translate("+t(e)+",0)"})}function bn(e,t){e.attr("transform",function(e){return"translate(0,"+t(e)+")"})}function wn(e,t,n){i=[];if(n&&t.length>1){var r=lt(e.domain()),i,s=-1,o=t.length,u=(t[1]-t[0])/++n,a,f;while(++s<o)for(a=n;--a>0;)(f=+t[s]-a*u)>=r[0]&&i.push(f);for(--s,a=0;++a<n&&(f=+t[s]+a*u)<r[1];)i.push(f)}return i}function En(){Ms||(Ms=d3.select("body").append("div").style("visibility","hidden").style("top",0).style("height",0).style("width",0).style("overflow-y","scroll").append("div").style("height","2000px").node().parentNode);var e=d3.event,t;try{Ms.scrollTop=1e3,Ms.dispatchEvent(e),t=1e3-Ms.scrollTop}catch(n){t=e.wheelDelta||-e.detail*5}return t}function Sn(e){var t=e.source,n=e.target,r=Tn(t,n),i=[t];while(t!==r)t=t.parent,i.push(t);var s=i.length;while(n!==r)i.splice(s,0,n),n=n.parent;return i}function xn(e){var t=[],n=e.parent;while(n!=null)t.push(e),e=n,n=n.parent;return t.push(e),t}function Tn(e,t){if(e===t)return e;var n=xn(e),r=xn(t),i=n.pop(),s=r.pop(),o=null;while(i===s)o=i,i=n.pop(),s=r.pop();return o}function Nn(e){e.fixed|=2}function Cn(e){e!==Ps&&(e.fixed&=1)}function kn(){Ps.fixed&=1,Ds=Ps=null}function Ln(){Ps.px=d3.event.x,Ps.py=d3.event.y,Ds.resume()}function An(e,t,n){var r=0,i=0;e.charge=0;if(!e.leaf){var s=e.nodes,o=s.length,u=-1,a;while(++u<o){a=s[u];if(a==null)continue;An(a,t,n),e.charge+=a.charge,r+=a.charge*a.cx,i+=a.charge*a.cy}}if(e.point){e.leaf||(e.point.x+=Math.random()-.5,e.point.y+=Math.random()-.5);var f=t*n[e.point.index];e.charge+=e.pointCharge=f,r+=f*e.point.x,i+=f*e.point.y}e.cx=r/e.charge,e.cy=i/e.charge}function On(e){return 20}function Mn(e){return 1}function _n(e){return e.x}function Dn(e){return e.y}function Pn(e,t,n){e.y0=t,e.y=n}function Hn(e){return d3.range(e.length)}function Bn(e){var t=-1,n=e[0].length,r=[];while(++t<n)r[t]=0;return r}function jn(e){var t=1,n=0,r=e[0][1],i,s=e.length;for(;t<s;++t)(i=e[t][1])>r&&(n=t,r=i);return n}function Fn(e){return e.reduce(In,0)}function In(e,t){return e+t[1]}function qn(e,t){return Rn(e,Math.ceil(Math.log(t.length)/Math.LN2+1))}function Rn(e,t){var n=-1,r=+e[0],i=(e[1]-r)/t,s=[];while(++n<=t)s[n]=i*n+r;return s}function Un(e){return[d3.min(e),d3.max(e)]}function zn(e,t){return d3.rebind(e,t,"sort","children","value"),e.links=$n,e.nodes=function(t){return Fs=!0,(e.nodes=e)(t)},e}function Wn(e){return e.children}function Xn(e){return e.value}function Vn(e,t){return t.value-e.value}function $n(e){return d3.merge(e.map(function(e){return(e.children||[]).map(function(t){return{source:e,target:t}})}))}function Jn(e,t){return e.value-t.value}function Kn(e,t){var n=e._pack_next;e._pack_next=t,t._pack_prev=e,t._pack_next=n,n._pack_prev=t}function Qn(e,t){e._pack_next=t,t._pack_prev=e}function Gn(e,t){var n=t.x-e.x,r=t.y-e.y,i=e.r+t.r;return i*i-n*n-r*r>.001}function Yn(e){function t(e){n=Math.min(e.x-e.r,n),r=Math.max(e.x+e.r,r),i=Math.min(e.y-e.r,i),s=Math.max(e.y+e.r,s)}var n=Infinity,r=-Infinity,i=Infinity,s=-Infinity,o=e.length,u,a,f,l,c;e.forEach(Zn),u=e[0],u.x=-u.r,u.y=0,t(u);if(o>1){a=e[1],a.x=a.r,a.y=0,t(a);if(o>2){f=e[2],rr(u,a,f),t(f),Kn(u,f),u._pack_prev=f,Kn(f,a),a=u._pack_next;for(var h=3;h<o;h++){rr(u,a,f=e[h]);var p=0,d=1,v=1;for(l=a._pack_next;l!==a;l=l._pack_next,d++)if(Gn(l,f)){p=1;break}if(p==1)for(c=u._pack_prev;c!==l._pack_prev;c=c._pack_prev,v++)if(Gn(c,f))break;p?(d<v||d==v&&a.r<u.r?Qn(u,a=l):Qn(u=c,a),h--):(Kn(u,f),a=f,t(f))}}}var m=(n+r)/2,g=(i+s)/2,y=0;for(var h=0;h<o;h++){var b=e[h];b.x-=m,b.y-=g,y=Math.max(y,b.r+Math.sqrt(b.x*b.x+b.y*b.y))}return e.forEach(er),y}function Zn(e){e._pack_next=e._pack_prev=e}function er(e){delete e._pack_next,delete e._pack_prev}function tr(e){var t=e.children;t&&t.length?(t.forEach(tr),e.r=Yn(t)):e.r=Math.sqrt(e.value)}function nr(e,t,n,r){var i=e.children;e.x=t+=r*e.x,e.y=n+=r*e.y,e.r*=r;if(i){var s=-1,o=i.length;while(++s<o)nr(i[s],t,n,r)}}function rr(e,t,n){var r=e.r+n.r,i=t.x-e.x,s=t.y-e.y;if(r&&(i||s)){var o=t.r+n.r,u=Math.sqrt(i*i+s*s),a=Math.max(-1,Math.min(1,(r*r+u*u-o*o)/(2*r*u))),f=Math.acos(a),l=a*(r/=u),c=Math.sin(f)*r;n.x=e.x+l*i+c*s,n.y=e.y+l*s-c*i}else n.x=e.x+r,n.y=e.y}function ir(e){return 1+d3.max(e,function(e){return e.y})}function sr(e){return e.reduce(function(e,t){return e+t.x},0)/e.length}function or(e){var t=e.children;return t&&t.length?or(t[0]):e}function ur(e){var t=e.children,n;return t&&(n=t.length)?ur(t[n-1]):e}function ar(e,t){return e.parent==t.parent?1:2}function fr(e){var t=e.children;return t&&t.length?t[0]:e._tree.thread}function lr(e){var t=e.children,n;return t&&(n=t.length)?t[n-1]:e._tree.thread}function cr(e,t){var n=e.children;if(n&&(i=n.length)){var r,i,s=-1;while(++s<i)t(r=cr(n[s],t),e)>0&&(e=r)}return e}function hr(e,t){return e.x-t.x}function pr(e,t){return t.x-e.x}function dr(e,t){return e.depth-t.depth}function vr(e,t){function n(e,r){var i=e.children;if(i&&(a=i.length)){var s,o=null,u=-1,a;while(++u<a)s=i[u],n(s,o),o=s}t(e,r)}n(e,null)}function mr(e){var t=0,n=0,r=e.children,i=r.length,s;while(--i>=0)s=r[i]._tree,s.prelim+=t,s.mod+=t,t+=s.shift+(n+=s.change)}function gr(e,t,n){e=e._tree,t=t._tree;var r=n/(t.number-e.number);e.change+=r,t.change-=r,t.shift+=n,t.prelim+=n,t.mod+=n}function yr(e,t,n){return e._tree.ancestor.parent==t.parent?e._tree.ancestor:n}function br(e){return{x:e.x,y:e.y,dx:e.dx,dy:e.dy}}function wr(e,t){var n=e.x+t[3],r=e.y+t[0],i=e.dx-t[1]-t[3],s=e.dy-t[0]-t[2];return i<0&&(n+=i/2,i=0),s<0&&(r+=s/2,s=0),{x:n,y:r,dx:i,dy:s}}function Er(e){return e.map(Sr).join(",")}function Sr(e){return/[",\n]/.test(e)?'"'+e.replace(/\"/g,'""')+'"':e}function xr(e,t){return function(n){return n&&e.hasOwnProperty(n.type)?e[n.type](n):t}}function Tr(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+ -2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function Nr(e,t){qs.hasOwnProperty(e.type)&&qs[e.type](e,t)}function Cr(e,t){Nr(e.geometry,t)}function kr(e,t){for(var n=e.features,r=0,i=n.length;r<i;r++)Nr(n[r].geometry,t)}function Lr(e,t){for(var n=e.geometries,r=0,i=n.length;r<i;r++)Nr(n[r],t)}function Ar(e,t){for(var n=e.coordinates,r=0,i=n.length;r<i;r++)t.apply(null,n[r])}function Or(e,t){for(var n=e.coordinates,r=0,i=n.length;r<i;r++)for(var s=n[r],o=0,u=s.length;o<u;o++)t.apply(null,s[o])}function Mr(e,t){for(var n=e.coordinates,r=0,i=n.length;r<i;r++)for(var s=n[r][0],o=0,u=s.length;o<u;o++)t.apply(null,s[o])}function _r(e,t){t.apply(null,e.coordinates)}function Dr(e,t){for(var n=e.coordinates[0],r=0,i=n.length;r<i;r++)t.apply(null,n[r])}function Pr(e){return e.source}function Hr(e){return e.target}function Br(e,t){function n(e){var t=Math.sin(v-(e*=v))/m,n=Math.sin(e)/m,r=t*u*i+n*p*l,o=t*u*s+n*p*c,f=t*a+n*d;return[Math.atan2(o,r)/Is,Math.atan2(f,Math.sqrt(r*r+o*o))/Is]}var r=e[0]*Is,i=Math.cos(r),s=Math.sin(r),o=e[1]*Is,u=Math.cos(o),a=Math.sin(o),f=t[0]*Is,l=Math.cos(f),c=Math.sin(f),h=t[1]*Is,p=Math.cos(h),d=Math.sin(h),v=n.d=Math.acos(Math.max(-1,Math.min(1,a*d+u*p*Math.cos(f-r)))),m=Math.sin(v);return n}function jr(e){var t=0,n=0;for(;;){if(e(t,n))return[t,n];t===0?(t=n+1,n=0):(t-=1,n+=1)}}function Fr(e,t,n,r){var i,s,o,u,a,f,l;return i=r[e],s=i[0],o=i[1],i=r[t],u=i[0],a=i[1],i=r[n],f=i[0],l=i[1],(l-o)*(u-s)-(a-o)*(f-s)>0}function Ir(e,t,n){return(n[0]-t[0])*(e[1]-t[1])<(n[1]-t[1])*(e[0]-t[0])}function qr(e,t,n,r){var i=e[0],s=t[0],o=n[0],u=r[0],a=e[1],f=t[1],l=n[1],c=r[1],h=i-o,p=s-i,d=u-o,v=a-l,m=f-a,g=c-l,y=(d*v-g*h)/(g*p-d*m);return[i+y*p,a+y*m]}function Rr(e,t){var n={list:e.map(function(e,t){return{index:t,x:e[0],y:e[1]}}).sort(function(e,t){return e.y<t.y?-1:e.y>t.y?1:e.x<t.x?-1:e.x>t.x?1:0}),bottomSite:null},r={list:[],leftEnd:null,rightEnd:null,init:function(){r.leftEnd=r.createHalfEdge(null,"l"),r.rightEnd=r.createHalfEdge(null,"l"),r.leftEnd.r=r.rightEnd,r.rightEnd.l=r.leftEnd,r.list.unshift(r.leftEnd,r.rightEnd)},createHalfEdge:function(e,t){return{edge:e,side:t,vertex:null,l:null,r:null}},insert:function(e,t){t.l=e,t.r=e.r,e.r.l=t,e.r=t},leftBound:function(e){var t=r.leftEnd;do t=t.r;while(t!=r.rightEnd&&i.rightOf(t,e));return t=t.l,t},del:function(e){e.l.r=e.r,e.r.l=e.l,e.edge=null},right:function(e){return e.r},left:function(e){return e.l},leftRegion:function(e){return e.edge==null?n.bottomSite:e.edge.region[e.side]},rightRegion:function(e){return e.edge==null?n.bottomSite:e.edge.region[zs[e.side]]}},i={bisect:function(e,t){var n={region:{l:e,r:t},ep:{l:null,r:null}},r=t.x-e.x,i=t.y-e.y,s=r>0?r:-r,o=i>0?i:-i;return n.c=e.x*r+e.y*i+(r*r+i*i)*.5,s>o?(n.a=1,n.b=i/r,n.c/=r):(n.b=1,n.a=r/i,n.c/=i),n},intersect:function(e,t){var n=e.edge,r=t.edge;if(!n||!r||n.region.r==r.region.r)return null;var i=n.a*r.b-n.b*r.a;if(Math.abs(i)<1e-10)return null;var s=(n.c*r.b-r.c*n.b)/i,o=(r.c*n.a-n.c*r.a)/i,u=n.region.r,a=r.region.r,f,l;u.y<a.y||u.y==a.y&&u.x<a.x?(f=e,l=n):(f=t,l=r);var c=s>=l.region.r.x;return c&&f.side==="l"||!c&&f.side==="r"?null:{x:s,y:o}},rightOf:function(e,t){var n=e.edge,r=n.region.r,i=t.x>r.x;if(i&&e.side==="l")return 1;if(!i&&e.side==="r")return 0;if(n.a===1){var s=t.y-r.y,o=t.x-r.x,u=0,a=0;!i&&n.b<0||i&&n.b>=0?a=u=s>=n.b*o:(a=t.x+t.y*n.b>n.c,n.b<0&&(a=!a),a||(u=1));if(!u){var f=r.x-n.region.l.x;a=n.b*(o*o-s*s)<f*s*(1+2*o/f+n.b*n.b),n.b<0&&(a=!a)}}else{var l=n.c-n.a*t.x,c=t.y-l,h=t.x-r.x,p=l-r.y;a=c*c>h*h+p*p}return e.side==="l"?a:!a},endPoint:function(e,n,r){e.ep[n]=r;if(!e.ep[zs[n]])return;t(e)},distance:function(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}},s={list:[],insert:function(e,t,n){e.vertex=t,e.ystar=t.y+n;for(var r=0,i=s.list,o=i.length;r<o;r++){var u=i[r];if(e.ystar>u.ystar||e.ystar==u.ystar&&t.x>u.vertex.x)continue;break}i.splice(r,0,e)},del:function(e){for(var t=0,n=s.list,r=n.length;t<r&&n[t]!=e;++t);n.splice(t,1)},empty:function(){return s.list.length===0},nextEvent:function(e){for(var t=0,n=s.list,r=n.length;t<r;++t)if(n[t]==e)return n[t+1];return null},min:function(){var e=s.list[0];return{x:e.vertex.x,y:e.ystar}},extractMin:function(){return s.list.shift()}};r.init(),n.bottomSite=n.list.shift();var o=n.list.shift(),u,a,f,l,c,h,p,d,v,m,g,y,b;for(;;){s.empty()||(u=s.min());if(o&&(s.empty()||o.y<u.y||o.y==u.y&&o.x<u.x))a=r.leftBound(o),f=r.right(a),p=r.rightRegion(a),y=i.bisect(p,o),h=r.createHalfEdge(y,"l"),r.insert(a,h),m=i.intersect(a,h),m&&(s.del(a),s.insert(a,m,i.distance(m,o))),a=h,h=r.createHalfEdge(y,"r"),r.insert(a,h),m=i.intersect(h,f),m&&s.insert(h,m,i.distance(m,o)),o=n.list.shift();else{if(!!s.empty())break;a=s.extractMin(),l=r.left(a),f=r.right(a),c=r.right(f),p=r.leftRegion(a),d=r.rightRegion(f),g=a.vertex,i.endPoint(a.edge,a.side,g),i.endPoint(f.edge,f.side,g),r.del(a),s.del(f),r.del(f),b="l",p.y>d.y&&(v=p,p=d,d=v,b="r"),y=i.bisect(p,d),h=r.createHalfEdge(y,b),r.insert(l,h),i.endPoint(y,zs[b],g),m=i.intersect(l,h),m&&(s.del(l),s.insert(l,m,i.distance(m,p))),m=i.intersect(h,c),m&&s.insert(h,m,i.distance(m,p))}}for(a=r.right(r.leftEnd);a!=r.rightEnd;a=r.right(a))t(a.edge)}function Ur(){return{leaf:!0,nodes:[],point:null}}function zr(e,t,n,r,i,s){if(!e(t,n,r,i,s)){var o=(n+i)*.5,u=(r+s)*.5,a=t.nodes;a[0]&&zr(e,a[0],n,r,o,u),a[1]&&zr(e,a[1],o,r,i,u),a[2]&&zr(e,a[2],n,u,o,s),a[3]&&zr(e,a[3],o,u,i,s)}}function Wr(e){return{x:e[0],y:e[1]}}function Xr(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Vr(e,t,n,r){var i,s,o=0,u=t.length,a=n.length;while(o<u){if(r>=a)return-1;i=t.charCodeAt(o++);if(i==37){s=Gs[t.charAt(o++)];if(!s||(r=s(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}function $r(e,t,n){return Ys.test(t.substring(n,n+=3))?n:-1}function Jr(e,t,n){Zs.lastIndex=0;var r=Zs.exec(t.substring(n,n+10));return r?n+=r[0].length:-1}function Kr(e,t,n){var r=eo.get(t.substring(n,n+=3).toLowerCase());return r==null?-1:(e.m=r,n)}function Qr(e,t,n){to.lastIndex=0;var r=to.exec(t.substring(n,n+12));return r?(e.m=no.get(r[0].toLowerCase()),n+=r[0].length):-1}function Gr(e,t,n){return Vr(e,Qs.c.toString(),t,n)}function Yr(e,t,n){return Vr(e,Qs.x.toString(),t,n)}function Zr(e,t,n){return Vr(e,Qs.X.toString(),t,n)}function ei(e,t,n){io.lastIndex=0;var r=io.exec(t.substring(n,n+4));return r?(e.y=+r[0],n+=r[0].length):-1}function ti(e,t,n){io.lastIndex=0;var r=io.exec(t.substring(n,n+2));return r?(e.y=ni()+ +r[0],n+=r[0].length):-1}function ni(){return~~((new Date).getFullYear()/1e3)*1e3}function ri(e,t,n){io.lastIndex=0;var r=io.exec(t.substring(n,n+2));return r?(e.m=r[0]-1,n+=r[0].length):-1}function ii(e,t,n){io.lastIndex=0;var r=io.exec(t.substring(n,n+2));return r?(e.d=+r[0],n+=r[0].length):-1}function si(e,t,n){io.lastIndex=0;var r=io.exec(t.substring(n,n+2));return r?(e.H=+r[0],n+=r[0].length):-1}function oi(e,t,n){io.lastIndex=0;var r=io.exec(t.substring(n,n+2));return r?(e.M=+r[0],n+=r[0].length):-1}function ui(e,t,n){io.lastIndex=0;var r=io.exec(t.substring(n,n+2));return r?(e.S=+r[0],n+=r[0].length):-1}function ai(e,t,n){io.lastIndex=0;var r=io.exec(t.substring(n,n+3));return r?(e.L=+r[0],n+=r[0].length):-1}function fi(e,t,n){var r=so.get(t.substring(n,n+=2).toLowerCase());return r==null?-1:(e.p=r,n)}function li(e){var t=e.getTimezoneOffset(),n=t>0?"-":"+",r=~~(Math.abs(t)/60),i=Math.abs(t)%60;return n+Vs(r)+Vs(i)}function ci(e){return e.toISOString()}function hi(e,t,n){function r(t){var n=e(t),r=s(n,1);return t-n<r-t?n:r}function i(n){return t(n=e(new Ws(n-1)),1),n}function s(e,n){return t(e=new Ws(+e),n),e}function o(e,r,s){var o=i(e),u=[];if(s>1)while(o<r)n(o)%s||u.push(new Date(+o)),t(o,1);else while(o<r)u.push(new Date(+o)),t(o,1);return u}function u(e,t,n){try{Ws=Xr;var r=new Xr;return r._=e,o(r,t,n)}finally{Ws=Date}}e.floor=e,e.round=r,e.ceil=i,e.offset=s,e.range=o;var a=e.utc=pi(e);return a.floor=a,a.round=pi(r),a.ceil=pi(i),a.offset=pi(s),a.range=u,e}function pi(e){return function(t,n){try{Ws=Xr;var r=new Xr;return r._=t,e(r,n)._}finally{Ws=Date}}}function di(e,t,n){function r(t){return e(t)}return r.invert=function(t){return mi(e.invert(t))},r.domain=function(t){return arguments.length?(e.domain(t),r):e.domain().map(mi)},r.nice=function(e){var t=vi(r.domain());return r.domain([e.floor(t[0]),e.ceil(t[1])])},r.ticks=function(n,i){var s=vi(r.domain());if(typeof n!="function"){var o=s[1]-s[0],u=o/n,a=d3.bisect(uo,u);if(a==uo.length)return t.year(s,n);if(!a)return e.ticks(n).map(mi);Math.log(u/uo[a-1])<Math.log(uo[a]/u)&&--a,n=t[a],i=n[1],n=n[0].range}return n(s[0],new Date(+s[1]+1),i)},r.tickFormat=function(){return n},r.copy=function(){return di(e.copy(),t,n)},d3.rebind(r,e,"range","rangeRound","interpolate","clamp")}function vi(e){var t=e[0],n=e[e.length-1];return t<n?[t,n]:[n,t]}function mi(e){return new Date(e)}function gi(e){return function(t){var n=e.length-1,r=e[n];while(!r[1](t))r=e[--n];return r[0](t)}}function yi(e){var t=new Date(e,0,1);return t.setFullYear(e),t}function bi(e){var t=e.getFullYear(),n=yi(t),r=yi(t+1);return t+(e-n)/(r-n)}function wi(e){var t=new Date(Date.UTC(e,0,1));return t.setUTCFullYear(e),t}function Ei(e){var t=e.getUTCFullYear(),n=wi(t),r=wi(t+1);return t+(e-n)/(r-n)}Date.now||(Date.now=function(){return+(new Date)});try{document.createElement("div").style.setProperty("opacity",0,"")}catch(Si){var xi=CSSStyleDeclaration.prototype,Ti=xi.setProperty;xi.setProperty=function(e,t,n){Ti.call(this,e,t+"",n)}}d3={version:"2.8.1"};var Ni=n;try{Ni(document.documentElement.childNodes)[0].nodeType}catch(Ci){Ni=t}var ki=[].__proto__?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)e[n]=t[n]};d3.map=function(e){var t=new r;for(var n in e)t.set(n,e[n]);return t},e(r,{has:function(e){return Li+e in this},get:function(e){return this[Li+e]},set:function(e,t){return this[Li+e]=t},remove:function(e){return e=Li+e,e in this&&delete this[e]},keys:function(){var e=[];return this.forEach(function(t){e.push(t)}),e},values:function(){var e=[];return this.forEach(function(t,n){e.push(n)}),e},entries:function(){var e=[];return this.forEach(function(t,n){e.push({key:t,value:n})}),e},forEach:function(e){for(var t in this)t.charCodeAt(0)===Ai&&e.call(this,t.substring(1),this[t])}});var Li="\0",Ai=Li.charCodeAt(0);d3.functor=function(e){return typeof e=="function"?e:function(){return e}},d3.rebind=function(e,t){var n=1,r=arguments.length,i;while(++n<r)e[i=arguments[n]]=s(e,t,t[i]);return e},d3.ascending=function(e,t){return e<t?-1:e>t?1:e>=t?0:NaN},d3.descending=function(e,t){return t<e?-1:t>e?1:t>=e?0:NaN},d3.mean=function(e,t){var n=e.length,r,i=0,s=-1,u=0;if(arguments.length===1)while(++s<n)o(r=e[s])&&(i+=(r-i)/++u);else while(++s<n)o(r=t.call(e,e[s],s))&&(i+=(r-i)/++u);return u?i:undefined},d3.median=function(e,t){return arguments.length>1&&(e=e.map(t)),e=e.filter(o),e.length?d3.quantile(e.sort(d3.ascending),.5):undefined},d3.min=function(e,t){var n=-1,r=e.length,i,s;if(arguments.length===1){while(++n<r&&((i=e[n])==null||i!=i))i=undefined;while(++n<r)(s=e[n])!=null&&i>s&&(i=s)}else{while(++n<r&&((i=t.call(e,e[n],n))==null||i!=i))i=undefined;while(++n<r)(s=t.call(e,e[n],n))!=null&&i>s&&(i=s)}return i},d3.max=function(e,t){var n=-1,r=e.length,i,s;if(arguments.length===1){while(++n<r&&((i=e[n])==null||i!=i))i=undefined;while(++n<r)(s=e[n])!=null&&s>i&&(i=s)}else{while(++n<r&&((i=t.call(e,e[n],n))==null||i!=i))i=undefined;while(++n<r)(s=t.call(e,e[n],n))!=null&&s>i&&(i=s)}return i},d3.extent=function(e,t){var n=-1,r=e.length,i,s,o;if(arguments.length===1){while(++n<r&&((i=o=e[n])==null||i!=i))i=o=undefined;while(++n<r)(s=e[n])!=null&&(i>s&&(i=s),o<s&&(o=s))}else{while(++n<r&&((i=o=t.call(e,e[n],n))==null||i!=i))i=undefined;while(++n<r)(s=t.call(e,e[n],n))!=null&&(i>s&&(i=s),o<s&&(o=s))}return[i,o]},d3.random={normal:function(e,t){return arguments.length<2&&(t=1),arguments.length<1&&(e=0),function(){var n,r,i;do n=Math.random()*2-1,r=Math.random()*2-1,i=n*n+r*r;while(!i||i>1);return e+t*n*Math.sqrt(-2*Math.log(i)/i)}}},d3.sum=function(e,t){var n=0,r=e.length,i,s=-1;if(arguments.length===1)while(++s<r)isNaN(i=+e[s])||(n+=i);else while(++s<r)isNaN(i=+t.call(e,e[s],s))||(n+=i);return n},d3.quantile=function(e,t){var n=(e.length-1)*t+1,r=Math.floor(n),i=e[r-1],s=n-r;return s?i+s*(e[r]-i):i},d3.transpose=function(e){return d3.zip.apply(d3,e)},d3.zip=function(){if(!(i=arguments.length))return[];for(var e=-1,t=d3.min(arguments,u),n=new Array(t);++e<t;)for(var r=-1,i,s=n[e]=new Array(i);++r<i;)s[r]=arguments[r][e];return n},d3.bisector=function(e){return{left:function(t,n,r,i){arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);while(r<i){var s=r+i>>1;e.call(t,t[s],s)<n?r=s+1:i=s}return r},right:function(t,n,r,i){arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);while(r<i){var s=r+i>>1;n<e.call(t,t[s],s)?i=s:r=s+1}return r}}};var Oi=d3.bisector(function(e){return e});d3.bisectLeft=Oi.left,d3.bisect=d3.bisectRight=Oi.right,d3.first=function(e,t){var n=0,r=e.length,i=e[0],s;arguments.length===1&&(t=d3.ascending);while(++n<r)t.call(e,i,s=e[n])>0&&(i=s);return i},d3.last=function(e,t){var n=0,r=e.length,i=e[0],s;arguments.length===1&&(t=d3.ascending);while(++n<r)t.call(e,i,s=e[n])<=0&&(i=s);return i},d3.nest=function(){function e(t,s){if(s>=i.length)return u?u.call(n,t):o?t.sort(o):t;var a=-1,f=t.length,l=i[s++],c,h,p=new r,v,m={};while(++a<f)(v=p.get(c=l(h=t[a])))?v.push(h):p.set(c,[h]);return p.forEach(function(t){m[t]=e(p.get(t),s)}),m}function t(e,n){if(n>=i.length)return e;var r=[],o=s[n++],u;for(u in e)r.push({key:u,values:t(e[u],n)});return o&&r.sort(function(e,t){return o(e.key,t.key)}),r}var n={},i=[],s=[],o,u;return n.map=function(t){return e(t,0)},n.entries=function(n){return t(e(n,0),0)},n.key=function(e){return i.push(e),n},n.sortKeys=function(e){return s[i.length-1]=e,n},n.sortValues=function(e){return o=e,n},n.rollup=function(e){return u=e,n},n},d3.keys=function(e){var t=[];for(var n in e)t.push(n);return t},d3.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t},d3.entries=function(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t},d3.permute=function(e,t){var n=[],r=-1,i=t.length;while(++r<i)n[r]=e[t[r]];return n},d3.merge=function(e){return Array.prototype.concat.apply([],e)},d3.split=function(e,t){var n=[],r=[],i,s=-1,o=e.length;arguments.length<2&&(t=a);while(++s<o)t.call(r,i=e[s],s)?r=[]:(r.length||n.push(r),r.push(i));return n},d3.range=function(e,t,n){arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0));if((t-e)/n===Infinity)throw new Error("infinite range");var r=[],i=l(Math.abs(n)),s=-1,o;e*=i,t*=i,n*=i;if(n<0)while((o=e+n*++s)>t)r.push(o/i);else while((o=e+n*++s)<t)r.push(o/i);return r},d3.requote=function(e){return e.replace(Mi,"\\$&")};var Mi=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;d3.round=function(e,t){return t?Math.round(e*(t=Math.pow(10,t)))/t:Math.round(e)},d3.xhr=function(e,t,n){var r=new XMLHttpRequest;arguments.length<3?(n=t,t=null):t&&r.overrideMimeType&&r.overrideMimeType(t),r.open("GET",e,!0),t&&r.setRequestHeader("Accept",t),r.onreadystatechange=function(){r.readyState===4&&n(r.status<300?r:null)},r.send(null)},d3.text=function(e,t,n){function r(e){n(e&&e.responseText)}arguments.length<3&&(n=t,t=null),d3.xhr(e,t,r)},d3.json=function(e,t){d3.text(e,"application/json",function(e){t(e?JSON.parse(e):null)})},d3.html=function(e,t){d3.text(e,"text/html",function(e){if(e!=null){var n=document.createRange();n.selectNode(document.body),e=n.createContextualFragment(e)}t(e)})},d3.xml=function(e,t,n){function r(e){n(e&&e.responseXML)}arguments.length<3&&(n=t,t=null),d3.xhr(e,t,r)};var _i={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};d3.ns={prefix:_i,qualify:function(e){var t=e.indexOf(":"),n=e;return t>=0&&(n=e.substring(0,t),e=e.substring(t+1)),_i.hasOwnProperty(n)?{space:_i[n],local:e}:e}},d3.dispatch=function(){var e=new c,t=-1,n=arguments.length;while(++t<n)e[arguments[t]]=h(e);return e},c.prototype.on=function(e,t){var n=e.indexOf("."),r="";return n>0&&(r=e.substring(n+1),e=e.substring(0,n)),arguments.length<2?this[e].on(r):this[e].on(r,t)},d3.format=function(e){var t=Di.exec(e),n=t[1]||" ",r=t[3]||"",i=t[5],s=+t[6],o=t[7],u=t[8],a=t[9],f=1,l="",c=!1;u&&(u=+u.substring(1)),i&&(n="0",o&&(s-=Math.floor((s-1)/4)));switch(a){case"n":o=!0,a="g";break;case"%":f=100,l="%",a="f";break;case"p":f=100,l="%",a="r";break;case"d":c=!0,u=0;break;case"s":f=-1,a="r"}return a=="r"&&!u&&(a="g"),a=Pi.get(a)||v,function(e){if(c&&e%1)return"";var t=e<0&&(e=-e)?"−":r;if(f<0){var h=d3.formatPrefix(e,u);e*=h.scale,l=h.symbol}else e*=f;e=a(e,u);if(i){var p=e.length+t.length;p<s&&(e=(new Array(s-p+1)).join(n)+e),o&&(e=m(e)),e=t+e}else{o&&(e=m(e)),e=t+e;var p=e.length;p<s&&(e=(new Array(s-p+1)).join(n)+e)}return e+l}};var Di=/(?:([^{])?([<>=^]))?([+\- ])?(#)?(0)?([0-9]+)?(,)?(\.[0-9]+)?([a-zA-Z%])?/,Pi=d3.map({g:function(e,t){return e.toPrecision(t)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},r:function(e,t){return d3.round(e,t=p(e,t)).toFixed(Math.max(0,Math.min(20,t)))}}),Hi=["y","z","a","f","p","n","μ","m","","k","M","G","T","P","E","Z","Y"].map(g);d3.formatPrefix=function(e,t){var n=0;return e&&(e<0&&(e*=-1),t&&(e=d3.round(e,p(e,t))),n=1+Math.floor(1e-12+Math.log(e)/Math.LN10),n=Math.max(-24,Math.min(24,Math.floor((n<=0?n+1:n-1)/3)*3))),Hi[8+n/3]};var Bi=S(2),ji=S(3),Fi=function(){return E},Ii=d3.map({linear:Fi,poly:S,quad:function(){return Bi},cubic:function(){return ji},sin:function(){return x},exp:function(){return T},circle:function(){return N},elastic:C,back:k,bounce:function(){return L}}),qi=d3.map({"in":E,out:b,"in-out":w,"out-in":function(e){return w(b(e))}});d3.ease=function(e){var t=e.indexOf("-"),n=t>=0?e.substring(0,t):e,r=t>=0?e.substring(t+1):"in";return n=Ii.get(n)||Fi,r=qi.get(r)||E,y(r(n.apply(null,Array.prototype.slice.call(arguments,1))))},d3.event=null,d3.interpolate=function(e,t){var n=d3.interpolators.length,r;while(--n>=0&&!(r=d3.interpolators[n](e,t)));return r},d3.interpolateNumber=function(e,t){return t-=e,function(n){return e+t*n}},d3.interpolateRound=function(e,t){return t-=e,function(n){return Math.round(e+t*n)}},d3.interpolateString=function(e,t){var n,r,i,s=0,o=0,u=[],a=[],f,l;Ri.lastIndex=0;for(r=0;n=Ri.exec(t);++r)n.index&&u.push(t.substring(s,o=n.index)),a.push({i:u.length,x:n[0]}),u.push(null),s=Ri.lastIndex;s<t.length&&u.push(t.substring(s));for(r=0,f=a.length;(n=Ri.exec(e))&&r<f;++r){l=a[r];if(l.x==n[0]){if(l.i)if(u[l.i+1]==null){u[l.i-1]+=l.x,u.splice(l.i,1);for(i=r+1;i<f;++i)a[i].i--}else{u[l.i-1]+=l.x+u[l.i+1],u.splice(l.i,2);for(i=r+1;i<f;++i)a[i].i-=2}else if(u[l.i+1]==null)u[l.i]=l.x;else{u[l.i]=l.x+u[l.i+1],u.splice(l.i+1,1);for(i=r+1;i<f;++i)a[i].i--}a.splice(r,1),f--,r--}else l.x=d3.interpolateNumber(parseFloat(n[0]),parseFloat(l.x))}while(r<f)l=a.pop(),u[l.i+1]==null?u[l.i]=l.x:(u[l.i]=l.x+u[l.i+1],u.splice(l.i+1,1)),f--;return u.length===1?u[0]==null?a[0].x:function(){return t}:function(e){for(r=0;r<f;++r)u[(l=a[r]).i]=l.x(e);return u.join("")}},d3.interpolateTransform=function(e,t){var n=[],r=[],i,s=d3.transform(e),o=d3.transform(t),u=s.translate,a=o.translate,f=s.rotate,l=o.rotate,c=s.skew,h=o.skew,p=s.scale,d=o.scale;return u[0]!=a[0]||u[1]!=a[1]?(n.push("translate(",null,",",null,")"),r.push({i:1,x:d3.interpolateNumber(u[0],a[0])},{i:3,x:d3.interpolateNumber(u[1],a[1])})):a[0]||a[1]?n.push("translate("+a+")"):n.push(""),f!=l?r.push({i:n.push(n.pop()+"rotate(",null,")")-2,x:d3.interpolateNumber(f,l)}):l&&n.push(n.pop()+"rotate("+l+")"),c!=h?r.push({i:n.push(n.pop()+"skewX(",null,")")-2,x:d3.interpolateNumber(c,h)}):h&&n.push(n.pop()+"skewX("+h+")"),p[0]!=d[0]||p[1]!=d[1]?(i=n.push(n.pop()+"scale(",null,",",null,")"),r.push({i:i-4,x:d3.interpolateNumber(p[0],d[0])},{i:i-2,x:d3.interpolateNumber(p[1],d[1])})):(d[0]!=1||d[1]!=1)&&n.push(n.pop()+"scale("+d+")"),i=r.length,function(e){var t=-1,s;while(++t<i)n[(s=r[t]).i]=s.x(e);return n.join("")}},d3.interpolateRgb=function(e,t){e=d3.rgb(e),t=d3.rgb(t);var n=e.r,r=e.g,i=e.b,s=t.r-n,o=t.g-r,u=t.b-i;return function(e){return"#"+j(Math.round(n+s*e))+j(Math.round(r+o*e))+j(Math.round(i+u*e))}},d3.interpolateHsl=function(e,t){e=d3.hsl(e),t=d3.hsl(t);var n=e.h,r=e.s,i=e.l,s=t.h-n,o=t.s-r,u=t.l-i;return function(e){return z(n+s*e,r+o*e,i+u*e).toString()}},d3.interpolateArray=function(e,t){var n=[],r=[],i=e.length,s=t.length,o=Math.min(e.length,t.length),u;for(u=0;u<o;++u)n.push(d3.interpolate(e[u],t[u]));for(;u<i;++u)r[u]=e[u];for(;u<s;++u)r[u]=t[u];return function(e){for(u=0;u<o;++u)r[u]=n[u](e);return r}},d3.interpolateObject=function(e,t){var n={},r={},i;for(i in e)i in t?n[i]=_(i)(e[i],t[i]):r[i]=e[i];for(i in t)i in e||(r[i]=t[i]);return function(e){for(i in n)r[i]=n[i](e);return r}};var Ri=/[-+]?(?:\d*\.?\d+)(?:[eE][-+]?\d+)?/g;d3.interpolators=[d3.interpolateObject,function(e,t){return t instanceof Array&&d3.interpolateArray(e,t)},function(e,t){return(typeof e=="string"||typeof t=="string")&&d3.interpolateString(e+"",t+"")},function(e,t){return(typeof t=="string"?Ui.has(t)||/^(#|rgb\(|hsl\()/.test(t):t instanceof B||t instanceof U)&&d3.interpolateRgb(e,t)},function(e,t){return!isNaN(e=+e)&&!isNaN(t=+t)&&d3.interpolateNumber(e,t)}],d3.rgb=function(e,t,n){return arguments.length===1?e instanceof B?H(e.r,e.g,e.b):F(""+e,H,z):H(~~e,~~t,~~n)},B.prototype.brighter=function(e){e=Math.pow(.7,arguments.length?e:1);var t=this.r,n=this.g,r=this.b,i=30;return!t&&!n&&!r?H(i,i,i):(t&&t<i&&(t=i),n&&n<i&&(n=i),r&&r<i&&(r=i),H(Math.min(255,Math.floor(t/e)),Math.min(255,Math.floor(n/e)),Math.min(255,Math.floor(r/e))))},B.prototype.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),H(Math.floor(e*this.r),Math.floor(e*this.g),Math.floor(e*this.b))},B.prototype.hsl=function(){return I(this.r,this.g,this.b)},B.prototype.toString=function(){return"#"+j(this.r)+j(this.g)+j(this.b)};var Ui=d3.map({aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"});Ui.forEach(function(e,t){Ui.set(e,F(t,H,z))}),d3.hsl=function(e,t,n){return arguments.length===1?e instanceof U?R(e.h,e.s,e.l):F(""+e,I,R):R(+e,+t,+n)},U.prototype.brighter=function(e){return e=Math.pow(.7,arguments.length?e:1),R(this.h,this.s,this.l/e)},U.prototype.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),R(this.h,this.s,e*this.l)},U.prototype.rgb=function(){return z(this.h,this.s,this.l)},U.prototype.toString=function(){return this.rgb().toString()};var zi=function(e,t){return t.querySelector(e)},Wi=function(e,t){return t.querySelectorAll(e)},Xi=document.documentElement,Vi=Xi.matchesSelector||Xi.webkitMatchesSelector||Xi.mozMatchesSelector||Xi.msMatchesSelector||Xi.oMatchesSelector,$i=function(e,t){return Vi.call(e,t)};typeof Sizzle=="function"&&(zi=function(e,t){return Sizzle(e,t)[0]},Wi=function(e,t){return Sizzle.uniqueSort(Sizzle(e,t))},$i=Sizzle.matchesSelector);var Ji=[];d3.selection=function(){return Qi},d3.selection.prototype=Ji,Ji.select=function(e){var t=[],n,r,i,s;typeof e!="function"&&(e=X(e));for(var o=-1,u=this.length;++o<u;){t.push(n=[]),n.parentNode=(i=this[o]).parentNode;for(var a=-1,f=i.length;++a<f;)(s=i[a])?(n.push(r=e.call(s,s.__data__,a)),r&&"__data__"in s&&(r.__data__=s.__data__)):n.push(null)}return W(t)},Ji.selectAll=function(e){var t=[],n,r;typeof e!="function"&&(e=V(e));for(var i=-1,s=this.length;++i<s;)for(var o=this[i],u=-1,a=o.length;++u<a;)if(r=o[u])t.push(n=Ni(e.call(r,r.__data__,u))),n.parentNode=r;return W(t)},Ji.attr=function(e,t){function n(){this.removeAttribute(e)}function r(){this.removeAttributeNS(e.space,e.local)}function i(){this.setAttribute(e,t)}function s(){this.setAttributeNS(e.space,e.local,t)}function o(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}function u(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}e=d3.ns.qualify(e);if(arguments.length<2){var a=this.node();return e.local?a.getAttributeNS(e.space,e.local):a.getAttribute(e)}return this.each(t==null?e.local?r:n:typeof t=="function"?e.local?u:o:e.local?s:i)},Ji.classed=function(e,t){var n=e.split(Ki),r=n.length,i=-1;if(arguments.length>1){while(++i<r)$.call(this,n[i],t);return this}while(++i<r)if(!$.call(this,n[i]))return!1;return!0};var Ki=/\s+/g;Ji.style=function(e,t,n){function r(){this.style.removeProperty(e)}function i(){this.style.setProperty(e,t,n)}function s(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}return arguments.length<3&&(n=""),arguments.length<2?window.getComputedStyle(this.node(),null).getPropertyValue(e):this.each(t==null?r:typeof t=="function"?s:i)},Ji.property=function(e,t){function n(){delete this[e]}function r(){this[e]=t}function i(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}return arguments.length<2?this.node()[e]:this.each(t==null?n:typeof t=="function"?i:r)},Ji.text=function(e){return arguments.length<1?this.node().textContent:this.each(typeof e=="function"?function(){var t=e.apply(this,arguments);this.textContent=t==null?"":t}:e==null?function(){this.textContent=""}:function(){this.textContent=e})},Ji.html=function(e){return arguments.length<1?this.node().innerHTML:this.each(typeof e=="function"?function(){var t=e.apply(this,arguments);this.innerHTML=t==null?"":t}:e==null?function(){this.innerHTML=""}:function(){this.innerHTML=e})},Ji.append=function(e){function t(){return this.appendChild(document.createElementNS(this.namespaceURI,e))}function n(){return this.appendChild(document.createElementNS(e.space,e.local))}return e=d3.ns.qualify(e),this.select(e.local?n:t)},Ji.insert=function(e,t){function n(){return this.insertBefore(document.createElementNS(this.namespaceURI,e),zi(t,this))}function r(){return this.insertBefore(document.createElementNS(e.space,e.local),zi(t,this))}return e=d3.ns.qualify(e),this.select(e.local?r:n)},Ji.remove=function(){return this.each(function(){var e=this.parentNode;e&&e.removeChild(this)})},Ji.data=function(e,t){function n(e,n){var i,s=e.length,o=n.length,u=Math.min(s,o),c=Math.max(s,o),h=[],p=[],d=[],v,m;if(t){var g=new r,y=[],b,w=n.length;for(i=-1;++i<s;)b=t.call(v=e[i],v.__data__,i),g.has(b)?d[w++]=v:g.set(b,v),y.push(b);for(i=-1;++i<o;)b=t.call(n,m=n[i],i),g.has(b)?(h[i]=v=g.get(b),v.__data__=m,p[i]=d[i]=null):(p[i]=J(m),h[i]=d[i]=null),g.remove(b);for(i=-1;++i<s;)g.has(y[i])&&(d[i]=e[i])}else{for(i=-1;++i<u;)v=e[i],m=n[i],v?(v.__data__=m,h[i]=v,p[i]=d[i]=null):(p[i]=J(m),h[i]=d[i]=null);for(;i<o;++i)p[i]=J(n[i]),h[i]=d[i]=null;for(;i<c;++i)d[i]=e[i],p[i]=h[i]=null}p.update=h,p.parentNode=h.parentNode=d.parentNode=e.parentNode,a.push(p),f.push(h),l.push(d)}var i=-1,s=this.length,o,u;if(!arguments.length){e=new Array(s=(o=this[0]).length);while(++i<s)if(u=o[i])e[i]=u.__data__;return e}var a=G([]),f=W([]),l=W([]);if(typeof e=="function")while(++i<s)n(o=this[i],e.call(o,o.parentNode.__data__,i));else while(++i<s)n(o=this[i],e);return f.enter=function(){return a},f.exit=function(){return l},f},Ji.datum=Ji.map=function(e){return arguments.length<1?this.property("__data__"):this.property("__data__",e)},Ji.filter=function(e){var t=[],n,r,i;typeof e!="function"&&(e=K(e));for(var s=0,o=this.length;s<o;s++){t.push(n=[]),n.parentNode=(r=this[s]).parentNode;for(var u=0,a=r.length;u<a;u++)(i=r[u])&&e.call(i,i.__data__,u)&&n.push(i)}return W(t)},Ji.order=function(){for(var e=-1,t=this.length;++e<t;)for(var n=this[e],r=n.length-1,i=n[r],s;--r>=0;)if(s=n[r])i&&i!==s.nextSibling&&i.parentNode.insertBefore(s,i),i=s;return this},Ji.sort=function(e){e=Q.apply(this,arguments);for(var t=-1,n=this.length;++t<n;)this[t].sort(e);return this.order()},Ji.on=function(e,t,n){arguments.length<3&&(n=!1);var r="__on"+e,i=e.indexOf(".");return i>0&&(e=e.substring(0,i)),arguments.length<2?(i=this.node()[r])&&i._:this.each(function(i,s){function o(e){var n=d3.event;d3.event=e;try{t.call(u,u.__data__,s)}finally{d3.event=n}}var u=this,a=u[r];a&&(u.removeEventListener(e,a,a.$),delete u[r]),t&&(u.addEventListener(e,u[r]=o,o.$=n),o._=t)})},Ji.each=function(e){for(var t=-1,n=this.length;++t<n;)for(var r=this[t],i=-1,s=r.length;++i<s;){var o=r[i];o&&e.call(o,o.__data__,i,t)}return this},Ji.call=function(e){return e.apply(this,(arguments[0]=this,arguments)),this},Ji.empty=function(){return!this.node()},Ji.node=function(e){for(var t=0,n=this.length;t<n;t++)for(var r=this[t],i=0,s=r.length;i<s;i++){var o=r[i];if(o)return o}return null},Ji.transition=function(){var e=[],t,n;for(var r=-1,i=this.length;++r<i;){e.push(t=[]);for(var s=this[r],o=-1,u=s.length;++o<u;)t.push((n=s[o])?{node:n,delay:ss,duration:os}:null)}return Y(e,ts||++es,Date.now())};var Qi=W([[document]]);Qi[0].parentNode=Xi,d3.select=function(e){return typeof e=="string"?Qi.select(e):W([[e]])},d3.selectAll=function(e){return typeof e=="string"?Qi.selectAll(e):W([Ni(e)])};var Gi=[];d3.selection.enter=G,d3.selection.enter.prototype=Gi,Gi.append=Ji.append,Gi.insert=Ji.insert,Gi.empty=Ji.empty,Gi.node=Ji.node,Gi.select=function(e){var t=[],n,r,i,s,o;for(var u=-1,a=this.length;++u<a;){i=(s=this[u]).update,t.push(n=[]),n.parentNode=s.parentNode;for(var f=-1,l=s.length;++f<l;)(o=s[f])?(n.push(i[f]=r=e.call(s.parentNode,o.__data__,f)),r.__data__=o.__data__):n.push(null)}return W(t)};var Yi={},Zi=[],es=0,ts=0,ns=0,rs=250,is=d3.ease("cubic-in-out"),ss=ns,os=rs,us=is;Zi.call=Ji.call,d3.transition=function(e){return arguments.length?ts?e.transition():e:Qi.transition()},d3.transition.prototype=Zi,Zi.select=function(e){var t=[],n,r,i;typeof e!="function"&&(e=X(e));for(var s=-1,o=this.length;++s<o;){t.push(n=[]);for(var u=this[s],a=-1,f=u.length;++a<f;)(i=u[a])&&(r=e.call(i.node,i.node.__data__,a))?("__data__"in i.node&&(r.__data__=i.node.__data__),n.push({node:r,delay:i.delay,duration:i.duration})):n.push(null)}return Y(t,this.id,this.time).ease(this.ease())},Zi.selectAll=function(e){var t=[],n,r,i;typeof e!="function"&&(e=V(e));for(var s=-1,o=this.length;++s<o;)for(var u=this[s],a=-1,f=u.length;++a<f;)if(i=u[a]){r=e.call(i.node,i.node.__data__,a),t.push(n=[]);for(var l=-1,c=r.length;++l<c;)n.push({node:r[l],delay:i.delay,duration:i.duration})}return Y(t,this.id,this.time).ease(this.ease())},Zi.attr=function(e,t){return this.attrTween(e,et(e,t))},Zi.attrTween=function(e,t){function n(e,n){var r=t.call(this,e,n,this.getAttribute(i));return r===Yi?(this.removeAttribute(i),null):r&&function(e){this.setAttribute(i,r(e))}}function r(e,n){var r=t.call(this,e,n,this.getAttributeNS(i.space,i.local));return r===Yi?(this.removeAttributeNS(i.space,i.local),null):r&&function(e){this.setAttributeNS(i.space,i.local,r(e))}}var i=d3.ns.qualify(e);return this.tween("attr."+e,i.local?r:n)},Zi.style=function(e,t,n){return arguments.length<3&&(n=""),this.styleTween(e,et(e,t),n)},Zi.styleTween=function(e,t,n){return arguments.length<3&&(n=""),this.tween("style."+e,function(r,i){var s=t.call(this,r,i,window.getComputedStyle(this,null).getPropertyValue(e));return s===Yi?(this.style.removeProperty(e),null):s&&function(t){this.style.setProperty(e,s(t),n)}})},Zi.text=function(e){return this.tween("text",function(t,n){this.textContent=typeof e=="function"?e.call(this,t,n):e})},Zi.remove=function(){return this.each("end.transition",function(){var e;!this.__transition__&&(e=this.parentNode)&&e.removeChild(this)})},Zi.delay=function(e){var t=this;return t.each(typeof e=="function"?function(n,r,i){t[i][r].delay=e.apply(this,arguments)|0}:(e|=0,function(n,r,i){t[i][r].delay=e}))},Zi.duration=function(e){var t=this;return t.each(typeof e=="function"?function(n,r,i){t[i][r].duration=Math.max(1,e.apply(this,arguments)|0)}:(e=Math.max(1,e|0),function(n,r,i){t[i][r].duration=e}))},Zi.transition=function(){return this.select(i)};var as=null,fs,ls;d3.timer=function(e,t,n){var r=!1,i,s=as;if(arguments.length<3){if(arguments.length<2)t=0;else if(!isFinite(t))return;n=Date.now()}while(s){if(s.callback===e){s.then=n,s.delay=t,r=!0;break}i=s,s=s.next}r||(as={callback:e,then:n,delay:t,next:as}),fs||(ls=clearTimeout(ls),fs=1,cs(nt))},d3.timer.flush=function(){var e,t=Date.now(),n=as;while(n)e=t-n.then,n.delay||(n.flush=n.callback(e)),n=n.next;rt()};var cs=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,17)};d3.transform=function(e){var t=document.createElementNS(d3.ns.prefix.svg,"g"),n={a:1,b:0,c:0,d:1,e:0,f:0};return(d3.transform=function(e){t.setAttribute("transform",e);var r=t.transform.baseVal.consolidate();return new it(r?r.matrix:n)})(e)},it.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var hs=180/Math.PI;d3.mouse=function(e){return at(e,O())};var ps=/WebKit/.test(navigator.userAgent)?-1:0;d3.touches=function(e,t){return arguments.length<2&&(t=O().touches),t?Ni(t).map(function(t){var n=at(e,t);return n.identifier=t.identifier,n}):[]},d3.scale={},d3.scale.linear=function(){return dt([0,1],[0,1],d3.interpolate,!1)},d3.scale.log=function(){return St(d3.scale.linear(),xt)};var ds=d3.format(".0e");xt.pow=function(e){return Math.pow(10,e)},Tt.pow=function(e){return-Math.pow(10,-e)},d3.scale.pow=function(){return Nt(d3.scale.linear(),1)},d3.scale.sqrt=function(){return d3.scale.pow().exponent(.5)},d3.scale.ordinal=function(){return kt([],{t:"range",x:[]})},d3.scale.category10=function(){return d3.scale.ordinal().range(vs)},d3.scale.category20=function(){return d3.scale.ordinal().range(ms)},d3.scale.category20b=function(){return d3.scale.ordinal().range(gs)},d3.scale.category20c=function(){return d3.scale.ordinal().range(ys)};var vs=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],ms=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],gs=["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"],ys=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"];d3.scale.quantile=function(){return Lt([],[])},d3.scale.quantize=function(){return At(0,1,[0,1])},d3.scale.identity=function(){return Ot([0,1])},d3.svg={},d3.svg.arc=function(){function e(){var e=t.apply(this,arguments),s=n.apply(this,arguments),o=r.apply(this,arguments)+bs,u=i.apply(this,arguments)+bs,a=(u<o&&(a=o,o=u,u=a),u-o),f=a<Math.PI?"0":"1",l=Math.cos(o),c=Math.sin(o),h=Math.cos(u),p=Math.sin(u);return a>=ws?e?"M0,"+s+"A"+s+","+s+" 0 1,1 0,"+ -s+"A"+s+","+s+" 0 1,1 0,"+s+"M0,"+e+"A"+e+","+e+" 0 1,0 0,"+ -e+"A"+e+","+e+" 0 1,0 0,"+e+"Z":"M0,"+s+"A"+s+","+s+" 0 1,1 0,"+ -s+"A"+s+","+s+" 0 1,1 0,"+s+"Z":e?"M"+s*l+","+s*c+"A"+s+","+s+" 0 "+f+",1 "+s*h+","+s*p+"L"+e*h+","+e*p+"A"+e+","+e+" 0 "+f+",0 "+e*l+","+e*c+"Z":"M"+s*l+","+s*c+"A"+s+","+s+" 0 "+f+",1 "+s*h+","+s*p+"L0,0"+"Z"}var t=Mt,n=_t,r=Dt,i=Pt;return e.innerRadius=function(n){return arguments.length?(t=d3.functor(n),e):t},e.outerRadius=function(t){return arguments.length?(n=d3.functor(t),e):n},e.startAngle=function(t){return arguments.length?(r=d3.functor(t),e):r},e.endAngle=function(t){return arguments.length?(i=d3.functor(t),e):i},e.centroid=function(){var e=(t.apply(this,arguments)+n.apply(this,arguments))/2,s=(r.apply(this,arguments)+i.apply(this,arguments))/2+bs;return[Math.cos(s)*e,Math.sin(s)*e]},e};var bs=-Math.PI/2,ws=2*Math.PI-1e-6;d3.svg.line=function(){return Ht(Object)};var Es="linear",Ss=d3.map({linear:It,"step-before":qt,"step-after":Rt,basis:$t,"basis-open":Jt,"basis-closed":Kt,bundle:Qt,cardinal:Wt,"cardinal-open":Ut,"cardinal-closed":zt,monotone:nn}),xs=[0,2/3,1/3,0],Ts=[0,1/3,2/3,0],Ns=[0,1/6,2/3,1/6];d3.svg.line.radial=function(){var e=Ht(rn);return e.radius=e.x,delete e.x,e.angle=e.y,delete e.y,e},qt.reverse=Rt,Rt.reverse=qt,d3.svg.area=function(){return sn(Object)},d3.svg.area.radial=function(){var e=sn(rn);return e.radius=e.x,delete e.x,e.innerRadius=e.x0,delete e.x0,e.outerRadius=e.x1,delete e.x1,e.angle=e.y,delete e.y,e.startAngle=e.y0,delete e.y0,e.endAngle=e.y1,delete e.y1,e},d3.svg.chord=function(){function e(e,u){var a=t(this,s,e,u),f=t(this,o,e,u);return"M"+a.p0+r(a.r,a.p1,a.a1-a.a0)+(n(a,f)?i(a.r,a.p1,a.r,a.p0):i(a.r,a.p1,f.r,f.p0)+r(f.r,f.p1,f.a1-f.a0)+i(f.r,f.p1,a.r,a.p0))+"Z"}function t(e,t,n,r){var i=t.call(e,n,r),s=u.call(e,i,r),o=a.call(e,i,r)+bs,l=f.call(e,i,r)+bs;return{r:s,a0:o,a1:l,p0:[s*Math.cos(o),s*Math.sin(o)],p1:[s*Math.cos(l),s*Math.sin(l)]}}function n(e,t){return e.a0==t.a0&&e.a1==t.a1}function r(e,t,n){return"A"+e+","+e+" 0 "+ +(n>Math.PI)+",1 "+t}function i(e,t,n,r){return"Q 0,0 "+r}var s=an,o=fn,u=ln,a=Dt,f=Pt;return e.radius=function(t){return arguments.length?(u=d3.functor(t),e):u},e.source=function(t){return arguments.length?(s=d3.functor(t),e):s},e.target=function(t){return arguments.length?(o=d3.functor(t),e):o},e.startAngle=function(t){return arguments.length?(a=d3.functor(t),e):a},e.endAngle=function(t){return arguments.length?(f=d3.functor(t),e):f},e},d3.svg.diagonal=function(){function e(e,i){var s=t.call(this,e,i),o=n.call(this,e,i),u=(s.y+o.y)/2,a=[s,{x:s.x,y:u},{x:o.x,y:u},o];return a=a.map(r),"M"+a[0]+"C"+a[1]+" "+a[2]+" "+a[3]}var t=an,n=fn,r=pn;return e.source=function(n){return arguments.length?(t=d3.functor(n),e):t},e.target=function(t){return arguments.length?(n=d3.functor(t),e):n},e.projection=function(t){return arguments.length?(r=t,e):r},e},d3.svg.diagonal.radial=function(){var e=d3.svg.diagonal(),t=pn,n=e.projection;return e.projection=function(e){return arguments.length?n(dn(t=e)):t},e},d3.svg.mouse=d3.mouse,d3.svg.touches=d3.touches,d3.svg.symbol=function(){function e(e,r){return(Cs.get(t.call(this,e,r))||gn)(n.call(this,e,r))}var t=mn,n=vn;return e.type=function(n){return arguments.length?(t=d3.functor(n),e):t},e.size=function(t){return arguments.length?(n=d3.functor(t),e):n},e};var Cs=d3.map({circle:gn,cross:function(e){var t=Math.sqrt(e/5)/2;return"M"+ -3*t+","+ -t+"H"+ -t+"V"+ -3*t+"H"+t+"V"+ -t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+ -t+"V"+t+"H"+ -3*t+"Z"},diamond:function(e){var t=Math.sqrt(e/(2*Ls)),n=t*Ls;return"M0,"+ -t+"L"+n+",0"+" 0,"+t+" "+ -n+",0"+"Z"},square:function(e){var t=Math.sqrt(e)/2;return"M"+ -t+","+ -t+"L"+t+","+ -t+" "+t+","+t+" "+ -t+","+t+"Z"},"triangle-down":function(e){var t=Math.sqrt(e/ks),n=t*ks/2;return"M0,"+n+"L"+t+","+ -n+" "+ -t+","+ -n+"Z"},"triangle-up":function(e){var t=Math.sqrt(e/ks),n=t*ks/2;return"M0,"+ -n+"L"+t+","+n+" "+ -t+","+n+"Z"}});d3.svg.symbolTypes=Cs.keys();var ks=Math.sqrt(3),Ls=Math.tan(30*Math.PI/180);d3.svg.axis=function(){function e(e){e.each(function(){var e=d3.select(this),c=a==null?t.ticks?t.ticks.apply(t,u):t.domain():a,h=f==null?t.tickFormat?t.tickFormat.apply(t,u):String:f,p=wn(t,c,l),v=e.selectAll(".minor").data(p,String),m=v.enter().insert("line","g").attr("class","tick minor").style("opacity",1e-6),g=d3.transition(v.exit()).style("opacity",1e-6).remove(),y=d3.transition(v).style("opacity",1),b=e.selectAll("g").data(c,String),w=b.enter().insert("g","path").style("opacity",1e-6),E=d3.transition(b.exit()).style("opacity",1e-6).remove(),S=d3.transition(b).style("opacity",1),x,T=ct(t),N=e.selectAll(".domain").data([0]),C=N.enter().append("path").attr("class","domain"),k=d3.transition(N),L=t.copy(),A=this.__chart__||L;this.__chart__=L,w.append("line").attr("class","tick"),w.append("text"),S.select("text").text(h);switch(n){case"bottom":x=yn,m.attr("y2",i),y.attr("x2",0).attr("y2",i),w.select("line").attr("y2",r),w.select("text").attr("y",Math.max(r,0)+o),S.select("line").attr("x2",0).attr("y2",r),S.select("text").attr("x",0).attr("y",Math.max(r,0)+o).attr("dy",".71em").attr("text-anchor","middle"),k.attr("d","M"+T[0]+","+s+"V0H"+T[1]+"V"+s);break;case"top":x=yn,m.attr("y2",-i),y.attr("x2",0).attr("y2",-i),w.select("line").attr("y2",-r),w.select("text").attr("y",-(Math.max(r,0)+o)),S.select("line").attr("x2",0).attr("y2",-r),S.select("text").attr("x",0).attr("y",-(Math.max(r,0)+o)).attr("dy","0em").attr("text-anchor","middle"),k.attr("d","M"+T[0]+","+ -s+"V0H"+T[1]+"V"+ -s);break;case"left":x=bn,m.attr("x2",-i),y.attr("x2",-i).attr("y2",0),w.select("line").attr("x2",-r),w.select("text").attr("x",-(Math.max(r,0)+o)),S.select("line").attr("x2",-r).attr("y2",0),S.select("text").attr("x",-(Math.max(r,0)+o)).attr("y",0).attr("dy",".32em").attr("text-anchor","end"),k.attr("d","M"+ -s+","+T[0]+"H0V"+T[1]+"H"+ -s);break;case"right":x=bn,m.attr("x2",i),y.attr("x2",i).attr("y2",0),w.select("line").attr("x2",r),w.select("text").attr("x",Math.max(r,0)+o),S.select("line").attr("x2",r).attr("y2",0),S.select("text").attr("x",Math.max(r,0)+o).attr("y",0).attr("dy",".32em").attr("text-anchor","start"),k.attr("d","M"+s+","+T[0]+"H0V"+T[1]+"H"+s)}if(t.ticks)w.call(x,A),S.call(x,L),E.call(x,L),m.call(x,A),y.call(x,L),g.call(x,L);else{var O=L.rangeBand()/2,M=function(e){return L(e)+O};w.call(x,M),S.call(x,M)}})}var t=d3.scale.linear(),n="bottom",r=6,i=6,s=6,o=3,u=[10],a=null,f,l=0;return e.scale=function(n){return arguments.length?(t=n,e):t},e.orient=function(t){return arguments.length?(n=t,e):n},e.ticks=function(){return arguments.length?(u=arguments,e):u},e.tickValues=function(t){return arguments.length?(a=t,e):a},e.tickFormat=function(t){return arguments.length?(f=t,e):f},e.tickSize=function(t,n,o){if(!arguments.length)return r;var u=arguments.length-1;return r=+t,i=u>1?+n:r,s=u>0?+arguments[u]:r,e},e.tickPadding=function(t){return arguments.length?(o=+t,e):o},e.tickSubdivide=function(t){return arguments.length?(l=+t,e):l},e},d3.svg.brush=function(){function e(s){s.each(function(){var s=d3.select(this),f=s.selectAll(".background").data([0]),l=s.selectAll(".extent").data([0]),c=s.selectAll(".resize").data(a,String),h;s.style("pointer-events","all").on("mousedown.brush",i).on("touchstart.brush",i),f.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),l.enter().append("rect").attr("class","extent").style("cursor","move"),c.enter().append("g").attr("class",function(e){return"resize "+e}).style("cursor",function(e){return As[e]}).append("rect").attr("x",function(e){return/[ew]$/.test(e)?-3:null}).attr("y",function(e){return/^[ns]/.test(e)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),c.style("display",e.empty()?"none":null),c.exit().remove(),o&&(h=ct(o),f.attr("x",h[0]).attr("width",h[1]-h[0]),n(s)),u&&(h=ct(u),f.attr("y",h[0]).attr("height",h[1]-h[0]),r(s)),t(s)})}function t(e){e.selectAll(".resize").attr("transform",function(e){return"translate("+f[+/e$/.test(e)][0]+","+f[+/^s/.test(e)][1]+")"})}function n(e){e.select(".extent").attr("x",f[0][0]),e.selectAll(".extent,.n>rect,.s>rect").attr("width",f[1][0]-f[0][0])}function r(e){e.select(".extent").attr("y",f[0][1]),e.selectAll(".extent,.e>rect,.w>rect").attr("height",f[1][1]-f[0][1])}function i(){function i(){var e=d3.event.changedTouches;return e?d3.touches(v,e)[0]:d3.mouse(v)}function a(){d3.event.keyCode==32&&(S||(x=null,T[0]-=f[1][0],T[1]-=f[1][1],S=2),A())}function c(){d3.event.keyCode==32&&S==2&&(T[0]+=f[1][0],T[1]+=f[1][1],S=0,A())}function h(){var e=i(),s=!1;N&&(e[0]+=N[0],e[1]+=N[1]),S||(d3.event.altKey?(x||(x=[(f[0][0]+f[1][0])/2,(f[0][1]+f[1][1])/2]),T[0]=f[+(e[0]<x[0])][0],T[1]=f[+(e[1]<x[1])][1]):x=null),w&&p(e,o,0)&&(n(y),s=!0),E&&p(e,u,1)&&(r(y),s=!0),s&&(t(y),g({type:"brush",mode:S?"move":"resize"}))}function p(e,t,n){var r=ct(t),i=r[0],s=r[1],o=T[n],u=f[1][n]-f[0][n],a,c;S&&(i-=o,s-=u+o),a=Math.max(i,Math.min(s,e[n])),S?c=(a+=o)+u:(x&&(o=Math.max(i,Math.min(s,2*x[n]-a))),o<a?(c=a,a=o):c=o);if(f[0][n]!==a||f[1][n]!==c)return l=null,f[0][n]=a,f[1][n]=c,!0}function d(){h(),y.style("pointer-events","all").selectAll(".resize").style("display",e.empty()?"none":null),d3.select("body").style("cursor",null),C.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),g({type:"brushend"}),A()}var v=this,m=d3.select(d3.event.target),g=s.of(v,arguments),y=d3.select(v),b=m.datum(),w=!/^(n|s)$/.test(b)&&o,E=!/^(e|w)$/.test(b)&&u,S=m.classed("extent"),x,T=i(),N,C=d3.select(window).on("mousemove.brush",h).on("mouseup.brush",d).on("touchmove.brush",h).on("touchend.brush",d).on("keydown.brush",a).on("keyup.brush",c);if(S)T[0]=f[0][0]-T[0],T[1]=f[0][1]-T[1];else if(b){var k=+/w$/.test(b),L=+/^n/.test(b);N=[f[1-k][0]-T[0],f[1-L][1]-T[1]],T[0]=f[k][0],T[1]=f[L][1]}else d3.event.altKey&&(x=T.slice());y.style("pointer-events","none").selectAll(".resize").style("display",null),d3.select("body").style("cursor",m.style("cursor")),g({type:"brushstart"}),h(),A()}var s=M(e,"brushstart","brush","brushend"),o=null,u=null,a=Os[0],f=[[0,0],[0,0]],l;return e.x=function(t){return arguments.length?(o=t,a=Os[!o<<1|!u],e):o},e.y=function(t){return arguments.length?(u=t,a=Os[!o<<1|!u],e):u},e.extent=function(t){var n,r,i,s,a;return arguments.length?(l=[[0,0],[0,0]],o&&(n=t[0],r=t[1],u&&(n=n[0],r=r[0]),l[0][0]=n,l[1][0]=r,o.invert&&(n=o(n),r=o(r)),r<n&&(a=n,n=r,r=a),f[0][0]=n|0,f[1][0]=r|0),u&&(i=t[0],s=t[1],o&&(i=i[1],s=s[1]),l[0][1]=i,l[1][1]=s,u.invert&&(i=u(i),s=u(s)),s<i&&(a=i,i=s,s=a),f[0][1]=i|0,f[1][1]=s|0),e):(t=l||f,o&&(n=t[0][0],r=t[1][0],l||(n=f[0][0],r=f[1][0],o.invert&&(n=o.invert(n),r=o.invert(r)),r<n&&(a=n,n=r,r=a))),u&&(i=t[0][1],s=t[1][1],l||(i=f[0][1],s=f[1][1],u.invert&&(i=u.invert(i),s=u.invert(s)),s<i&&(a=i,i=s,s=a))),o&&u?[[n,i],[r,s]]:o?[n,r]:u&&[i,s])},e.clear=function(){return l=null,f[0][0]=f[0][1]=f[1][0]=f[1][1]=0,e},e.empty=function(){return o&&f[0][0]===f[1][0]||u&&f[0][1]===f[1][1]},d3.rebind(e,s,"on")};var As={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Os=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];d3.behavior={},d3.behavior.drag=function(){function e(){this.on("mousedown.drag",t).on("touchstart.drag",t)}function t(){function e(){var e=o.parentNode,t=d3.event.changedTouches;return t?d3.touches(e,t)[0]:d3.mouse(e)}function t(){if(!o.parentNode)return i();var t=e(),n=t[0]-l[0],r=t[1]-l[1];c|=n|r,l=t,A(),u({type:"drag",x:t[0]+f[0],y:t[1]+f[1],dx:n,dy:r})}function i(){u({type:"dragend"}),c&&(A(),d3.event.target===a&&h.on("click.drag",s,!0)),h.on("mousemove.drag",null).on("touchmove.drag",null).on("mouseup.drag",null).on("touchend.drag",null)}function s(){A(),h.on("click.drag",null)}var o=this,u=n.of(o,arguments),a=d3.event.target,f,l=e(),c=0,h=d3.select(window).on("mousemove.drag",t).on("touchmove.drag",t).on("mouseup.drag",i,!0).on("touchend.drag",i,!0);r?(f=r.apply(o,arguments),f=[f.x-l[0],f.y-l[1]]):f=[0,0],u({type:"dragstart"})}var n=M(e,"drag","dragstart","dragend"),r=null;return e.origin=function(t){return arguments.length?(r=t,e):r},d3.rebind(e,n,"on")},d3.behavior.zoom=function(){function e(){this.on("mousedown.zoom",o).on("mousewheel.zoom",u).on("mousemove.zoom",a).on("DOMMouseScroll.zoom",u).on("dblclick.zoom",f).on("touchstart.zoom",l).on("touchmove.zoom",c).on("touchend.zoom",l)}function t(e){return[(e[0]-h[0])/d,(e[1]-h[1])/d]}function n(e){return[e[0]*d+h[0],e[1]*d+h[1]]}function r(e){d=Math.max(m[0],Math.min(m[1],e))}function i(e,t){t=n(t),h[0]+=e[0]-t[0],h[1]+=e[1]-t[1]}function s(e){b&&b.domain(y.range().map(function(e){return(e-h[0])/d}).map(y.invert)),E&&E.domain(w.range().map(function(e){return(e-h[1])/d}).map(w.invert)),d3.event.preventDefault(),e({type:"zoom",scale:d,translate:h})}function o(){function e(){f=1,i(d3.mouse(o),c),s(u)}function n(){f&&A(),l.on("mousemove.zoom",null).on("mouseup.zoom",null),f&&d3.event.target===a&&l.on("click.zoom",r)}function r(){A(),l.on("click.zoom",null)}var o=this,u=g.of(o,arguments),a=d3.event.target,f=0,l=d3.select(window).on("mousemove.zoom",e).on("mouseup.zoom",n),c=t(d3.mouse(o));window.focus(),A()}function u(){p||(p=t(d3.mouse(this))),r(Math.pow(2,En()*.002)*d),i(d3.mouse(this),p),s(g.of(this,arguments))}function a(){p=null}function f(){var e=d3.mouse(this),n=t(e);r(d3.event.shiftKey?d/2:d*2),i(e,n),s(g.of(this,arguments))}function l(){var e=d3.touches(this),n=Date.now();v=d,p={},e.forEach(function(e){p[e.identifier]=t(e)}),A();if(e.length===1&&n-S<500){var o=e[0],u=t(e[0]);r(d*2),i(o,u),s(g.of(this,arguments))}S=n}function c(){var e=d3.touches(this),t=e[0],n=p[t.identifier];if(o=e[1]){var o,u=p[o.identifier];t=[(t[0]+o[0])/2,(t[1]+o[1])/2],n=[(n[0]+u[0])/2,(n[1]+u[1])/2],r(d3.event.scale*v)}i(t,n),s(g.of(this,arguments))}var h=[0,0],p,d=1,v,m=_s,g=M(e,"zoom"),y,b,w,E,S;return e.translate=function(t){return arguments.length?(h=t.map(Number),e):h},e.scale=function(t){return arguments.length?(d=+t,e):d},e.scaleExtent=function(t){return arguments.length?(m=t==null?_s:t.map(Number),e):m},e.x=function(t){return arguments.length?(b=t,y=t.copy(),e):b},e.y=function(t){return arguments.length?(E=t,w=t.copy(),e):E},d3.rebind(e,g,"on")};var Ms,_s=[0,Infinity];d3.layout={},d3.layout.bundle=function(){return function(e){var t=[],n=-1,r=e.length;while(++n<r)t.push(Sn(e[n]));return t}},d3.layout.chord=function(){function e(){var e={},n=[],c=d3.range(o),h=[],p,v,m,g,y;r=[],i=[],p=0,g=-1;while(++g<o){v=0,y=-1;while(++y<o)v+=s[g][y];n.push(v),h.push(d3.range(o)),p+=v}a&&c.sort(function(e,t){return a(n[e],n[t])}),f&&h.forEach(function(e,t){e.sort(function(e,n){return f(s[t][e],s[t][n])})}),p=(2*Math.PI-u*o)/p,v=0,g=-1;while(++g<o){m=v,y=-1;while(++y<o){var b=c[g],w=h[b][y],E=s[b][w],S=v,x=v+=E*p;e[b+"-"+w]={index:b,subindex:w,startAngle:S,endAngle:x,value:E}}i.push({index:b,startAngle:m,endAngle:v,value:(v-m)/p}),v+=u}g=-1;while(++g<o){y=g-1;while(++y<o){var T=e[g+"-"+y],N=e[y+"-"+g];(T.value||N.value)&&r.push(T.value<N.value?{source:N,target:T}:{source:T,target:N})}}l&&t()}function t(){r.sort(function(e,t){return l((e.source.value+e.target.value)/2,(t.source.value+t.target.value)/2)})}var n={},r,i,s,o,u=0,a,f,l;return n.matrix=function(e){return arguments.length?(o=(s=e)&&s.length,r=i=null,n):s},n.padding=function(e){return arguments.length?(u=e,r=i=null,n):u},n.sortGroups=function(e){return arguments.length?(a=e,r=i=null,n):a},n.sortSubgroups=function(e){return arguments.length?(f=e,r=null,n):f},n.sortChords=function(e){return arguments.length?(l=e,r&&t(),n):l},n.chords=function(){return r||e(),r},n.groups=function(){return i||e(),i},n},d3.layout.force=function(){function e(e){return function(t,n,r,i,s){if(t.point!==e){var o=t.cx-e.x,u=t.cy-e.y,a=1/Math.sqrt(o*o+u*u);if((i-n)*a<h){var f=t.charge*a*a;return e.px-=o*f,e.py-=u*f,!0}if(t.point&&isFinite(a)){var f=t.pointCharge*a*a;e.px-=o*f,e.py-=u*f}}return!t.charge}}function t(e){Nn(Ps=e),Ds=n}var n={},r=d3.dispatch("start","tick","end"),i=[1,1],s,o,u=.9,a=On,f=Mn,l=-30,c=.1,h=.8,p,d=[],v=[],m,g,y;return n.tick=function(){if((o*=.99)<.005)return r.end({type:"end",alpha:o=0}),!0;var t=d.length,n=v.length,s,a,f,h,p,b,w,E,S;for(a=0;a<n;++a){f=v[a],h=f.source,p=f.target,E=p.x-h.x,S=p.y-h.y;if(b=E*E+S*S)b=o*g[a]*((b=Math.sqrt(b))-m[a])/b,E*=b,S*=b,p.x-=E*(w=h.weight/(p.weight+h.weight)),p.y-=S*w,h.x+=E*(w=1-w),h.y+=S*w}if(w=o*c){E=i[0]/2,S=i[1]/2,a=-1;if(w)while(++a<t)f=d[a],f.x+=(E-f.x)*w,f.y+=(S-f.y)*w}if(l){An(s=d3.geom.quadtree(d),o,y),a=-1;while(++a<t)(f=d[a]).fixed||s.visit(e(f))}a=-1;while(++a<t)f=d[a],f.fixed?(f.x=f.px,f.y=f.py):(f.x-=(f.px-(f.px=f.x))*u,f.y-=(f.py-(f.py=f.y))*u);r.tick({type:"tick",alpha:o})},n.nodes=function(e){return arguments.length?(d=e,n):d},n.links=function(e){return arguments.length?(v=e,n):v},n.size=function(e){return arguments.length?(i=e,n):i},n.linkDistance=function(e){return arguments.length?(a=d3.functor(e),n):a},n.distance=n.linkDistance,n.linkStrength=function(e){return arguments.length?(f=d3.functor(e),n):f},n.friction=function(e){return arguments.length?(u=e,n):u},n.charge=function(e){return arguments.length?(l=typeof e=="function"?e:+e,n):l},n.gravity=function(e){return arguments.length?(c=e,n):c},n.theta=function(e){return arguments.length?(h=e,n):h},n.alpha=function(e){return arguments.length?(o?e>0?o=e:o=0:e>0&&(r.start({type:"start",alpha:o=e}),d3.timer(n.tick)),n):o},n.start=function(){function e(e,n){var i=t(r),s=-1,o=i.length,u;while(++s<o)if(!isNaN(u=i[s][e]))return u;return Math.random()*n}function t(){if(!p){p=[];for(s=0;s<o;++s)p[s]=[];for(s=0;s<u;++s){var e=v[s];p[e.source.index].push(e.target),p[e.target.index].push(e.source)}}return p[r]}var r,s,o=d.length,u=v.length,c=i[0],h=i[1],p,b;for(r=0;r<o;++r)(b=d[r]).index=r,b.weight=0;m=[],g=[];for(r=0;r<u;++r)b=v[r],typeof b.source=="number"&&(b.source=d[b.source]),typeof b.target=="number"&&(b.target=d[b.target]),m[r]=a.call(this,b,r),g[r]=f.call(this,b,r),++b.source.weight,++b.target.weight;for(r=0;r<o;++r)b=d[r],isNaN(b.x)&&(b.x=e("x",c)),isNaN(b.y)&&(b.y=e("y",h)),isNaN(b.px)&&(b.px=b.x),isNaN(b.py)&&(b.py=b.y);y=[];if(typeof l=="function")for(r=0;r<o;++r)y[r]=+l.call(this,d[r],r);else for(r=0;r<o;++r)y[r]=l;return n.resume()},n.resume=function(){return n.alpha(.1)},n.stop=function(){return n.alpha(0)},n.drag=function(){s||(s=d3.behavior.drag().origin(Object).on("dragstart",t).on("drag",Ln).on("dragend",kn)),this.on("mouseover.force",Nn).on("mouseout.force",Cn).call(s)},d3.rebind(n,r,"on")};var Ds,Ps;d3.layout.partition=function(){function e(t,n,r,i){var s=t.children;t.x=n,t.y=t.depth*i,t.dx=r,t.dy=i;if(s&&(u=s.length)){var o=-1,u,a,f;r=t.value?r/t.value:0;while(++o<u)e(a=s[o],n,f=a.value*r,i),n+=f}}function t(e){var n=e.children,r=0;if(n&&(s=n.length)){var i=-1,s;while(++i<s)r=Math.max(r,t(n[i]))}return 1+r}function n(n,s){var o=r.call(this,n,s);return e(o[0],0,i[0],i[1]/t(o[0])),o}var r=d3.layout.hierarchy(),i=[1,1];return n.size=function(e){return arguments.length?(i=e,n):i},zn(n,r)},d3.layout.pie=function(){function e(s,o){var u=s.map(function(n,r){return+t.call(e,n,r)}),a=+(typeof r=="function"?r.apply(this,arguments):r),f=((typeof i=="function"?i.apply(this,arguments):i)-r)/d3.sum(u),l=d3.range(s.length);n!=null&&l.sort(n===Hs?function(e,t){return u[t]-u[e]}:function(e,t){return n(s[e],s[t])});var c=[];return l.forEach(function(e){c[e]={data:s[e],value:d=u[e],startAngle:a,endAngle:a+=d*f}}),c}var t=Number,n=Hs,r=0,i=2*Math.PI;return e.value=function(n){return arguments.length?(t=n,e):t},e.sort=function(t){return arguments.length?(n=t,e):n},e.startAngle=function(t){return arguments.length?(r=t,e):r},e.endAngle=function(t){return arguments.length?(i=t,e):i},e};var Hs={};d3.layout.stack=function(){function e(u,a){var f=u.map(function(n,r){return t.call(e,n,r)}),l=f.map(function(t,n){return t.map(function(t,n){return[s.call(e,t,n),o.call(e,t,n)]})}),c=n.call(e,l,a);f=d3.permute(f,c),l=d3.permute(l,c);var h=r.call(e,l,a),p=f.length,v=f[0].length,m,g,y;for(g=0;g<v;++g){i.call(e,f[0][g],y=h[g],l[0][g][1]);for(m=1;m<p;++m)i.call(e,f[m][g],y+=l[m-1][g][1],l[m][g][1])}return u}var t=Object,n=Hn,r=Bn,i=Pn,s=_n,o=Dn;return e.values=function(n){return arguments.length?(t=n,e):t},e.order=function(t){return arguments.length?(n=typeof t=="function"?t:Bs.get(t)||Hn,e):n},e.offset=function(t){return arguments.length?(r=typeof t=="function"?t:js.get(t)||Bn,e):r},e.x=function(t){return arguments.length?(s=t,e):s},e.y=function(t){return arguments.length?(o=t,e):o},e.out=function(t){return arguments.length?(i=t,e):i},e};var Bs=d3.map({"inside-out":function(e){var t=e.length,n,r,i=e.map(jn),s=e.map(Fn),o=d3.range(t).sort(function(e,t){return i[e]-i[t]}),u=0,a=0,f=[],l=[];for(n=0;n<t;++n)r=o[n],u<a?(u+=s[r],f.push(r)):(a+=s[r],l.push(r));return l.reverse().concat(f)},reverse:function(e){return d3.range(e.length).reverse()},"default":Hn}),js=d3.map({silhouette:function(e){var t=e.length,n=e[0].length,r=[],i=0,s,o,u,a=[];for(o=0;o<n;++o){for(s=0,u=0;s<t;s++)u+=e[s][o][1];u>i&&(i=u),r.push(u)}for(o=0;o<n;++o)a[o]=(i-r[o])/2;return a},wiggle:function(e){var t=e.length,n=e[0],r=n.length,i=0,s,o,u,a,f,l,c,h,p,d=[];d[0]=h=p=0;for(o=1;o<r;++o){for(s=0,a=0;s<t;++s)a+=e[s][o][1];for(s=0,f=0,c=n[o][0]-n[o-1][0];s<t;++s){for(u=0,l=(e[s][o][1]-e[s][o-1][1])/(2*c);u<s;++u)l+=(e[u][o][1]-e[u][o-1][1])/c;f+=l*e[s][o][1]}d[o]=h-=a?f/a*c:0,h<p&&(p=h)}for(o=0;o<r;++o)d[o]-=p;return d},expand:function(e){var t=e.length,n=e[0].length,r=1/t,i,s,o,u=[];for(s=0;s<n;++s){for(i=0,o=0;i<t;i++)o+=e[i][s][1];if(o)for(i=0;i<t;i++)e[i][s][1]/=o;else for(i=0;i<t;i++)e[i][s][1]=r}for(s=0;s<n;++s)u[s]=0;return u},zero:Bn});d3.layout.histogram=function(){function e(e,s){var o=[],u=e.map(n,this),a=r.call(this,u,s),f=i.call(this,a,u,s),l,s=-1,c=u.length,h=f.length-1,p=t?1:1/c,v;while(++s<h)l=o[s]=[],l.dx=f[s+1]-(l.x=f[s]),l.y=0;s=-1;while(++s<c)v=u[s],v>=a[0]&&v<=a[1]&&(l=o[d3.bisect(f,v,1,h)-1],l.y+=p,l.push(e[s]));return o}var t=!0,n=Number,r=Un,i=qn;return e.value=function(t){return arguments.length?(n=t,e):n},e.range=function(t){return arguments.length?(r=d3.functor(t),e):r},e.bins=function(t){return arguments.length?(i=typeof t=="number"?function(e){return Rn(e,t)}:d3.functor(t),e):i},e.frequency=function(n){return arguments.length?(t=!!n,e):t},e},d3.layout.hierarchy=function(){function e(t,o,u){var a=i.call(n,t,o),f=Fs?t:{data:t};f.depth=o,u.push(f);if(a&&(c=a.length)){var l=-1,c,h=f.children=[],p=0,v=o+1;while(++l<c)d=e(a[l],v,u),d.parent=f,h.push(d),p+=d.value;r&&h.sort(r),s&&(f.value=p)}else s&&(f.value=+s.call(n,t,o)||0);return f}function t(e,r){var i=e.children,o=0;if(i&&(a=i.length)){var u=-1,a,f=r+1;while(++u<a)o+=t(i[u],f)}else s&&(o=+s.call(n,Fs?e:e.data,r)||0);return s&&(e.value=o),o}function n(t){var n=[];return e(t,0,n),n}var r=Vn,i=Wn,s=Xn;return n.sort=function(e){return arguments.length?(r=e,n):r},n.children=function(e){return arguments.length?(i=e,n):i},n.value=function(e){return arguments.length?(s=e,n):s},n.revalue=function(e){return t(e,0),e},n};var Fs=!1;d3.layout.pack=function(){function e(e,r){var i=t.call(this,e,r),s=i[0];s.x=0,s.y=0,tr(s);var o=n[0],u=n[1],a=1/Math.max(2*s.r/o,2*s.r/u);return nr(s,o/2,u/2,a),i}var t=d3.layout.hierarchy().sort(Jn),n=[1,1];return e.size=function(t){return arguments.length?(n=t,e):n},zn(e,t)},d3.layout.cluster=function(){function e(e,i){var s=t.call(this,e,i),o=s[0],u,a=0,f,l;vr(o,function(e){var t=e.children;t&&t.length?(e.x=sr(t),e.y=ir(t)):(e.x=u?a+=n(e,u):0,e.y=0,u=e)});var c=or(o),h=ur(o),p=c.x-n(c,h)/2,d=h.x+n(h,c)/2;return vr(o,function(e){e.x=(e.x-p)/(d-p)*r[0],e.y=(1-(o.y?e.y/o.y:1))*r[1]}),s}var t=d3.layout.hierarchy().sort(null).value(null),n=ar,r=[1,1];return e.separation=function(t){return arguments.length?(n=t,e):n},e.size=function(t){return arguments.length?(r=t,e):r},zn(e,t)},d3.layout.tree=function(){function e(e,i){function s(e,t){var r=e.children,i=e._tree;if(r&&(o=r.length)){var o,a=r[0],f,l=a,c,h=-1;while(++h<o)c=r[h],s(c,f),l=u(c,f,l),f=c;mr(e);var p=.5*(a._tree.prelim+c._tree.prelim);t?(i.prelim=t._tree.prelim+n(e,t),i.mod=i.prelim-p):i.prelim=p}else t&&(i.prelim=t._tree.prelim+n(e,t))}function o(e,t){e.x=e._tree.prelim+t;var n=e.children;if(n&&(i=n.length)){var r=-1,i;t+=e._tree.mod;while(++r<i)o(n[r],t)}}function u(e,t,r){if(t){var i=e,s=e,o=t,u=e.parent.children[0],a=i._tree.mod,f=s._tree.mod,l=o._tree.mod,c=u._tree.mod,h;while(o=lr(o),i=fr(i),o&&i)u=fr(u),s=lr(s),s._tree.ancestor=e,h=o._tree.prelim+l-i._tree.prelim-a+n(o,i),h>0&&(gr(yr(o,e,r),e,h),a+=h,f+=h),l+=o._tree.mod,a+=i._tree.mod,c+=u._tree.mod,f+=s._tree.mod;o&&!lr(s)&&(s._tree.thread=o,s._tree.mod+=l-f),i&&!fr(u)&&(u._tree.thread=i,u._tree.mod+=a-c,r=e)}return r}var a=t.call(this,e,i),f=a[0];vr(f,function(e,t){e._tree={ancestor:e,prelim:0,mod:0,change:0,shift:0,number:t?t._tree.number+1:0}}),s(f),o(f,-f._tree.prelim);var l=cr(f,pr),c=cr(f,hr),h=cr(f,dr),p=l.x-n(l,c)/2,d=c.x+n(c,l)/2,v=h.depth||1;return vr(f,function(e){e.x=(e.x-p)/(d-p)*r[0],e.y=e.depth/v*r[1],delete e._tree}),a}var t=d3.layout.hierarchy().sort(null).value(null),n=ar,r=[1,1];return e.separation=function(t){return arguments.length?(n=t,e):n},e.size=function(t){return arguments.length?(r=t,e):r},zn(e,t)},d3.layout.treemap=function(){function e(e,t){var n=-1,r=e.length,i,s;while(++n<r)s=(i=e[n]).value*(t<0?0:t),i.area=isNaN(s)||s<=0?0:s}function t(n){var s=n.children;if(s&&s.length){var o=l(n),u=[],a=s.slice(),f,c=Infinity,h,p=Math.min(o.dx,o.dy),d;e(a,o.dx*o.dy/n.value),u.area=0;while((d=a.length)>0)u.push(f=a[d-1]),u.area+=f.area,(h=r(u,p))<=c?(a.pop(),c=h):(u.area-=u.pop().area,i(u,p,o,!1),p=Math.min(o.dx,o.dy),u.length=u.area=0,c=Infinity);u.length&&(i(u,p,o,!0),u.length=u.area=0),s.forEach(t)}}function n(t){var r=t.children;if(r&&r.length){var s=l(t),o=r.slice(),u,a=[];e(o,s.dx*s.dy/t.value),a.area=0;while(u=o.pop())a.push(u),a.area+=u.area,u.z!=null&&(i(a,u.z?s.dx:s.dy,s,!o.length),a.length=a.area=0);r.forEach(n)}}function r(e,t){var n=e.area,r,i=0,s=Infinity,o=-1,u=e.length;while(++o<u){if(!(r=e[o].area))continue;r<s&&(s=r),r>i&&(i=r)}return n*=n,t*=t,n?Math.max(t*i*p/n,n/(t*s*p)):Infinity}function i(e,t,n,r){var i=-1,s=e.length,o=n.x,a=n.y,f=t?u(e.area/t):0,l;if(t==n.dx){if(r||f>n.dy)f=n.dy;while(++i<s)l=e[i],l.x=o,l.y=a,l.dy=f,o+=l.dx=Math.min(n.x+n.dx-o,f?u(l.area/f):0);l.z=!0,l.dx+=n.x+n.dx-o,n.y+=f,n.dy-=f}else{if(r||f>n.dx)f=n.dx;while(++i<s)l=e[i],l.x=o,l.y=a,l.dx=f,a+=l.dy=Math.min(n.y+n.dy-a,f?u(l.area/f):0);l.z=!1,l.dy+=n.y+n.dy-a,n.x+=f,n.dx-=f}}function s(r){var i=h||o(r),s=i[0];return s.x=0,s.y=0,s.dx=a[0],s.dy=a[1],h&&o.revalue(s),e([s],s.dx*s.dy/s.value),(h?n:t)(s),c&&(h=i),i}var o=d3.layout.hierarchy(),u=Math.round,a=[1,1],f=null,l=br,c=!1,h,p=.5*(1+Math.sqrt(5));return s.size=function(e){return arguments.length?(a=e,s):a},s.padding=function(e){function t(t){var n=e.call(s,t,t.depth);return n==null?br(t):wr(t,typeof n=="number"?[n,n,n,n]:n)}function n(t){return wr(t,e)}if(!arguments.length)return f;var r;return l=(f=e)==null?br:(r=typeof e)==="function"?t:r==="number"?(e=[e,e,e,e],n):n,s},s.round=function(e){return arguments.length?(u=e?Math.round:Number,s):u!=Number},s.sticky=function(e){return arguments.length?(c=e,h=null,s):c},s.ratio=function(e){return arguments.length?(p=e,s):p},zn(s,o)},d3.csv=function(e,t){d3.text(e,"text/csv",function(e){t(e&&d3.csv.parse(e))})},d3.csv.parse=function(e){var t;return d3.csv.parseRows(e,function(e,n){if(n){var r={},i=-1,s=t.length;while(++i<s)r[t[i]]=e[i];return r}return t=e,null})},d3.csv.parseRows=function(e,t){function n(){if(o.lastIndex>=e.length)return i;if(f)return f=!1,r;var t=o.lastIndex;if(e.charCodeAt(t)===34){var n=t;while(n++<e.length)if(e.charCodeAt(n)===34){if(e.charCodeAt(n+1)!==34)break;n++}o.lastIndex=n+2;var s=e.charCodeAt(n+1);return s===13?(f=!0,e.charCodeAt(n+2)===10&&o.lastIndex++):s===10&&(f=!0),e.substring(t+1,n).replace(/""/g,'"')}var u=o.exec(e);return u?(f=u[0].charCodeAt(0)!==44,e.substring(t,u.index)):(o.lastIndex=e.length,e.substring(t))}var r={},i={},s=[],o=/\r\n|[,\r\n]/g,u=0,a,f;o.lastIndex=0;while((a=n())!==i){var l=[];while(a!==r&&a!==i)l.push(a),a=n();if(t&&!(l=t(l,u++)))continue;s.push(l)}return s},d3.csv.format=function(e){return e.map(Er).join("\n")},d3.geo={};var Is=Math.PI/180;d3.geo.azimuthal=function(){function e(e){var n=e[0]*Is-s,o=e[1]*Is,f=Math.cos(n),l=Math.sin(n),c=Math.cos(o),h=Math.sin(o),p=t!=="orthographic"?a*h+u*c*f:null,v,m=t==="stereographic"?1/(1+p):t==="gnomonic"?1/p:t==="equidistant"?(v=Math.acos(p),v?v/Math.sin(v):0):t==="equalarea"?Math.sqrt(2/(1+p)):1,g=m*c*l,y=m*(a*c*f-u*h);return[r*g+i[0],r*y+i[1]]}var t="orthographic",n,r=200,i=[480,250],s,o,u,a;return e.invert=function(e){var n=(e[0]-i[0])/r,o=(e[1]-i[1])/r,f=Math.sqrt(n*n+o*o),l=t==="stereographic"?2*Math.atan(f):t==="gnomonic"?Math.atan(f):t==="equidistant"?f:t==="equalarea"?2*Math.asin(.5*f):Math.asin(f),c=Math.sin(l),h=Math.cos(l);return[(s+Math.atan2(n*c,f*u*h+o*a*c))/Is,Math.asin(h*a-(f?o*c*u/f:0))/Is]},e.mode=function(n){return arguments.length?(t=n+"",e):t},e.origin=function(t){return arguments.length?(n=t,s=n[0]*Is,o=n[1]*Is,u=Math.cos(o),a=Math.sin(o),e):n},e.scale=function(t){return arguments.length?(r=+t,e):r},e.translate=function(t){return arguments.length?(i=[+t[0],+t[1]],e):i},e.origin([0,0])},d3.geo.albers=function(){function e(e){var t=u*(Is*e[0]-o),n=Math.sqrt(a-2*u*Math.sin(Is*e[1]))/u;return[i*n*Math.sin(t)+s[0],i*(n*Math.cos(t)-f)+s[1]]}function t(){var t=Is*r[0],i=Is*r[1],s=Is*n[1],l=Math.sin(t),c=Math.cos(t);return o=Is*n[0],u=.5*(l+Math.sin(i)),a=c*c+2*u*l,f=Math.sqrt(a-2*u*Math.sin(s))/u,e}var n=[-98,38],r=[29.5,45.5],i=1e3,s=[480,250],o,u,a,f;return e.invert=function(e){var t=(e[0]-s[0])/i,n=(e[1]-s[1])/i,r=f+n,l=Math.atan2(t,r),c=Math.sqrt(t*t+r*r);return[(o+l/u)/Is,Math.asin((a-c*c*u*u)/(2*u))/Is]},e.origin=function(e){return arguments.length?(n=[+e[0],+e[1]],t()):n},e.parallels=function(e){return arguments.length?(r=[+e[0],+e[1]],t()):r},e.scale=function(t){return arguments.length?(i=+t,e):i},e.translate=function(t){return arguments.length?(s=[+t[0],+t[1]],e):s},t()},d3.geo.albersUsa=function(){function e(e){var s=e[0],o=e[1];return(o>50?n:s<-140?r:o<21?i:t)(e)}var t=d3.geo.albers(),n=d3.geo.albers().origin([-160,60]).parallels([55,65]),r=d3.geo.albers().origin([-160,20]).parallels([8,18]),i=d3.geo.albers().origin([-60,10]).parallels([8,18]);return e.scale=function(s){return arguments.length?(t.scale(s),n.scale(s*.6),r.scale(s),i.scale(s*1.5),e.translate(t.translate())):t.scale()},e.translate=function(s){if(!arguments.length)return t.translate();var o=t.scale()/1e3,u=s[0],a=s[1];return t.translate(s),n.translate([u-400*o,a+170*o]),r.translate([u-190*o,a+200*o]),i.translate([u+580*o,a+430*o]),e},e.scale(t.scale())},d3.geo.bonne=function(){function e(e){var u=e[0]*Is-r,a=e[1]*Is-i;if(s){var f=o+s-a,l=u*Math.cos(a)/f;u=f*Math.sin(l),a=f*Math.cos(l)-o}else u*=Math.cos(a),a*=-1;return[t*u+n[0],t*a+n[1]]}var t=200,n=[480,250],r,i,s,o;return e.invert=function(e){var i=(e[0]-n[0])/t,u=(e[1]-n[1])/t;if(s){var a=o+u,f=Math.sqrt(i*i+a*a);u=o+s-f,i=r+f*Math.atan2(i,a)/Math.cos(u)}else u*=-1,i/=Math.cos(u);return[i/Is,u/Is]},e.parallel=function(t){return arguments.length?(o=1/Math.tan(s=t*Is),e):s/Is},e.origin=function(t){return arguments.length?(r=t[0]*Is,i=t[1]*Is,e):[r/Is,i/Is]},e.scale=function(n){return arguments.length?(t=+n,e):t},e.translate=function(t){return arguments.length?(n=[+t[0],+t[1]],e):n},e.origin([0,0]).parallel(45)},d3.geo.equirectangular=function(){function e(e){var r=e[0]/360,i=-e[1]/360;return[t*r+n[0],t*i+n[1]]}var t=500,n=[480,250];return e.invert=function(e){var r=(e[0]-n[0])/t,i=(e[1]-n[1])/t;return[360*r,-360*i]},e.scale=function(n){return arguments.length?(t=+n,e):t},e.translate=function(t){return arguments.length?(n=[+t[0],+t[1]],e):n},e},d3.geo.mercator=function(){function e(e){var r=e[0]/360,i=-(Math.log(Math.tan(Math.PI/4+e[1]*Is/2))/Is)/360;return[t*r+n[0],t*Math.max(-0.5,Math.min(.5,i))+n[1]]}var t=500,n=[480,250];return e.invert=function(e){var r=(e[0]-n[0])/t,i=(e[1]-n[1])/t;return[360*r,2*Math.atan(Math.exp(-360*i*Is))/Is-90]},e.scale=function(n){return arguments.length?(t=+n,e):t},e.translate=function(t){return arguments.length?(n=[+t[0],+t[1]],e):n},e},d3.geo.path=function(){function e(e,t){return typeof s=="function"&&(o=Tr(s.apply(this,arguments))),a(e)||null}function t(e){return u(e).join(",")}function n(e){var t=i(e[0]),n=0,r=e.length;while(++n<r)t-=i(e[n]);return t}function r(e){var t=d3.geom.polygon(e[0].map(u)),n=t.area(),r=t.centroid(n<0?(n*=-1,1):-1),i=r[0],s=r[1],o=n,a=0,f=e.length;while(++a<f)t=d3.geom.polygon(e[a].map(u)),n=t.area(),r=t.centroid(n<0?(n*=-1,1):-1),i-=r[0],s-=r[1],o-=n;return[i,s,6*o]}function i(e){return Math.abs(d3.geom.polygon(e.map(u)).area())}var s=4.5,o=Tr(s),u=d3.geo.albersUsa(),a=xr({FeatureCollection:function(e){var t=[],n=e.features,r=-1,i=n.length;while(++r<i)t.push(a(n[r].geometry));return t.join("")},Feature:function(e){return a(e.geometry)},Point:function(e){return"M"+t(e.coordinates)+o},MultiPoint:function(e){var n=[],r=e.coordinates,i=-1,s=r.length;while(++i<s)n.push("M",t(r[i]),o);return n.join("")},LineString:function(e){var n=["M"],r=e.coordinates,i=-1,s=r.length;while(++i<s)n.push(t(r[i]),"L");return n.pop(),n.join("")},MultiLineString:function(e){var n=[],r=e.coordinates,i=-1,s=r.length,o,u,a;while(++i<s){o=r[i],u=-1,a=o.length,n.push("M");while(++u<a)n.push(t(o[u]),"L");n.pop()}return n.join("")},Polygon:function(e){var n=[],r=e.coordinates,i=-1,s=r.length,o,u,a;while(++i<s){o=r[i],u=-1;if((a=o.length-1)>0){n.push("M");while(++u<a)n.push(t(o[u]),"L");n[n.length-1]="Z"}}return n.join("")},MultiPolygon:function(e){var n=[],r=e.coordinates,i=-1,s=r.length,o,u,a,f,l,c;while(++i<s){o=r[i],u=-1,a=o.length;while(++u<a){f=o[u],l=-1;if((c=f.length-1)>0){n.push("M");while(++l<c)n.push(t(f[l]),"L");n[n.length-1]="Z"}}}return n.join("")},GeometryCollection:function(e){var t=[],n=e.geometries,r=-1,i=n.length;while(++r<i)t.push(a(n[r]));return t.join("")}}),f=e.area=xr({FeatureCollection:function(e){var t=0,n=e.features,r=-1,i=n.length;while(++r<i)t+=f(n[r]);return t},Feature:function(e){return f(e.geometry)},Polygon:function(e){return n(e.coordinates)},MultiPolygon:function(e){var t=0,r=e.coordinates,i=-1,s=r.length;while(++i<s)t+=n(r[i]);return t},GeometryCollection:function(e){var t=0,n=e.geometries,r=-1,i=n.length;while(++r<i)t+=f(n[r]);return t}},0),l=e.centroid=xr({Feature:function(e){return l(e.geometry)},Polygon:function(e){var t=r(e.coordinates);return[t[0]/t[2],t[1]/t[2]]},MultiPolygon:function(e){var t=0,n=e.coordinates,i,s=0,o=0,u=0,a=-1,f=n.length;while(++a<f)i=r(n[a]),s+=i[0],o+=i[1],u+=i[2];return[s/u,o/u]}});return e.projection=function(t){return u=t,e},e.pointRadius=function(t){return typeof t=="function"?s=t:(s=+t,o=Tr(s)),e},e},d3.geo.bounds=function(e){var t=Infinity,n=Infinity,r=-Infinity,i=-Infinity;return Nr(e,function(e,s){e<t&&(t=e),e>r&&(r=e),s<n&&(n=s),s>i&&(i=s)}),[[t,n],[r,i]]};var qs={Feature:Cr,FeatureCollection:kr,GeometryCollection:Lr,LineString:Ar,MultiLineString:Or,MultiPoint:Ar,MultiPolygon:Mr,Point:_r,Polygon:Dr};d3.geo.circle=function(){function e(){}function t(e){return u.distance(e)<o}function n(e){var t=-1,n=e.length,i=[],s,a,f,l,c;while(++t<n)c=u.distance(f=e[t]),c<o?(a&&i.push(Br(a,f)((l-o)/(l-c))),i.push(f),s=a=null):(a=f,!s&&i.length&&(i.push(Br(i[i.length-1],a)((o-l)/(c-l))),s=a)),l=c;return a&&i.length&&(c=u.distance(f=i[0]),i.push(Br(a,f)((l-o)/(l-c)))),r(i)}function r(e){var t=0,n=e.length,r,i,s=n?[e[0]]:e,o,a=u.source();while(++t<n){o=u.source(e[t-1])(e[t]).coordinates;for(r=0,i=o.length;++r<i;)s.push(o[r])}return u.source(a),s}var i=[0,0],s=89.99,o=s*Is,u=d3.geo.greatArc().target(Object);e.clip=function(e){return u.source(typeof i=="function"?i.apply(this,arguments):i),a(e)};var a=xr({FeatureCollection:function(e){var t=e.features.map(a).filter(Object);return t&&(e=Object.create(e),e.features=t,e)},Feature:function(e){var t=a(e.geometry);return t&&(e=Object.create(e),e.geometry=t,e)},Point:function(e){return t(e.coordinates)&&e},MultiPoint:function(e){var n=e.coordinates.filter(t);return n.length&&{type:e.type,coordinates:n}},LineString:function(e){var t=n(e.coordinates);return t.length&&(e=Object.create(e),e.coordinates=t,e)},MultiLineString:function(e){var t=e.coordinates.map(n).filter(function(e){return e.length});return t.length&&(e=Object.create(e),e.coordinates=t,e)},Polygon:function(e){var t=e.coordinates.map(n);return t[0].length&&(e=Object.create(e),e.coordinates=t,e)},MultiPolygon:function(e){var t=e.coordinates.map(function(e){return e.map(n)}).filter(function(e){return e[0].length});return t.length&&(e=Object.create(e),e.coordinates=t,e)},GeometryCollection:function(e){var t=e.geometries.map(a).filter(Object);return t.length&&(e=Object.create(e),e.geometries=t,e)}});return e.origin=function(t){return arguments.length?(i=t,e):i},e.angle=function(t){return arguments.length?(o=(s=+t)*Is,e):s},e.precision=function(t){return arguments.length?(u.precision(t),e):u.precision()},e},d3.geo.greatArc=function(){function e(){var e=typeof t=="function"?t.apply(this,arguments):t,i=typeof n=="function"?n.apply(this,arguments):n,s=Br(e,i),o=r/s.d,u=0,a=[e];while((u+=o)<1)a.push(s(u));return a.push(i),{type:"LineString",coordinates:a}}var t=Pr,n=Hr,r=6*Is;return e.distance=function(){var e=typeof t=="function"?t.apply(this,arguments):t,r=typeof n=="function"?n.apply(this,arguments):n;return Br(e,r).d},e.source=function(n){return arguments.length?(t=n,e):t},e.target=function(t){return arguments.length?(n=t,e):n},e.precision=function(t){return arguments.length?(r=t*Is,e):r/Is},e},d3.geo.greatCircle=d3.geo.circle,d3.geom={},d3.geom.contour=function(e,t){var n=t||jr(e),r=[],i=n[0],s=n[1],o=0,u=0,a=NaN,f=NaN,l=0;do l=0,e(i-1,s-1)&&(l+=1),e(i,s-1)&&(l+=2),e(i-1,s)&&(l+=4),e(i,s)&&(l+=8),l===6?(o=f===-1?-1:1,u=0):l===9?(o=0,u=a===1?-1:1):(o=Rs[l],u=Us[l]),o!=a&&u!=f&&(r.push([i,s]),a=o,f=u),i+=o,s+=u;while(n[0]!=i||n[1]!=s);return r};var Rs=[1,0,1,1,-1,0,-1,1,0,0,0,0,-1,0,-1,NaN],Us=[0,-1,0,0,0,-1,0,0,1,-1,1,1,0,-1,0,NaN];d3.geom.hull=function(e){if(e.length<3)return[];var t=e.length,n=t-1,r=[],i=[],s,o,u=0,a,f,l,c,h,p,d,v;for(s=1;s<t;++s)e[s][1]<e[u][1]?u=s:e[s][1]==e[u][1]&&(u=e[s][0]<e[u][0]?s:u);for(s=0;s<t;++s){if(s===u)continue;f=e[s][1]-e[u][1],a=e[s][0]-e[u][0],r.push({angle:Math.atan2(f,a),index:s})}r.sort(function(e,t){return e.angle-t.angle}),d=r[0].angle,p=r[0].index,h=0;for(s=1;s<n;++s)o=r[s].index,d==r[s].angle?(a=e[p][0]-e[u][0],f=e[p][1]-e[u][1],l=e[o][0]-e[u][0],c=e[o][1]-e[u][1],a*a+f*f>=l*l+c*c?r[s].index=-1:(r[h].index=-1,d=r[s].angle,h=s,p=o)):(d=r[s].angle,h=s,p=o);i.push(u);for(s=0,o=0;s<2;++o)r[o].index!==-1&&(i.push(r[o].index),s++);v=i.length;for(;o<n;++o){if(r[o].index===-1)continue;while(!Fr(i[v-2],i[v-1],r[o].index,e))--v;i[v++]=r[o].index}var m=[];for(s=0;s<v;++s)m.push(e[i[s]]);return m},d3.geom.polygon=function(e){return e.area=function(){var t=0,n=e.length,r=e[n-1][0]*e[0][1],i=e[n-1][1]*e[0][0];while(++t<n)r+=e[t-1][0]*e[t][1],i+=e[t-1][1]*e[t][0];return(i-r)*.5},e.centroid=function(t){var n=-1,r=e.length,i=0,s=0,o,u=e[r-1],a;arguments.length||(t=-1/(6*e.area()));while(++n<r)o=u,u=e[n],a=o[0]*u[1]-u[0]*o[1],i+=(o[0]+u[0])*a,s+=(o[1]+u[1])*a;return[i*t,s*t]},e.clip=function(t){var n,r=-1,i=e.length,s,o,u=e[i-1],a,f,l;while(++r<i){n=t.slice(),t.length=0,a=e[r],f=n[(o=n.length)-1],s=-1;while(++s<o)l=n[s],Ir(l,u,a)?(Ir(f,u,a)||t.push(qr(f,l,u,a)),t.push(l)):Ir(f,u,a)&&t.push(qr(f,l,u,a)),f=l;u=a}return t},e},d3.geom.voronoi=function(e){var t=e.map(function(){return[]});return Rr(e,function(e){var n,r,i,s,o,u;e.a===1&&e.b>=0?(n=e.ep.r,r=e.ep.l):(n=e.ep.l,r=e.ep.r),e.a===1?(o=n?n.y:-1e6,i=e.c-e.b*o,u=r?r.y:1e6,s=e.c-e.b*u):(i=n?n.x:-1e6,o=e.c-e.a*i,s=r?r.x:1e6,u=e.c-e.a*s);var a=[i,o],f=[s,u];t[e.region.l.index].push(a,f),t[e.region.r.index].push(a,f)}),t.map(function(t,n){var r=e[n][0],i=e[n][1];return t.forEach(function(e){e.angle=Math.atan2(e[0]-r,e[1]-i)}),t.sort(function(e,t){return e.angle-t.angle}).filter(function(e,n){return!n||e.angle-t[n-1].angle>1e-10})})};var zs={l:"r",r:"l"};d3.geom.delaunay=function(e){var t=e.map(function(){return[]}),n=[];return Rr(e,function(n){t[n.region.l.index].push(e[n.region.r.index])}),t.forEach(function(t,r){var i=e[r],s=i[0],o=i[1];t.forEach(function(e){e.angle=Math.atan2(e[0]-s,e[1]-o)}),t.sort(function(e,t){return e.angle-t.angle});for(var u=0,a=t.length-1;u<a;u++)n.push([i,t[u],t[u+1]])}),n},d3.geom.quadtree=function(e,t,n,r,i){function s(e,t,n,r,i,s){if(isNaN(t.x)||isNaN(t.y))return;if(e.leaf){var u=e.point;u?Math.abs(u.x-t.x)+Math.abs(u.y-t.y)<.01?o(e,t,n,r,i,s):(e.point=null,o(e,u,n,r,i,s),o(e,t,n,r,i,s)):e.point=t}else o(e,t,n,r,i,s)}function o(e,t,n,r,i,o){var u=(n+i)*.5,a=(r+o)*.5,f=t.x>=u,l=t.y>=a,c=(l<<1)+f;e.leaf=!1,e=e.nodes[c]||(e.nodes[c]=Ur()),f?n=u:i=u,l?r=a:o=a,s(e,t,n,r,i,o)}var u,a=-1,f=e.length;f&&isNaN(e[0].x)&&(e=e.map(Wr));if(arguments.length<5)if(arguments.length===3)i=r=n,n=t;else{t=n=Infinity,r=i=-Infinity;while(++a<f)u=e[a],u.x<t&&(t=u.x),u.y<n&&(n=u.y),u.x>r&&(r=u.x),u.y>i&&(i=u.y);var l=r-t,c=i-n;l>c?i=n+l:r=t+c}var h=Ur();return h.add=function(e){s(h,e,t,n,r,i)},h.visit=function(e){zr(e,h,t,n,r,i)},e.forEach(h.add),h},d3.time={};var Ws=Date;Xr.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){Xs.setUTCDate.apply(this._,arguments)},setDay:function(){Xs.setUTCDay.apply(this._,arguments)},setFullYear:function(){Xs.setUTCFullYear.apply(this._,arguments)},setHours:function(){Xs.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){Xs.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){Xs.setUTCMinutes.apply(this._,arguments)},setMonth:function(){Xs.setUTCMonth.apply(this._,arguments)},setSeconds:function(){Xs.setUTCSeconds.apply(this._,arguments)},setTime:function(){Xs.setTime.apply(this._,arguments)}};var Xs=Date.prototype;d3.time.format=function(e){function t(t){var r=[],i=-1,s=0,o,u;while(++i<n)e.charCodeAt(i)==37&&(r.push(e.substring(s,i),(u=Qs[o=e.charAt(++i)])?u(t):o),s=i+1);return r.push(e.substring(s,i)),r.join("")}var n=e.length;return t.parse=function(t){var n={y:1900,m:0,d:1,H:0,M:0,S:0,L:0},r=Vr(n,e,t,0);if(r!=t.length)return null;"p"in n&&(n.H=n.H%12+n.p*12);var i=new Ws;return i.setFullYear(n.y,n.m,n.d),i.setHours(n.H,n.M,n.S,n.L),i},t.toString=function(){return e},t};var Vs=d3.format("02d"),$s=d3.format("03d"),Js=d3.format("04d"),Ks=d3.format("2d"),Qs={a:function(e){return d3_time_weekdays[e.getDay()].substring(0,3)},A:function(e){return d3_time_weekdays[e.getDay()]},b:function(e){return ro[e.getMonth()].substring(0,3)},B:function(e){return ro[e.getMonth()]},c:d3.time.format("%a %b %e %H:%M:%S %Y"),d:function(e){return Vs(e.getDate())},e:function(e){return Ks(e.getDate())},H:function(e){return Vs(e.getHours())},I:function(e){return Vs(e.getHours()%12||12)},j:function(e){return $s(1+d3.time.dayOfYear(e))},L:function(e){return $s(e.getMilliseconds())},m:function(e){return Vs(e.getMonth()+1)},M:function(e){return Vs(e.getMinutes())},p:function(e){return e.getHours()>=12?"PM":"AM"},S:function(e){return Vs(e.getSeconds())},U:function(e){return Vs(d3.time.sundayOfYear(e))},w:function(e){return e.getDay()},W:function(e){return Vs(d3.time.mondayOfYear(e))},x:d3.time.format("%m/%d/%y"),X:d3.time.format("%H:%M:%S"),y:function(e){return Vs(e.getFullYear()%100)},Y:function(e){return Js(e.getFullYear()%1e4)},Z:li,"%":function(e){return"%"}},Gs={a:$r,A:Jr,b:Kr,B:Qr,c:Gr,d:ii,e:ii,H:si,I:si,L:ai,m:ri,M:oi,p:fi,S:ui,x:Yr,X:Zr,y:ti,Y:ei},Ys=/^(?:sun|mon|tue|wed|thu|fri|sat)/i,Zs=/^(?:Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday)/i;d3_time_weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var eo=d3.map({jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11}),to=/^(?:January|February|March|April|May|June|July|August|September|October|November|December)/ig,no=d3.map({january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11}),ro=["January","February","March","April","May","June","July","August","September","October","November","December"],io=/\s*\d+/,so=d3.map({am:0,pm:1});d3.time.format.utc=function(e){function t(e){try{Ws=Xr;var t=new Ws;return t._=e,n(t)}finally{Ws=Date}}var n=d3.time.format(e);return t.parse=function(e){try{Ws=Xr;var t=n.parse(e);return t&&t._}finally{Ws=Date}},t.toString=n.toString,t};var oo=d3.time.format.utc("%Y-%m-%dT%H:%M:%S.%LZ");d3.time.format.iso=Date.prototype.toISOString?ci:oo,ci.parse=function(e){return new Date(e)},ci.toString=oo.toString,d3.time.second=hi(function(e){return new Ws(Math.floor(e/1e3)*1e3)},function(e,t){e.setTime(e.getTime()+Math.floor(t)*1e3)},function(e){return e.getSeconds()}),d3.time.seconds=d3.time.second.range,d3.time.seconds.utc=d3.time.second.utc.range,d3.time.minute=hi(function(e){return new Ws(Math.floor(e/6e4)*6e4)},function(e,t){e.setTime(e.getTime()+Math.floor(t)*6e4)},function(e){return e.getMinutes()}),d3.time.minutes=d3.time.minute.range,d3.time.minutes.utc=d3.time.minute.utc.range,d3.time.hour=hi(function(e){var t=e.getTimezoneOffset()/60;return new Ws((Math.floor(e/36e5-t)+t)*36e5)},function(e,t){e.setTime(e.getTime()+Math.floor(t)*36e5)},function(e){return e.getHours()}),d3.time.hours=d3.time.hour.range,d3.time.hours.utc=d3.time.hour.utc.range,d3.time.day=hi(function(e){return new Ws(e.getFullYear(),e.getMonth(),e.getDate())},function(e,t){e.setDate(e.getDate()+t)},function(e){return e.getDate()-1}),d3.time.days=d3.time.day.range,d3.time.days.utc=d3.time.day.utc.range,d3.time.dayOfYear=function(e){var t=d3.time.year(e);return Math.floor((e-t)/864e5-(e.getTimezoneOffset()-t.getTimezoneOffset())/1440)},d3_time_weekdays.forEach(function(e,t){e=e.toLowerCase(),t=7-t;var n=d3.time[e]=hi(function(e){return(e=d3.time.day(e)).setDate(e.getDate()-(e.getDay()+t)%7),e},function(e,t){e.setDate(e.getDate()+Math.floor(t)*7)},function(e){var n=d3.time.year(e).getDay();return Math.floor((d3.time.dayOfYear(e)+(n+t)%7)/7)-(n!==t)});d3.time[e+"s"]=n.range,d3.time[e+"s"].utc=n.utc.range,d3.time[e+"OfYear"]=function(e){var n=d3.time.year(e).getDay();return Math.floor((d3.time.dayOfYear(e)+(n+t)%7)/7)}}),d3.time.week=d3.time.sunday,d3.time.weeks=d3.time.sunday.range,d3.time.weeks.utc=d3.time.sunday.utc.range,d3.time.weekOfYear=d3.time.sundayOfYear,d3.time.month=hi(function(e){return new Ws(e.getFullYear(),e.getMonth(),1)},function(e,t){e.setMonth(e.getMonth()+t)},function(e){return e.getMonth()}),d3.time.months=d3.time.month.range,d3.time.months.utc=d3.time.month.utc.range,d3.time.year=hi(function(e){return new Ws(e.getFullYear(),0,1)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e){return e.getFullYear()}),d3.time.years=d3.time.year.range,d3.time.years.utc=d3.time.year.utc.range;var uo=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],ao=[[d3.time.second,1],[d3.time.second,5],[d3.time.second,15],[d3.time.second,30],[d3.time.minute,1],[d3.time.minute,5],[d3.time.minute,15],[d3.time.minute,30],[d3.time.hour,1],[d3.time.hour,3],[d3.time.hour,6],[d3.time.hour,12],[d3.time.day,1],[d3.time.day,2],[d3.time.week,1],[d3.time.month,1],[d3.time.month,3],[d3.time.year,1]],fo=[[d3.time.format("%Y"),function(e){return!0}],[d3.time.format("%B"),function(e){return e.getMonth()}],[d3.time.format("%b %d"),function(e){return e.getDate()!=1}],[d3.time.format("%a %d"),function(e){return e.getDay()&&e.getDate()!=1}],[d3.time.format("%I %p"),function(e){return e.getHours()}],[d3.time.format("%I:%M"),function(e){return e.getMinutes()}],[d3.time.format(":%S"),function(e){return e.getSeconds()}],[d3.time.format(".%L"),function(e){return e.getMilliseconds()}]],lo=d3.scale.linear(),co=gi(fo);ao.year=function(e,t){return lo.domain(e.map(bi)).ticks(t).map(yi)},d3.time.scale=function(){return di(d3.scale.linear(),ao,co)};var ho=ao.map(function(e){return[e[0].utc,e[1]]}),po=[[d3.time.format.utc("%Y"),function(e){return!0}],[d3.time.format.utc("%B"),function(e){return e.getUTCMonth()}],[d3.time.format.utc("%b %d"),function(e){return e.getUTCDate()!=1}],[d3.time.format.utc("%a %d"),function(e){return e.getUTCDay()&&e.getUTCDate()!=1}],[d3.time.format.utc("%I %p"),function(e){return e.getUTCHours()}],[d3.time.format.utc("%I:%M"),function(e){return e.getUTCMinutes()}],[d3.time.format.utc(":%S"),function(e){return e.getUTCSeconds()}],[d3.time.format.utc(".%L"),function(e){return e.getUTCMilliseconds()}]],vo=gi(po);ho.year=function(e,t){return lo.domain(e.map(Ei)).ticks(t).map(wi)},d3.time.scale.utc=function(){return di(d3.scale.linear(),ho,vo)}}(),define("d3",function(e){return function(){var t,n;return t||e.d3}}(this)),define("views/graphs/histogram-view",["jquery","underscore","backbone","config","utils","text!templates/histogram.html","views/graphs/graph-view-base","d3"],function(e,t,n,r,i,s,o,u){var a=o.extend({className:"graph histogram",scopes:[GraphScope.OVERALL],events:{},initialize:function(e){var n=this,e=t.extend({renderAxes:!0},e);a.__super__.initialize.call(this,e),this.template=t.template(s)},renderGraph:function(){var e=this,t=this.model.getValFormatter();a.__super__.renderGraph.apply(this,arguments);var n=this.collection.properties.numBins,r=this.collection.properties.binSize,i=this.collection.models,s=t.unit||(this.model.getNumericField()||"").split(".").pop(),o=this.model.getDisplay("itemTitlePlural"),f=this.model.getMappedExtremes(),l=function(e){return e.attributes.count||0},c=function(e){var t=e.getNumericVal();return t=t.avg?t.avg:t,t},h=u.extent(i,l),p=h[0]/h[1]<1e-4?"log":"linear",d=u.scale.linear().range(this.getXRange()).domain([f.numeric.min,f.numeric.max]),v=u.scale[p]().range(this.getYRange()).domain(u.extent(i,l)),m=this.graphWidth/n;if(this.renderAxes){var g=u.svg.axis().scale(d).orient("bottom").tickFormat(function(e){return t.format(e)}),y=u.svg.axis().scale(v).orient("left");this.appendXAxis(g,s),this.appendYAxis(y,o)}return this.svg.selectAll("rect").data(i).enter().append("rect").attr("x",function(e,t){return d(c(e))}).attr("y",function(e,t){return v(l(e))}).attr("height",function(t,n){return e.graphHeight-v(l(t))}).attr("width",m).attr("class","crisp").style("fill",function(e,t){return e.getRenderAttr("color")}).on("mouseover",function(n){var i=this,s=l(n),o=c(n),a=o+r;e.showTooltip(this,__("%(count)s %(title)s between %(min)s–%(max)s",{count:autoFormatNumber(s),title:s!=1?e.model.getDisplay("itemTitlePlural"):e.model.getDisplay("itemTitle"),min:t.format(o),max:t.format(a)})),u.select(this).style("fill",n.getRenderAttr("hightlightColor",function(){return highlightForColor(n.getRenderAttr("color"))}))}).on("mouseout",function(e){u.select(this).style("fill",e.getRenderAttr("color"))}),this}});return a}),define("text!templates/legend.html",[],function(){return'<ul class="color-bar clearfix condensed"></ul>\n<div class="unit box">\n    <ul class="nav nav-pills nav-pills-inline nav-pills-muted">\n    </ul>\n</div>\n\n<div class="color-scheme-popover">\n	<ul class="color-schemes nav ">\n	</ul>\n</div>\n'}),define("views/legend-view",["jquery","underscore","backbone","config","utils","text!templates/legend.html"],function(e,t,n,r,i,s){var o=n.View.extend({className:"legend",autoHide:!0,events:{"click .unit-toggle":"unitToggleClicked","click .color-scheme-trigger":function(e){e.preventDefault()}},initialize:function(e){this.template=t.template(s),this.listenTo(this.model,"toggle:valFormatter",this.valFormatterChanged),this.listenTo(this.model,"toggle:colorScheme",this.colorSchemeChanged),this.listenTo(this.model.mapFeatures,"reset",this.countsChanged),this.hasBeenVisible=!1,this.autoHide=e.autoHide!=undefined?e.autoHide:this.autoHide},unitToggleClicked:function(t){this.model.setValFormatter(parseInt(e(t.currentTarget).attr("data-index"))),t.preventDefault()},countsChanged:function(e){this.model.getOption("attrMap",{}).featureColor=="count"&&this.updateColorBarLabels()},valFormatterChanged:function(t){var n=this.$(".unit ul li");n.removeClass("active"),this.model.getValFormatters().length>1&&e(n[this.model.sessionOptions.valFormatterIndex]).addClass("active"),this.updateColorBarLabels()},colorSchemeToggleClicked:function(t){this.model.setColorScheme(parseInt(e(t.currentTarget).attr("data-index"))),t.preventDefault()},colorSchemeChanged:function(e){this.render()},removePopover:function(){this.colorSchemeTrigger&&this.colorSchemeTrigger.popover("hide"),e(".popover").remove()},getDisplayUnit:function(e){return this.isDisplayingCounts()?this.model.getDisplay("itemTitlePlural"):(e||(e=this.model.getValFormatter()),e.unit)},render:function(){var t=this,n=this.model.getLayerOptions();e(this.el).html(this.template()),this.removePopover();var r=this.model.getValFormatter(),i=this.getDisplayUnit(r),s=this.model.getLayerOptions().colorSchemes,o=this.model.getColorScheme();if(i){var u=[],a=this.model.getValFormatters(),f=this.$(".unit ul"),l=!this.isDisplayingCounts()&&a.length>1,c=l?a.length:1;f.html("");for(var h=0;h<c;h++){var p=a[h],d='<li class="unit-item'+(l&&p==r?" active":"")+'">'+(l?'<a href="#" class="unit-toggle" data-index="'+h+'">':"<span>")+this.getDisplayUnit(p)+(l?"</a>":"</span>")+"</li>",d=e(d);f.append(d)}this.$(".unit").show()}else this.$(".unit").hide();var v=this.$(".color-scheme-popover").remove();if(s&&s.length>1){var f=this.$(".unit ul"),m=s.map(function(e,t){return'<li><a href="#" class="color-scheme-toggle" data-index="'+t+'">'+e.name+"</a></li>"});f.append('<li><a href="#" class="color-scheme-trigger has-popover" data-placement="bottom"><i class="glyphicon glyphicon-adjust"></i> <span class="caret"></span></a>'),this.colorSchemeTrigger=this.$(".color-scheme-trigger"),e(".color-schemes",v).append(m.join("\n")),this.$(".unit").show(),this.colorSchemeTrigger.popover({animation:!1,content:function(){return e(".color-scheme-toggle",v).each(function(n){e(this).toggleClass("active",n==t.model.sessionOptions.colorSchemeIndex)}),v.html()},html:!0,title:__("Color Schemes")}).on("shown.bs.popover",function(){e(".color-scheme-toggle").click(function(e){return t.colorSchemeTrigger.popover("hide"),t.colorSchemeToggleClicked(e)})})}if(this.$(".color-bar").length){var g=[],y=this.model.getNormalizedColors(),b=n.colorLabelColor&&n.colorLabelColor.length?n.colorLabelColor:null,w=100;for(var h=0;h<y.length;h++){var E=y[h].color,S=multRGB(E,.95),x=getRGBChannels(b||E),T=rgb2hsb(x)[2]<.5,T=b?!T:T;g.push('<li style="width: '+Math.round(w/y.length*100)/100+'%;">'+'<div class="segment'+(T?" inverted":"")+'" style="background: '+E+";"+"background: linear-gradient(top, "+E+" 40%, "+S+" 80%);"+"background: -webkit-gradient(linear, left top, left bottom, color-stop(.4, "+E+"), color-stop(.8, "+S+"));"+(b?" color: "+b+";":"")+'">'+"</div>"+"</li>")}this.$(".color-bar").html(g.join("")),this.updateColorBarLabels()}return this},isDisplayingCounts:function(){return this.model.getOption("attrMap",{}).featureColor=="count"},updateColorBarLabels:function(){if(!this.$(".color-bar").length)return;var t=this.model.getValFormatter(),n=this.model.getNormalizedColors(),r=n.length>1,i=this.$(".color-bar .segment"),s=!1;for(var o=0;o<n.length;o++){var u,a,f=this.model.isNumeric(),l=this.isDisplayingCounts(),c=!1,h=this.model.mapFeatures.getCounts(),p=h?h.max>1e4?1e3:h.max>100?100:1:0,d=this.model.getMappedExtremes(),v=d.numeric?d.numeric.min:NaN,m=d.numeric?d.numeric.max:NaN,g=this.model.attrMap?this.model.attrMap.numeric:null;if(n[o].label!=undefined)u=n[o].label;else if(l)h&&h.max?(u=n[o].position*h.max,u<1?u=1:(u>p&&(u=Math.round(u/p)*p),u=autoFormatNumber(u)),c=!0):u="&nbsp;";else if(!f||n[o].title&&n[o].title.length)u=n[o].title||"&nbsp;";else{s=!0;if(r){u=t.format(v+n[o].position*(m-v));if(a==undefined||n[o].position>n[a].position)a=o}else u="%(min)s – %(max)s".format({min:t.format(v),max:t.format(m)})}e(i[o]).html(u)}a!=undefined&&n[a].position<1&&e(i[a]).append("+"),l?c?(this.$el.show("fast"),this.hasBeenVisible=!0):this.autoHide&&this.$el.hide(this.hasBeenVisible?"fast":null):this.hasBeenVisible=!1}});return o}),!function(e,t,n){function o(e,n){var r=t.createElement(e||"div"),i;for(i in n)r[i]=n[i];return r}function u(e){for(var t=1,n=arguments.length;t<n;t++)e.appendChild(arguments[t]);return e}function f(e,t,n,r){var o=["opacity",t,~~(e*100),n,r].join("-"),u=.01+n/r*100,f=Math.max(1-(1-e)/t*(100-u),e),l=s.substring(0,s.indexOf("Animation")).toLowerCase(),c=l&&"-"+l+"-"||"";return i[o]||(a.insertRule("@"+c+"keyframes "+o+"{"+"0%{opacity:"+f+"}"+u+"%{opacity:"+e+"}"+(u+.01)+"%{opacity:1}"+(u+t)%100+"%{opacity:"+e+"}"+"100%{opacity:"+f+"}"+"}",a.cssRules.length),i[o]=1),o}function l(e,t){var i=e.style,s,o;if(i[t]!==n)return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(o=0;o<r.length;o++){s=r[o]+t;if(i[s]!==n)return s}}function c(e,t){for(var n in t)e.style[l(e,n)||n]=t[n];return e}function h(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)e[i]===n&&(e[i]=r[i])}return e}function p(e){var t={x:e.offsetLeft,y:e.offsetTop};while(e=e.offsetParent)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}function v(e){if(!this.spin)return new v(e);this.opts=h(e||{},v.defaults,d)}var r=["webkit","Moz","ms","O"],i={},s,a=function(){var e=o("style",{type:"text/css"});return u(t.getElementsByTagName("head")[0],e),e.sheet||e.styleSheet}(),d={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};v.defaults={},h(v.prototype,{spin:function(e){this.stop();var t=this,n=t.opts,r=t.el=c(o(0,{className:n.className}),{position:n.position,width:0,zIndex:n.zIndex}),i=n.radius+n.length+n.width,u,a;e&&(e.insertBefore(r,e.firstChild||null),a=p(e),u=p(r),c(r,{left:(n.left=="auto"?a.x-u.x+(e.offsetWidth>>1):parseInt(n.left,10)+i)+"px",top:(n.top=="auto"?a.y-u.y+(e.offsetHeight>>1):parseInt(n.top,10)+i)+"px"})),r.setAttribute("aria-role","progressbar"),t.lines(r,t.opts);if(!s){var f=0,l=n.fps,h=l/n.speed,d=(1-n.opacity)/(h*n.trail/100),v=h/n.lines;(function m(){f++;for(var e=n.lines;e;e--){var i=Math.max(1-(f+e*v)%h*d,n.opacity);t.opacity(r,n.lines-e,i,n)}t.timeout=t.el&&setTimeout(m,~~(1e3/l))})()}return t},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=n),this},lines:function(e,t){function i(e,r){return c(o(),{position:"absolute",width:t.length+t.width+"px",height:t.width+"px",background:e,boxShadow:r,transformOrigin:"left",transform:"rotate("+~~(360/t.lines*n+t.rotate)+"deg) translate("+t.radius+"px"+",0)",borderRadius:(t.corners*t.width>>1)+"px"})}var n=0,r;for(;n<t.lines;n++)r=c(o(),{position:"absolute",top:1+~(t.width/2)+"px",transform:t.hwaccel?"translate3d(0,0,0)":"",opacity:t.opacity,animation:s&&f(t.opacity,t.trail,n,t.lines)+" "+1/t.speed+"s linear infinite"}),t.shadow&&u(r,c(i("#000","0 0 4px #000"),{top:"2px"})),u(e,u(r,i(t.color,"0 0 1px rgba(0,0,0,.1)")));return e},opacity:function(e,t,n){t<e.childNodes.length&&(e.childNodes[t].style.opacity=n)}}),function(){function e(e,t){return o("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',t)}var t=c(o("group"),{behavior:"url(#default#VML)"});!l(t,"transform")&&t.adj?(a.addRule(".spin-vml","behavior:url(#default#VML)"),v.prototype.lines=function(t,n){function s(){return c(e("group",{coordsize:i+" "+i,coordorigin:-r+" "+ -r}),{width:i,height:i})}function l(t,i,o){u(a,u(c(s(),{rotation:360/n.lines*t+"deg",left:~~i}),u(c(e("roundrect",{arcsize:n.corners}),{width:r,height:n.width,left:n.radius,top:-n.width>>1,filter:o}),e("fill",{color:n.color,opacity:n.opacity}),e("stroke",{opacity:0}))))}var r=n.length+n.width,i=2*r,o=-(n.width+n.length)*2+"px",a=c(s(),{position:"absolute",top:o,left:o}),f;if(n.shadow)for(f=1;f<=n.lines;f++)l(f,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(f=1;f<=n.lines;f++)l(f);return u(t,a)},v.prototype.opacity=function(e,t,n,r){var i=e.firstChild;r=r.shadow&&r.lines||0,i&&t+r<i.childNodes.length&&(i=i.childNodes[t+r],i=i&&i.firstChild,i=i&&i.firstChild,i&&(i.opacity=n))}):s=l(t,"animation")}(),typeof define=="function"&&define.amd?define("spin",[],function(){return v}):e.Spinner=v}(window,document),define("mixins/spinner-mixin",["jquery","underscore","backbone","spin"],function(e,t,n,r){var i={showSpinner:function(){return this.$spinner.is(":visible")||this.$spinner.css({opacity:0}).show(),this.$spinner.stop().animate({opacity:1},50),this},hideSpinner:function(){var e=this;return this.$spinner.stop().fadeOut(300,function(){}),this},initLargeSpinner:function(e,n){return this.initSpinner(e,t.extend({radius:10,width:10},n))},initSpinner:function(n,i){var i=t.extend({radius:4,length:0,width:4,color:"#888",lines:7,speed:1.5},i);return this.$spinner=e((new r(i)).spin().el).hide(),e(n).append(this.$spinner),this}};return i}),define("mixins/in-place-editor-mixin",["jquery","underscore","backbone"],function(e,t,n){var r={getInPlaceTextElement:function(e){return e.attr("data-text")?e.find(e.attr("data-text")):e},toggleInPlaceEditMode:function(){this.__inPlaceEditMode?(this.__preventInPlaceEditMode=!0,this.exitInPlaceEditMode(),this.__preventInPlaceEditMode=!1):this.enterInPlaceEditMode()},enterInPlaceEditMode:function(){var n=this;this.__inPlaceEditMode=!0,this.trigger("inplace:enter"),this.editableElements=this.$(".model-editable"),this.editableElements.each(function(){var r=e(this);if(r.data("replacedWith"))return;var i=e('<input class="in-place-input" type="text" name="'+e(this).attr("data-name")+'">');i.val(n.getInPlaceTextElement(r).text()),i.width(r.outerWidth()+20).height(r.outerHeight()).css({border:"none"}).addClass("edit-in-place"),t.each(["display","font-size","font-family","font-weight","line-height","color","padding","margin","min-height","max-height"],function(e){i.css(e,r.css(e))}),i.on("change",function(e){n.inPlaceInputChanged(r,i)}),i.on("keyup",function(e){switch(e.keyCode){case 13:n.inPlaceInputChanged(r,i),e.stopPropagation();break;case 27:n.exitInPlaceEditMode(),e.stopPropagation()}}),r.replaceWith(i),r.data("replacedWith",i)}),this.editableElements.length&&e(this.editableElements[0]).data("replacedWith").focus()},inPlaceInputChanged:function(e,t){var n=t.attr("name");if(n){var r={},i=t.val();r[n]=i,this.trigger("inplace:changed",r),this.getInPlaceTextElement(e).text(i)}this.__preventInPlaceEditMode||this.exitInPlaceEditMode()},exitInPlaceEditMode:function(){this.__inPlaceEditMode=!1,this.trigger("inplace:exit"),this.editableElements.each(function(){var t=e(this);if(!t.data("replacedWith"))return;e(t.data("replacedWith")).replaceWith(this),t.data("replacedWith",null)})}};return r}),define("mixins/timeout-queue-mixin",[],function(){var e=function(e){this.time=e,this.queue=[]};return e.prototype.push=function(e,t){this.queue.push(setTimeout(e,t!=undefined?t:this.time));for(var n=this.queue.length;n>1;n--)clearTimeout(this.queue.shift())},{createTimeoutQueue:function(t,n){this.timeoutQueues||(this.timeoutQueues={}),this.timeoutQueues[t]=new e(n)},queueTimeout:function(e,t,n){this.timeoutQueues[e].push(t,n)}}}),define("views/map-layer-view",["jquery","underscore","backbone","config","utils","permissions","text!templates/map-layer.html","views/panel-view-base","views/graphs/histogram-view","views/legend-view","mixins/spinner-mixin","mixins/in-place-editor-mixin","mixins/timeout-queue-mixin","lib/color-gradient/color-gradient","moment"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v=n.View.extend({className:"map-layer",showEffect:"slideDown",hideEffect:"slideUp",events:{"click .toggle-layer":"toggleLayerClicked","click .show-layer-editor":"showLayerEditorClicked","click .show-layer-graphs":"showLayerGraphsClicked","click .show-layer-details":"showLayerDetailsClicked","click .show-layer-extents":"showLayerExtentsClicked","click .edit-collection":"editCollectionClicked","click .histogram":"histogramClicked","click .move-layer ":function(){return!1}},initialize:function(e){this.template=t.template(o),this.legendViewOptions={},this.expandContent,this.expandLayerDetails=!1,this.subViewsRendered=!1,this.createTimeoutQueue("redrawGraphs",250),this.listenTo(this.model,"change",this.modelChanged),this.listenTo(this.model,"toggle:enabled",this.updateEnabled),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model.mapFeatures,"request",this.layerFeaturesRequest),this.listenTo(this.model.mapFeatures,"error",this.layerFeaturesRequestError),this.listenTo(this.model.mapFeatures,"sync",this.layerFeaturesSynced),this.listenTo(this.model.featureCollection,"sync",function(){this.populateFromModel(!1)})},sharingToggleClicked:function(t){return this.$(".sharing-status").attr("disabled",!0),this.model.featureCollection.save({sharing:e(t.currentTarget).attr("data-value")},{patch:!0}),this.hidePopovers(),!1},hidePopovers:function(){this.superView.$el.parent().find(".sharing-status").popover("hide"),this.superView.$el.parent().find(".popover").remove()},layerFeaturesRequest:function(e,t,n){this.isLoading=!0,this.updateStatus()},layerFeaturesRequestError:function(e,t,n){this.isLoading=!1,this.updateStatus(__("failed"))},layerFeaturesSynced:function(e,t,n){this.isLoading=!1,this.updateStatus()},updateStatus:function(e){var t="",n=this.model.getFeatureCollectionAttr("progress"),r=this.model.mapFeatures;this.isLoading||this.model.getDataStatus()!=DataStatus.COMPLETE?this.showSpinner():this.hideSpinner();if(!e)switch(this.model.getDataStatus()){case DataStatus.COMPLETE:if(this.model.isEnabled()){var i=r.initiallyFetched?r.getCounts():this.model.getCounts();if(i){formatLargeNumber(i.original)!=undefined?e=__("%(number)i of %(total)i",{number:formatLargeNumber(i.original),total:formatLargeNumber(i.full)}):e=(i.full!=1?__("%(total)i %(itemTitlePlural)s"):__("%(total)i %(itemTitle)s")).format({total:formatLargeNumber(i.full),itemTitle:this.model.getDisplay("itemTitle"),itemTitlePlural:this.model.getDisplay("itemTitlePlural")});if(r.initiallyFetched){var s=r.url();e+='&nbsp;&nbsp;<a target="_blank" class="muted download-collection"" href="'+s+'"><span class="glyphicon glyphicon-download muted"></span></a>'}}else e="loading…"}else e="";break;case DataStatus.IMPORTING:case DataStatus.IMPORTING_INC:e=__(n?"importing… %(count)s":"importing…",{count:formatLargeNumber(this.model.attributes.featureCollection.progress)});break;case DataStatus.UNREDUCED:case DataStatus.UNREDUCED_INC:e=__("queued for crunching…");break;case DataStatus.REDUCING:case DataStatus.REDUCING_INC:if(this.model.attributes.featureCollection.numBusy){var o=Math.floor(n/this.model.attributes.featureCollection.numBusy*100);e=__(n?"crunching… %(percent)s%":"crunching…",{percent:o}),this.$(".progress .bar").css("width",o+"%"),this.$(".progress").show()}else e=__("crunching…",{})}var u=this.$(".status .text");u.html(e)},render:function(){var e=this;this.$el.html(this.template()),this.$el.attr("data-id",this.model.id),this.$el.attr("data-feature-collection-id",this.model.attributes.featureCollection._id),this.$(".has-tooltip").tooltip({container:"body"});var t=this.$(".state-indicator");t.length&&this.initSpinner(t),this.toggleEl=this.$(".collapse-toggle"),this.collapseEl=this.$(".collapse"),this.toggleEl.attr("href","#collapse-"+this.className+"-"+(this.model.id||this.model.attributes.featureCollection._id)),this.collapseEl.attr("id","collapse-"+this.className+"-"+(this.model.id||this.model.attributes.featureCollection._id));var n=this.model.isEnabled();return this.expandContent==undefined&&(this.expandContent=n),this.collapseEl.on("hide.bs.collapse",function(){e.trigger("collapse")}),this.collapseEl.on("show.bs.collapse",function(){e.trigger("expand"),e.model.isEnabled()||e.model.toggleEnabled(!0)}),this.model.parentMap?(this.$(".layer-tools .library-tool").remove(),this.$(".status").toggle(n)):(this.$(".layer-tools .map-tool").remove(),this.$(".collapse-content").prepend(this.$(".status").remove()),(!app||!app.mapView)&&this.$(".layer-tools .library-map-tool").remove()),this.$layerTools=this.$(".layer-tools").clone(),this.populateFromModel(this.expandContent),this.$(".details").toggle(this.expandLayerDetails),this.$(".has-tooltip").tooltip({delay:200,container:"body"}),this.initInPlaceEditing(),this},initInPlaceEditing:function(){var e=this;this.on("inplace:enter",function(){e.$(".edit-collection").tooltip("hide"),e.$(".edit-collection").attr("disabled",!0)}),this.on("inplace:changed",function(t){e.model.featureCollection.save(t,{patch:!0})}),this.on("inplace:exit",function(){e.$(".edit-collection").attr("disabled",!1)})},isExpanded:function(){return this.collapseEl.is(".in")},expand:function(e){return e||e==undefined?this.isExpanded()||this.collapseEl.collapse("show"):this.collapseEl.addClass("in"),this.toggleEl.removeClass("collapsed"),this},collapse:function(e){return e||e==undefined?this.isExpanded()&&this.collapseEl.collapse("hide"):this.collapseEl.addClass("collapse"),this.toggleEl.addClass("collapsed"),this},hide:function(e){return e?(this.$el[this.hideEffect](e),this):(this.$el.hide(),this)},show:function(e){return e?(this.$el[this.showEffect](e),this):(this.$el.show(),this)},renderHistogram:function(){if(!this.model.histogram)return;var e=this;this.histogramView||(this.$(".graphs").hide(),this.listenToOnce(this.model.histogram,"sync",function(){this.isExpanded()?this.$(".graphs").slideDown("fast"):this.$(".graphs").show(),this.histogramView.renderGraph()}),this.histogramView=new a({model:this.model,collection:this.model.histogram,renderAxes:!1}),this.$(".graphs").append(e.histogramView.el))},renderLegend:function(){this.legendView?this.legendView.$el.remove():this.legendView=new f(t.extend({},this.legendViewOptions,{model:this.model}));if(!this.model.canDisplayValues())return;this.$(".legend").append(this.legendView.el),this.legendView.render().delegateEvents()},setSuperView:function(e){this.superView=e,this.listenTo(e,"panel:resize",this.panelViewResized)},panelViewResized:function(e){var t=this;this.histogramView&&this.queueTimeout("redrawGraphs",function(){t.histogramView.fillExtents().redrawGraphIfVisible()}),this.legendView&&this.legendView.removePopover()},updateEnabled:function(e){var t=this.model.isEnabled(),n=e||e==undefined?"fast":0;t&&!self.subViewsRendered&&this.renderSubViews(),this.legendView&&this.legendView.removePopover(),this.$el.toggleClass("enabled",t),this.$el.toggleClass("disabled",!t),this.model.parentMap&&this.$(".toggle-layer").toggleClass("active",t),t?this.$(".status").slideDown(n):this.$(".status").slideUp(n),!t||!this.expandContent?this.collapse(e):this.expand(e),this.$(".layer-tools .show-layer-graphs").attr("disabled",!t),this.$(".layer-tools .show-layer-extents").attr("disabled",!t)},modelChanged:function(e,t){if(t.patch||t.poll){this.updateStatus();return}this.legendView&&this.legendView.removePopover(),this.populateFromModel(this.model.hasChangedColors()||this.model.hasChanged("featureCollection.status")||this.model.hasChanged("layerOptions.unit")||this.model.hasChanged("layerOptions.histogram"))},renderSubViews:function(){this.renderHistogram(),this.renderLegend(),this.subViewsRendered=!0},remove:function(){this.histogramView&&this.histogramView.remove(),this.legendView&&this.legendView.remove(),v.__super__.remove.apply(this,arguments)},populateFromModel:function(t){var n=this;this.$(".model-title").text(this.model.getDisplay("title")),this.$(".layer-tools").replaceWith(this.$layerTools.clone()),this.updateEnabled(!1),t&&this.renderSubViews(),this.updateStatus();var r=this.model.attributes.featureCollection,i=this.model.getDisplay("description"),o=this.model.getDisplay("source"),u=this.model.getDisplay("sourceUrl");this.$(".description").html(i),i?this.$(".description").show():(this.$(".description").hide(),this.$(".layer-tools .show-layer-details").remove());if(o||r&&r.sync){this.$(".source").show();var a=u&&u.length?'<a href="%(sourceUrl)s">%(source)s</a>'.format({sourceUrl:u,source:o}):o;o&&(o=__("Source: %(source)s",{source:a})),r.sync&&(o+=' <span class="updated micro">('+__("updated %(date)s",{date:d(r.reduce?r.updatedAt<r.lastReducedAt||!r.lastReducedAt?r.updatedAt:r.lastReducedAt:r.updatedAt).format(locale.formats.DATE_SHORT)})+")</span>"),this.$(".source").html(o)}else this.$(".source").hide();if(this.model.parentMap)app.isMapAdmin()?!this.model.getDataStatus()==DataStatus.COMPLETE&&this.$(".layer-tools .admin-control.layer-editor").remove():this.$(".layer-tools .admin-control").remove(),this.model.hasGraphs()||this.$(".layer-tools .show-layer-graphs").remove(),this.model.getBbox().length||this.$(".layer-tools .show-layer-extents").remove();else if(!s.canAdminModel(this.model.featureCollection))this.$(".layer-tools .admin-control").remove();else{var f,l;switch(this.model.attributes.featureCollection.sharing){case SharingType.PRIVATE:this.$(".is-public").hide(),this.$(".is-private").show(),f=__("This collection is private."),l='<p class="micro">'+__("Only you can use this data on your maps.")+"</p>"+__('<a href="#" class="btn btn-warning btn-sm sharing-toggle" data-value="'+SharingType.WORLD+'"><span class="glyphicon glyphicon-globe"></span> Allow everybody to use collection</a>');break;case SharingType.WORLD:this.$(".is-private").hide(),this.$(".is-public").show(),f=__("This collection is public."),l='<p class="micro">'+__("Everybody can currently add this data to their own maps.")+"</p>"+__('<a href="#" class="btn btn-danger btn-sm sharing-toggle make-private" data-value="'+SharingType.PRIVATE+'""><span class="glyphicon glyphicon-lock"></span> Make this collection private</a>')}this.$(".sharing-status").popover("destroy"),this.$(".sharing-status").attr("disabled",!1),this.$(".sharing-status").popover({animation:!1,content:l,html:l,title:f,container:n.superView.$el,placement:"bottom"}).on("show.bs.popover",function(e){n.hidePopovers()}).on("shown.bs.popover",function(t){e(".sharing-toggle").click(function(e){return n.sharingToggleClicked(e)}),t.stopPropagation()})}},toggleLayerClicked:function(e){return this.model.parentMap?(this.model.toggleEnabled(!this.model.isEnabled()),!1):(this.isExpanded()?this.collapse():this.expand(),!1)},showLayerEditorClicked:function(e){return this.model.trigger("show:editor"),!1},showLayerGraphsClicked:function(e){return this.model.trigger("show:graphs"),!1},showLayerExtentsClicked:function(e){return app.mapView.zoomToExtent(this.model.attributes.featureCollection.bbox),!1},showLayerDetailsClicked:function(e){var t=this;return this.$(".details").uiToggle({activate:this.$(".show-layer-details"),show:function(){t.expand()}}),!1},editCollectionClicked:function(e){this.toggleInPlaceEditMode()},histogramClicked:function(e){this.model.parentMap&&app.showMapLayerGraphs(this.model).toggleGraphView("histogram")}});return t.extend(v.prototype,l),t.extend(v.prototype,c),t.extend(v.prototype,h),v}),define("text!templates/data-library-panel.html",[],function(){return'<div class="panel-heading" style="position: relative;">\n	Data Library\n    <div class="btn-toolbar">\n	    <div class="btn-group btn-group-xs">\n			<button type="button" class="btn btn-default panel-extend"><span class="glyphicon glyphicon-plus-sign"></span></button>\n	        <button type="button" class="btn btn-default panel-close"><span class="glyphicon glyphicon-remove-sign"></span></button>\n		</div>\n	</div>\n</div>\n<div class="panel-body">\n	<form class="search">\n		<div class="input-group">\n	  		<input type="text" class="form-control search-query" placeholder="Search data library">\n	  		<span class="input-group-btn">\n	    		<button class="btn btn-default" type="submit"><span class="glyphicon glyphicon-search"></span></button>\n	    		<button class="btn btn-default remove-query" type="submit"><span class="glyphicon glyphicon-remove"></span></button>\n	  		</span>\n		</div>\n		<div class="status">\n	      <p class="help-block muted"><span class="status-message"></span>&nbsp;</p>\n	      <div class="state-indicator"></div>\n	    </div>\n	</form>\n\n	<ul class="type-toggles nav nav-pills nav-pills-muted nav-justified">\n	  <li class="active" data-type="public"><a class="btn-sm" href="#public-collections" data-toggle="pill">Public collections</a></li>\n	  <li data-type="user"><a class="btn-sm" href="#user-collections" data-toggle="pill">My collections</a></li>\n	</ul>\n\n	<div class="active" id="public-collections">\n	  <div class="hidden alert alert-info no-objects public">  \n	    No matching data collections found.\n	  </div>\n	</div>\n	<div id="user-collections">\n	  <div class="hidden alert alert-info no-objects user">  \n	    You don\'t have any matching data collections.\n	  </div>\n	</div>\n\n	<div class="panel-scrollable-container">\n		<div class="panel-scrollable-content collections-list">\n		</div>\n	</div>\n</div>\n\n<div class="drop-zone" id="dropZone">\n	<div class="instruction-wrapper">\n		<h3 class="instruction">drop here</h3>\n	</div>\n</div>\n'}),define("models/geo-feature-collection",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({idAttribute:"_id",urlRoot:BASE_URL+"api/featurecollection"});return r}),function(){var e,t,n,r,i,s,o=[].slice;n=function(e){var t,r;return!_.isObject(e)||_.isFunction(e)?e:_.isDate(e)?new Date(e.getTime()):_.isRegExp(e)?new RegExp(e.source,e.toString().replace(/.*\//,"")):(r=_.isArray(e||_.isArguments(e)),t=function(e,t,i){return r?e.push(n(t)):e[i]=n(t),e},_.reduce(e,t,r?[]:{}))},s=function(e){return e==null?!1:(e.prototype==={}.prototype||e.prototype===Object.prototype)&&_.isObject(e)&&!_.isArray(e)&&!_.isFunction(e)&&!_.isDate(e)&&!_.isRegExp(e)&&!_.isArguments(e)},t=function(e){return _.filter(_.keys(e),function(t){return s(e[t])})},e=function(e){return _.filter(_.keys(e),function(t){return _.isArray(e[t])})},i=function(n,r,s){var o,u,a,f,l,c,h,p,d,v;s==null&&(s=20);if(s<=0)return console.warn("_.deepExtend(): Maximum depth of recursion hit."),_.extend(n,r);c=_.intersection(t(n),t(r)),u=function(e){return r[e]=i(n[e],r[e],s-1)};for(h=0,d=c.length;h<d;h++)l=c[h],u(l);f=_.intersection(e(n),e(r)),o=function(e){return r[e]=_.union(n[e],r[e])};for(p=0,v=f.length;p<v;p++)a=f[p],o(a);return _.extend(n,r)},r=function(){var e,t,r,s;r=2<=arguments.length?o.call(arguments,0,s=arguments.length-1):(s=0,[]),t=arguments[s++],_.isNumber(t)||(r.push(t),t=20);if(r.length<=1)return r[0];if(t<=0)return _.extend.apply(this,r);e=r.shift();while(r.length>0)e=i(e,n(r.shift()),t);return e},_.mixin({deepClone:n,isBasicObject:s,basicObjects:t,arrays:e,deepExtend:r})}.call(this),define("deepextend",["underscore"],function(){}),function(e){typeof define=="function"&&define.amd?define("deepmodel",["underscore","backbone"],e):e(_,Backbone)}(function(e,t){function n(t){var r={},i=o.keyPathSeparator;for(var s in t){var u=t[s];if(u&&u.constructor===Object&&!e.isEmpty(u)){var a=n(u);for(var f in a){var l=a[f];r[s+i+f]=l}}else r[s]=u}return r}function r(t,n,r){var i=o.keyPathSeparator,s=n.split(i),u=t;r||r===!1;for(var a=0,f=s.length;a<f;a++){if(r&&!e.has(u,s[a]))return!1;u=u[s[a]],u==null&&a<f-1&&(u={});if(typeof u=="undefined")return r?!0:u}return r?!0:u}function i(t,n,r,i){i=i||{};var s=o.keyPathSeparator,u=n.split(s),a=t;for(var f=0,l=u.length;f<l&&a!==undefined;f++){var c=u[f];if(f===l-1)i.unset?delete a[c]:a[c]=r;else{if(typeof a[c]=="undefined"||!e.isObject(a[c]))a[c]={};a=a[c]}}}function s(e,t){i(e,t,null,{unset:!0})}var o=t.Model.extend({constructor:function(t,n){var r,i=t||{};this.cid=e.uniqueId("c"),this.attributes={},n&&n.collection&&(this.collection=n.collection),n&&n.parse&&(i=this.parse(i,n)||{});if(r=e.result(this,"defaults"))i=e.deepExtend({},r,i);this.set(i,n),this.changed={},this.initialize.apply(this,arguments)},toJSON:function(t){return e.deepClone(this.attributes)},get:function(e){return r(this.attributes,e)},set:function(t,u,a){var f,l,c,h,p,d,v,m;if(t==null)return this;typeof t=="object"?(l=t,a=u||{}):(l={})[t]=u,a||(a={});if(!this._validate(l,a))return!1;c=a.unset,p=a.silent,h=[],d=this._changing,this._changing=!0,d||(this._previousAttributes=e.deepClone(this.attributes),this.changed={}),m=this.attributes,v=this._previousAttributes,this.idAttribute in l&&(this.id=l[this.idAttribute]),l=n(l);for(f in l)u=l[f],e.isEqual(r(m,f),u)||h.push(f),e.isEqual(r(v,f),u)?s(this.changed,f):i(this.changed,f,e.deepClone(u)),c?s(m,f):i(m,f,u);if(!p){h.length&&(this._pending=!0);var g=o.keyPathSeparator;for(var y=0,b=h.length;y<b;y++){var t=h[y];this.trigger("change:"+t,this,r(m,t),a);var w=t.split(g);for(var E=w.length-1;E>0;E--){var S=e.first(w,E).join(g),x=S+g+"*";this.trigger("change:"+x,this,r(m,S),a)}}}if(d)return this;if(!p)while(this._pending)this._pending=!1,this.trigger("change",this,a);return this._pending=!1,this._changing=!1,this},clear:function(t){var r={},i=n(this.attributes);for(var s in i)r[s]=void 0;return this.set(r,e.extend({},t,{unset:!0}))},hasChanged:function(t){if(t==null)return!e.isEmpty(this.changed);var n=r(this.changed,t)!==undefined;return n},changedAttributes:function(t){if(!t)return this.hasChanged()?n(this.changed):!1;var r=this._changing?this._previousAttributes:this.attributes;t=n(t),r=n(r);var i,s=!1;for(var o in t){if(e.isEqual(r[o],i=t[o]))continue;(s||(s={}))[o]=i}return s},previous:function(e){return e==null||!this._previousAttributes?null:r(this._previousAttributes,e)},previousAttributes:function(){return e.deepClone(this._previousAttributes)}});return o.keyPathSeparator=".",t.DeepModel=o,typeof module!="undefined"&&(module.exports=o),t}),define("models/geo-feature",["jquery","underscore","backbone","deepextend","deepmodel"],function(e,t,n){var r=n.DeepModel.extend({idAttribute:"_id",initialize:function(){var e=this;this.on("change",function(){delete e._renderAttrs})},getNumericVal:function(){var e=this.collection.mapLayer.getNumericField();return e?this.get(e):undefined},getDatetimeVal:function(){var e=this.collection.mapLayer.getOption("attrMap",{});return e.datetime?this.get(e.datetime):undefined},getCenter:function(){if(!this.attributes.bbox||!this.attributes.bbox.length)return this.attributes.geometry.coordinates;var e=this.getSize();return[this.attributes.bbox[0]+e[0]/2,this.attributes.bbox[1]+e[1]/2]},getSize:function(){return!this.attributes.bbox||!this.attributes.bbox.length?[0,0]:[this.attributes.bbox[2]-this.attributes.bbox[0],this.attributes.bbox[3]-this.attributes.bbox[1]]},getBox:function(){var e,t=this.collection.mapLayer.mapFeatures.gridSize();this.attributes.geometry.type=="Point"&&t?e=t:e=this.getSize();var n=e[0]/2,r=e[1]/2,i=this.getCenter(),s=i[0]-n,o=i[1]-r,u=i[0]+n,a=i[1]+r;return[[s,o],[u,o],[u,a],[s,a]]},getRenderAttr:function(e,t){if(!this._renderAttrs){var n=this.collection.mapLayer,r=n.getLayerOptions(),i=this.collection.mapLayer.getOption("attrMap",{}),s=n.getMappedExtremes(),o=n.mapFeatures.getCounts(),u=this.getNumericVal(),a=s.numeric?s.numeric.max:NaN,f=s.numeric?s.numeric.min:NaN;u&&u.avg!=null&&(u=u.avg);var l=this.attributes.properties?this.attributes.properties.count||1:1,c=(u-f)/(a-f),h=l/(o?o.max:1),p,d;switch(r.colorType){default:switch(i.featureColor){case"count":p=n.colorAt(h);break;default:case"$numeric.avg":p=n.colorAt(isNaN(c)?0:c)}}switch(i.featureSize){default:case"count":d=h;break;case"$numeric.avg":d=c}this._renderAttrs={size:d,color:p,model:this,data:{val:u,normVal:c,count:l}}}return e?(this._renderAttrs[e]==undefined&&t!=undefined&&(this._renderAttrs[e]=typeof t=="function"?t():t),this._renderAttrs[e]):this._renderAttrs}});return r}),define("parsers/geojson",["jquery","underscore","backbone"],function(e,t,n){var r=function(e){this.collection=e};return r.prototype.parse=function(e,t){return{features:this.collection._super("parse",[e.features,t]),properties:e.properties}},r}),define("parsers/twitter",["jquery","underscore","backbone"],function(e,t,n){var r=function(e){this.collection=e};return r.prototype.parse=function(e,n){var r=[];return t.each(e.results,function(e){if(e.geo){var t=[e.geo.coordinates[1],e.geo.coordinates[0]];r.push({type:"Feature",geometry:{type:"Point",coordinates:t},bbox:[t[0],t[1],t[0],t[1]],properties:{description:e.text,created_at:new Date(e.created_at),label:e.from_user_name}})}}),{features:r,counts:{result:r.length,original:r.length,max:r.length,full:e.results.length}}},r}),define("parsers/index",["jquery","underscore","backbone","parsers/geojson","parsers/twitter"],function(e,t,n,r,i){return{GeoJSON:r,Twitter:i}}),define("collections/map-features",["jquery","underscore","backbone","models/geo-feature","parsers/index","moment"],function(e,t,n,r,i,s){var o=n.Collection.extend({model:r,initialize:function(t,n){this.mapLayer=n.mapLayer,this.queryParams=n.queryParams?e.extend({},n.queryParams):{},this.urlParams=n.urlParams?e.extend({},n.urlParams):{},this.urlFormat=n.urlFormat,this.properties={},n.parser?this.parser=new i[n.parser](this):this.parser=new i.GeoJSON(this),this.initiallyFetched=this.visibleMapAreaFetched=!1,this.on("error",function(){this.initiallyFetched=!1})},canFetch:function(){return this.mapLayer.attributes.featureCollection||this.urlFormat!=undefined&&this.urlFormat!=""},fetch:function(e){var e=e||{};return this.urlFormat!=undefined&&(e=t.extend(e,{dataType:"jsonp"})),this.initiallyFetched=this.visibleMapAreaFetched=!0,o.__super__.fetch.call(this,e)},url:function(e){if(this.urlFormat!=undefined){var n=this.urlFormat.format(this.urlParams);return n}if(!e){var e={},r=this.urlParams.bounds;r&&(e.b=[r[0][0],r[0][1],r[1][0],r[1][1]]),this.urlParams.zoom!=undefined&&(e.z=this.urlParams.zoom),this.urlParams.original&&(e.o=this.urlParams.original=1)}return this.mapLayer.url()+"/features"+"?"+genQueryString(t.extend(this.queryParams,e))},resetFrom:function(e){this.reset(e.models),this.visibleMapAreaFetched=e.visibleMapAreaFetched,this.urlParams=t.clone(e.urlParams)},setVisibleMapArea:function(e){var n=t.clone(this.urlParams);this.urlParams.bounds=e.bounds,this.urlParams.zoom=e.zoom,this.visibleMapAreaFetched=t.isEqual(n,this.urlParams)},isCurrent:function(){return this.initiallyFetched&&this.visibleMapAreaFetched},parse:function(e,t){var n=this.parser.parse(e,t);return this.properties=n.properties,n.features},getCounts:function(){return this.properties.counts},gridSize:function(){return this.properties.gridSize}});return o}),define("collections/histogram",["jquery","underscore","backbone","models/geo-feature"],function(e,t,n,r){var i=n.Collection.extend({model:r,initialize:function(e,t){this.mapLayer=t.mapLayer},url:function(){return BASE_URL+"api/featurecollection/"+this.mapLayer.attributes.featureCollection._id+"/histogram"},parse:function(e,t){return this.properties=e.properties,e.items}});return i}),define("models/map-layer",["jquery","underscore","backbone","models/geo-feature-collection","collections/map-features","collections/histogram","lib/color-gradient/color-gradient","deepextend","deepmodel"],function(e,t,n,r,i,s,o){var u=n.DeepModel.extend({idAttribute:"_id",urlRoot:function(){return this.parentMap.url()+"/layer"},getLayerOptions:function(){return this.attributes.layerOptions?this.attributes.layerOptions:{}},setLayerOptions:function(e){for(var t in e)this.set("layerOptions."+t,e[t])},getFeatureCollectionAttr:function(e,t){return this.attributes.featureCollection&&this.attributes.featureCollection[e]!=undefined?this.attributes.featureCollection[e]:t!=undefined?t:null},getOption:function(e,t){var n=this.attributes.layerOptions;return!n||n[e]==undefined?t:n[e]},getNumericField:function(){var e=this.getOption("attrMap",{});return e.numeric},limitFeatures:function(){return this.getFeatureCollectionAttr("limitFeatures",!0)},getDataStatus:function(){return this.getFeatureCollectionAttr("status",DataStatus.COMPLETE)},getBbox:function(){return this.getFeatureCollectionAttr("bbox",[])},getDisplay:function(e){var t=this.attributes.layerOptions,n=this.attributes.featureCollection,r=n?n.defaults:{},i=t&&t[e]&&(typeof t[e]!="string"||t[e].length)?t[e]:n?n[e]:r?r[e]:null;return!i&&e=="itemTitle"?i=__("feature"):!i&&e=="itemTitlePlural"&&(i=__("features")),i},getCounts:function(){return this.attributes.featureCollection.counts},fetchGraphs:function(){this.histogram&&this.histogram.fetch()},createCollection:function(e){return new e([],{mapLayer:this})},initCollections:function(){var e=this;if(this.attributes.featureCollection)this.mapFeatures=this.createCollection(i),this.getOption("histogram")&&this.isNumeric()&&(this.histogram=this.createCollection(s)),this.isTimeBased()&&(this.timeline=this.createCollection(i),this.listenTo(this.mapFeatures,"reset add remove",function(){e.timeline.resetFrom(e.mapFeatures)})),this.featureCollection=new r(this.attributes.featureCollection),this.on("sync",function(){e.featureCollection.set(e.attributes.featureCollection)}),this.listenTo(this.featureCollection,"sync change",function(n,r){e.set({featureCollection:t.clone(this.featureCollection.attributes)},r)});else{var n=this.getLayerOptions().feed;this.mapFeatures=new i([],{mapLayer:this,urlFormat:n?n.url:"",parser:n?n.parser:""})}return this},initialize:function(e,n){var r=this,n=n||{};this.parentMap=n.parentMap,this.valFormatters=[],this.sessionOptions=t.extend(n.sessionOptions||{},{enabled:this.attributes.layerOptions?this.attributes.layerOptions.enabled:!0,valFormatterIndex:0,colorSchemeIndex:e&&e.layerOptions?e.layerOptions.colorSchemeIndex:0}),this.on("change",this.onChange,this),this.initValFormatters()},onChange:function(){delete this._normalizedColors,delete this._colorGradient,this.initValFormatters()},initValFormatters:function(){var e=this;this.valFormatters=[],this.attributes.layerOptions&&!this.attributes.layerOptions.unit&&(!this.attributes.layerOptions.unit+"").length&&this.attributes.layerOptions.valFormat&&this.attributes.layerOptions.valFormat.length?t.each(this.attributes.layerOptions.valFormat,function(t){e.valFormatters.push(new ValFormatter(t))}):this.valFormatters.push(new ValFormatter({unit:this.getDisplay("unit")})),this.setValFormatter(Math.min(this.valFormatters.length-1,this.sessionOptions.valFormatterIndex))},getValFormatter:function(){return this.valFormatters[this.sessionOptions.valFormatterIndex]},getValFormatters:function(){return this.valFormatters},setValFormatter:function(e){this.sessionOptions.valFormatterIndex=e,this.trigger("toggle:valFormatter",this)},setColorScheme:function(e){delete this._normalizedColors,delete this._colorGradient,this.sessionOptions.colorSchemeIndex=e,this.trigger("toggle:colorScheme",this)},isNumeric:function(){var e=this.getFeatureCollectionAttr("extremes",{}),t=this.getOption("attrMap",{}),n=t.numeric;return n!=undefined&&getAttr(e,n)!=undefined},isTimeBased:function(){var e=this.getFeatureCollectionAttr("extremes",{}),t=this.getOption("attrMap",{}),n=t.datetime;return n!=undefined&&getAttr(e,n)!=undefined},hasGraphs:function(){return this.isTimeBased()||this.histogram!=undefined},getMappedExtremes:function(){var e=this.getFeatureCollectionAttr("extremes",{}),t=this.getOption("attrMap",{}),n={};for(var r in t)n[r]=getAttr(e,t[r]);return n},colorAt:function(e){return this._colorGradient||(this._colorGradient=new o(this.getNormalizedColors())),this._colorGradient.colorAt(e,COLOR_GRADIENT_STEP)},getColorScheme:function(e){var e=e!=undefined?e:this.sessionOptions.colorSchemeIndex,t=this.getLayerOptions().colorSchemes;return t?e?t[e]:t[0]:{colors:[]}},getNormalizedColors:function(e){var n=this,e=e||this.getColorScheme().colors,r=this.getMappedExtremes();return this._normalizedColors||(this._normalizedColors=e.map(function(e){var n=parseFloat(e.position),n=isNaN(n)?1:n,i=(e.position||"")+"";return t.extend({},e,{position:i[i.length-1]=="%"?n/100:r.numeric?(n-r.numeric.min)/(r.numeric.max-r.numeric.min):0})})),this._normalizedColors},toggleEnabled:function(e){this.sessionOptions.enabled!=e&&(this.sessionOptions.enabled=e,this.trigger("toggle:enabled",this))},isEnabled:function(){return this.sessionOptions.enabled},canDisplayValues:function(){var e=this.getDataStatus();return e==DataStatus.COMPLETE||e==DataStatus.UNREDUCED_INC||e==DataStatus.REDUCING||e==DataStatus.REDUCING_INC||e==DataStatus.IMPORTING_INC},hasChangedColors:function(){var e=this.previousAttributes();if(!e.layerOptions)return!0;var n=e.layerOptions.colorSchemes,r=this.attributes.layerOptions.colorSchemes;return this.hasChanged("layerOptions.colorLabelColor")||n&&r&&!t.isEqual(n,r)}});return u}),define("mixins/scroll-paginator-mixin",["jquery","underscore","backbone"],function(e,t,n){var r={initScrollable:function(n,r,i,s){var o=this;this.lastPage=!0,this.searchParams={p:0},this.resultHeight=i||50,this.$scrollable=t.isString(n)?this.$(n):e(n),this.$scrollContent=t.isString(r)?this.$(r):e(r),this.$scrollable.on("scroll resize",function(t){clearTimeout(e.data(this,"scrollTimer")),e.data(this,"scrollTimer",setTimeout(function(){o.updateAfterScrolled(t)},250))})},scrollableHeight:function(){var e=this.$scrollable.height();return this.$scrollable.offset()||(e-=this.$scrollContent.offset().top),e},detectPageLimit:function(){return Math.max(1,Math.ceil(this.scrollableHeight()/this.resultHeight/10))*10},resetPageParams:function(){return this.isLastPage=!1,this.searchParams.p=0,this.searchParams.l=this.detectPageLimit(),this},updateAfterScrolled:function(e){var t=this.$scrollable.scrollTop()+this.scrollableHeight()-this.$scrollContent.height();if(t>-50){if(!this.loadNextPage){console.error("View needs to implement loadNextPage()");return}this.loadNextPage()}}};return r}),define("collections/geo-feature-collections",["jquery","underscore","backbone","models/map-layer"],function(e,t,n,r){var i=n.Collection.extend({url:function(){return BASE_URL+"api/featurecollections"+(this.fetchType?"/"+this.fetchType:"")},forType:function(e){return this.fetchType=e,this}});return i}),define("views/data-library-view",["jquery","underscore","backbone","config","utils","permissions","models/map-layer","views/panel-view-base","views/map-layer-view","mixins/scroll-paginator-mixin","mixins/spinner-mixin","collections/geo-feature-collections"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=u.extend({draggable:!1,events:{"submit form.search, keypress form.search .search-query":"searchLibrary","click button.remove-query":"removeQueryClicked"},subViewContainer:".collections-list",scrollableContainer:".panel-scrollable-container",prevQuery:"",dataCollectionsFetched:!1,initialize:function(e){var t=this;h.__super__.initialize.apply(this,arguments),this.collection=new c,this.listenTo(app,"user:login",function(e){t.render(),t.searchLibrary()})},loadNextPage:function(e){if(this.isLoading||this.isLastPage)return;var t=this;this.searchParams.p++,this.fetchResults(this.searchParams,function(e,n,r){t.updateFeatureCollectionList(!1)})},render:function(){var t=this;return h.__super__.render.call(this),this.$("form.search .search-query").on("click",function(){e(this).select()}),this.$("form.search .search-query").keyup(function(){}),this.initScrollable(this.scrollableContainer,this.$(this.subViewContainer),30),this.initSpinner(this.$(".state-indicator")),this.$removeQueryParent=this.$("button.remove-query").parent(),this.$removeQueryButton=this.$("button.remove-query").remove(),s.currentUser()||(this.$('.type-toggles li[data-type="user"]').removeClass("active").remove(),this.$('.type-toggles li[data-type="public"]').addClass("active")),this.$(".type-toggles > li > a").on("shown.bs.tab",function(e){t.searchLibrary()}),this.$(".no-objects").addClass("hidden"),this},searchLibrary:function(e){var t=this.$(".search-query").val();return this.resetPageParams(),this.searchParams.q=t,self.$(".no-objects").addClass("hidden"),t!=""?this.$removeQueryParent.append(this.$removeQueryButton):this.$removeQueryButton.remove(),this.fetchResults(this.searchParams),self.$(".search-query").focus(),!1},removeQueryClicked:function(e){this.$(".search-query").val("")},removeSubViews:function(e){h.__super__.removeSubViews.apply(this,arguments),this.$(".status-message").text(e)},updateFeatureCollectionList:function(e){var t=this,n=this.collection;e&&this.removeSubViews(),n.each(function(e,n){var r=(new o({featureCollection:e.attributes,layerOptions:e.attributes.defaults})).initCollections(),i=new a({model:r});r.isEnabled=function(){return!0},i.expandContent=!1,i.expandLayerDetails=!0,i.legendViewOptions.autoHide=!1,i.once("expand",function(){setTimeout(function(){r.fetchGraphs()},500)}),t.appendSubView(i).render(),t.mapLayerViewPostRender(i),i.$el.hide().slideDown("fast")});var r=this.numResults();this.isLastPage||(r+="+"),this.$(".status-message").text(r==1?__("%(num)s collection found",{num:r}):__("%(num)s collections found",{num:r}))},mapLayerViewPostRender:function(e){},numResults:function(){return this.$(this.subViewContainer).children().length},fetchResults:function(e,t,n){var r=this;return r.isLoading=!0,r.showSpinner(),this.dataCollectionsFetched=!0,e.t=this.$(".type-toggles .active").attr("data-type"),this.collection.fetch({data:e,success:function(n,i,s){r.isLoading=!1,r.hideSpinner(),n.length||r.$(".no-objects."+e.t).removeClass("hidden").hide().fadeIn("fast");if(!n.length||n.length<r.searchParams.l)r.isLastPage=!0;t?t(n,i,s):r.updateFeatureCollectionList(!0)},error:function(e,t,i){console.error("failed to fetch collections"),r.isLoading=!1,r.hideSpinner(),n&&n(e,t,i)}}),this}});return t.extend(h.prototype,f),t.extend(h.prototype,l),h}),define("views/data-library-panel-view",["jquery","underscore","backbone","config","utils","text!templates/data-library-panel.html","views/data-library-view"],function(e,t,n,r,i,s,o){var u=o.extend({className:"panel panel-default panel-anchor-left panel-scrollable layers-panel data-library",draggable:!1,events:{"submit form.search, keypress form.search .search-query":"searchLibrary","click button.remove-query":"removeQueryClicked","click button.add-layer":"addLayerButtonClicked"},initialize:function(e){u.__super__.initialize.apply(this,arguments),this.template=t.template(s),this.listenTo(app,"featureCollection:added",this.refresh)},refresh:function(){if(!this.searchParams.q||this.searchParams.q=="")this.resetPageParams(),this.fetchResults(this.searchParams)},render:function(){var t=this;return u.__super__.render.call(this),this.on("panel:show",function(){if(!t.searchParams.q||t.searchParams.q=="")t.removeSubViews(""),t.$(".no-objects").addClass("hidden")}),this.on("panel:shown",function(){setTimeout(function(){t.refresh()},250),t.$(".search-query").focus()}),e(window).on("resize",function(){if(t.isLoading)return;var e=t.detectPageLimit();!t.isLastPage&&t.numResults()<e&&(t.searchParams.l=e,t.fetchResults(t.searchParams))}),this.$dropZone=t.$(".drop-zone").remove(),this},dataDrop:function(e,t){var n=t.draggable.attr("data-feature-collection-id");app.saveNewMapLayer(n)},addLayerButtonClicked:function(t){var n=e(t.currentTarget).closest(".map-layer").attr("data-feature-collection-id");return app.saveNewMapLayer(n),!1},mapLayerViewPostRender:function(t){var n=this;t.$el.draggable({revert:"invalid",start:function(t,r){n.$dropZone.css({left:n.$el.outerWidth()+"px"}).droppable({accept:".map-layer",hoverClass:"hover",drop:n.dataDrop}),e("#main-viewport").append(n.$dropZone),n.$dropZone.addClass("visible"),r.helper.css("width",e(this).outerWidth()+"px"),r.helper.addClass("drag-helper")},helper:"clone",appendTo:n.$el,stop:function(e,t){n.$dropZone.removeClass("visible").remove()}})}});return u}),define("text!templates/data-import.html",[],function(){return'<div class="modal-dialog">\n    <div class="modal-content">\n        <div class="modal-header">\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n            <h4 class="modal-title">Data Import</h4>\n        </div>\n        <div class="modal-body">\n\n			<form class="step source well">\n			    <fieldset>\n			        <p class="help-block">\n			        	Please enter the URL and type of the dataset you would like to import.\n			        </p>\n			        <div class="form-group">\n				        <label>Source URL</label>\n			    	    <input name="url" class="form-control text input-lg" placeholder="http://" value="" />\n			    	</div>\n\n					<div class="btn-group btn-group-justified select-filetype" data-toggle="buttons-radio">\n						<a href="#" class="btn btn-default filetype csv" data-value="csv"><i class="icon icon-filetype csv"><span>CSV</span></i></a>\n						<a href="#" class="btn btn-default filetype geojson json" data-value="geojson"><i class="icon icon-filetype geojson"><span>GeoJSON</span></i></a>\n						<a href="#" class="btn btn-default filetype kml" data-value="kml"><i class="icon icon-filetype kml"><span>KML</span></i></a>\n						<a href="#" class="btn btn-default filetype rss" data-value="rss"><i class="icon icon-filetype rss"><span>RSS</span></i></a>\n						<a href="#" class="btn btn-default filetype asc ascii" data-value="esri.grid.ascii"><i class="icon icon-filetype esri-grid"><span>ESRI grid</span></i></a>\n					</div>\n\n      				<div class="form-group">\n						<button class="source-start btn btn-primary source-submit">Import <i class="glyphicon glyphicon-arrow-right half-opacity"></i></button>\n					</div>\n\n			    </fieldset>\n			</form>\n\n			<!-- Review data -->\n			<form class="step transform">\n\n				<div class="source">\n					<h4>Source Data</h4>\n					<div class="table-container">\n						<table class="from-data table table-striped">\n							<thead>\n						    	<tr>\n						    		<th class="element-template">\n\n						    			<span class="well clearfix">\n								    		<span class="from-field label" data-from="">\n								    			<a href="" class="remove"><span class="glyphicon glyphicon-remove-sign"></span></a>\n								    			<span class="field-name"></span> \n								    		</span>\n								    	</span>\n\n								    </th>\n						    	</tr>\n						    </thead>\n						    <tbody>\n						    </tbody>\n						</table>\n					</div>\n				</div>\n\n				<div class="target">\n					<h4>Transformed Data</h4>\n					<div class="table-container">\n						<table class="to-data table table-striped">\n							<thead>\n						    	<tr>\n								    <th class="element-template">\n								    	<button class="btn btn-default btn-sm show-field-settings" data-placement="top"> <span class="field-label"></span> <span class="glyphicon glyphicon-cog half-opacity"></span> <span class="field-type half-opacity micro"></span></button>\n								    	<span class="well to-field clearfix" data-to=""></span>\n								    	<div class="field-settings">\n								    		<label>Type</label>\n								    		<select class="form-control input-sm field-type field-setting" name="type">\n								    		</select>\n											<!--<label class="checkbox">\n											   	<input class="field-setting" name="options.skipEmpty" type="checkbox"> Skip empty\n											</label>\n											<label class="checkbox">\n											   	<input class="field-setting" name="options.skipZero" type="checkbox"> Skip zero\n											</label>-->\n				    			    	</span>\n								    </th>\n						    	</tr>\n						    </thead>\n						    <tbody>\n						    </tbody>\n						</table>\n					</div>\n				</div>\n\n			</form>\n\n			<!-- Alerts -->\n			<div class="alert alert-block alert-error">\n		         <strong class="error-title"></strong>\n		         <div class="errors"></div>\n		   </div>\n\n		</div>\n        <div class="modal-footer">\n			<button class="btn btn-default step transform back"><i class="glyphicon glyphicon-arrow-left half-opacity"></i> Use another source</button>\n			<button data-dismiss="modal" class="btn btn-default pull-right cancel">Cancel</button>\n			<button class="step transform import-run btn btn-primary pull-right">Run Import</button>\n			<div class="state-indicator pull-right"><div class="spinner"></div></div>\n        </div>\n    </div><!-- /.modal-content -->\n</div><!-- /.modal-dialog -->\n'}),define("views/data-import-view",["jquery","underscore","backbone","config","utils","text!templates/data-import.html","views/modal-view","moment"],function(e,t,n,r,i,s,o,u){var a=o.extend({tagName:"div",className:"data-import-view modal large fade",events:{"change .step.source input":"sourceInputChanged","click .import-run":"importButtonClicked","click .source-submit":"sourceSubmitButtonClicked","click .back":"backButtonClicked","click .from-field .remove":"fromFieldRemoveClicked","click .btn.filetype":"filetypeButtonClicked"},expandObjects:!0,initialize:function(e){this.template=t.template(s),a.__super__.initialize.apply(this,arguments),this.dataTitle="",this.dataDescription="",this.maxPreview=30,this.inspectedSource,this.fromFieldColors=["#a52a2a","#f89406","#46a546","#62cffc","#ff7f50","#87ceeb","#daa520","#b8860b","#c43c35","#556b2f"],this.requests=[],this.defaultDescripts=[{to:"geometry.coordinates",type:"LatLng",label:"coordinates",options:{},allowedTypes:["LatLng","LngLat"]},{toTemplate:"properties.$field",type:"Number",label:"",options:{}},{toTemplate:"properties.$field",type:"String",label:"",options:{}},{toTemplate:"properties.$field",type:"Date",label:"",options:{}}],this.emptyDescript={toTemplate:"properties.$field",type:"String",label:"",options:{}},this.fieldTypes={Number:"Number",String:"Text",Date:"Date",Array:"List",Object:"Object",LatLng:"Lat,Lng",LngLat:"Lng,Lat"}},canImport:function(){return!this.isLoading&&this.$("input[name=url]").val().length&&this.$(".filetype.active").length},setButtonState:function(){this.$(".btn.source-submit").attr("disabled",!this.canImport()),this.$(".import-run").attr("disabled",!this.canImport())},sourceSubmitButtonClicked:function(e){e.preventDefault();var t=this;if(!this.canImport())return!1;this.runImport({inspect:!0,max:this.maxPreview},{success:function(e){if(e.items&&e.items.length){t.initDataTransformForSource(e);if(e.autoTransform){t.importButtonClicked();return}t.setStep("transform")}}})},filetypeButtonClicked:function(t){return this.$(".btn.filetype").each(function(){e(this).toggleClass("active",t.currentTarget==this)}),this.setButtonState(),!1},backButtonClicked:function(){this.setStep("source")},sourceInputChanged:function(){var t=this,n=this.$("input[name=url]").data("prevVal"),r=this.$("input[name=url]").val();this.$("input[name=url]").data("prevVal",r),r=r.replace(/^https:\/\/www.dropbox.com\//,"https://dl.dropbox.com/"),this.$("input[name=url]").val(r);var i=r.match(/\.([^\.]+)$/),s=i?i[1]:undefined;t.$(".btn.filetype").each(function(){e(this).toggleClass("active",s!=undefined&&e(this).hasClass(s))}),this.setButtonState()},importButtonClicked:function(){var e=this;return this.canImport()?(this.runImport({background:!0},{success:function(t){app.saveNewMapLayer(t.collection._id),e.setStep("source"),e.close()}}),!1):!1},displayAttr:function(e){return Array.isArray(e)?"["+e+"]":typeof e=="object"?"[Object]":e+""},initDataTransformForSource:function(n){var r=this;this.inspectedSource=n,this.fromFields={};var i=function(e,n){t.each(e,function(e,t){var s=n?n+"."+t:t;r.fromFields[s]=s,typeof e=="object"&&!Array.isArray(e)&&i(e,s)})};i(this.inspectedSource.items[0]),this.inspectedSource.autoTransform?this.descripts=this.inspectedSource.descripts:this.descripts=t.deepClone(this.defaultDescripts),this.$(".from-data thead").empty(),this.$(".from-data tbody").empty(),this.$(".to-data thead").empty(),this.$(".to-data tbody").empty();var s=0;for(var o in this.fromFields){var u=this.fromFieldTemplate.clone();u.removeClass("element-template"),e(".field-name",u).text(o),e(".label",u).css("background-color",this.fromFieldColors[s%this.fromFieldColors.length]),e(".from-field",u).attr("data-from",o),this.$(".from-data thead").append(u).show(),s++}t.each(this.inspectedSource.items,function(e){var n="";t.each(r.fromFields,function(t,i){n+="<td>"+r.displayAttr(getAttr(e,i))+"</td>"}),r.$(".from-data tbody").append("<tr>"+n+"</tr>")}),this.updateHandleStates(),t.each(this.descripts,function(e){r.initDescript(e)}),this.$(".from-field").draggable({revert:"invalid",helper:"clone",connectToSortable:".to-field",stack:".drag.label",start:function(t,n){r.preventSortableEvents=!0,e(n.helper).removeClass("half-opacity"),r.$(".to-field").addClass("highlight")},stop:function(t,n){r.preventSortableEvents=!1,r.removePopover(),r.$(".to-field").removeClass("highlight"),r.$(".to-data .from-field").removeClass("half-opacity"),e(n.helper).addClass("mapped"),r.updateHandleStates(),r.updateDescripts(),r.loadImportPreview()}})},initDescript:function(t){var n=this,r=n.toFieldTemplate.clone();r.removeClass("element-template"),t.dismiss=function(){e(".show-field-settings",r).popover("hide")},t.updateContainer=function(){e(".field-label",r).text(t.label),e(".field-type",r).text(n.fieldTypes[t.type])},t.container=r,n.initDescriptSettings(t),n.$(".to-data thead").append(r).show(),t.updateContainer(),e(".to-field",r).sortable({connectWith:".to-field",start:function(e,t){},stop:function(e,t){if(n.preventSortableEvents)return;n.removePopover(),n.updateDescripts(),n.loadImportPreview()},receive:function(t,n){e(".from-field",this).addClass("mapped")}})},initDescriptSettings:function(n){var r=this,i=e(".field-settings",n.container).remove();e("select.field-type",i).each(function(){var i=e(this),s=n.allowedTypes||t.keys(r.fieldTypes);t.each(s,function(e){i.append('<option value="'+e+'">'+r.fieldTypes[e]+"</option>")})}),e(".show-field-settings",n.container).popover({title:"Transform",content:i,html:!0,container:r.$el,animation:!1}).on("shown.bs.popover",function(t){e(this).addClass("active");var s=this;e(".field-setting",i).each(function(){e(this).attr("type")=="checkbox"?e(this).attr("checked",getAttr(n,e(this).attr("name"))):e(this).val(getAttr(n,e(this).attr("name")))}),e(".field-setting",i).change(function(){setAttr(n,e(this).attr("name"),e(this).attr("type")=="checkbox"?e(this).is(":checked"):e(this).val()),r.updateDescripts(),r.loadImportPreview()}),r.$(".show-field-settings").each(function(){this!=s&&e(this).popover("hide")})}).on("hidden.bs.popover",function(t){return e(this).removeClass("active"),!1}).click(function(e){return!1})},updateDescripts:function(){var n=[];t.each(this.descripts,function(r){r.from=[];var i=e(".from-field",r.container);r.from=[];for(var s=0;s<i.length;s++)r.from.push(e(i[s]).attr("data-from"));r.from.length?(!r.to&&r.toTemplate&&(r.to=r.toTemplate.replace("$field",r.from[0].replace(/\./g," ")),r.label=r.to),n.push({to:t.clone(r.to),from:t.clone(r.from),options:t.clone(r.options),type:t.clone(r.type)})):r.toTemplate&&(r.to=null,r.label=""),r.updateContainer()});if(n.length>=this.descripts.length-1){var r=t.clone(this.emptyDescript);this.descripts.push(r),this.initDescript(r)}return n},render:function(){var t=this;return a.__super__.render.call(this),this.spinner=this.$(".spinner").html((new Spinner({radius:6,length:0,width:6,color:"#333",lines:7,speed:1.5})).spin().el).hide(),this.setStep("source"),DEV&&this.$("[name=url]").val("https://dl.dropbox.com/s/cb4blktkkelwg1n/nuclear_reactors.csv"),this.sourceInputChanged(),this.fromFieldTemplate=this.$(".from-data thead .element-template"),this.toFieldTemplate=this.$(".to-data thead .element-template"),this.$(".element-template").remove(),this.$("input.text").click(function(){e(this).select()}),this},removePopover:function(){t.each(this.descripts,function(e){e.dismiss()})},remove:function(){return this.removePopover(),a.__super__.remove.apply(this,arguments)},setStep:function(t){this.setAlert(),this.$(".step").each(function(){e(this).toggle(e(this).is("."+t))}),this.$(".modal-dialog").toggleClass("large",t=="transform")},updateHandleStates:function(){var t=this,n=this.$(".to-data .from-field");this.$(".from-data .from-field").each(function(){for(var t=0;t<n.length;t++)if(e(n[t]).attr("data-from")==e(this).attr("data-from")){e(this).addClass("half-opacity");return}e(this).removeClass("half-opacity")}),this.$(".target").toggleClass("mapped",n.length>0)},fromFieldRemoveClicked:function(t){return e(t.currentTarget).closest(".from-field").remove(),this.updateHandleStates(),this.previousValidDescripts=null,this.updateDescripts(),this.loadImportPreview(),!1},setAlert:function(e,t){e?(this.$(".modal-body .alert").show("fast"),this.$(".modal-body .errors").html(e),this.$(".modal-body .error-title").html(t)):this.$(".modal-body .alert").hide()},runImport:function(n,r){var i=this,r=r||{},s;if(!n.inspect){s=this.updateDescripts();if(!s.length&&n.preview){i.updateImportPreview([]);return}}if(r.ifChanged&&this.previousValidDescripts&&t.isEqual(this.previousValidDescripts,s))return;this.previousValidDescripts=s;var n=t.extend({url:this.$("input[name=url]").val(),format:this.$(".filetype.active").attr("data-value"),transform:s},n);console.log("Requesting import",n),this.setAlert(),this.setLoading(!0),this.requests.push(e.ajax({type:"POST",url:BASE_URL+"api/import/",data:n,success:function(e){i.setLoading(!1),n.preview&&i.updateImportPreview(e.items),r.success&&r.success(e)},error:function(t,s,o){if(t.__aborted)return;i.setLoading(!1);if(t.responseText){var u=e.parseJSON(t.responseText),a=u&&u.errors?u.errors:u.error?{"":u}:null,f="";if(a){for(var l in a)f+="<li>"+a[l].message+"</li>";r.silent||i.setAlert("<ul>"+f+"</ul>","Import failed with the following errors:")}}n.preview&&i.updateImportPreview([])}}));while(this.requests.length>1){var o=this.requests.shift();o.__aborted=!0}},setLoading:function(e){this.isLoading=e,this.setButtonState(),e?this.spinner.show():this.spinner.hide()},loadImportPreview:function(){this.runImport({preview:!0,max:this.maxPreview},{silent:!0,ifChanged:!0})},updateImportPreview:function(e){var n=this,r=e.reduce(function(e,r){var i="";return r&&t.each(n.descripts,function(e){var t,s,o,a;if(e.to){o=getAttr(r,e.to),a=typeof o=="object"&&o.error;if(a){s="conversion-error";switch(o.name){case"FilterWarning":t=o.message;break;default:t=o.message}}else switch(e.type){default:t=n.displayAttr(o);break;case"Date":o&&(t=new Date(o),t&&(t=u(t).format(locale.formats.DATE_TIME)))}}var f=e.to&&e.to.length;f&&(t==undefined||(typeof t=="string"||Array.isArray(t))&&!t.length)?(s="conversion-blank",t="blank"):a||(f?t='<i class="icon icon-ok-circle half-opacity"></i> '+t:t="&nbsp;"),i+="<td"+(s?' class="'+s+'"':"")+">"+t+"</td>"}),e.push("<tr>"+i+"</tr>"),e},[]);this.$(".to-data tbody").html(r.join(""))}});return a}),define("text!templates/share.html",[],function(){return'<div class="modal-dialog">\n  <div class="modal-content">\n      <div class="modal-header">\n          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n          <h4 class="modal-title">Share Current View</h4>\n      </div>\n      <div class="modal-body">\n\n        <form class="well map-setup">\n\n          <div class="alert alert-danger private">\n            <div class="pull-left glyphicon glyphicon-ban-circle icon-xl"></div>\n            <div>\n                You are sharing your <strong>secret link</strong>. You should only share this URL with people who are supposed to see the map.\n            </div>\n          </div>\n\n          <div class="form-group">\n            <label>Paste link in email or IM:</label>\n            <textarea class="map-url form-control" rows="2" spellcheck="false"></textarea>\n          </div>\n          <div class="form-group">\n            <label>Paste HTML to embed in website:</label>\n            <textarea class="iframe form-control" rows="4" spellcheck="false"></textarea>\n          </div>\n        </form>\n\n      </div>\n      <div class="modal-footer">\n          <button id="cancelButton" data-dismiss="modal" class="btn btn-default btn-cancel pull-right">Close</button>\n      </div>\n    </div><!-- /.modal-content -->\n</div><!-- /.modal-dialog -->\n'}),define("views/share-view",["jquery","underscore","backbone","config","utils","text!templates/share.html","views/modal-view"],function(e,t,n,r,i,s,o){var u=o.extend({events:{},initialize:function(e){this.template=t.template(s),u.__super__.initialize.apply(this,arguments)},render:function(){return u.__super__.render.call(this),this.$(".map-url, .iframe").click(function(){e(this).select()}),this},show:function(){var e=app.currentPublicMapUrl();this.$(".map-url").val(e),this.$(".iframe").val('<iframe width="920" height="640" frameborder="0" scrolling="auto" marginwidth="0" marginheight="0" src="%(url)s"></iframe>'.format({url:e})),this.$(".alert.private").toggle(app.map.isPrivate()),u.__super__.show.call(this)}});return u}),define("text!templates/graphs-panel.html",[],function(){return'<div class="panel-heading">\n    <span class="model-title"></span> \n\n    <div class="btn-toolbar">\n\n        <div class="btn-group btn-group-xs graph-toggles text-buttons">\n            <button type="button" class="btn btn-default element-template" data-value=""></button>\n        </div>\n\n        <div class="btn-group btn-group-xs graph-scope-toggles text-buttons">\n            <button type="button" class="btn btn-default active" data-value="overall">overall</button>\n            <button type="button" class="btn btn-default" data-value="current-view">current view</button>\n        </div>\n\n        <div class="btn-group btn-group-xs">\n            <button type="button" class="btn btn-default panel-collapse"><span class="glyphicon glyphicon-minus-sign"></span></button>\n            <button type="button" class="btn btn-default panel-extend"><span class="glyphicon glyphicon-plus-sign"></span></button>\n            <button type="button" class="btn btn-default panel-close"><span class="glyphicon glyphicon-remove-sign"></span></button>\n        </div>\n    </div>\n</div>\n<div class="panel-body">\n    <div class="box graph-container"></div>\n</div>\n'}),define("views/graphs-panel-view",["jquery","underscore","backbone","config","utils","text!templates/graphs-panel.html","views/panel-view-base","mixins/timeout-queue-mixin"],function(e,t,n,r,i,s,o,u){var a=o.extend({className:"panel panel-default panel-anchor-bottom graphs",draggable:!1,events:{"click .graph-toggles button":"toggleGraphViewClicked","click .graph-scope-toggles button":"toggleGraphScopeClicked"},initialize:function(e){a.__super__.initialize.call(this,e);var n=this;this.template=t.template(s),this.createTimeoutQueue("redraw",250),this.graphViews={},this.graphView,this.on("panel:resize",this.adjustAndRedrawGraphs),this.on("panel:show",this.adjustAndRedrawGraphs),this.listenTo(this.model,"change",this.modelChanged),this.listenTo(this.model,"toggle:valFormatter",function(){n.adjustAndRedrawGraphs()})},adjustAndRedrawGraphs:function(){var e=this;this.queueTimeout("redraw",function(){t.each(e.graphViews,function(e,t){e.fillExtents()}),e.graphView&&e.$el.is(":visible")&&(e.graphView.graphRendered?e.graphView.redrawGraph():e.graphView.renderGraph())})},render:function(){return a.__super__.render.call(this),this.populateFromModel(),this.$graphToggles=this.$(".graph-toggles"),this.$graphToggleTemplate=e(".element-template",this.$graphToggles).remove().removeClass("element-template"),this.$graphScopeToggles=this.$(".graph-scope-toggles"),this},modelChanged:function(e,t){if(t.poll)return;this.adjustAndRedrawGraphs(),this.populateFromModel()},populateFromModel:function(){this.$(".model-title").text(this.model.getDisplay("title"))},addGraphView:function(e,t,n){this.graphViews[e]=t;var r=this.$graphToggleTemplate.clone().attr("data-value",e).data("view",t).text(n||e);this.$graphToggles.append(r),this.$(".graph-container").append(t.$el),this.graphView?t.hide():this.toggleGraphView(e)},toggleGraphViewClicked:function(t){this.toggleGraphView(e(t.currentTarget).attr("data-value")),this.expand()},toggleGraphView:function(n){var r=this;n&&(this.graphView=this.graphViews[n]),e("button",this.$graphToggles).each(function(){e(this).toggleClass("active",e(this).data("view")==r.graphView)}),this.$el.is(":visible")&&t.each(this.graphViews,function(e,t){e==r.graphView?e.show():e.hide()}),e("button",this.$graphScopeToggles).each(function(){e(this).attr("disabled",r.graphView.scopes.indexOf(e(this).attr("data-value"))==-1)}),r.graphView.scopes&&this.toggleGraphScope(r.graphView.scopes[0])},toggleGraphScopeClicked:function(t){this.toggleGraphScope(e(t.currentTarget).attr("data-value"))},toggleGraphScope:function(t){e("button",this.$graphScopeToggles).each(function(){e(this).toggleClass("active",e(this).attr("data-value")==t)})},show:function(){a.__super__.show.apply(this,arguments),this.toggleGraphView()}});return t.extend(a.prototype,u),a}),define("text!templates/scatter-plot.html",[],function(){return"<!-- scatter plot -->"}),define("views/graphs/timeline-scatter-plot-view",["jquery","underscore","backbone","config","utils","text!templates/scatter-plot.html","views/graphs/graph-view-base","d3"],function(e,t,n,r,i,s,o,u){var a=o.extend({className:"graph scatter-plot",scopes:[GraphScope.CURRENT_VIEW],events:{},initialize:function(e){var n=this,e=t.extend({renderAxes:!0},e);a.__super__.initialize.call(this,e),this.template=t.template(s),this.model.on("feature:selected",function(e,t){var r=n.collection,i=t.getBox(),s=[i[0],i[2]];r.setVisibleMapArea({bounds:s}),r.urlParams.original=!0,n.graphVisible()&&r.fetch()}),this.model.on("feature:unselected",function(e,t){var r=n.collection;r.resetFrom(e.mapFeatures)})},renderGraph:function(){var e=this,t=this.model.getValFormatter();a.__super__.renderGraph.apply(this,arguments);var n=this.collection.models,r=t.unit||(this.model.getNumericField()||"").split(".").pop(),i=function(e){var t=e.getDatetimeVal(),t=t.min!=undefined?t.min:t;return t!=undefined?new Date(t):null},s=function(e){var n=e.getNumericVal(),n=n.avg!=undefined?n.avg:n;return t.convert(n)},o=function(e){return __("%(label)s: %(value)s",{value:t.format(e),label:r})},f=u.time.scale().range(this.getXRange()).domain(u.extent(n,i)),l=u.scale.linear().range(this.getYRange()).domain(u.extent(n,s));if(this.renderAxes){var c=u.svg.axis().scale(f).orient("bottom"),h=u.svg.axis().scale(l).tickFormat(function(e,t){return autoFormatNumber(e)}).orient("left");this.appendXAxis(c),this.appendYAxis(h,r)}return this.svg.selectAll("circle").data(n).enter().append("circle").attr("class","dot").attr("fill",function(e){return e.getRenderAttr().color}).attr("stroke",function(e){return e.getRenderAttr("strokeColor",function(){return strokeForColor(e.getRenderAttr("color"))})}).attr("cx",function(e){return f(i(e))}).attr("cy",function(e){return l(s(e))}).attr("r",function(e){return 3.5}).on("mouseover",function(t){e.showTooltip(this,o(s(t))),u.select(this).style("fill",t.getRenderAttr("hightlightColor",function(){return highlightForColor(t.getRenderAttr("color"))}))}).on("mouseout",function(e){u.select(this).style("fill",e.getRenderAttr("color"))}),this}});return a}),define("models/map",["jquery","underscore","backbone","models/map-layer","deepextend","deepmodel"],function(e,t,n,r){var i=n.DeepModel.extend({idAttribute:"slug",urlRoot:BASE_URL+"api/map",url:function(){return this.urlRoot+"/"+this.publicUri({omitSlug:!1})},isPrivate:function(){return this.attributes.sharing!=SharingType.WORLD},adminUri:function(e){var n=this.publicUri(t.extend({slug:this.attributes.slug},e));return"admin"+(n!=""?"/"+n:"")},publicUri:function(e){var t=e||{},n=this.isCustomHost&&(t.omitSlug||t.omitSlug==undefined),r=t.secret!=undefined?t.secret:this.isPrivate(),i=(n?"":t.slug?t.slug:r?"s/"+this.attributes.secretSlug:this.attributes.slug)+(t.view?"/"+t.view:"");return t.x!=undefined&&t.y!=undefined&&(i+="/"+(t.x||0)+","+(t.y||0),t.zoom!=undefined&&(i+=","+t.zoom)),i},adminUrl:function(e){return BASE_URL+this.adminUri(e)},publicUrl:function(e){var n=BASE_URL,r=t.extend({},e);return this.attributes.host&&this.attributes.host!=""&&(r.omitSlug=!0,n="http://"+this.attributes.host+"/"),n+this.publicUri(r)},newLayerInstance:function(e,t){var t=t||{};return t.parentMap=this,new r(e,t)}});return i}),define("text!templates/help/about.html",[],function(){return'<div class="well text-center">\n	<p>\n		<span class="muted">GeoSense was originally created by</span>\n		<br><strong>Anthony DeVincenzi</strong> &amp; <strong>Samuel Luescher</strong>\n	</p>\n	<p class="text-muted">at the \n		<a href="http://www.mit.edu">Massachusetts Institute of Technology</a>, <a href="http://media.mit.edu/">MIT Media Lab</a>.\n	</p>\n</div>\n\n<p>\n	This project has been supported by the <a href="http://tangible.media.mit.edu">Tangible Media Group</a>, <a href="http://safecast.net">Safecast</a>, and the <a href="http://megacitylab.mit.edu/">MIT Megacity Logistics Lab</a>.\n</p>\n\n<p>\n	GeoSense is an open publishing platform for visualization, social sharing, and data analysis of geospatial data. \n	It explores the power of data analysis through robust layering and highly customizable data visualization. \n	GeoSense supports the simultaneous comparison and individual styling for multiple massive data sources \n	ranging from 10 thousand to 10 million geolocated points.\n</p>\n\n<p>\n	Powered by <a href="http://nodejs.org/">Node.js</a>, <a href="http://www.mongodb.org/">MongoDB</a>, <a href="http://backbonejs.org/">Backbone</a>, \n	and <a href="http://twitter.github.com/bootstrap/">Bootstrap</a>. Some interface elements courtesy of <a href="http://glyphicons.com/">glyphicons.com</a>.\n</p>\n'}),define("map-router",["jquery","underscore","backbone","config","utils","permissions","views/login-signup-view","views/header-view","views/setup-view","views/help-panel-view","views/layers-panel-view","views/data-detail-view","views/map-info-view","views/baselayer-editor-view","views/map-layer-editor-view","views/map-layer-view","views/data-library-panel-view","views/data-import-view","views/modal-view","views/share-view","views/graphs-panel-view","views/graphs/timeline-scatter-plot-view","views/graphs/histogram-view","views/notification-bubble-view","models/map","models/map-layer","text!templates/help/about.html"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C){var k=n.Router.extend({routes:{},defaultRoutes:{"admin/:slug":"mapAdminRoute","admin/:slug/:view":"mapAdminRoute","admin/:slug/:view/:pos":"mapAdminRoute",":slug":"mapRoute",":slug/:view":"mapRoute",":slug/:view/:pos":"mapRoute","s/:slug":"mapRoute","s/:slug/:view":"mapRoute","s/:slug/:view/:pos":"mapRoute"},byHostRoutes:{admin:"mapAdminRouteByHost","admin/:view":"mapAdminRouteByHost","admin/:view/:pos":"mapAdminRouteByHost","":"mapRouteByHost",":view":"mapRouteByHost",":view/:pos":"mapRouteByHost"},getRoutes:function(e){var t;e?(console.log("route by custom host"),t=this.byHostRoutes):(console.log("route by slug"),t=this.defaultRoutes);var n=[];for(var r in t)n.unshift([r,t[r]]);return n},initialize:function(e,n){var r=this;t.each(this.getRoutes(n),function(e){r.route.apply(r,e)}),e&&(this.map=new T(e),this.map.isCustomHost=n),this.isRendered=!1,this.mapLayerSubViewsAttached=!1,this.mapLayerEditorViews={},this.graphsPanelViews={},this.mapChanged=!1,this.adminRoute=!1,this.routingByHost=!1,this.sessionOptions={},this.isEmbedded=window!=window.top},mapRoute:function(t,n,r){var i,s,o,u,a,f,l;if(n){this.setupRoute=n=="setup";if(!this.setupRoute){var c=n.split(":");i=c.shift(),c.length>1&&(s=c.shift()),c.length&&(o=c.shift())}else e("#app").empty()}if(r!=undefined){var c=r.split(",");c.length==3&&(a=c.pop()),c.length==2&&(f=parseFloat(c.shift()),l=parseFloat(c.shift()),!isNaN(f)&&!isNaN(l)&&(u=[f,l]))}this.render();if(!this.mapView){console.log("slug:",t,"mapViewName:",i,"viewBase:",s,"viewStyle:",o,"center:",u,"zoom:",a);if(!this.map){this.map=new T({slug:t}),this.loadAndInitMap(t,i,u,a,s,o);return}this.initMap(i,u,a,s,o)}else{var h=this.getDefaultVisibleMapArea();u&&(h.center=u),a&&(h.zoom=a),this.mapView.setVisibleMapArea(h)}},mapAdminRoute:function(e,t,n){this.adminRoute=!0,this.mapRoute(e,t,n)},mapRouteByHost:function(e,t){return this.routingByHost=!0,this.mapRoute(null,e,t)},mapAdminRouteByHost:function(e,t){return this.routingByHost=!0,this.mapAdminRoute(null,e,t)},setUIReady:function(){e("#center-spinner").hide("fast",function(){e(this).remove()})},loadAndInitMap:function(e,t,n,r,i,s){var o=this;this.map.fetch({success:function(e,t,n){o.initMap()},error:function(t,n,r){console.error("failed to load map",e)}})},initMap:function(e,n,r,i,s){var o=this;this.mapLayersById={},t.each(this.map.attributes.layers,function(e){o.initMapLayer(o.map.newLayerInstance(e))});var u=o.map.attributes.viewOptions||{};o.setViewOptions(u);var a=function(e,t){return e&&e!=""?e:t};o.initMapView(a(e,u.viewName),n,r,a(i,u.viewBase),a(s,u.viewStyle))},initMapView:function(t,n,i,s,o){var u=this,a;this.mapViewName=t,this.mapView&&(this.mapView.remove(),this.stopListening(this.mapView),delete this.mapView);switch(this.mapViewName){default:case"map":a=r.MAP_VIEW_MODULES[0],this.mapViewName="map"}e(".map-view-toggle").each(function(){e(this).toggleClass("active",e(this).hasClass(u.mapViewName))});var f=this.getDefaultVisibleMapArea();n&&(f.center=n),i&&(f.zoom=i),require([a],function(e){u.mapView=new e,u.listenTo(u.mapView,"view:areachanged",u.visibleMapAreaChanged),u.listenTo(u.mapView,"view:ready",u.mapViewReady),u.listenTo(u.mapView,"view:optionschanged",u.viewOptionsChanged);var t=u.mapView.render().el;u.$mainEl.append(t),u.mapView.renderMap(s,o),u.mapView.setVisibleMapArea(f)})},mapViewReady:function(){this.__mapViewReady,this.__mapViewReady=!0;var e=this;setTimeout(function(){console.log("mapViewReady: attaching sub views for all layers"),e.setUIReady(),e.attachMapLayerSubViews(),e.fetchMapFeatures()},200)},isMapAdmin:function(){return this.adminRoute&&this.map.attributes.admin},getMapLayer:function(e){return this.mapLayersById[e]},initMapLayer:function(e,t){var n=this;return this.mapLayersById[e.id]=e,e.initCollections(),this.mapLayerSubViewsAttached&&(this.attachSubViewsForMapLayer(e,t),this.fetchMapFeatures()),this.listenTo(e,"toggle:enabled",function(){e.isEnabled()?setTimeout(function(){n.fetchMapFeatures()},300):n.hideMapLayerGraphs(e)}),this.listenTo(e,"show:editor",function(){this.showMapLayerEditor(e)}),this.listenTo(e,"show:graphs",function(){this.showMapLayerGraphs(e)}),this.listenTo(e,"destroy",function(){n.stopListening(e),delete n.mapLayersById[e.id]}),e.getDataStatus()!=DataStatus.COMPLETE&&this.pollForMapLayerStatus(e,INITIAL_POLL_INTERVAL),e},pollForMapLayerStatus:function(e,t){var n=this;if(t){setTimeout(function(){n.pollForMapLayerStatus(e)},t);return}e.once("sync",function(){e.canDisplayValues()&&n.fetchMapFeatures();if(e.getDataStatus()==DataStatus.COMPLETE){e.trigger("change",e,{complete:!0}),n.trigger("featureCollection:added");return}n.pollForMapLayerStatus(e,POLL_INTERVAL)}),e.fetch({data:{incomplete:!0},poll:!0})},attachSubViewsForMapLayer:function(e,t){this.layersPanelView.isAttached||this.attachPanelView(this.layersPanelView).hide().show(),console.log("attachSubViewsForMapLayer",e.id,e.getDisplay("title"));var n=(new v({model:e})).render();this.layersPanelView.appendSubView(n),t&&n.hide().show("fast"),this.mapView.attachLayer(e),e.limitFeatures()&&e.mapFeatures.setVisibleMapArea(this.mapView.getVisibleMapArea()),this.listenTo(e,"feature:selected",this.featureSelected),this.listenTo(e,"feature:unselected",this.featureUnselected);if(e.hasGraphs()){var r=(new w({model:e,collection:e.mapFeatures})).render();e.timeline&&r.addGraphView("timeline",(new E({model:e,collection:e.timeline})).render(),__("Timeline")),e.histogram&&r.addGraphView("histogram",(new S({model:e,collection:e.histogram})).render(),__("Histogram")),this.graphsPanelViews[e.id]=r;var i=function(){setTimeout(function(){e.fetchGraphs()},500)};e.isEnabled()?i():e.once("toggle:enabled",function(){i()})}},attachMapLayerSubViews:function(){var e=this;e.mapLayerSubViewsAttached||(e.mapLayerSubViewsAttached=!0,t.each(e.mapLayersById,function(t){e.attachSubViewsForMapLayer(t)}),this.layersPanelView.show("fast"))},fetchMapFeatures:function(){t.each(this.mapLayersById,function(e){e.isEnabled()&&e.canDisplayValues()&&e.mapFeatures.canFetch()&&!e.mapFeatures.isCurrent()&&(console.log("Fetching features for",e.id,e.getDisplay("title")),e.mapFeatures.fetch())})},adjustViewport:function(){this.$mainEl.css("top",e("header").outerHeight()+"px")},render:function(){var t=this;window.document.title=this.map.get("title")+" – GeoSense",this.isEmbedded&&e("body").addClass("embed"),this.headerView=new u({model:this.map}),this.mapWasCreatedAnonymously=!this.map.createdBy,this.on("user:login",function(){t.mapWasCreatedAnonymously&&(t.map.attributes.createdBy=s.currentUser(),console.log("Setting map user",t.map.attributes.createdBy)),t.headerView.updateUser()}),e("#app").append(this.headerView.render().el),this.$mainEl=e('<div id="main-viewport"></div>'),this.mainEl=this.$mainEl[0],e("#app").append(this.mainEl),e(window).on("resize",function(){t.adjustViewport()}),setTimeout(function(){t.adjustViewport()},0),this.isMapAdmin()&&(this.setupView=(new a({model:this.map})).render(),this.setupView.on("map:saved",function(e){x.success(__("Map information saved."))}),this.setupRoute&&this.showSetupView()),this.layersPanelView=(new l({})).render(),this.baselayerEditorView=(new p({model:this.map})).render();var n=e('<div class="snap top" /><div class="snap right" />');t.$mainEl.append(n),this.isMapAdmin()&&(this.helpPanelView=(new f).render(),(!this.map.attributes.layers.length||!s.currentUser())&&this.attachPanelView(this.helpPanelView).hide().show("fast")),t.isRendered=!0},geocode:function(e,t){var n=this,r=new google.maps.Geocoder;r.geocode({address:e},t)},zoomToAddress:function(t){var n=this;this.geocode(t,function(r,i){if(i!=google.maps.GeocoderStatus.OK){alert("Unable to find address: "+t);return}var s=r[0].geometry.viewport,o=s.getSouthWest(),u=s.getNorthEast();n.mapView.zoomToExtent([o.lng(),o.lat(),u.lng(),u.lat()]),e(".search-query").blur()})},genMapViewParam:function(e){if(!e||e=="map"){var t=this.mapView.viewBase&&this.mapView.viewBase!=DEFAULT_MAP_VIEW_BASE,n=t||this.mapView.viewStyle&&this.mapView.viewStyle!=this.mapView.defaultViewStyle;e=this.mapViewName+(n||t?":":"")+(t?this.mapView.viewBase+":":"")+(n?this.mapView.viewStyle?this.mapView.viewStyle:"default":"")}return e},getCurrentViewOptions:function(){var t=e.extend(this.sessionOptions.viewOptions,{viewName:this.mapViewName,viewBase:this.mapView.viewBase,viewStyle:this.mapView.viewStyle});return t},currentMapUriOptions:function(e){var t={x:e.center[0],y:e.center[1],zoom:e.zoom,view:this.genMapViewParam("map")},n={x:this.map.attributes.initialArea.center.length?this.map.attributes.initialArea.center[0]:0,y:this.map.attributes.initialArea.center.length?this.map.attributes.initialArea.center[1]:0,zoom:this.map.attributes.initialArea.zoom!=undefined?this.map.attributes.initialArea.zoom:0};return n.x!=t.x||n.y!=t.y||n.zoom!=t.zoom?t:{mapViewName:t.view}},currentMapUri:function(){var e=this.currentMapUriOptions(this.mapView.getVisibleMapArea());return this.isMapAdmin()?this.map.adminUri(e):this.map.publicUri(e)},currentPublicMapUrl:function(){var e=this.currentMapUriOptions(this.mapView.getVisibleMapArea());return this.map.publicUrl(e)},resetMap:function(){var e=this.isMapAdmin()?this.map.adminUri():this.map.publicUri();this.mapChanged=!1,this.navigate(e,{trigger:!0})},visibleMapAreaChanged:function(e,n){this.mapChanged&&this.navigate(this.currentMapUri(),{trigger:!1}),this.mapChanged=!0,t.each(this.mapLayersById,function(e){e.limitFeatures()&&e.mapFeatures.setVisibleMapArea(n)}),this.fetchMapFeatures()},getDefaultVisibleMapArea:function(){var e=DEFAULT_MAP_AREA;return this.map.attributes.initialArea&&this.map.attributes.initialArea.center.length&&(e.center=this.map.attributes.initialArea.center),this.map.attributes.initialArea.zoom!=undefined&&(e.zoom=this.map.attributes.initialArea.zoom),e},viewOptionsChanged:function(t){var n=this;if(t==this.mapView){n.setViewOptions(),e("#app").removeClass(function(e,t){return(t.match(/\bmap-style-\S+/g)||[]).join(" ")});var r={},i=this.mapView.viewStyle||"default";this.mapView.viewStyles?r=this.mapView.viewStyles:r={"default":"Default"},e("#app").addClass("map-style-"+i);var s=[];e.each(r,function(e,t){var n=e;s.push('<li class="view-style'+(n==i?" active":"")+'">'+'<a href="#'+n+'">'+t+"</a></li>")}),e("#viewStyle .dropdown-menu .view-style").remove(),e("#viewStyle .dropdown-menu").prepend(s.join("")),e("#viewStyleCurrent").text(r[i]),e("#viewStyle").show();if(this.mapView.viewBase){var s=[];for(var o in this.mapView.ViewBase){var u=this.mapView.ViewBase[o].prototype;s.push('<li class="view-base'+(o==n.mapView.viewBase?" active":"")+'">'+'<a href="#'+o+'">'+'<span class="view-base-thumb"'+(o!="blank"?' style="background: url('+BASE_URL+"/assets/baselayer-thumbs/"+o+'.png)"':"")+"></span>"+'<span class="view-base-caption">'+u.providerName+"</span>"+"</a></li>")}e("#viewBase .dropdown-menu .view-base").remove(),e("#viewBase .dropdown-menu").prepend(s.join("")),e("#viewBaseCurrent").text(this.mapView.ViewBase[this.mapView.viewBase].prototype.providerName),e("#viewBaselayer").show()}else e("#viewBaselayer").hide();this.baselayerEditorView.$(".form-group.opacity").toggle(this.mapView.viewBase!="blank")}},setViewStyle:function(e,t){this.mapView.trigger("update:style",e),(t||t==undefined)&&this.navigate(this.currentMapUri(),{trigger:!1}),this.setViewOptions()},setViewBase:function(e,t){this.mapView.trigger("update:base",e),(t||t==undefined)&&this.navigate(this.currentMapUri(),{trigger:!1}),this.setViewOptions()},setViewOptions:function(t){t?this.sessionOptions.viewOptions=e.extend(this.sessionOptions.viewOptions,t):t=this.sessionOptions.viewOptions,this.mapView&&(this.__mapViewReady=!1,this.mapView.updateViewOptions(t))},featureSelected:function(e,t,n){var r=this;if(!SHOW_DETAIL_DATA_ON_MAP)this.dataDetailView||(this.dataDetailView=(new c).render()),this.dataDetailView.isAttached||(this.attachPanelView(this.dataDetailView),this.dataDetailView.snapToView(this.layersPanelView,"left",!0).hide().show("fast")),this.dataDetailView.setPanelState(!0),this.dataDetailView.setModel(t),this.dataDetailView.show();else{var i=new c;i.render(),i.setModel(t),i.on("panel:close",function(){r.mapView.destroyPopupForFeature(n)});var s=i.el;this.mapView.setPopupForFeature(n,s)}},featureUnselected:function(e,t,n){this.dataDetailView&&this.dataDetailView.hide(),this.mapView.destroyPopupForFeature(n)},showMapInfo:function(){this.mapInfoView=(new h({model:this.map})).render(),this.mapInfoView.show()},toggleDataLibrary:function(){var e=this;this.dataLibraryView||(this.dataLibraryView=(new m).render()),this.dataLibraryView.isVisible()?this.dataLibraryView.close("fast"):(this.attachPanelView(this.dataLibraryView),this.dataLibraryView.show("fast"))},showShareLink:function(){var e=(new b).render();e.show()},showAbout:function(){var e=(new y).render();e.setTitle("About GeoSense"),e.setBody(C),e.show()},showSignup:function(){(new o).showSignup()},showLogin:function(){(new o).showLogin()},showSetupView:function(e){this.setupView.show(),e&&this.setupView.focusTab(e)},toggleDataImport:function(){if(!s.currentUser()){this.showSignup();return}this.dataImportView||(this.dataImportView=(new g({})).render()),this.dataImportView.show()},showBaselayerEditor:function(){this.attachPanelView(this.baselayerEditorView).snapToView(this.layersPanelView,"left",!0).hide().show("fast")},hideMapLayerGraphs:function(e){return this.graphsPanelViews[e.id]&&this.graphsPanelViews[e.id].hide("fast"),this.graphsPanelViews[e.id]},showMapLayerGraphs:function(e){var n=this,r=e.id;return t.each(this.graphsPanelViews,function(e,t){r==t?(e.isAttached||n.attachPanelView(e).hide(),e.expand().show("fast")):setTimeout(function(){e.hide("fast")},250)}),this.graphsPanelViews[e.id]},showMapLayerEditor:function(e){var t=e.id,n=this;this.mapLayerEditorViews[t]||(this.mapLayerEditorViews[t]=(new d({model:this.getMapLayer(t)})).render(),this.mapLayerEditorViews[t].on("mapLayer:saved",function(){x.success(__("Layer saved."))}),this.mapLayerEditorViews[t].on("mapLayer:destroyed",function(){x.success(__("Layer removed."))}));for(var r in this.mapLayerEditorViews)t!=this.mapLayerEditorViews[r].model.get("_id")?this.mapLayerEditorViews[r].detach():this.mapLayerEditorViews[r].isVisible()?this.mapLayerEditorViews[r].close("fast"):(this.mapLayerEditorViews[r].hide(),this.attachPanelView(this.mapLayerEditorViews[r]),this.mapLayerEditorViews[r].snapToView(this.layersPanelView,"left",!0).show("fast"));return this.mapLayerEditorViews[t]},attachPanelView:function(e){return e.attachTo(this.mainEl),e},saveNewMapLayer:function(e){var t=this,n=this.map.newLayerInstance({featureCollection:{_id:e}});console.log("saving new map layer",n),n.once("sync",function(){t.initMapLayer(n,!0),t.trigger("mapLayer:added",n)}),n.save({},{success:function(e,n,r){console.log("new map layer saved",e),t.layersPanelView.show("fast"),x.success(__("Layer added to map."))},error:function(e,t,n){console.error("failed to save new map layer")}})}}),L=function(e,t){return i.initAjaxErrorNotification(),new k(e,t)},A=function(){if(!n.history.start({pushState:!0,root:BASE_URL.replace(/^(.*:\/\/)?[^\/]*\/?/,""),silent:!1})){var e=window.location.href.length-1;window.location.href[e]=="/"?window.location.href=window.location.href.substr(0,e):window.location.href=BASE_URL+"404"}};return{initialize:L,start:A}}),function(e,t){function n(t,n){var i,s,o,u=t.nodeName.toLowerCase();return"area"===u?(i=t.parentNode,s=i.name,t.href&&s&&"map"===i.nodeName.toLowerCase()?(o=e("img[usemap=#"+s+"]")[0],!!o&&r(o)):!1):(/input|select|textarea|button|object/.test(u)?!t.disabled:"a"===u?t.href||n:n)&&r(t)}function r(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var i=0,s=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(n,r){return"number"==typeof n?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),r&&r.call(t)},n)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length)for(var r,i,s=e(this[0]);s.length&&s[0]!==document;){if(r=s.css("position"),("absolute"===r||"relative"===r||"fixed"===r)&&(i=parseInt(s.css("zIndex"),10),!isNaN(i)&&0!==i))return i;s=s.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++i)})},removeUniqueId:function(){return this.each(function(){s.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var r=e.attr(t,"tabindex"),i=isNaN(r);return(i||r>=0)&&n(t,!i)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function i(t,n,r,i){return e.each(s,function(){n-=parseFloat(e.css(t,"padding"+this))||0,r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),i&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var s="Width"===r?["Left","Right"]:["Top","Bottom"],o=r.toLowerCase(),u={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?u["inner"+r].call(this):this.each(function(){e(this).css(o,i(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return"number"!=typeof t?u["outer"+r].call(this,t):this.each(function(){e(this).css(o,i(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,r){var i,s=e.ui[t].prototype;for(i in r)s.plugins[i]=s.plugins[i]||[],s.plugins[i].push([n,r[i]])},call:function(e,t,n){var r,i=e.plugins[t];if(i&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(r=0;i.length>r;r++)e.options[i[r][0]]&&i[r][1].apply(e.element,n)}},hasScroll:function(t,n){if("hidden"===e(t).css("overflow"))return!1;var r=n&&"left"===n?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)}})}(jQuery),function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n,r=0;null!=(n=t[r]);r++)try{e(n).triggerHandler("remove")}catch(s){}i(t)},e.widget=function(n,r,i){var s,o,u,a,f={},l=n.split(".")[0];n=n.split(".")[1],s=l+"-"+n,i||(i=r,r=e.Widget),e.expr[":"][s.toLowerCase()]=function(t){return!!e.data(t,s)},e[l]=e[l]||{},o=e[l][n],u=e[l][n]=function(e,n){return this._createWidget?(arguments.length&&this._createWidget(e,n),t):new u(e,n)},e.extend(u,o,{version:i.version,_proto:e.extend({},i),_childConstructors:[]}),a=new r,a.options=e.widget.extend({},a.options),e.each(i,function(n,i){return e.isFunction(i)?(f[n]=function(){var e=function(){return r.prototype[n].apply(this,arguments)},t=function(e){return r.prototype[n].apply(this,e)};return function(){var n,r=this._super,s=this._superApply;return this._super=e,this._superApply=t,n=i.apply(this,arguments),this._super=r,this._superApply=s,n}}(),t):(f[n]=i,t)}),u.prototype=e.widget.extend(a,{widgetEventPrefix:o?a.widgetEventPrefix:n},f,{constructor:u,namespace:l,widgetName:n,widgetFullName:s}),o?(e.each(o._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,u,n._proto)}),delete o._childConstructors):r._childConstructors.push(u),e.widget.bridge(n,u)},e.widget.extend=function(n){for(var i,o,u=r.call(arguments,1),a=0,f=u.length;f>a;a++)for(i in u[a])o=u[a][i],u[a].hasOwnProperty(i)&&o!==t&&(n[i]=e.isPlainObject(o)?e.isPlainObject(n[i])?e.widget.extend({},n[i],o):e.widget.extend({},o):o);return n},e.widget.bridge=function(n,i){var o=i.prototype.widgetFullName||n;e.fn[n]=function(u){var f="string"==typeof u,l=r.call(arguments,1),c=this;return u=!f&&l.length?e.widget.extend.apply(null,[u].concat(l)):u,f?this.each(function(){var r,i=e.data(this,o);return i?e.isFunction(i[u])&&"_"!==u.charAt(0)?(r=i[u].apply(i,l),r!==i&&r!==t?(c=r&&r.jquery?c.pushStack(r.get()):r,!1):t):e.error("no such method '"+u+"' for "+n+" widget instance"):e.error("cannot call methods on "+n+" prior to initialization; "+"attempted to call method '"+u+"'")}):this.each(function(){var t=e.data(this,o);t?t.option(u||{})._init():e.data(this,o,new i(u,this))}),c}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var i,s,o,u=n;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof n)if(u={},i=n.split("."),n=i.shift(),i.length){for(s=u[n]=e.widget.extend({},this.options[n]),o=0;i.length-1>o;o++)s[i[o]]=s[i[o]]||{},s=s[i[o]];if(n=i.pop(),r===t)return s[n]===t?null:s[n];s[n]=r}else{if(r===t)return this.options[n]===t?null:this.options[n];u[n]=r}return this._setOptions(u),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(n,r,i){var s,o=this;"boolean"!=typeof n&&(i=r,r=n,n=!1),i?(r=s=e(r),this.bindings=this.bindings.add(r)):(i=r,r=this.element,s=this.widget()),e.each(i,function(i,u){function f(){return n||o.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof u?o[u]:u).apply(o,arguments):t}"string"!=typeof u&&(f.guid=u.guid=u.guid||f.guid||e.guid++);var l=i.match(/^(\w+)\s*(.*)$/),c=l[1]+o.eventNamespace,h=l[2];h?s.delegate(h,c,f):r.bind(c,f)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return("string"==typeof e?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];if(r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){"string"==typeof i&&(i={effect:i});var o,u=i?i===!0||"number"==typeof i?n:i.effect||n:t;i=i||{},"number"==typeof i&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&e.effects.effect[u]?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}})}(jQuery),function(e){var t=!1;e(document).mouseup(function(){t=!1}),e.widget("ui.mouse",{version:"1.10.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){return!0===e.data(n.target,t.widgetName+".preventClickEvent")?(e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1):undefined}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(n){if(!t){this._mouseStarted&&this._mouseUp(n),this._mouseDownEvent=n;var r=this,i=1===n.which,s="string"==typeof this.options.cancel&&n.target.nodeName?e(n.target).closest(this.options.cancel).length:!1;return i&&!s&&this._mouseCapture(n)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(n)&&this._mouseDelayMet(n)&&(this._mouseStarted=this._mouseStart(n)!==!1,!this._mouseStarted)?(n.preventDefault(),!0):(!0===e.data(n.target,this.widgetName+".preventClickEvent")&&e.removeData(n.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),n.preventDefault(),t=!0,!0)):!0}},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e,t){function n(e,t,n){return[parseFloat(e[0])*(p.test(e[0])?t/100:1),parseFloat(e[1])*(p.test(e[1])?n/100:1)]}function r(t,n){return parseInt(e.css(t,n),10)||0}function i(t){var n=t[0];return 9===n.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(n)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:n.preventDefault?{width:0,height:0,offset:{top:n.pageY,left:n.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var s,o=Math.max,u=Math.abs,a=Math.round,f=/left|center|right/,l=/top|center|bottom/,c=/[\+\-]\d+(\.[\d]+)?%?/,h=/^\w+/,p=/%$/,d=e.fn.position;e.position={scrollbarWidth:function(){if(s!==t)return s;var n,r,i=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=i.children()[0];return e("body").append(i),n=o.offsetWidth,i.css("overflow","scroll"),r=o.offsetWidth,n===r&&(r=i[0].clientWidth),i.remove(),s=n-r},getScrollInfo:function(t){var n=t.isWindow?"":t.element.css("overflow-x"),r=t.isWindow?"":t.element.css("overflow-y"),i="scroll"===n||"auto"===n&&t.width<t.element[0].scrollWidth,s="scroll"===r||"auto"===r&&t.height<t.element[0].scrollHeight;return{width:s?e.position.scrollbarWidth():0,height:i?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),r=e.isWindow(n[0]);return{element:n,isWindow:r,offset:n.offset()||{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:r?n.width():n.outerWidth(),height:r?n.height():n.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return d.apply(this,arguments);t=e.extend({},t);var s,p,v,m,g,y,b=e(t.of),w=e.position.getWithinInfo(t.within),E=e.position.getScrollInfo(w),S=(t.collision||"flip").split(" "),x={};return y=i(b),b[0].preventDefault&&(t.at="left top"),p=y.width,v=y.height,m=y.offset,g=e.extend({},m),e.each(["my","at"],function(){var e,n,r=(t[this]||"").split(" ");1===r.length&&(r=f.test(r[0])?r.concat(["center"]):l.test(r[0])?["center"].concat(r):["center","center"]),r[0]=f.test(r[0])?r[0]:"center",r[1]=l.test(r[1])?r[1]:"center",e=c.exec(r[0]),n=c.exec(r[1]),x[this]=[e?e[0]:0,n?n[0]:0],t[this]=[h.exec(r[0])[0],h.exec(r[1])[0]]}),1===S.length&&(S[1]=S[0]),"right"===t.at[0]?g.left+=p:"center"===t.at[0]&&(g.left+=p/2),"bottom"===t.at[1]?g.top+=v:"center"===t.at[1]&&(g.top+=v/2),s=n(x.at,p,v),g.left+=s[0],g.top+=s[1],this.each(function(){var i,f,l=e(this),c=l.outerWidth(),h=l.outerHeight(),d=r(this,"marginLeft"),y=r(this,"marginTop"),T=c+d+r(this,"marginRight")+E.width,N=h+y+r(this,"marginBottom")+E.height,C=e.extend({},g),L=n(x.my,l.outerWidth(),l.outerHeight());"right"===t.my[0]?C.left-=c:"center"===t.my[0]&&(C.left-=c/2),"bottom"===t.my[1]?C.top-=h:"center"===t.my[1]&&(C.top-=h/2),C.left+=L[0],C.top+=L[1],e.support.offsetFractions||(C.left=a(C.left),C.top=a(C.top)),i={marginLeft:d,marginTop:y},e.each(["left","top"],function(n,r){e.ui.position[S[n]]&&e.ui.position[S[n]][r](C,{targetWidth:p,targetHeight:v,elemWidth:c,elemHeight:h,collisionPosition:i,collisionWidth:T,collisionHeight:N,offset:[s[0]+L[0],s[1]+L[1]],my:t.my,at:t.at,within:w,elem:l})}),t.using&&(f=function(e){var n=m.left-C.left,r=n+p-c,i=m.top-C.top,s=i+v-h,a={target:{element:b,left:m.left,top:m.top,width:p,height:v},element:{element:l,left:C.left,top:C.top,width:c,height:h},horizontal:0>r?"left":n>0?"right":"center",vertical:0>s?"top":i>0?"bottom":"middle"};c>p&&p>u(n+r)&&(a.horizontal="center"),h>v&&v>u(i+s)&&(a.vertical="middle"),a.important=o(u(n),u(r))>o(u(i),u(s))?"horizontal":"vertical",t.using.call(this,e,a)}),l.offset(e.extend(C,{using:f}))})},e.ui.position={fit:{left:function(e,t){var n,r=t.within,i=r.isWindow?r.scrollLeft:r.offset.left,s=r.width,u=e.left-t.collisionPosition.marginLeft,a=i-u,f=u+t.collisionWidth-s-i;t.collisionWidth>s?a>0&&0>=f?(n=e.left+a+t.collisionWidth-s-i,e.left+=a-n):e.left=f>0&&0>=a?i:a>f?i+s-t.collisionWidth:i:a>0?e.left+=a:f>0?e.left-=f:e.left=o(e.left-u,e.left)},top:function(e,t){var n,r=t.within,i=r.isWindow?r.scrollTop:r.offset.top,s=t.within.height,u=e.top-t.collisionPosition.marginTop,a=i-u,f=u+t.collisionHeight-s-i;t.collisionHeight>s?a>0&&0>=f?(n=e.top+a+t.collisionHeight-s-i,e.top+=a-n):e.top=f>0&&0>=a?i:a>f?i+s-t.collisionHeight:i:a>0?e.top+=a:f>0?e.top-=f:e.top=o(e.top-u,e.top)}},flip:{left:function(e,t){var n,r,i=t.within,s=i.offset.left+i.scrollLeft,o=i.width,a=i.isWindow?i.scrollLeft:i.offset.left,f=e.left-t.collisionPosition.marginLeft,l=f-a,c=f+t.collisionWidth-o-a,h="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,d=-2*t.offset[0];0>l?(n=e.left+h+p+d+t.collisionWidth-o-s,(0>n||u(l)>n)&&(e.left+=h+p+d)):c>0&&(r=e.left-t.collisionPosition.marginLeft+h+p+d-a,(r>0||c>u(r))&&(e.left+=h+p+d))},top:function(e,t){var n,r,i=t.within,s=i.offset.top+i.scrollTop,o=i.height,a=i.isWindow?i.scrollTop:i.offset.top,f=e.top-t.collisionPosition.marginTop,l=f-a,c=f+t.collisionHeight-o-a,h="top"===t.my[1],p=h?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,d="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,v=-2*t.offset[1];0>l?(r=e.top+p+d+v+t.collisionHeight-o-s,e.top+p+d+v>l&&(0>r||u(l)>r)&&(e.top+=p+d+v)):c>0&&(n=e.top-t.collisionPosition.marginTop+p+d+v-a,e.top+p+d+v>c&&(n>0||c>u(n))&&(e.top+=p+d+v))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,n,r,i,s,o=document.getElementsByTagName("body")[0],u=document.createElement("div");t=document.createElement(o?"div":"body"),r={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},o&&e.extend(r,{position:"absolute",left:"-1000px",top:"-1000px"});for(s in r)t.style[s]=r[s];t.appendChild(u),n=o||document.documentElement,n.insertBefore(t,n.firstChild),u.style.cssText="position: absolute; left: 10.7432222px;",i=e(u).offset().left,e.support.offsetFractions=i>10&&11>i,t.innerHTML="",n.removeChild(t)}()}(jQuery),function(e){e.widget("ui.draggable",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var n=this.options;return this.helper||n.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(e(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){e("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,n){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!n){var r=this._uiHash();if(this._trigger("drag",t,r)===!1)return this._mouseUp({}),!1;this.position=r.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var n=this,r=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(r=e.ui.ddmanager.drop(this,t)),this.dropped&&(r=this.dropped,this.dropped=!1),"original"!==this.options.helper||e.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!r||"valid"===this.options.revert&&r||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,r)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){n._trigger("stop",t)!==!1&&n._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1):!1},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):"clone"===n.helper?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo("parent"===n.appendTo?this.element[0].parentNode:n.appendTo),r[0]===this.element[0]||/(fixed|absolute)/.test(r.css("position"))||r.css("position","absolute"),r},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,n,r,i=this.options;return i.containment?"window"===i.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],undefined):"document"===i.containment?(this.containment=[0,0,e(document).width()-this.helperProportions.width-this.margins.left,(e(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],undefined):i.containment.constructor===Array?(this.containment=i.containment,undefined):("parent"===i.containment&&(i.containment=this.helper[0].parentNode),n=e(i.containment),r=n[0],r&&(t="hidden"!==n.css("overflow"),this.containment=[(parseInt(n.css("borderLeftWidth"),10)||0)+(parseInt(n.css("paddingLeft"),10)||0),(parseInt(n.css("borderTopWidth"),10)||0)+(parseInt(n.css("paddingTop"),10)||0),(t?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(n.css("borderRightWidth"),10)||0)-(parseInt(n.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(n.css("borderBottomWidth"),10)||0)-(parseInt(n.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n),undefined):(this.containment=null,undefined)},_convertPositionTo:function(t,n){n||(n=this.position);var r="absolute"===t?1:-1,i="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:i.scrollTop(),left:i.scrollLeft()}),{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*r}},_generatePosition:function(t){var n,r,i,s,o=this.options,u="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=t.pageX,f=t.pageY;return this.offset.scroll||(this.offset.scroll={top:u.scrollTop(),left:u.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(r=this.relative_container.offset(),n=[this.containment[0]+r.left,this.containment[1]+r.top,this.containment[2]+r.left,this.containment[3]+r.top]):n=this.containment,t.pageX-this.offset.click.left<n[0]&&(a=n[0]+this.offset.click.left),t.pageY-this.offset.click.top<n[1]&&(f=n[1]+this.offset.click.top),t.pageX-this.offset.click.left>n[2]&&(a=n[2]+this.offset.click.left),t.pageY-this.offset.click.top>n[3]&&(f=n[3]+this.offset.click.top)),o.grid&&(i=o.grid[1]?this.originalPageY+Math.round((f-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,f=n?i-this.offset.click.top>=n[1]||i-this.offset.click.top>n[3]?i:i-this.offset.click.top>=n[1]?i-o.grid[1]:i+o.grid[1]:i,s=o.grid[0]?this.originalPageX+Math.round((a-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,a=n?s-this.offset.click.left>=n[0]||s-this.offset.click.left>n[2]?s:s-this.offset.click.left>=n[0]?s-o.grid[0]:s+o.grid[0]:s)),{top:f-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,n,r){return r=r||this._uiHash(),e.ui.plugin.call(this,t,[n,r]),"drag"===t&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,n,r)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n){var r=e(this).data("ui-draggable"),i=r.options,s=e.extend({},n,{item:r.element});r.sortables=[],e(i.connectToSortable).each(function(){var n=e.data(this,"ui-sortable");n&&!n.options.disabled&&(r.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",t,s))})},stop:function(t,n){var r=e(this).data("ui-draggable"),i=e.extend({},n,{item:r.element});e.each(r.sortables,function(){this.instance.isOver?(this.instance.isOver=0,r.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"===r.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,i))})},drag:function(t,n){var r=e(this).data("ui-draggable"),i=this;e.each(r.sortables,function(){var o=!1,u=this;this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(o=!0,e.each(r.sortables,function(){return this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this!==u&&this.instance._intersectsWith(this.instance.containerCache)&&e.contains(u.instance.element[0],this.instance.element[0])&&(o=!1),o})),o?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(i).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=r.offset.click.top,this.instance.offset.click.left=r.offset.click.left,this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top,r._trigger("toSortable",t),r.dropped=this.instance.element,r.currentItem=r.element,this.instance.fromOutside=r),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),r._trigger("fromSortable",t),r.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),n=e(this).data("ui-draggable").options;t.css("cursor")&&(n._cursor=t.css("cursor")),t.css("cursor",n.cursor)},stop:function(){var t=e(this).data("ui-draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,n){var r=e(n.helper),i=e(this).data("ui-draggable").options;r.css("opacity")&&(i._opacity=r.css("opacity")),r.css("opacity",i.opacity)},stop:function(t,n){var r=e(this).data("ui-draggable").options;r._opacity&&e(n.helper).css("opacity",r._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("ui-draggable");t.scrollParent[0]!==document&&"HTML"!==t.scrollParent[0].tagName&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var n=e(this).data("ui-draggable"),r=n.options,i=!1;n.scrollParent[0]!==document&&"HTML"!==n.scrollParent[0].tagName?(r.axis&&"x"===r.axis||(n.overflowOffset.top+n.scrollParent[0].offsetHeight-t.pageY<r.scrollSensitivity?n.scrollParent[0].scrollTop=i=n.scrollParent[0].scrollTop+r.scrollSpeed:t.pageY-n.overflowOffset.top<r.scrollSensitivity&&(n.scrollParent[0].scrollTop=i=n.scrollParent[0].scrollTop-r.scrollSpeed)),r.axis&&"y"===r.axis||(n.overflowOffset.left+n.scrollParent[0].offsetWidth-t.pageX<r.scrollSensitivity?n.scrollParent[0].scrollLeft=i=n.scrollParent[0].scrollLeft+r.scrollSpeed:t.pageX-n.overflowOffset.left<r.scrollSensitivity&&(n.scrollParent[0].scrollLeft=i=n.scrollParent[0].scrollLeft-r.scrollSpeed))):(r.axis&&"x"===r.axis||(t.pageY-e(document).scrollTop()<r.scrollSensitivity?i=e(document).scrollTop(e(document).scrollTop()-r.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<r.scrollSensitivity&&(i=e(document).scrollTop(e(document).scrollTop()+r.scrollSpeed))),r.axis&&"y"===r.axis||(t.pageX-e(document).scrollLeft()<r.scrollSensitivity?i=e(document).scrollLeft(e(document).scrollLeft()-r.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<r.scrollSensitivity&&(i=e(document).scrollLeft(e(document).scrollLeft()+r.scrollSpeed)))),i!==!1&&e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(n,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("ui-draggable"),n=t.options;t.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var n=e(this),r=n.offset();this!==t.element[0]&&t.snapElements.push({item:this,width:n.outerWidth(),height:n.outerHeight(),top:r.top,left:r.left})})},drag:function(t,n){var r,i,s,o,u,a,f,l,c,h,p=e(this).data("ui-draggable"),d=p.options,v=d.snapTolerance,m=n.offset.left,g=m+p.helperProportions.width,y=n.offset.top,b=y+p.helperProportions.height;for(c=p.snapElements.length-1;c>=0;c--)u=p.snapElements[c].left,a=u+p.snapElements[c].width,f=p.snapElements[c].top,l=f+p.snapElements[c].height,u-v>g||m>a+v||f-v>b||y>l+v||!e.contains(p.snapElements[c].item.ownerDocument,p.snapElements[c].item)?(p.snapElements[c].snapping&&p.options.snap.release&&p.options.snap.release.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[c].item})),p.snapElements[c].snapping=!1):("inner"!==d.snapMode&&(r=v>=Math.abs(f-b),i=v>=Math.abs(l-y),s=v>=Math.abs(u-g),o=v>=Math.abs(a-m),r&&(n.position.top=p._convertPositionTo("relative",{top:f-p.helperProportions.height,left:0}).top-p.margins.top),i&&(n.position.top=p._convertPositionTo("relative",{top:l,left:0}).top-p.margins.top),s&&(n.position.left=p._convertPositionTo("relative",{top:0,left:u-p.helperProportions.width}).left-p.margins.left),o&&(n.position.left=p._convertPositionTo("relative",{top:0,left:a}).left-p.margins.left)),h=r||i||s||o,"outer"!==d.snapMode&&(r=v>=Math.abs(f-y),i=v>=Math.abs(l-b),s=v>=Math.abs(u-m),o=v>=Math.abs(a-g),r&&(n.position.top=p._convertPositionTo("relative",{top:f,left:0}).top-p.margins.top),i&&(n.position.top=p._convertPositionTo("relative",{top:l-p.helperProportions.height,left:0}).top-p.margins.top),s&&(n.position.left=p._convertPositionTo("relative",{top:0,left:u}).left-p.margins.left),o&&(n.position.left=p._convertPositionTo("relative",{top:0,left:a-p.helperProportions.width}).left-p.margins.left)),!p.snapElements[c].snapping&&(r||i||s||o||h)&&p.options.snap.snap&&p.options.snap.snap.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[c].item})),p.snapElements[c].snapping=r||i||s||o||h)}}),e.ui.plugin.add("draggable","stack",{start:function(){var t,n=this.data("ui-draggable").options,r=e.makeArray(e(n.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)});r.length&&(t=parseInt(e(r[0]).css("zIndex"),10)||0,e(r).each(function(n){e(this).css("zIndex",t+n)}),this.css("zIndex",t+r.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,n){var r=e(n.helper),i=e(this).data("ui-draggable").options;r.css("zIndex")&&(i._zIndex=r.css("zIndex")),r.css("zIndex",i.zIndex)},stop:function(t,n){var r=e(this).data("ui-draggable").options;r._zIndex&&e(n.helper).css("zIndex",r._zIndex)}})}(jQuery),function(e){function t(e,t,n){return e>t&&t+n>e}e.widget("ui.droppable",{version:"1.10.3",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t=this.options,n=t.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(n)?n:function(e){return e.is(n)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[],e.ui.ddmanager.droppables[t.scope].push(this),t.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var t=0,n=e.ui.ddmanager.droppables[this.options.scope];n.length>t;t++)n[t]===this&&n.splice(t,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,n){"accept"===t&&(this.accept=e.isFunction(n)?n:function(e){return e.is(n)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),n&&this._trigger("activate",t,this.ui(n))},_deactivate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),n&&this._trigger("deactivate",t,this.ui(n))},_over:function(t){var n=e.ui.ddmanager.current;n&&(n.currentItem||n.element)[0]!==this.element[0]&&this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(n)))},_out:function(t){var n=e.ui.ddmanager.current;n&&(n.currentItem||n.element)[0]!==this.element[0]&&this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(n)))},_drop:function(t,n){var r=n||e.ui.ddmanager.current,i=!1;return r&&(r.currentItem||r.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"ui-droppable");return t.options.greedy&&!t.options.disabled&&t.options.scope===r.options.scope&&t.accept.call(t.element[0],r.currentItem||r.element)&&e.ui.intersect(r,e.extend(t,{offset:t.element.offset()}),t.options.tolerance)?(i=!0,!1):undefined}),i?!1:this.accept.call(this.element[0],r.currentItem||r.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(r)),this.element):!1):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(e,n,r){if(!n.offset)return!1;var i,s,o=(e.positionAbs||e.position.absolute).left,u=o+e.helperProportions.width,a=(e.positionAbs||e.position.absolute).top,f=a+e.helperProportions.height,l=n.offset.left,c=l+n.proportions.width,h=n.offset.top,p=h+n.proportions.height;switch(r){case"fit":return o>=l&&c>=u&&a>=h&&p>=f;case"intersect":return o+e.helperProportions.width/2>l&&c>u-e.helperProportions.width/2&&a+e.helperProportions.height/2>h&&p>f-e.helperProportions.height/2;case"pointer":return i=(e.positionAbs||e.position.absolute).left+(e.clickOffset||e.offset.click).left,s=(e.positionAbs||e.position.absolute).top+(e.clickOffset||e.offset.click).top,t(s,h,n.proportions.height)&&t(i,l,n.proportions.width);case"touch":return(a>=h&&p>=a||f>=h&&p>=f||h>a&&f>p)&&(o>=l&&c>=o||u>=l&&c>=u||l>o&&u>c);default:return!1}},e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,n){var r,i,s=e.ui.ddmanager.droppables[t.options.scope]||[],o=n?n.type:null,u=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(r=0;s.length>r;r++)if(!(s[r].options.disabled||t&&!s[r].accept.call(s[r].element[0],t.currentItem||t.element))){for(i=0;u.length>i;i++)if(u[i]===s[r].element[0]){s[r].proportions.height=0;continue e}s[r].visible="none"!==s[r].element.css("display"),s[r].visible&&("mousedown"===o&&s[r]._activate.call(s[r],n),s[r].offset=s[r].element.offset(),s[r].proportions={width:s[r].element[0].offsetWidth,height:s[r].element[0].offsetHeight})}},drop:function(t,n){var r=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(r=this._drop.call(this,n)||r),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,n)))}),r},dragStart:function(t,n){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)})},drag:function(t,n){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,n),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var r,s,o,u=e.ui.intersect(t,this,this.options.tolerance),a=!u&&this.isover?"isout":u&&!this.isover?"isover":null;a&&(this.options.greedy&&(s=this.options.scope,o=this.element.parents(":data(ui-droppable)").filter(function(){return e.data(this,"ui-droppable").options.scope===s}),o.length&&(r=e.data(o[0],"ui-droppable"),r.greedyChild="isover"===a)),r&&"isover"===a&&(r.isover=!1,r.isout=!0,r._out.call(r,n)),this[a]=!0,this["isout"===a?"isover":"isout"]=!1,this["isover"===a?"_over":"_out"].call(this,n),r&&"isout"===a&&(r.isout=!1,r.isover=!0,r._over.call(r,n)))}})},dragStop:function(t,n){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)}}}(jQuery),function(e){function t(e){return parseInt(e,10)||0}function n(e){return!isNaN(parseInt(e,10))}e.widget("ui.resizable",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var t,n,r,i,s,o=this,u=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!u.aspectRatio,aspectRatio:u.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:u.helper||u.ghost||u.animate?u.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=u.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},n=0;t.length>n;n++)r=e.trim(t[n]),s="ui-resizable-"+r,i=e("<div class='ui-resizable-handle "+s+"'></div>"),i.css({zIndex:u.zIndex}),"se"===r&&i.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[r]=".ui-resizable-"+r,this.element.append(i);this._renderAxis=function(t){var n,r,i,s;t=t||this.element;for(n in this.handles)this.handles[n].constructor===String&&(this.handles[n]=e(this.handles[n],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(r=e(this.handles[n],this.element),s=/sw|ne|nw|se|n|s/.test(n)?r.outerHeight():r.outerWidth(),i=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join(""),t.css(i,s),this._proportionallyResize()),e(this.handles[n]).length},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&&(i=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=i&&i[1]?i[1]:"se")}),u.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){u.disabled||(e(this).removeClass("ui-resizable-autohide"),o._handles.show())}).mouseleave(function(){u.disabled||o.resizing||(e(this).addClass("ui-resizable-autohide"),o._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,n=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(n(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),n(this.originalElement),this},_mouseCapture:function(t){var n,r,i=!1;for(n in this.handles)r=e(this.handles[n])[0],(r===t.target||e.contains(r,t.target))&&(i=!0);return!this.options.disabled&&i},_mouseStart:function(n){var r,i,s,o=this.options,u=this.element.position(),a=this.element;return this.resizing=!0,/absolute/.test(a.css("position"))?a.css({position:"absolute",top:a.css("top"),left:a.css("left")}):a.is(".ui-draggable")&&a.css({position:"absolute",top:u.top,left:u.left}),this._renderProxy(),r=t(this.helper.css("left")),i=t(this.helper.css("top")),o.containment&&(r+=e(o.containment).scrollLeft()||0,i+=e(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:r,top:i},this.size=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.originalPosition={left:r,top:i},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalMousePosition={left:n.pageX,top:n.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,s=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===s?this.axis+"-resize":s),a.addClass("ui-resizable-resizing"),this._propagate("start",n),!0},_mouseDrag:function(t){var n,r=this.helper,i={},s=this.originalMousePosition,o=this.axis,u=this.position.top,a=this.position.left,f=this.size.width,l=this.size.height,c=t.pageX-s.left||0,h=t.pageY-s.top||0,p=this._change[o];return p?(n=p.apply(this,[t,c,h]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(n=this._updateRatio(n,t)),n=this._respectSize(n,t),this._updateCache(n),this._propagate("resize",t),this.position.top!==u&&(i.top=this.position.top+"px"),this.position.left!==a&&(i.left=this.position.left+"px"),this.size.width!==f&&(i.width=this.size.width+"px"),this.size.height!==l&&(i.height=this.size.height+"px"),r.css(i),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(i)||this._trigger("resize",t,this.ui()),!1):!1},_mouseStop:function(t){this.resizing=!1;var n,r,i,s,o,u,a,f=this.options,l=this;return this._helper&&(n=this._proportionallyResizeElements,r=n.length&&/textarea/i.test(n[0].nodeName),i=r&&e.ui.hasScroll(n[0],"left")?0:l.sizeDiff.height,s=r?0:l.sizeDiff.width,o={width:l.helper.width()-s,height:l.helper.height()-i},u=parseInt(l.element.css("left"),10)+(l.position.left-l.originalPosition.left)||null,a=parseInt(l.element.css("top"),10)+(l.position.top-l.originalPosition.top)||null,f.animate||this.element.css(e.extend(o,{top:a,left:u})),l.helper.height(l.size.height),l.helper.width(l.size.width),this._helper&&!f.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,r,s,o,u,a=this.options;u={minWidth:n(a.minWidth)?a.minWidth:0,maxWidth:n(a.maxWidth)?a.maxWidth:1/0,minHeight:n(a.minHeight)?a.minHeight:0,maxHeight:n(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||e)&&(t=u.minHeight*this.aspectRatio,s=u.minWidth/this.aspectRatio,r=u.maxHeight*this.aspectRatio,o=u.maxWidth/this.aspectRatio,t>u.minWidth&&(u.minWidth=t),s>u.minHeight&&(u.minHeight=s),u.maxWidth>r&&(u.maxWidth=r),u.maxHeight>o&&(u.maxHeight=o)),this._vBoundaries=u},_updateCache:function(e){this.offset=this.helper.offset(),n(e.left)&&(this.position.left=e.left),n(e.top)&&(this.position.top=e.top),n(e.height)&&(this.size.height=e.height),n(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,r=this.size,s=this.axis;return n(e.height)?e.width=e.height*this.aspectRatio:n(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===s&&(e.left=t.left+(r.width-e.width),e.top=null),"nw"===s&&(e.top=t.top+(r.height-e.height),e.left=t.left+(r.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,r=this.axis,s=n(e.width)&&t.maxWidth&&t.maxWidth<e.width,o=n(e.height)&&t.maxHeight&&t.maxHeight<e.height,u=n(e.width)&&t.minWidth&&t.minWidth>e.width,a=n(e.height)&&t.minHeight&&t.minHeight>e.height,f=this.originalPosition.left+this.originalSize.width,l=this.position.top+this.size.height,c=/sw|nw|w/.test(r),h=/nw|ne|n/.test(r);return u&&(e.width=t.minWidth),a&&(e.height=t.minHeight),s&&(e.width=t.maxWidth),o&&(e.height=t.maxHeight),u&&c&&(e.left=f-t.minWidth),s&&c&&(e.left=f-t.maxWidth),a&&h&&(e.top=l-t.minHeight),o&&h&&(e.top=l-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var e,t,n,r,i,s=this.helper||this.element;for(e=0;this._proportionallyResizeElements.length>e;e++){if(i=this._proportionallyResizeElements[e],!this.borderDif)for(this.borderDif=[],n=[i.css("borderTopWidth"),i.css("borderRightWidth"),i.css("borderBottomWidth"),i.css("borderLeftWidth")],r=[i.css("paddingTop"),i.css("paddingRight"),i.css("paddingBottom"),i.css("paddingLeft")],t=0;n.length>t;t++)this.borderDif[t]=(parseInt(n[t],10)||0)+(parseInt(r[t],10)||0);i.css({height:s.height()-this.borderDif[0]-this.borderDif[2]||0,width:s.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var t=this.element,n=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++n.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var n=this.originalSize,r=this.originalPosition;return{left:r.left+t,width:n.width-t}},n:function(e,t,n){var r=this.originalSize,i=this.originalPosition;return{top:i.top+n,height:r.height-n}},s:function(e,t,n){return{height:this.originalSize.height+n}},se:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},sw:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,n,r]))},ne:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},nw:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,n,r]))}},_propagate:function(t,n){e.ui.plugin.call(this,t,[n,this.ui()]),"resize"!==t&&this._trigger(t,n,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var n=e(this).data("ui-resizable"),r=n.options,i=n._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),o=s&&e.ui.hasScroll(i[0],"left")?0:n.sizeDiff.height,u=s?0:n.sizeDiff.width,a={width:n.size.width-u,height:n.size.height-o},f=parseInt(n.element.css("left"),10)+(n.position.left-n.originalPosition.left)||null,l=parseInt(n.element.css("top"),10)+(n.position.top-n.originalPosition.top)||null;n.element.animate(e.extend(a,l&&f?{top:l,left:f}:{}),{duration:r.animateDuration,easing:r.animateEasing,step:function(){var r={width:parseInt(n.element.css("width"),10),height:parseInt(n.element.css("height"),10),top:parseInt(n.element.css("top"),10),left:parseInt(n.element.css("left"),10)};i&&i.length&&e(i[0]).css({width:r.width,height:r.height}),n._updateCache(r),n._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var n,r,i,s,o,u,a,f=e(this).data("ui-resizable"),l=f.options,c=f.element,h=l.containment,p=h instanceof e?h.get(0):/parent/.test(h)?c.parent().get(0):h;p&&(f.containerElement=e(p),/document/.test(h)||h===document?(f.containerOffset={left:0,top:0},f.containerPosition={left:0,top:0},f.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(n=e(p),r=[],e(["Top","Right","Left","Bottom"]).each(function(e,i){r[e]=t(n.css("padding"+i))}),f.containerOffset=n.offset(),f.containerPosition=n.position(),f.containerSize={height:n.innerHeight()-r[3],width:n.innerWidth()-r[1]},i=f.containerOffset,s=f.containerSize.height,o=f.containerSize.width,u=e.ui.hasScroll(p,"left")?p.scrollWidth:o,a=e.ui.hasScroll(p)?p.scrollHeight:s,f.parentData={element:p,left:i.left,top:i.top,width:u,height:a}))},resize:function(t){var n,r,i,s,o=e(this).data("ui-resizable"),u=o.options,a=o.containerOffset,f=o.position,l=o._aspectRatio||t.shiftKey,c={top:0,left:0},h=o.containerElement;h[0]!==document&&/static/.test(h.css("position"))&&(c=a),f.left<(o._helper?a.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-a.left:o.position.left-c.left),l&&(o.size.height=o.size.width/o.aspectRatio),o.position.left=u.helper?a.left:0),f.top<(o._helper?a.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-a.top:o.position.top),l&&(o.size.width=o.size.height*o.aspectRatio),o.position.top=o._helper?a.top:0),o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top,n=Math.abs((o._helper?o.offset.left-c.left:o.offset.left-c.left)+o.sizeDiff.width),r=Math.abs((o._helper?o.offset.top-c.top:o.offset.top-a.top)+o.sizeDiff.height),i=o.containerElement.get(0)===o.element.parent().get(0),s=/relative|absolute/.test(o.containerElement.css("position")),i&&s&&(n-=o.parentData.left),n+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-n,l&&(o.size.height=o.size.width/o.aspectRatio)),r+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-r,l&&(o.size.width=o.size.height*o.aspectRatio))},stop:function(){var t=e(this).data("ui-resizable"),n=t.options,r=t.containerOffset,i=t.containerPosition,s=t.containerElement,o=e(t.helper),u=o.offset(),a=o.outerWidth()-t.sizeDiff.width,f=o.outerHeight()-t.sizeDiff.height;t._helper&&!n.animate&&/relative/.test(s.css("position"))&&e(this).css({left:u.left-i.left-r.left,width:a,height:f}),t._helper&&!n.animate&&/static/.test(s.css("position"))&&e(this).css({left:u.left-i.left-r.left,width:a,height:f})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("ui-resizable"),n=t.options,r=function(t){e(t).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};"object"!=typeof n.alsoResize||n.alsoResize.parentNode?r(n.alsoResize):n.alsoResize.length?(n.alsoResize=n.alsoResize[0],r(n.alsoResize)):e.each(n.alsoResize,function(e){r(e)})},resize:function(t,n){var r=e(this).data("ui-resizable"),i=r.options,s=r.originalSize,o=r.originalPosition,u={height:r.size.height-s.height||0,width:r.size.width-s.width||0,top:r.position.top-o.top||0,left:r.position.left-o.left||0},a=function(t,r){e(t).each(function(){var t=e(this),i=e(this).data("ui-resizable-alsoresize"),s={},o=r&&r.length?r:t.parents(n.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(o,function(e,t){var n=(i[t]||0)+(u[t]||0);n&&n>=0&&(s[t]=n||null)}),t.css(s)})};"object"!=typeof i.alsoResize||i.alsoResize.nodeType?a(i.alsoResize):e.each(i.alsoResize,function(e,t){a(e,t)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("ui-resizable"),n=t.options,r=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:r.height,width:r.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof n.ghost?n.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).data("ui-resizable");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).data("ui-resizable");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t=e(this).data("ui-resizable"),n=t.options,r=t.size,i=t.originalSize,s=t.originalPosition,o=t.axis,u="number"==typeof n.grid?[n.grid,n.grid]:n.grid,a=u[0]||1,f=u[1]||1,l=Math.round((r.width-i.width)/a)*a,c=Math.round((r.height-i.height)/f)*f,h=i.width+l,p=i.height+c,d=n.maxWidth&&h>n.maxWidth,v=n.maxHeight&&p>n.maxHeight,m=n.minWidth&&n.minWidth>h,g=n.minHeight&&n.minHeight>p;n.grid=u,m&&(h+=a),g&&(p+=f),d&&(h-=a),v&&(p-=f),/^(se|s|e)$/.test(o)?(t.size.width=h,t.size.height=p):/^(ne)$/.test(o)?(t.size.width=h,t.size.height=p,t.position.top=s.top-c):/^(sw)$/.test(o)?(t.size.width=h,t.size.height=p,t.position.left=s.left-l):(t.size.width=h,t.size.height=p,t.position.top=s.top-c,t.position.left=s.left-l)}})}(jQuery),function(e){e.widget("ui.selectable",e.ui.mouse,{version:"1.10.3",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t,n=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){t=e(n.options.filter,n.element[0]),t.addClass("ui-selectee"),t.each(function(){var t=e(this),n=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:n.left,top:n.top,right:n.left+t.outerWidth(),bottom:n.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=t.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var n=this,r=this.options;this.opos=[t.pageX,t.pageY],this.options.disabled||(this.selectees=e(r.filter,this.element[0]),this._trigger("start",t),e(r.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),r.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var r=e.data(this,"selectable-item");r.startselected=!0,t.metaKey||t.ctrlKey||(r.$element.removeClass("ui-selected"),r.selected=!1,r.$element.addClass("ui-unselecting"),r.unselecting=!0,n._trigger("unselecting",t,{unselecting:r.element}))}),e(t.target).parents().addBack().each(function(){var r,s=e.data(this,"selectable-item");return s?(r=!t.metaKey&&!t.ctrlKey||!s.$element.hasClass("ui-selected"),s.$element.removeClass(r?"ui-unselecting":"ui-selected").addClass(r?"ui-selecting":"ui-unselecting"),s.unselecting=!r,s.selecting=r,s.selected=r,r?n._trigger("selecting",t,{selecting:s.element}):n._trigger("unselecting",t,{unselecting:s.element}),!1):undefined}))},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var n,r=this,i=this.options,s=this.opos[0],o=this.opos[1],u=t.pageX,a=t.pageY;return s>u&&(n=u,u=s,s=n),o>a&&(n=a,a=o,o=n),this.helper.css({left:s,top:o,width:u-s,height:a-o}),this.selectees.each(function(){var n=e.data(this,"selectable-item"),f=!1;n&&n.element!==r.element[0]&&("touch"===i.tolerance?f=!(n.left>u||s>n.right||n.top>a||o>n.bottom):"fit"===i.tolerance&&(f=n.left>s&&u>n.right&&n.top>o&&a>n.bottom),f?(n.selected&&(n.$element.removeClass("ui-selected"),n.selected=!1),n.unselecting&&(n.$element.removeClass("ui-unselecting"),n.unselecting=!1),n.selecting||(n.$element.addClass("ui-selecting"),n.selecting=!0,r._trigger("selecting",t,{selecting:n.element}))):(n.selecting&&((t.metaKey||t.ctrlKey)&&n.startselected?(n.$element.removeClass("ui-selecting"),n.selecting=!1,n.$element.addClass("ui-selected"),n.selected=!0):(n.$element.removeClass("ui-selecting"),n.selecting=!1,n.startselected&&(n.$element.addClass("ui-unselecting"),n.unselecting=!0),r._trigger("unselecting",t,{unselecting:n.element}))),n.selected&&(t.metaKey||t.ctrlKey||n.startselected||(n.$element.removeClass("ui-selected"),n.selected=!1,n.$element.addClass("ui-unselecting"),n.unselecting=!0,r._trigger("unselecting",t,{unselecting:n.element})))))}),!1}},_mouseStop:function(t){var n=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-unselecting"),r.unselecting=!1,r.startselected=!1,n._trigger("unselected",t,{unselected:r.element})}),e(".ui-selecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-selecting").addClass("ui-selected"),r.selecting=!1,r.selected=!0,r.startselected=!0,n._trigger("selected",t,{selected:r.element})}),this._trigger("stop",t),this.helper.remove(),!1}})}(jQuery),function(e){function t(e,t,n){return e>t&&t+n>e}function n(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}e.widget("ui.sortable",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===e.axis||n(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,n){"disabled"===t?(this.options[t]=n,this.widget().toggleClass("ui-sortable-disabled",!!n)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,n){var r=null,i=!1,s=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,s.widgetName+"-item")===s?(r=e(this),!1):undefined}),e.data(t.target,s.widgetName+"-item")===s&&(r=e(t.target)),r?!this.options.handle||n||(e(this.options.handle,r).find("*").addBack().each(function(){this===t.target&&(i=!0)}),i)?(this.currentItem=r,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(t,n,r){var i,s,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(s=this.document.find("body"),this.storedCursor=s.css("cursor"),s.css("cursor",o.cursor),this.storedStylesheet=e("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(s)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!r)for(i=this.containers.length-1;i>=0;i--)this.containers[i]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var n,r,i,s,o=this.options,u=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=u=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=u=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=u=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=u=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-e(document).scrollTop()<o.scrollSensitivity?u=e(document).scrollTop(e(document).scrollTop()-o.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<o.scrollSensitivity&&(u=e(document).scrollTop(e(document).scrollTop()+o.scrollSpeed)),t.pageX-e(document).scrollLeft()<o.scrollSensitivity?u=e(document).scrollLeft(e(document).scrollLeft()-o.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<o.scrollSensitivity&&(u=e(document).scrollLeft(e(document).scrollLeft()+o.scrollSpeed))),u!==!1&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),n=this.items.length-1;n>=0;n--)if(r=this.items[n],i=r.item[0],s=this._intersectsWithPointer(r),s&&r.instance===this.currentContainer&&i!==this.currentItem[0]&&this.placeholder[1===s?"next":"prev"]()[0]!==i&&!e.contains(this.placeholder[0],i)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],i):!0)){if(this.direction=1===s?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(r))break;this._rearrange(t,r),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,n){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var r=this,i=this.placeholder.offset(),s=this.options.axis,o={};s&&"x"!==s||(o.left=i.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),s&&"y"!==s||(o.top=i.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){r._clear(t)})}else this._clear(t,n);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},e(n).each(function(){var n=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);n&&r.push((t.key||n[1]+"[]")+"="+(t.key&&t.expression?n[1]:n[2]))}),!r.length&&t.key&&r.push(t.key+"="),r.join("&")},toArray:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},n.each(function(){r.push(e(t.item||this).attr(t.attribute||"id")||"")}),r},_intersectsWith:function(e){var t=this.positionAbs.left,n=t+this.helperProportions.width,r=this.positionAbs.top,i=r+this.helperProportions.height,s=e.left,o=s+e.width,u=e.top,a=u+e.height,f=this.offset.click.top,l=this.offset.click.left,c="x"===this.options.axis||r+f>u&&a>r+f,h="y"===this.options.axis||t+l>s&&o>t+l,p=c&&h;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:t+this.helperProportions.width/2>s&&o>n-this.helperProportions.width/2&&r+this.helperProportions.height/2>u&&a>i-this.helperProportions.height/2},_intersectsWithPointer:function(e){var n="x"===this.options.axis||t(this.positionAbs.top+this.offset.click.top,e.top,e.height),r="y"===this.options.axis||t(this.positionAbs.left+this.offset.click.left,e.left,e.width),i=n&&r,s=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return i?this.floating?o&&"right"===o||"down"===s?2:1:s&&("down"===s?2:1):!1},_intersectsWithSides:function(e){var n=t(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),r=t(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),i=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return this.floating&&s?"right"===s&&r||"left"===s&&!r:i&&("down"===i&&n||"up"===i&&!n)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var n,r,i,s,o=[],u=[],a=this._connectWith();if(a&&t)for(n=a.length-1;n>=0;n--)for(i=e(a[n]),r=i.length-1;r>=0;r--)s=e.data(i[r],this.widgetFullName),s&&s!==this&&!s.options.disabled&&u.push([e.isFunction(s.options.items)?s.options.items.call(s.element):e(s.options.items,s.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),s]);for(u.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),n=u.length-1;n>=0;n--)u[n][0].each(function(){o.push(this)});return e(o)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var n=0;t.length>n;n++)if(t[n]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var n,r,i,s,o,u,a,f,l=this.items,c=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],h=this._connectWith();if(h&&this.ready)for(n=h.length-1;n>=0;n--)for(i=e(h[n]),r=i.length-1;r>=0;r--)s=e.data(i[r],this.widgetFullName),s&&s!==this&&!s.options.disabled&&(c.push([e.isFunction(s.options.items)?s.options.items.call(s.element[0],t,{item:this.currentItem}):e(s.options.items,s.element),s]),this.containers.push(s));for(n=c.length-1;n>=0;n--)for(o=c[n][1],u=c[n][0],r=0,f=u.length;f>r;r++)a=e(u[r]),a.data(this.widgetName+"-item",o),l.push({item:a,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var n,r,i,s;for(n=this.items.length-1;n>=0;n--)r=this.items[n],r.instance!==this.currentContainer&&this.currentContainer&&r.item[0]!==this.currentItem[0]||(i=this.options.toleranceElement?e(this.options.toleranceElement,r.item):r.item,t||(r.width=i.outerWidth(),r.height=i.outerHeight()),s=i.offset(),r.left=s.left,r.top=s.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(n=this.containers.length-1;n>=0;n--)s=this.containers[n].element.offset(),this.containers[n].containerCache.left=s.left,this.containers[n].containerCache.top=s.top,this.containers[n].containerCache.width=this.containers[n].element.outerWidth(),this.containers[n].containerCache.height=this.containers[n].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var n,r=t.options;r.placeholder&&r.placeholder.constructor!==String||(n=r.placeholder,r.placeholder={element:function(){var r=t.currentItem[0].nodeName.toLowerCase(),s=e("<"+r+">",t.document[0]).addClass(n||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===r?t.currentItem.children().each(function(){e("<td>&#160;</td>",t.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(s)}):"img"===r&&s.attr("src",t.currentItem.attr("src")),n||s.css("visibility","hidden"),s},update:function(e,o){(!n||r.forcePlaceholderSize)&&(o.height()||o.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),o.width()||o.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(r.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),r.placeholder.update(t,t.placeholder)},_contactContainers:function(r){var s,o,u,a,f,l,c,h,p,d,v=null,m=null;for(s=this.containers.length-1;s>=0;s--)if(!e.contains(this.currentItem[0],this.containers[s].element[0]))if(this._intersectsWith(this.containers[s].containerCache)){if(v&&e.contains(this.containers[s].element[0],v.element[0]))continue;v=this.containers[s],m=s}else this.containers[s].containerCache.over&&(this.containers[s]._trigger("out",r,this._uiHash(this)),this.containers[s].containerCache.over=0);if(v)if(1===this.containers.length)this.containers[m].containerCache.over||(this.containers[m]._trigger("over",r,this._uiHash(this)),this.containers[m].containerCache.over=1);else{for(u=1e4,a=null,d=v.floating||n(this.currentItem),f=d?"left":"top",l=d?"width":"height",c=this.positionAbs[f]+this.offset.click[f],o=this.items.length-1;o>=0;o--)e.contains(this.containers[m].element[0],this.items[o].item[0])&&this.items[o].item[0]!==this.currentItem[0]&&(!d||t(this.positionAbs.top+this.offset.click.top,this.items[o].top,this.items[o].height))&&(h=this.items[o].item.offset()[f],p=!1,Math.abs(h-c)>Math.abs(h+this.items[o][l]-c)&&(p=!0,h+=this.items[o][l]),u>Math.abs(h-c)&&(u=Math.abs(h-c),a=this.items[o],this.direction=p?"up":"down"));if(!a&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[m])return;a?this._rearrange(r,a,null,!0):this._rearrange(r,null,this.containers[m].element,!0),this._trigger("change",r,this._uiHash()),this.containers[m]._trigger("change",r,this._uiHash(this)),this.currentContainer=this.containers[m],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[m]._trigger("over",r,this._uiHash(this)),this.containers[m].containerCache.over=1}},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t,this.currentItem])):"clone"===n.helper?this.currentItem.clone():this.currentItem;return r.parents("body").length||e("parent"!==n.appendTo?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!r[0].style.width||n.forceHelperSize)&&r.width(this.currentItem.width()),(!r[0].style.height||n.forceHelperSize)&&r.height(this.currentItem.height()),r},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,n,r,i=this.options;"parent"===i.containment&&(i.containment=this.helper[0].parentNode),("document"===i.containment||"window"===i.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"===i.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"===i.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(i.containment)||(t=e(i.containment)[0],n=e(i.containment).offset(),r="hidden"!==e(t).css("overflow"),this.containment=[n.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,n.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,n.left+(r?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,n.top+(r?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,n){n||(n=this.position);var r="absolute"===t?1:-1,i="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,s=/(html|body)/i.test(i[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():s?0:i.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():s?0:i.scrollLeft())*r}},_generatePosition:function(t){var n,r,i=this.options,s=t.pageX,o=t.pageY,u="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(u[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(s=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(s=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),i.grid&&(n=this.originalPageY+Math.round((o-this.originalPageY)/i.grid[1])*i.grid[1],o=this.containment?n-this.offset.click.top>=this.containment[1]&&n-this.offset.click.top<=this.containment[3]?n:n-this.offset.click.top>=this.containment[1]?n-i.grid[1]:n+i.grid[1]:n,r=this.originalPageX+Math.round((s-this.originalPageX)/i.grid[0])*i.grid[0],s=this.containment?r-this.offset.click.left>=this.containment[0]&&r-this.offset.click.left<=this.containment[2]?r:r-this.offset.click.left>=this.containment[0]?r-i.grid[0]:r+i.grid[0]:r)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():a?0:u.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():a?0:u.scrollLeft())}},_rearrange:function(e,t,n,r){n?n[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var i=this.counter;this._delay(function(){i===this.counter&&this.refreshPositions(!r)})},_clear:function(e,t){this.reverting=!1;var n,r=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(n in this._storedCSS)("auto"===this._storedCSS[n]||"static"===this._storedCSS[n])&&(this._storedCSS[n]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&r.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||r.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(r.push(function(e){this._trigger("remove",e,this._uiHash())}),r.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),r.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),n=this.containers.length-1;n>=0;n--)t||r.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[n])),this.containers[n].containerCache.over&&(r.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[n])),this.containers[n].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!t){for(this._trigger("beforeStop",e,this._uiHash()),n=0;r.length>n;n++)r[n].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!1}if(t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!t){for(n=0;r.length>n;n++)r[n].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var n=t||this;return{helper:n.helper,placeholder:n.placeholder||e([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:t?t.element:null}}})}(jQuery),function(e){var t=5;e.widget("ui.slider",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,n,r=this.options,i=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),s="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",o=[];for(n=r.values&&r.values.length||1,i.length>n&&(i.slice(n).remove(),i=i.slice(0,n)),t=i.length;n>t;t++)o.push(s);this.handles=i.add(e(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)})},_createRange:function(){var t=this.options,n="";t.range?(t.range===!0&&(t.values?t.values.length&&2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=e("<div></div>").appendTo(this.element),n="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(n+("min"===t.range||"max"===t.range?" ui-slider-range-"+t.range:""))):this.range=e([])},_setupEvents:function(){var e=this.handles.add(this.range).filter("a");this._off(e),this._on(e,this._handleEvents),this._hoverable(e),this._focusable(e)},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var n,r,i,s,o,u,a,f,l=this,c=this.options;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),n={x:t.pageX,y:t.pageY},r=this._normValueFromMouse(n),i=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var n=Math.abs(r-l.values(t));(i>n||i===n&&(t===l._lastChangedValue||l.values(t)===c.min))&&(i=n,s=e(this),o=t)}),u=this._start(t,o),u===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,s.addClass("ui-state-active").focus(),a=s.offset(),f=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=f?{left:0,top:0}:{left:t.pageX-a.left-s.width()/2,top:t.pageY-a.top-s.height()/2-(parseInt(s.css("borderTopWidth"),10)||0)-(parseInt(s.css("borderBottomWidth"),10)||0)+(parseInt(s.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,r),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,n),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,n,r,i,s;return"horizontal"===this.orientation?(t=this.elementSize.width,n=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,n=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),r=n/t,r>1&&(r=1),0>r&&(r=0),"vertical"===this.orientation&&(r=1-r),i=this._valueMax()-this._valueMin(),s=this._valueMin()+r*i,this._trimAlignValue(s)},_start:function(e,t){var n={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("start",e,n)},_slide:function(e,t,n){var r,i,s;this.options.values&&this.options.values.length?(r=this.values(t?0:1),2===this.options.values.length&&this.options.range===!0&&(0===t&&n>r||1===t&&r>n)&&(n=r),n!==this.values(t)&&(i=this.values(),i[t]=n,s=this._trigger("slide",e,{handle:this.handles[t],value:n,values:i}),r=this.values(t?0:1),s!==!1&&this.values(t,n,!0))):n!==this.value()&&(s=this._trigger("slide",e,{handle:this.handles[t],value:n}),s!==!1&&this.value(n))},_stop:function(e,t){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("stop",e,n)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,n)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0),undefined):this._value()},values:function(t,n){var r,i,s;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(n),this._refreshValue(),this._change(null,t),undefined;if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(r=this.options.values,i=arguments[0],s=0;r.length>s;s+=1)r[s]=this._trimAlignValue(i[s]),this._change(null,s);this._refreshValue()},_setOption:function(t,n){var r,i=0;switch("range"===t&&this.options.range===!0&&("min"===n?(this.options.value=this._values(0),this.options.values=null):"max"===n&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(i=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments),t){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),r=0;i>r;r+=1)this._change(null,r);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,n,r;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);if(this.options.values&&this.options.values.length){for(n=this.options.values.slice(),r=0;n.length>r;r+=1)n[r]=this._trimAlignValue(n[r]);return n}return[]},_trimAlignValue:function(e){if(this._valueMin()>=e)return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,n=(e-this._valueMin())%t,r=e-n;return 2*Math.abs(n)>=t&&(r+=n>0?t:-t),parseFloat(r.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,n,r,i,s,o=this.options.range,u=this.options,a=this,f=this._animateOff?!1:u.animate,l={};this.options.values&&this.options.values.length?this.handles.each(function(r){n=100*((a.values(r)-a._valueMin())/(a._valueMax()-a._valueMin())),l["horizontal"===a.orientation?"left":"bottom"]=n+"%",e(this).stop(1,1)[f?"animate":"css"](l,u.animate),a.options.range===!0&&("horizontal"===a.orientation?(0===r&&a.range.stop(1,1)[f?"animate":"css"]({left:n+"%"},u.animate),1===r&&a.range[f?"animate":"css"]({width:n-t+"%"},{queue:!1,duration:u.animate})):(0===r&&a.range.stop(1,1)[f?"animate":"css"]({bottom:n+"%"},u.animate),1===r&&a.range[f?"animate":"css"]({height:n-t+"%"},{queue:!1,duration:u.animate}))),t=n}):(r=this.value(),i=this._valueMin(),s=this._valueMax(),n=s!==i?100*((r-i)/(s-i)):0,l["horizontal"===this.orientation?"left":"bottom"]=n+"%",this.handle.stop(1,1)[f?"animate":"css"](l,u.animate),"min"===o&&"horizontal"===this.orientation&&this.range.stop(1,1)[f?"animate":"css"]({width:n+"%"},u.animate),"max"===o&&"horizontal"===this.orientation&&this.range[f?"animate":"css"]({width:100-n+"%"},{queue:!1,duration:u.animate}),"min"===o&&"vertical"===this.orientation&&this.range.stop(1,1)[f?"animate":"css"]({height:n+"%"},u.animate),"max"===o&&"vertical"===this.orientation&&this.range[f?"animate":"css"]({height:100-n+"%"},{queue:!1,duration:u.animate}))},_handleEvents:{keydown:function(n){var r,i,s,o,u=e(n.target).data("ui-slider-handle-index");switch(n.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(n.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(n.target).addClass("ui-state-active"),r=this._start(n,u),r===!1))return}switch(o=this.options.step,i=s=this.options.values&&this.options.values.length?this.values(u):this.value(),n.keyCode){case e.ui.keyCode.HOME:s=this._valueMin();break;case e.ui.keyCode.END:s=this._valueMax();break;case e.ui.keyCode.PAGE_UP:s=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/t);break;case e.ui.keyCode.PAGE_DOWN:s=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/t);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(i===this._valueMax())return;s=this._trimAlignValue(i+o);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i===this._valueMin())return;s=this._trimAlignValue(i-o)}this._slide(n,u,s)},click:function(e){e.preventDefault()},keyup:function(t){var n=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,n),this._change(t,n),e(t.target).removeClass("ui-state-active"))}}})}(jQuery),function(e,t){var n="ui-effects-";e.effects={effect:{}},function(e,t){function n(e,t,n){var r=c[t.type]||{};return null==e?n||!t.def?null:t.def:(e=r.floor?~~e:parseFloat(e),isNaN(e)?t.def:r.mod?(e+r.mod)%r.mod:0>e?0:e>r.max?r.max:e)}function r(n){var r=f(),i=r._rgba=[];return n=n.toLowerCase(),d(a,function(e,s){var o,u=s.re.exec(n),a=u&&s.parse(u),f=s.space||"rgba";return a?(o=r[f](a),r[l[f].cache]=o[l[f].cache],i=r._rgba=o._rgba,!1):t}),i.length?("0,0,0,0"===i.join()&&e.extend(i,s.transparent),r):s[n]}function i(e,t,n){return n=(n+1)%1,1>6*n?e+6*(t-e)*n:1>2*n?t:2>3*n?e+6*(t-e)*(2/3-n):e}var s,o="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",u=/^([\-+])=\s*(\d+\.?\d*)/,a=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],f=e.Color=function(t,n,r,i){return new e.Color.fn.parse(t,n,r,i)},l={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},c={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},h=f.support={},p=e("<p>")[0],d=e.each;p.style.cssText="background-color:rgba(1,1,1,.5)",h.rgba=p.style.backgroundColor.indexOf("rgba")>-1,d(l,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),f.fn=e.extend(f.prototype,{parse:function(i,o,u,a){if(i===t)return this._rgba=[null,null,null,null],this;(i.jquery||i.nodeType)&&(i=e(i).css(o),o=t);var c=this,h=e.type(i),p=this._rgba=[];return o!==t&&(i=[i,o,u,a],h="array"),"string"===h?this.parse(r(i)||s._default):"array"===h?(d(l.rgba.props,function(e,t){p[t.idx]=n(i[t.idx],t)}),this):"object"===h?(i instanceof f?d(l,function(e,t){i[t.cache]&&(c[t.cache]=i[t.cache].slice())}):d(l,function(t,r){var s=r.cache;d(r.props,function(e,t){if(!c[s]&&r.to){if("alpha"===e||null==i[e])return;c[s]=r.to(c._rgba)}c[s][t.idx]=n(i[e],t,!0)}),c[s]&&0>e.inArray(null,c[s].slice(0,3))&&(c[s][3]=1,r.from&&(c._rgba=r.from(c[s])))}),this):t},is:function(e){var n=f(e),r=!0,i=this;return d(l,function(e,s){var o,u=n[s.cache];return u&&(o=i[s.cache]||s.to&&s.to(i._rgba)||[],d(s.props,function(e,n){return null!=u[n.idx]?r=u[n.idx]===o[n.idx]:t})),r}),r},_space:function(){var e=[],t=this;return d(l,function(n,r){t[r.cache]&&e.push(n)}),e.pop()},transition:function(e,t){var r=f(e),i=r._space(),s=l[i],o=0===this.alpha()?f("transparent"):this,u=o[s.cache]||s.to(o._rgba),a=u.slice();return r=r[s.cache],d(s.props,function(e,i){var s=i.idx,o=u[s],f=r[s],l=c[i.type]||{};null!==f&&(null===o?a[s]=f:(l.mod&&(f-o>l.mod/2?o+=l.mod:o-f>l.mod/2&&(o-=l.mod)),a[s]=n((f-o)*t+o,i)))}),this[i](a)},blend:function(t){if(1===this._rgba[3])return this;var n=this._rgba.slice(),r=n.pop(),i=f(t)._rgba;return f(e.map(n,function(e,t){return(1-r)*i[t]+r*e}))},toRgbaString:function(){var t="rgba(",n=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===n[3]&&(n.pop(),t="rgb("),t+n.join()+")"},toHslaString:function(){var t="hsla(",n=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&3>t&&(e=Math.round(100*e)+"%"),e});return 1===n[3]&&(n.pop(),t="hsl("),t+n.join()+")"},toHexString:function(t){var n=this._rgba.slice(),r=n.pop();return t&&n.push(~~(255*r)),"#"+e.map(n,function(e){return e=(e||0).toString(16),1===e.length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),f.fn.parse.prototype=f.fn,l.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,n,r=e[0]/255,i=e[1]/255,s=e[2]/255,o=e[3],u=Math.max(r,i,s),a=Math.min(r,i,s),f=u-a,l=u+a,c=.5*l;return t=a===u?0:r===u?60*(i-s)/f+360:i===u?60*(s-r)/f+120:60*(r-i)/f+240,n=0===f?0:.5>=c?f/l:f/(2-l),[Math.round(t)%360,n,c,null==o?1:o]},l.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,n=e[1],r=e[2],s=e[3],o=.5>=r?r*(1+n):r+n-r*n,u=2*r-o;return[Math.round(255*i(u,o,t+1/3)),Math.round(255*i(u,o,t)),Math.round(255*i(u,o,t-1/3)),s]},d(l,function(r,i){var s=i.props,o=i.cache,a=i.to,l=i.from;f.fn[r]=function(r){if(a&&!this[o]&&(this[o]=a(this._rgba)),r===t)return this[o].slice();var i,u=e.type(r),c="array"===u||"object"===u?r:arguments,h=this[o].slice();return d(s,function(e,t){var r=c["object"===u?e:t.idx];null==r&&(r=h[t.idx]),h[t.idx]=n(r,t)}),l?(i=f(l(h)),i[o]=h,i):f(h)},d(s,function(t,n){f.fn[t]||(f.fn[t]=function(i){var s,o=e.type(i),a="alpha"===t?this._hsla?"hsla":"rgba":r,f=this[a](),l=f[n.idx];return"undefined"===o?l:("function"===o&&(i=i.call(this,l),o=e.type(i)),null==i&&n.empty?this:("string"===o&&(s=u.exec(i),s&&(i=l+parseFloat(s[2])*("+"===s[1]?1:-1))),f[n.idx]=i,this[a](f)))})})}),f.hook=function(t){var n=t.split(" ");d(n,function(t,n){e.cssHooks[n]={set:function(t,i){var s,o,u="";if("transparent"!==i&&("string"!==e.type(i)||(s=r(i)))){if(i=f(s||i),!h.rgba&&1!==i._rgba[3]){for(o="backgroundColor"===n?t.parentNode:t;(""===u||"transparent"===u)&&o&&o.style;)try{u=e.css(o,"backgroundColor"),o=o.parentNode}catch(a){}i=i.blend(u&&"transparent"!==u?u:"_default")}i=i.toRgbaString()}try{t.style[n]=i}catch(a){}}},e.fx.step[n]=function(t){t.colorInit||(t.start=f(t.elem,n),t.end=f(t.end),t.colorInit=!0),e.cssHooks[n].set(t.elem,t.start.transition(t.end,t.pos))}})},f.hook(o),e.cssHooks.borderColor={expand:function(e){var t={};return d(["Top","Right","Bottom","Left"],function(n,r){t["border"+r+"Color"]=e}),t}},s=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){function n(t){var n,r,i=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,s={};if(i&&i.length&&i[0]&&i[i[0]])for(r=i.length;r--;)n=i[r],"string"==typeof i[n]&&(s[e.camelCase(n)]=i[n]);else for(n in i)"string"==typeof i[n]&&(s[n]=i[n]);return s}function r(t,n){var r,i,o={};for(r in n)i=n[r],t[r]!==i&&(s[r]||(e.fx.step[r]||!isNaN(parseFloat(i)))&&(o[r]=i));return o}var i=["add","remove","toggle"],s={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,n){e.fx.step[n]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(jQuery.style(e.elem,n,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(t,s,o,u){var a=e.speed(s,o,u);return this.queue(function(){var s,o=e(this),u=o.attr("class")||"",f=a.children?o.find("*").addBack():o;f=f.map(function(){var t=e(this);return{el:t,start:n(this)}}),s=function(){e.each(i,function(e,n){t[n]&&o[n+"Class"](t[n])})},s(),f=f.map(function(){return this.end=n(this.el[0]),this.diff=r(this.start,this.end),this}),o.attr("class",u),f=f.map(function(){var t=this,n=e.Deferred(),r=e.extend({},a,{queue:!1,complete:function(){n.resolve(t)}});return this.el.animate(this.diff,r),n.promise()}),e.when.apply(e,f.get()).done(function(){s(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),a.complete.call(o[0])})})},e.fn.extend({addClass:function(t){return function(n,r,i,s){return r?e.effects.animateClass.call(this,{add:n},r,i,s):t.apply(this,arguments)}}(e.fn.addClass),removeClass:function(t){return function(n,r,i,s){return arguments.length>1?e.effects.animateClass.call(this,{remove:n},r,i,s):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(n){return function(r,i,s,o,u){return"boolean"==typeof i||i===t?s?e.effects.animateClass.call(this,i?{add:r}:{remove:r},s,o,u):n.apply(this,arguments):e.effects.animateClass.call(this,{toggle:r},i,s,o)}}(e.fn.toggleClass),switchClass:function(t,n,r,i,s){return e.effects.animateClass.call(this,{add:n,remove:t},r,i,s)}})}(),function(){function r(t,n,r,i){return e.isPlainObject(t)&&(n=t,t=t.effect),t={effect:t},null==n&&(n={}),e.isFunction(n)&&(i=n,r=null,n={}),("number"==typeof n||e.fx.speeds[n])&&(i=r,r=n,n={}),e.isFunction(r)&&(i=r,r=null),n&&e.extend(t,n),r=r||n.duration,t.duration=e.fx.off?0:"number"==typeof r?r:r in e.fx.speeds?e.fx.speeds[r]:e.fx.speeds._default,t.complete=i||n.complete,t}function s(t){return!t||"number"==typeof t||e.fx.speeds[t]?!0:"string"!=typeof t||e.effects.effect[t]?e.isFunction(t)?!0:"object"!=typeof t||t.effect?!1:!0:!0}e.extend(e.effects,{version:"1.10.3",save:function(e,t){for(var r=0;t.length>r;r++)null!==t[r]&&e.data(n+t[r],e[0].style[t[r]])},restore:function(e,r){var s,o;for(o=0;r.length>o;o++)null!==r[o]&&(s=e.data(n+r[o]),s===t&&(s=""),e.css(r[o],s))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var n,r;switch(e[0]){case"top":n=0;break;case"middle":n=.5;break;case"bottom":n=1;break;default:n=e[0]/t.height}switch(e[1]){case"left":r=0;break;case"center":r=.5;break;case"right":r=1;break;default:r=e[1]/t.width}return{x:r,y:n}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var n={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},r=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),i={width:t.width(),height:t.height()},s=document.activeElement;try{s.id}catch(o){s=document.body}return t.wrap(r),(t[0]===s||e.contains(t[0],s))&&e(s).focus(),r=t.parent(),"static"===t.css("position")?(r.css({position:"relative"}),t.css({position:"relative"})):(e.extend(n,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,r){n[r]=t.css(r),isNaN(parseInt(n[r],10))&&(n[r]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(i),r.css(n).show()},removeWrapper:function(t){var n=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===n||e.contains(t[0],n))&&e(n).focus()),t},setTransition:function(t,n,r,i){return i=i||{},e.each(n,function(e,n){var s=t.cssUnit(n);s[0]>0&&(i[n]=s[0]*r+s[1])}),i}}),e.fn.extend({effect:function(){function t(t){function r(){e.isFunction(s)&&s.call(i[0]),e.isFunction(t)&&t()}var i=e(this),s=n.complete,u=n.mode;(i.is(":hidden")?"hide"===u:"show"===u)?(i[u](),r()):o.call(i[0],n,r)}var n=r.apply(this,arguments),i=n.mode,s=n.queue,o=e.effects.effect[n.effect];return e.fx.off||!o?i?this[i](n.duration,n.complete):this.each(function(){n.complete&&n.complete.call(this)}):s===!1?this.each(t):this.queue(s||"fx",t)},show:function(e){return function(t){if(s(t))return e.apply(this,arguments);var n=r.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(e.fn.show),hide:function(e){return function(t){if(s(t))return e.apply(this,arguments);var n=r.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(e.fn.hide),toggle:function(e){return function(t){if(s(t)||"boolean"==typeof t)return e.apply(this,arguments);var n=r.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(e.fn.toggle),cssUnit:function(t){var n=this.css(t),r=[];return e.each(["em","px","%","pt"],function(e,t){n.indexOf(t)>0&&(r=[parseFloat(n),t])}),r}})}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,n){t[n]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,n=4;((t=Math.pow(2,--n))-1)/11>e;);return 1/Math.pow(4,3-n)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,n){e.easing["easeIn"+t]=n,e.easing["easeOut"+t]=function(e){return 1-n(1-e)},e.easing["easeInOut"+t]=function(e){return.5>e?n(2*e)/2:1-n(-2*e+2)/2}})}()}(jQuery),function(e){var t=/up|down|vertical/,n=/up|left|vertical|horizontal/;e.effects.effect.blind=function(r,s){var o,u,a,f=e(this),l=["position","top","bottom","left","right","height","width"],c=e.effects.setMode(f,r.mode||"hide"),h=r.direction||"up",p=t.test(h),d=p?"height":"width",v=p?"top":"left",m=n.test(h),g={},y="show"===c;f.parent().is(".ui-effects-wrapper")?e.effects.save(f.parent(),l):e.effects.save(f,l),f.show(),o=e.effects.createWrapper(f).css({overflow:"hidden"}),u=o[d](),a=parseFloat(o.css(v))||0,g[d]=y?u:0,m||(f.css(p?"bottom":"right",0).css(p?"top":"left","auto").css({position:"absolute"}),g[v]=y?a:u+a),y&&(o.css(d,0),m||o.css(v,a+u)),o.animate(g,{duration:r.duration,easing:r.easing,queue:!1,complete:function(){"hide"===c&&f.hide(),e.effects.restore(f,l),e.effects.removeWrapper(f),s()}})}}(jQuery),function(e){e.effects.effect.bounce=function(n,r){var i,s,o,u=e(this),a=["position","top","bottom","left","right","height","width"],f=e.effects.setMode(u,n.mode||"effect"),l="hide"===f,c="show"===f,h=n.direction||"up",p=n.distance,d=n.times||5,v=2*d+(c||l?1:0),m=n.duration/v,g=n.easing,y="up"===h||"down"===h?"top":"left",b="up"===h||"left"===h,w=u.queue(),E=w.length;for((c||l)&&a.push("opacity"),e.effects.save(u,a),u.show(),e.effects.createWrapper(u),p||(p=u["top"===y?"outerHeight":"outerWidth"]()/3),c&&(o={opacity:1},o[y]=0,u.css("opacity",0).css(y,b?2*-p:2*p).animate(o,m,g)),l&&(p/=Math.pow(2,d-1)),o={},o[y]=0,i=0;d>i;i++)s={},s[y]=(b?"-=":"+=")+p,u.animate(s,m,g).animate(o,m,g),p=l?2*p:p/2;l&&(s={opacity:0},s[y]=(b?"-=":"+=")+p,u.animate(s,m,g)),u.queue(function(){l&&u.hide(),e.effects.restore(u,a),e.effects.removeWrapper(u),r()}),E>1&&w.splice.apply(w,[1,0].concat(w.splice(E,v+1))),u.dequeue()}}(jQuery),function(e){e.effects.effect.clip=function(n,r){var i,s,o,u=e(this),a=["position","top","bottom","left","right","height","width"],f=e.effects.setMode(u,n.mode||"hide"),l="show"===f,c=n.direction||"vertical",h="vertical"===c,p=h?"height":"width",d=h?"top":"left",v={};e.effects.save(u,a),u.show(),i=e.effects.createWrapper(u).css({overflow:"hidden"}),s="IMG"===u[0].tagName?i:u,o=s[p](),l&&(s.css(p,0),s.css(d,o/2)),v[p]=l?o:0,v[d]=l?0:o/2,s.animate(v,{queue:!1,duration:n.duration,easing:n.easing,complete:function(){l||u.hide(),e.effects.restore(u,a),e.effects.removeWrapper(u),r()}})}}(jQuery),function(e){e.effects.effect.drop=function(n,r){var i,s=e(this),o=["position","top","bottom","left","right","opacity","height","width"],u=e.effects.setMode(s,n.mode||"hide"),a="show"===u,f=n.direction||"left",l="up"===f||"down"===f?"top":"left",c="up"===f||"left"===f?"pos":"neg",h={opacity:a?1:0};e.effects.save(s,o),s.show(),e.effects.createWrapper(s),i=n.distance||s["top"===l?"outerHeight":"outerWidth"](!0)/2,a&&s.css("opacity",0).css(l,"pos"===c?-i:i),h[l]=(a?"pos"===c?"+=":"-=":"pos"===c?"-=":"+=")+i,s.animate(h,{queue:!1,duration:n.duration,easing:n.easing,complete:function(){"hide"===u&&s.hide(),e.effects.restore(s,o),e.effects.removeWrapper(s),r()}})}}(jQuery),function(e){e.effects.effect.explode=function(n,r){function i(){w.push(this),w.length===h*p&&s()}function s(){d.css({visibility:"visible"}),e(w).remove(),m||d.hide(),r()}var o,u,a,f,l,c,h=n.pieces?Math.round(Math.sqrt(n.pieces)):3,p=h,d=e(this),v=e.effects.setMode(d,n.mode||"hide"),m="show"===v,g=d.show().css("visibility","hidden").offset(),y=Math.ceil(d.outerWidth()/p),b=Math.ceil(d.outerHeight()/h),w=[];for(o=0;h>o;o++)for(f=g.top+o*b,c=o-(h-1)/2,u=0;p>u;u++)a=g.left+u*y,l=u-(p-1)/2,d.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-u*y,top:-o*b}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:y,height:b,left:a+(m?l*y:0),top:f+(m?c*b:0),opacity:m?0:1}).animate({left:a+(m?0:l*y),top:f+(m?0:c*b),opacity:m?1:0},n.duration||500,n.easing,i)}}(jQuery),function(e){e.effects.effect.fade=function(n,r){var i=e(this),s=e.effects.setMode(i,n.mode||"toggle");i.animate({opacity:s},{queue:!1,duration:n.duration,easing:n.easing,complete:r})}}(jQuery),function(e){e.effects.effect.fold=function(n,r){var i,s,o=e(this),u=["position","top","bottom","left","right","height","width"],a=e.effects.setMode(o,n.mode||"hide"),f="show"===a,l="hide"===a,c=n.size||15,h=/([0-9]+)%/.exec(c),p=!!n.horizFirst,d=f!==p,v=d?["width","height"]:["height","width"],m=n.duration/2,g={},y={};e.effects.save(o,u),o.show(),i=e.effects.createWrapper(o).css({overflow:"hidden"}),s=d?[i.width(),i.height()]:[i.height(),i.width()],h&&(c=parseInt(h[1],10)/100*s[l?0:1]),f&&i.css(p?{height:0,width:c}:{height:c,width:0}),g[v[0]]=f?s[0]:c,y[v[1]]=f?s[1]:0,i.animate(g,m,n.easing).animate(y,m,n.easing,function(){l&&o.hide(),e.effects.restore(o,u),e.effects.removeWrapper(o),r()})}}(jQuery),function(e){e.effects.effect.highlight=function(n,r){var i=e(this),s=["backgroundImage","backgroundColor","opacity"],o=e.effects.setMode(i,n.mode||"show"),u={backgroundColor:i.css("backgroundColor")};"hide"===o&&(u.opacity=0),e.effects.save(i,s),i.show().css({backgroundImage:"none",backgroundColor:n.color||"#ffff99"}).animate(u,{queue:!1,duration:n.duration,easing:n.easing,complete:function(){"hide"===o&&i.hide(),e.effects.restore(i,s),r()}})}}(jQuery),function(e){e.effects.effect.pulsate=function(n,r){var i,s=e(this),o=e.effects.setMode(s,n.mode||"show"),u="show"===o,a="hide"===o,f=u||"hide"===o,l=2*(n.times||5)+(f?1:0),c=n.duration/l,h=0,p=s.queue(),d=p.length;for((u||!s.is(":visible"))&&(s.css("opacity",0).show(),h=1),i=1;l>i;i++)s.animate({opacity:h},c,n.easing),h=1-h;s.animate({opacity:h},c,n.easing),s.queue(function(){a&&s.hide(),r()}),d>1&&p.splice.apply(p,[1,0].concat(p.splice(d,l+1))),s.dequeue()}}(jQuery),function(e){e.effects.effect.puff=function(n,r){var i=e(this),s=e.effects.setMode(i,n.mode||"hide"),o="hide"===s,u=parseInt(n.percent,10)||150,a=u/100,f={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};e.extend(n,{effect:"scale",queue:!1,fade:!0,mode:s,complete:r,percent:o?u:100,from:o?f:{height:f.height*a,width:f.width*a,outerHeight:f.outerHeight*a,outerWidth:f.outerWidth*a}}),i.effect(n)},e.effects.effect.scale=function(n,r){var i=e(this),s=e.extend(!0,{},n),o=e.effects.setMode(i,n.mode||"effect"),u=parseInt(n.percent,10)||(0===parseInt(n.percent,10)?0:"hide"===o?0:100),a=n.direction||"both",f=n.origin,l={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()},c={y:"horizontal"!==a?u/100:1,x:"vertical"!==a?u/100:1};s.effect="size",s.queue=!1,s.complete=r,"effect"!==o&&(s.origin=f||["middle","center"],s.restore=!0),s.from=n.from||("show"===o?{height:0,width:0,outerHeight:0,outerWidth:0}:l),s.to={height:l.height*c.y,width:l.width*c.x,outerHeight:l.outerHeight*c.y,outerWidth:l.outerWidth*c.x},s.fade&&("show"===o&&(s.from.opacity=0,s.to.opacity=1),"hide"===o&&(s.from.opacity=1,s.to.opacity=0)),i.effect(s)},e.effects.effect.size=function(n,r){var i,s,o,u=e(this),a=["position","top","bottom","left","right","width","height","overflow","opacity"],f=["position","top","bottom","left","right","overflow","opacity"],l=["width","height","overflow"],c=["fontSize"],h=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],p=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],d=e.effects.setMode(u,n.mode||"effect"),v=n.restore||"effect"!==d,m=n.scale||"both",g=n.origin||["middle","center"],y=u.css("position"),b=v?a:f,w={height:0,width:0,outerHeight:0,outerWidth:0};"show"===d&&u.show(),i={height:u.height(),width:u.width(),outerHeight:u.outerHeight(),outerWidth:u.outerWidth()},"toggle"===n.mode&&"show"===d?(u.from=n.to||w,u.to=n.from||i):(u.from=n.from||("show"===d?w:i),u.to=n.to||("hide"===d?w:i)),o={from:{y:u.from.height/i.height,x:u.from.width/i.width},to:{y:u.to.height/i.height,x:u.to.width/i.width}},("box"===m||"both"===m)&&(o.from.y!==o.to.y&&(b=b.concat(h),u.from=e.effects.setTransition(u,h,o.from.y,u.from),u.to=e.effects.setTransition(u,h,o.to.y,u.to)),o.from.x!==o.to.x&&(b=b.concat(p),u.from=e.effects.setTransition(u,p,o.from.x,u.from),u.to=e.effects.setTransition(u,p,o.to.x,u.to))),("content"===m||"both"===m)&&o.from.y!==o.to.y&&(b=b.concat(c).concat(l),u.from=e.effects.setTransition(u,c,o.from.y,u.from),u.to=e.effects.setTransition(u,c,o.to.y,u.to)),e.effects.save(u,b),u.show(),e.effects.createWrapper(u),u.css("overflow","hidden").css(u.from),g&&(s=e.effects.getBaseline(g,i),u.from.top=(i.outerHeight-u.outerHeight())*s.y,u.from.left=(i.outerWidth-u.outerWidth())*s.x,u.to.top=(i.outerHeight-u.to.outerHeight)*s.y,u.to.left=(i.outerWidth-u.to.outerWidth)*s.x),u.css(u.from),("content"===m||"both"===m)&&(h=h.concat(["marginTop","marginBottom"]).concat(c),p=p.concat(["marginLeft","marginRight"]),l=a.concat(h).concat(p),u.find("*[width]").each(function(){var r=e(this),i={height:r.height(),width:r.width(),outerHeight:r.outerHeight(),outerWidth:r.outerWidth()};v&&e.effects.save(r,l),r.from={height:i.height*o.from.y,width:i.width*o.from.x,outerHeight:i.outerHeight*o.from.y,outerWidth:i.outerWidth*o.from.x},r.to={height:i.height*o.to.y,width:i.width*o.to.x,outerHeight:i.height*o.to.y,outerWidth:i.width*o.to.x},o.from.y!==o.to.y&&(r.from=e.effects.setTransition(r,h,o.from.y,r.from),r.to=e.effects.setTransition(r,h,o.to.y,r.to)),o.from.x!==o.to.x&&(r.from=e.effects.setTransition(r,p,o.from.x,r.from),r.to=e.effects.setTransition(r,p,o.to.x,r.to)),r.css(r.from),r.animate(r.to,n.duration,n.easing,function(){v&&e.effects.restore(r,l)})})),u.animate(u.to,{queue:!1,duration:n.duration,easing:n.easing,complete:function(){0===u.to.opacity&&u.css("opacity",u.from.opacity),"hide"===d&&u.hide(),e.effects.restore(u,b),v||("static"===y?u.css({position:"relative",top:u.to.top,left:u.to.left}):e.each(["top","left"],function(e,t){u.css(t,function(t,n){var r=parseInt(n,10),i=e?u.to.left:u.to.top;return"auto"===n?i+"px":r+i+"px"})})),e.effects.removeWrapper(u),r()}})}}(jQuery),function(e){e.effects.effect.shake=function(n,r){var i,s=e(this),o=["position","top","bottom","left","right","height","width"],u=e.effects.setMode(s,n.mode||"effect"),a=n.direction||"left",f=n.distance||20,l=n.times||3,c=2*l+1,h=Math.round(n.duration/c),p="up"===a||"down"===a?"top":"left",d="up"===a||"left"===a,v={},m={},g={},y=s.queue(),b=y.length;for(e.effects.save(s,o),s.show(),e.effects.createWrapper(s),v[p]=(d?"-=":"+=")+f,m[p]=(d?"+=":"-=")+2*f,g[p]=(d?"-=":"+=")+2*f,s.animate(v,h,n.easing),i=1;l>i;i++)s.animate(m,h,n.easing).animate(g,h,n.easing);s.animate(m,h,n.easing).animate(v,h/2,n.easing).queue(function(){"hide"===u&&s.hide(),e.effects.restore(s,o),e.effects.removeWrapper(s),r()}),b>1&&y.splice.apply(y,[1,0].concat(y.splice(b,c+1))),s.dequeue()}}(jQuery),function(e){e.effects.effect.slide=function(n,r){var i,s=e(this),o=["position","top","bottom","left","right","width","height"],u=e.effects.setMode(s,n.mode||"show"),a="show"===u,f=n.direction||"left",l="up"===f||"down"===f?"top":"left",c="up"===f||"left"===f,h={};e.effects.save(s,o),s.show(),i=n.distance||s["top"===l?"outerHeight":"outerWidth"](!0),e.effects.createWrapper(s).css({overflow:"hidden"}),a&&s.css(l,c?isNaN(i)?"-"+i:-i:i),h[l]=(a?c?"+=":"-=":c?"-=":"+=")+i,s.animate(h,{queue:!1,duration:n.duration,easing:n.easing,complete:function(){"hide"===u&&s.hide(),e.effects.restore(s,o),e.effects.removeWrapper(s),r()}})}}(jQuery),function(e){e.effects.effect.transfer=function(n,r){var i=e(this),s=e(n.to),o="fixed"===s.css("position"),u=e("body"),a=o?u.scrollTop():0,f=o?u.scrollLeft():0,l=s.offset(),c={top:l.top-a,left:l.left-f,height:s.innerHeight(),width:s.innerWidth()},h=i.offset(),p=e("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(n.className).css({top:h.top-a,left:h.left-f,height:i.innerHeight(),width:i.innerWidth(),position:o?"fixed":"absolute"}).animate(c,n.duration,n.easing,function(){p.remove(),r()})}}(jQuery),define("jqueryui",function(){});if(!jQuery)throw new Error("Bootstrap requires jQuery");+function(e){function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in t)if(void 0!==e.style[n])return{end:t[n]}}e.fn.emulateTransitionEnd=function(t){var n=!1,r=this;e(this).one(e.support.transition.end,function(){n=!0});var i=function(){n||e(r).trigger(e.support.transition.end)};return setTimeout(i,t),this},e(function(){e.support.transition=t()})}(window.jQuery),+function(e){var t='[data-dismiss="alert"]',n=function(n){e(n).on("click",t,this.close)};n.prototype.close=function(t){function n(){s.trigger("closed.bs.alert").remove()}var r=e(this),i=r.attr("data-target");i||(i=r.attr("href"),i=i&&i.replace(/.*(?=#[^\s]*$)/,""));var s=e(i);t&&t.preventDefault(),s.length||(s=r.hasClass("alert")?r:r.parent()),s.trigger(t=e.Event("close.bs.alert")),t.isDefaultPrevented()||(s.removeClass("in"),e.support.transition&&s.hasClass("fade")?s.one(e.support.transition.end,n).emulateTransitionEnd(150):n())};var r=e.fn.alert;e.fn.alert=function(t){return this.each(function(){var r=e(this),i=r.data("bs.alert");i||r.data("bs.alert",i=new n(this)),"string"==typeof t&&i[t].call(r)})},e.fn.alert.Constructor=n,e.fn.alert.noConflict=function(){return e.fn.alert=r,this},e(document).on("click.bs.alert.data-api",t,n.prototype.close)}(window.jQuery),+function(e){var t=function(n,r){this.$element=e(n),this.options=e.extend({},t.DEFAULTS,r)};t.DEFAULTS={loadingText:"loading..."},t.prototype.setState=function(e){var t="disabled",n=this.$element,r=n.is("input")?"val":"html",i=n.data();e+="Text",i.resetText||n.data("resetText",n[r]()),n[r](i[e]||this.options[e]),setTimeout(function(){"loadingText"==e?n.addClass(t).attr(t,t):n.removeClass(t).removeAttr(t)},0)},t.prototype.toggle=function(){var e=this.$element.closest('[data-toggle="buttons"]');if(e.length){var t=this.$element.find("input").prop("checked",!this.$element.hasClass("active")).trigger("change");"radio"===t.prop("type")&&e.find(".active").removeClass("active")}this.$element.toggleClass("active")};var n=e.fn.button;e.fn.button=function(n){return this.each(function(){var r=e(this),i=r.data("bs.button"),s="object"==typeof n&&n;i||r.data("bs.button",i=new t(this,s)),"toggle"==n?i.toggle():n&&i.setState(n)})},e.fn.button.Constructor=t,e.fn.button.noConflict=function(){return e.fn.button=n,this},e(document).on("click.bs.button.data-api","[data-toggle^=button]",function(t){var n=e(t.target);n.hasClass("btn")||(n=n.closest(".btn")),n.button("toggle"),t.preventDefault()})}(window.jQuery),+function(e){var t=function(t,n){this.$element=e(t),this.$indicators=this.$element.find(".carousel-indicators"),this.options=n,this.paused=this.sliding=this.interval=this.$active=this.$items=null,"hover"==this.options.pause&&this.$element.on("mouseenter",e.proxy(this.pause,this)).on("mouseleave",e.proxy(this.cycle,this))};t.DEFAULTS={interval:5e3,pause:"hover",wrap:!0},t.prototype.cycle=function(t){return t||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},t.prototype.getActiveIndex=function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},t.prototype.to=function(t){var n=this,r=this.getActiveIndex();return t>this.$items.length-1||0>t?void 0:this.sliding?this.$element.one("slid",function(){n.to(t)}):r==t?this.pause().cycle():this.slide(t>r?"next":"prev",e(this.$items[t]))},t.prototype.pause=function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition.end&&(this.$element.trigger(e.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},t.prototype.next=function(){return this.sliding?void 0:this.slide("next")},t.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},t.prototype.slide=function(t,n){var r=this.$element.find(".item.active"),i=n||r[t](),s=this.interval,o="next"==t?"left":"right",u="next"==t?"first":"last",f=this;if(!i.length){if(!this.options.wrap)return;i=this.$element.find(".item")[u]()}this.sliding=!0,s&&this.pause();var l=e.Event("slide.bs.carousel",{relatedTarget:i[0],direction:o});if(!i.hasClass("active")){if(this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid",function(){var t=e(f.$indicators.children()[f.getActiveIndex()]);t&&t.addClass("active")})),e.support.transition&&this.$element.hasClass("slide")){if(this.$element.trigger(l),l.isDefaultPrevented())return;i.addClass(t),i[0].offsetWidth,r.addClass(o),i.addClass(o),r.one(e.support.transition.end,function(){i.removeClass([t,o].join(" ")).addClass("active"),r.removeClass(["active",o].join(" ")),f.sliding=!1,setTimeout(function(){f.$element.trigger("slid")},0)}).emulateTransitionEnd(600)}else{if(this.$element.trigger(l),l.isDefaultPrevented())return;r.removeClass("active"),i.addClass("active"),this.sliding=!1,this.$element.trigger("slid")}return s&&this.cycle(),this}};var n=e.fn.carousel;e.fn.carousel=function(n){return this.each(function(){var r=e(this),i=r.data("bs.carousel"),s=e.extend({},t.DEFAULTS,r.data(),"object"==typeof n&&n),o="string"==typeof n?n:s.slide;i||r.data("bs.carousel",i=new t(this,s)),"number"==typeof n?i.to(n):o?i[o]():s.interval&&i.pause().cycle()})},e.fn.carousel.Constructor=t,e.fn.carousel.noConflict=function(){return e.fn.carousel=n,this},e(document).on("click.bs.carousel.data-api","[data-slide], [data-slide-to]",function(t){var n,r=e(this),i=e(r.attr("data-target")||(n=r.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,"")),s=e.extend({},i.data(),r.data()),o=r.attr("data-slide-to");o&&(s.interval=!1),i.carousel(s),(o=r.attr("data-slide-to"))&&i.data("bs.carousel").to(o),t.preventDefault()}),e(window).on("load",function(){e('[data-ride="carousel"]').each(function(){var t=e(this);t.carousel(t.data())})})}(window.jQuery),+function(e){var t=function(n,r){this.$element=e(n),this.options=e.extend({},t.DEFAULTS,r),this.transitioning=null,this.options.parent&&(this.$parent=e(this.options.parent)),this.options.toggle&&this.toggle()};t.DEFAULTS={toggle:!0},t.prototype.dimension=function(){var e=this.$element.hasClass("width");return e?"width":"height"},t.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var t=e.Event("show.bs.collapse");if(this.$element.trigger(t),!t.isDefaultPrevented()){var n=this.$parent&&this.$parent.find("> .panel > .in");if(n&&n.length){var r=n.data("bs.collapse");if(r&&r.transitioning)return;n.collapse("hide"),r||n.data("bs.collapse",null)}var i=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[i](0),this.transitioning=1;var s=function(){this.$element.removeClass("collapsing").addClass("in")[i]("auto"),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!e.support.transition)return s.call(this);var o=e.camelCase(["scroll",i].join("-"));this.$element.one(e.support.transition.end,e.proxy(s,this)).emulateTransitionEnd(350)[i](this.$element[0][o])}}},t.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var t=e.Event("hide.bs.collapse");if(this.$element.trigger(t),!t.isDefaultPrevented()){var n=this.dimension();this.$element[n](this.$element[n]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var r=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};return e.support.transition?(this.$element[n](0).one(e.support.transition.end,e.proxy(r,this)).emulateTransitionEnd(350),void 0):r.call(this)}}},t.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var n=e.fn.collapse;e.fn.collapse=function(n){return this.each(function(){var r=e(this),i=r.data("bs.collapse"),s=e.extend({},t.DEFAULTS,r.data(),"object"==typeof n&&n);i||r.data("bs.collapse",i=new t(this,s)),"string"==typeof n&&i[n]()})},e.fn.collapse.Constructor=t,e.fn.collapse.noConflict=function(){return e.fn.collapse=n,this},e(document).on("click.bs.collapse.data-api","[data-toggle=collapse]",function(t){var n,r=e(this),i=r.attr("data-target")||t.preventDefault()||(n=r.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,""),s=e(i),o=s.data("bs.collapse"),u=o?"toggle":r.data(),f=r.attr("data-parent"),l=f&&e(f);o&&o.transitioning||(l&&l.find('[data-toggle=collapse][data-parent="'+f+'"]').not(r).addClass("collapsed"),r[s.hasClass("in")?"addClass":"removeClass"]("collapsed")),s.collapse(u)})}(window.jQuery),+function(e){function t(){e(r).remove(),e(i).each(function(t){var r=n(e(this));r.hasClass("open")&&(r.trigger(t=e.Event("hide.bs.dropdown")),t.isDefaultPrevented()||r.removeClass("open").trigger("hidden.bs.dropdown"))})}function n(t){var n=t.attr("data-target");n||(n=t.attr("href"),n=n&&/#/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,""));var r=n&&e(n);return r&&r.length?r:t.parent()}var r=".dropdown-backdrop",i="[data-toggle=dropdown]",s=function(t){e(t).on("click.bs.dropdown",this.toggle)};s.prototype.toggle=function(r){var i=e(this);if(!i.is(".disabled, :disabled")){var s=n(i),o=s.hasClass("open");if(t(),!o){if("ontouchstart"in document.documentElement&&!s.closest(".navbar-nav").length&&e('<div class="dropdown-backdrop"/>').insertAfter(e(this)).on("click",t),s.trigger(r=e.Event("show.bs.dropdown")),r.isDefaultPrevented())return;s.toggleClass("open").trigger("shown.bs.dropdown"),i.focus()}return!1}},s.prototype.keydown=function(t){if(/(38|40|27)/.test(t.keyCode)){var r=e(this);if(t.preventDefault(),t.stopPropagation(),!r.is(".disabled, :disabled")){var s=n(r),o=s.hasClass("open");if(!o||o&&27==t.keyCode)return 27==t.which&&s.find(i).focus(),r.click();var u=e("[role=menu] li:not(.divider):visible a",s);if(u.length){var f=u.index(u.filter(":focus"));38==t.keyCode&&f>0&&f--,40==t.keyCode&&f<u.length-1&&f++,~f||(f=0),u.eq(f).focus()}}}};var o=e.fn.dropdown;e.fn.dropdown=function(t){return this.each(function(){var n=e(this),r=n.data("dropdown");r||n.data("dropdown",r=new s(this)),"string"==typeof t&&r[t].call(n)})},e.fn.dropdown.Constructor=s,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=o,this},e(document).on("click.bs.dropdown.data-api",t).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",i,s.prototype.toggle).on("keydown.bs.dropdown.data-api",i+", [role=menu]",s.prototype.keydown)}(window.jQuery),+function(e){var t=function(t,n){this.options=n,this.$element=e(t),this.$backdrop=this.isShown=null,this.options.remote&&this.$element.load(this.options.remote)};t.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},t.prototype.toggle=function(e){return this[this.isShown?"hide":"show"](e)},t.prototype.show=function(t){var n=this,r=e.Event("show.bs.modal",{relatedTarget:t});this.$element.trigger(r),this.isShown||r.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.$element.on("click.dismiss.modal",'[data-dismiss="modal"]',e.proxy(this.hide,this)),this.backdrop(function(){var r=e.support.transition&&n.$element.hasClass("fade");n.$element.parent().length||n.$element.appendTo(document.body),n.$element.show(),r&&n.$element[0].offsetWidth,n.$element.addClass("in").attr("aria-hidden",!1),n.enforceFocus();var i=e.Event("shown.bs.modal",{relatedTarget:t});r?n.$element.find(".modal-dialog").one(e.support.transition.end,function(){n.$element.focus().trigger(i)}).emulateTransitionEnd(300):n.$element.focus().trigger(i)}))},t.prototype.hide=function(t){t&&t.preventDefault(),t=e.Event("hide.bs.modal"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),e(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.modal"),e.support.transition&&this.$element.hasClass("fade")?this.$element.one(e.support.transition.end,e.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal())},t.prototype.enforceFocus=function(){e(document).off("focusin.bs.modal").on("focusin.bs.modal",e.proxy(function(e){this.$element[0]===e.target||this.$element.has(e.target).length||this.$element.focus()},this))},t.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",e.proxy(function(e){27==e.which&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},t.prototype.hideModal=function(){var e=this;this.$element.hide(),this.backdrop(function(){e.removeBackdrop(),e.$element.trigger("hidden.bs.modal")})},t.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},t.prototype.backdrop=function(t){var n=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var r=e.support.transition&&n;if(this.$backdrop=e('<div class="modal-backdrop '+n+'" />').appendTo(document.body),this.$element.on("click.dismiss.modal",e.proxy(function(e){e.target===e.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),r&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!t)return;r?this.$backdrop.one(e.support.transition.end,t).emulateTransitionEnd(150):t()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,t).emulateTransitionEnd(150):t()):t&&t()};var n=e.fn.modal;e.fn.modal=function(n,r){return this.each(function(){var i=e(this),s=i.data("bs.modal"),o=e.extend({},t.DEFAULTS,i.data(),"object"==typeof n&&n);s||i.data("bs.modal",s=new t(this,o)),"string"==typeof n?s[n](r):o.show&&s.show(r)})},e.fn.modal.Constructor=t,e.fn.modal.noConflict=function(){return e.fn.modal=n,this},e(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(t){var n=e(this),r=n.attr("href"),i=e(n.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),s=i.data("modal")?"toggle":e.extend({remote:!/#/.test(r)&&r},i.data(),n.data());t.preventDefault(),i.modal(s,this).one("hide",function(){n.is(":visible")&&n.focus()})}),e(document).on("show.bs.modal",".modal",function(){e(document.body).addClass("modal-open")}).on("hidden.bs.modal",".modal",function(){e(document.body).removeClass("modal-open")})}(window.jQuery),+function(e){var t=function(e,t){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",e,t)};t.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},t.prototype.init=function(t,n,r){this.enabled=!0,this.type=t,this.$element=e(n),this.options=this.getOptions(r);for(var i=this.options.trigger.split(" "),s=i.length;s--;){var o=i[s];if("click"==o)this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this));else if("manual"!=o){var u="hover"==o?"mouseenter":"focus",f="hover"==o?"mouseleave":"blur";this.$element.on(u+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(f+"."+this.type,this.options.selector,e.proxy(this.leave,this))}}this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},t.prototype.getDefaults=function(){return t.DEFAULTS},t.prototype.getOptions=function(t){return t=e.extend({},this.getDefaults(),this.$element.data(),t),t.delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},t.prototype.getDelegateOptions=function(){var t={},n=this.getDefaults();return this._options&&e.each(this._options,function(e,r){n[e]!=r&&(t[e]=r)}),t},t.prototype.enter=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(n.timeout),n.hoverState="in",n.options.delay&&n.options.delay.show?(n.timeout=setTimeout(function(){"in"==n.hoverState&&n.show()},n.options.delay.show),void 0):n.show()},t.prototype.leave=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(n.timeout),n.hoverState="out",n.options.delay&&n.options.delay.hide?(n.timeout=setTimeout(function(){"out"==n.hoverState&&n.hide()},n.options.delay.hide),void 0):n.hide()},t.prototype.show=function(){var t=e.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){if(this.$element.trigger(t),t.isDefaultPrevented())return;var n=this.tip();this.setContent(),this.options.animation&&n.addClass("fade");var r="function"==typeof this.options.placement?this.options.placement.call(this,n[0],this.$element[0]):this.options.placement,i=/\s?auto?\s?/i,s=i.test(r);s&&(r=r.replace(i,"")||"top"),n.detach().css({top:0,left:0,display:"block"}).addClass(r),this.options.container?n.appendTo(this.options.container):n.insertAfter(this.$element);var o=this.getPosition(),u=n[0].offsetWidth,f=n[0].offsetHeight;if(s){var l=this.$element.parent(),c=r,h=document.documentElement.scrollTop||document.body.scrollTop,p="body"==this.options.container?window.innerWidth:l.outerWidth(),d="body"==this.options.container?window.innerHeight:l.outerHeight(),v="body"==this.options.container?0:l.offset().left;r="bottom"==r&&o.top+o.height+f-h>d?"top":"top"==r&&o.top-h-f<0?"bottom":"right"==r&&o.right+u>p?"left":"left"==r&&o.left-u<v?"right":r,n.removeClass(c).addClass(r)}var m=this.getCalculatedOffset(r,o,u,f);this.applyPlacement(m,r),this.$element.trigger("shown.bs."+this.type)}},t.prototype.applyPlacement=function(e,t){var n,r=this.tip(),i=r[0].offsetWidth,s=r[0].offsetHeight,o=parseInt(r.css("margin-top"),10),u=parseInt(r.css("margin-left"),10);isNaN(o)&&(o=0),isNaN(u)&&(u=0),e.top=e.top+o,e.left=e.left+u,r.offset(e).addClass("in");var a=r[0].offsetWidth,f=r[0].offsetHeight;if("top"==t&&f!=s&&(n=!0,e.top=e.top+s-f),/bottom|top/.test(t)){var l=0;e.left<0&&(l=-2*e.left,e.left=0,r.offset(e),a=r[0].offsetWidth,f=r[0].offsetHeight),this.replaceArrow(l-i+a,a,"left")}else this.replaceArrow(f-s,f,"top");n&&r.offset(e)},t.prototype.replaceArrow=function(e,t,n){this.arrow().css(n,e?50*(1-e/t)+"%":"")},t.prototype.setContent=function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},t.prototype.hide=function(){function t(){"in"!=n.hoverState&&r.detach()}var n=this,r=this.tip(),i=e.Event("hide.bs."+this.type);return this.$element.trigger(i),i.isDefaultPrevented()?void 0:(r.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?r.one(e.support.transition.end,t).emulateTransitionEnd(150):t(),this.$element.trigger("hidden.bs."+this.type),this)},t.prototype.fixTitle=function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("data-original-title"))&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},t.prototype.hasContent=function(){return this.getTitle()},t.prototype.getPosition=function(){var t=this.$element[0];return e.extend({},"function"==typeof t.getBoundingClientRect?t.getBoundingClientRect():{width:t.offsetWidth,height:t.offsetHeight},this.$element.offset())},t.prototype.getCalculatedOffset=function(e,t,n,r){return"bottom"==e?{top:t.top+t.height,left:t.left+t.width/2-n/2}:"top"==e?{top:t.top-r,left:t.left+t.width/2-n/2}:"left"==e?{top:t.top+t.height/2-r/2,left:t.left-n}:{top:t.top+t.height/2-r/2,left:t.left+t.width}},t.prototype.getTitle=function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||("function"==typeof n.title?n.title.call(t[0]):n.title)},t.prototype.tip=function(){return this.$tip=this.$tip||e(this.options.template)},t.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},t.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},t.prototype.enable=function(){this.enabled=!0},t.prototype.disable=function(){this.enabled=!1},t.prototype.toggleEnabled=function(){this.enabled=!this.enabled},t.prototype.toggle=function(t){var n=t?e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type):this;n.tip().hasClass("in")?n.leave(n):n.enter(n)},t.prototype.destroy=function(){this.hide().$element.off("."+this.type).removeData("bs."+this.type)};var n=e.fn.tooltip;e.fn.tooltip=function(n){return this.each(function(){var r=e(this),i=r.data("bs.tooltip"),s="object"==typeof n&&n;i||r.data("bs.tooltip",i=new t(this,s)),"string"==typeof n&&i[n]()})},e.fn.tooltip.Constructor=t,e.fn.tooltip.noConflict=function(){return e.fn.tooltip=n,this}}(window.jQuery),+function(e){var t=function(e,t){this.init("popover",e,t)};if(!e.fn.tooltip)throw new Error("Popover requires tooltip.js");t.DEFAULTS=e.extend({},e.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),t.prototype=e.extend({},e.fn.tooltip.Constructor.prototype),t.prototype.constructor=t,t.prototype.getDefaults=function(){return t.DEFAULTS},t.prototype.setContent=function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content")[this.options.html?"html":"text"](n),e.removeClass("fade top bottom left right in"),e.find(".popover-title").html()||e.find(".popover-title").hide()},t.prototype.hasContent=function(){return this.getTitle()||this.getContent()},t.prototype.getContent=function(){var e=this.$element,t=this.options;return e.attr("data-content")||("function"==typeof t.content?t.content.call(e[0]):t.content)},t.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},t.prototype.tip=function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip};var n=e.fn.popover;e.fn.popover=function(n){return this.each(function(){var r=e(this),i=r.data("bs.popover"),s="object"==typeof n&&n;i||r.data("bs.popover",i=new t(this,s)),"string"==typeof n&&i[n]()})},e.fn.popover.Constructor=t,e.fn.popover.noConflict=function(){return e.fn.popover=n,this}}(window.jQuery),+function(e){function t(n,r){var i,s=e.proxy(this.process,this);this.$element=e(n).is("body")?e(window):e(n),this.$body=e("body"),this.$scrollElement=this.$element.on("scroll.bs.scroll-spy.data-api",s),this.options=e.extend({},t.DEFAULTS,r),this.selector=(this.options.target||(i=e(n).attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.offsets=e([]),this.targets=e([]),this.activeTarget=null,this.refresh(),this.process()}t.DEFAULTS={offset:10},t.prototype.refresh=function(){var t=this.$element[0]==window?"offset":"position";this.offsets=e([]),this.targets=e([]);var n=this;this.$body.find(this.selector).map(function(){var r=e(this),i=r.data("target")||r.attr("href"),s=/^#\w/.test(i)&&e(i);return s&&s.length&&[[s[t]().top+(!e.isWindow(n.$scrollElement.get(0))&&n.$scrollElement.scrollTop()),i]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){n.offsets.push(this[0]),n.targets.push(this[1])})},t.prototype.process=function(){var e,t=this.$scrollElement.scrollTop()+this.options.offset,n=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,r=n-this.$scrollElement.height(),i=this.offsets,s=this.targets,o=this.activeTarget;if(t>=r)return o!=(e=s.last()[0])&&this.activate(e);for(e=i.length;e--;)o!=s[e]&&t>=i[e]&&(!i[e+1]||t<=i[e+1])&&this.activate(s[e])},t.prototype.activate=function(t){this.activeTarget=t,e(this.selector).parents(".active").removeClass("active");var n=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',r=e(n).parents("li").addClass("active");r.parent(".dropdown-menu").length&&(r=r.closest("li.dropdown").addClass("active")),r.trigger("activate")};var n=e.fn.scrollspy;e.fn.scrollspy=function(n){return this.each(function(){var r=e(this),i=r.data("bs.scrollspy"),s="object"==typeof n&&n;i||r.data("bs.scrollspy",i=new t(this,s)),"string"==typeof n&&i[n]()})},e.fn.scrollspy.Constructor=t,e.fn.scrollspy.noConflict=function(){return e.fn.scrollspy=n,this},e(window).on("load",function(){e('[data-spy="scroll"]').each(function(){var t=e(this);t.scrollspy(t.data())})})}(window.jQuery),+function(e){var t=function(t){this.element=e(t)};t.prototype.show=function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.attr("data-target");if(r||(r=t.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,"")),!t.parent("li").hasClass("active")){var i=n.find(".active:last a")[0],s=e.Event("show.bs.tab",{relatedTarget:i});if(t.trigger(s),!s.isDefaultPrevented()){var o=e(r);this.activate(t.parent("li"),n),this.activate(o,o.parent(),function(){t.trigger({type:"shown.bs.tab",relatedTarget:i})})}}},t.prototype.activate=function(t,n,r){function i(){s.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),o?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),r&&r()}var s=n.find("> .active"),o=r&&e.support.transition&&s.hasClass("fade");o?s.one(e.support.transition.end,i).emulateTransitionEnd(150):i(),s.removeClass("in")};var n=e.fn.tab;e.fn.tab=function(n){return this.each(function(){var r=e(this),i=r.data("bs.tab");i||r.data("bs.tab",i=new t(this)),"string"==typeof n&&i[n]()})},e.fn.tab.Constructor=t,e.fn.tab.noConflict=function(){return e.fn.tab=n,this},e(document).on("click.bs.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault(),e(this).tab("show")})}(window.jQuery),+function(e){var t=function(n,r){this.options=e.extend({},t.DEFAULTS,r),this.$window=e(window).on("scroll.bs.affix.data-api",e.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",e.proxy(this.checkPositionWithEventLoop,this)),this.$element=e(n),this.affixed=this.unpin=null,this.checkPosition()};t.RESET="affix affix-top affix-bottom",t.DEFAULTS={offset:0},t.prototype.checkPositionWithEventLoop=function(){setTimeout(e.proxy(this.checkPosition,this),1)},t.prototype.checkPosition=function(){if(this.$element.is(":visible")){var n=e(document).height(),r=this.$window.scrollTop(),i=this.$element.offset(),s=this.options.offset,o=s.top,u=s.bottom;"object"!=typeof s&&(u=o=s),"function"==typeof o&&(o=s.top()),"function"==typeof u&&(u=s.bottom());var f=null!=this.unpin&&r+this.unpin<=i.top?!1:null!=u&&i.top+this.$element.height()>=n-u?"bottom":null!=o&&o>=r?"top":!1;this.affixed!==f&&(this.unpin&&this.$element.css("top",""),this.affixed=f,this.unpin="bottom"==f?i.top-r:null,this.$element.removeClass(t.RESET).addClass("affix"+(f?"-"+f:"")),"bottom"==f&&this.$element.offset({top:document.body.offsetHeight-u-this.$element.height()}))}};var n=e.fn.affix;e.fn.affix=function(n){return this.each(function(){var r=e(this),i=r.data("bs.affix"),s="object"==typeof n&&n;i||r.data("bs.affix",i=new t(this,s)),"string"==typeof n&&i[n]()})},e.fn.affix.Constructor=t,e.fn.affix.noConflict=function(){return e.fn.affix=n,this},e(window).on("load",function(){e('[data-spy="affix"]').each(function(){var t=e(this),n=t.data();n.offset=n.offset||{},n.offsetBottom&&(n.offset.bottom=n.offsetBottom),n.offsetTop&&(n.offset.top=n.offsetTop),t.affix(n)})})}(window.jQuery),define("bootstrap",function(){}),function(e){function t(e,t){this._superCallObjects||(this._superCallObjects={});var r=this._superCallObjects[e]||this,i=n(e,r);this._superCallObjects[e]=i;var s=i[e].apply(this,t||[]);return delete this._superCallObjects[e],s}function n(e,t){var n=t;while(n[e]===t[e])n=n.constructor.__super__;return n}_.each(["Model","Collection","View","Router"],function(n){e[n].prototype._super=t})}(Backbone),define("backbone_super",["backbone"],function(){}),function(e){function t(t){var n;return t&&t.constructor==Array&&t.length==3?t:(n=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(t))?[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])]:(n=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(t))?[parseFloat(n[1])*2.55,parseFloat(n[2])*2.55,parseFloat(n[3])*2.55]:(n=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(t))?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:(n=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(t))?[parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16),parseInt(n[3]+n[3],16)]:(n=/rgba\(0, 0, 0, 0\)/.exec(t))?r.transparent:r[e.trim(t).toLowerCase()]}function n(n,r){var i;do{i=e.curCSS(n,r);if(i!=""&&i!="transparent"||e.nodeName(n,"body"))break;r="backgroundColor"}while(n=n.parentNode);return t(i)}e.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","color","outlineColor"],function(r,i){e.fx.step[i]=function(e){e.state==0&&(e.start=n(e.elem,i),e.end=t(e.end)),e.elem.style[i]="rgb("+[Math.max(Math.min(parseInt(e.pos*(e.end[0]-e.start[0])+e.start[0]),255),0),Math.max(Math.min(parseInt(e.pos*(e.end[1]-e.start[1])+e.start[1]),255),0),Math.max(Math.min(parseInt(e.pos*(e.end[2]-e.start[2])+e.start[2]),255),0)].join(",")+")"}});var r={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]}}(jQuery),define("lib/jquery/jquery.color",function(){}),function($){function parseOptions(e){return{RADIUS:e.radius||20,DURATION:e.duration||500,TEXT_COLOR:e.textColor||"#fff",HALO_COLOR:e.haloColor||"#777"}}function currentRadius(e){return(prop=e.style["text-shadow"])?parseInt(prop.match(/0 0 (\d+)px/)):0}function stepTextShadow(e){e.state==0&&(e.start=currentRadius(e.elem)),updatedRadius=e.end.begin?Math.max(Math.min(parseInt(e.end.radius*e.pos))):Math.max(Math.min(parseInt(e.end.radius-e.end.radius*e.pos))),e.end.begin||e.state<1?e.elem.style["text-shadow"]=e.end.color+" 0 0 "+updatedRadius+"px":e.elem.style["text-shadow"]="none"}function addGlow(opts){function startGlow(){$(this).animate({color:opts.TEXT_COLOR,textShadow:{begin:!0,color:opts.HALO_COLOR,radius:opts.RADIUS}},opts.DURATION)}function startFade(){$(this).animate({color:$(this).data("glow.originColor"),textShadow:{begin:!1,color:opts.HALO_COLOR,radius:opts.RADIUS}},opts.DURATION)}var opts=parseOptions(opts||{});with($(this))bind("mouseenter",startGlow),bind("mouseleave",startFade),data("glow.originColor",css("color"));return this}function tempGlow(opts){var opts=parseOptions(opts||{}),self=this;with($(this))data("glow.originColor",css("color"));return $(self).css({color:opts.TEXT_COLOR}),$(self).animate({textShadow:{begin:!0,color:opts.HALO_COLOR,radius:opts.RADIUS}},50).delay(600).animate({color:$(self).data("glow.originColor"),textShadow:{begin:!1,color:opts.HALO_COLOR,radius:opts.RADIUS}},opts.DURATION),this}var currentRadius,multiplier;$.fx.step.textShadow=stepTextShadow,$.fn.addGlow=addGlow,$.fn.tempGlow=tempGlow}(jQuery),define("lib/jquery/jquery.glowing",function(){}),jQuery&&function(e){e.extend(e.fn,{miniColors:function(t,n){var r=function(t,n,r){var i=m(t.val());i||(i="FFFFFF");var s=E(i),f=e('<a class="miniColors-trigger" style="background-color: #'+i+'" href="#"></a>');f.insertAfter(t),t.addClass("miniColors").attr("maxlength",7).attr("autocomplete","off"),t.data("trigger",f),t.data("hsb",s),n.change&&t.data("change",n.change),n.readonly&&t.attr("readonly",!0),n.disabled&&o(t),f.bind("click.miniColors",function(e){e.preventDefault(),t.trigger("focus")}),t.bind("focus.miniColors",function(e){u(t)}),t.bind("blur.miniColors",function(e){var n=m(t.val());t.val(n?"#"+n:"")}),t.bind("keydown.miniColors",function(e){e.keyCode===9&&a(t)}),t.bind("keyup.miniColors",function(e){var n=t.val().replace(/[^A-F0-9#]/ig,"");t.val(n),p(t)||t.data("trigger").css("backgroundColor","#FFF")}),t.bind("paste.miniColors",function(e){setTimeout(function(){t.trigger("keyup")},5)})},i=function(t){a(),t=e(t),t.data("trigger").remove(),t.removeAttr("autocomplete"),t.removeData("trigger"),t.removeData("selector"),t.removeData("hsb"),t.removeData("huePicker"),t.removeData("colorPicker"),t.removeData("mousebutton"),t.removeData("moving"),t.unbind("click.miniColors"),t.unbind("focus.miniColors"),t.unbind("blur.miniColors"),t.unbind("keyup.miniColors"),t.unbind("keydown.miniColors"),t.unbind("paste.miniColors"),e(document).unbind("mousedown.miniColors"),e(document).unbind("mousemove.miniColors")},s=function(e){e.attr("disabled",!1),e.data("trigger").css("opacity",1)},o=function(e){a(e),e.attr("disabled",!0),e.data("trigger").css("opacity",.5)},u=function(t){if(t.attr("disabled"))return!1;a();var n=e('<div class="miniColors-selector"></div>');n.append('<div class="miniColors-colors" style="background-color: #FFF;"><div class="miniColors-colorPicker"></div></div>'),n.append('<div class="miniColors-hues"><div class="miniColors-huePicker"></div></div>'),n.css({top:t.is(":visible")?t.offset().top+t.outerHeight():t.data("trigger").offset().top+t.data("trigger").outerHeight(),left:t.is(":visible")?t.offset().left:t.data("trigger").offset().left,display:"none"}).addClass(t.attr("class"));var r=t.data("hsb");n.find(".miniColors-colors").css("backgroundColor","#"+S({h:r.h,s:100,b:100}));var i=t.data("colorPosition");i||(i=d(r)),n.find(".miniColors-colorPicker").css("top",i.y+"px").css("left",i.x+"px");var s=t.data("huePosition");s||(s=v(r)),n.find(".miniColors-huePicker").css("top",s.y+"px"),t.data("selector",n),t.data("huePicker",n.find(".miniColors-huePicker")),t.data("colorPicker",n.find(".miniColors-colorPicker")),t.data("mousebutton",0),e("BODY").append(n),n.fadeIn(100),n.bind("selectstart",function(){return!1}),e(document).bind("mousedown.miniColors",function(n){t.data("mousebutton",1),e(n.target).parents().andSelf().hasClass("miniColors-colors")&&(n.preventDefault(),t.data("moving","colors"),f(t,n)),e(n.target).parents().andSelf().hasClass("miniColors-hues")&&(n.preventDefault(),t.data("moving","hues"),l(t,n));if(e(n.target).parents().andSelf().hasClass("miniColors-selector")){n.preventDefault();return}if(e(n.target).parents().andSelf().hasClass("miniColors"))return;a(t)}),e(document).bind("mouseup.miniColors",function(e){t.data("mousebutton",0),t.removeData("moving")}),e(document).bind("mousemove.miniColors",function(e){t.data("mousebutton")===1&&(t.data("moving")==="colors"&&f(t,e),t.data("moving")==="hues"&&l(t,e))})},a=function(t){t||(t=".miniColors"),e(t).each(function(){var t=e(this).data("selector");e(this).removeData("selector"),e(t).fadeOut(100,function(){e(this).remove()})}),e(document).unbind("mousedown.miniColors"),e(document).unbind("mousemove.miniColors")},f=function(t,n){var r=t.data("colorPicker");r.hide();var i={x:n.clientX-t.data("selector").find(".miniColors-colors").offset().left+e(document).scrollLeft()-5,y:n.clientY-t.data("selector").find(".miniColors-colors").offset().top+e(document).scrollTop()-5};i.x<=-5&&(i.x=-5),i.x>=144&&(i.x=144),i.y<=-5&&(i.y=-5),i.y>=144&&(i.y=144),t.data("colorPosition",i),r.css("left",i.x).css("top",i.y).show();var s=Math.round((i.x+5)*.67);s<0&&(s=0),s>100&&(s=100);var o=100-Math.round((i.y+5)*.67);o<0&&(o=0),o>100&&(o=100);var u=t.data("hsb");u.s=s,u.b=o,c(t,u,!0)},l=function(t,n){var r=t.data("huePicker");r.hide();var i={y:n.clientY-t.data("selector").find(".miniColors-colors").offset().top+e(document).scrollTop()-1};i.y<=-1&&(i.y=-1),i.y>=149&&(i.y=149),t.data("huePosition",i),r.css("top",i.y).show();var s=Math.round((150-i.y-1)*2.4);s<0&&(s=0),s>360&&(s=360);var o=t.data("hsb");o.h=s,c(t,o,!0)},c=function(e,t,n){e.data("hsb",t);var r=S(t);n&&e.val("#"+r),e.data("trigger").css("backgroundColor","#"+r),e.data("selector")&&e.data("selector").find(".miniColors-colors").css("backgroundColor","#"+S({h:t.h,s:100,b:100})),e.data("change")&&e.data("change").call(e,"#"+r,g(t))},p=function(t){var n=m(t.val());if(!n)return!1;var r=E(n),i=t.data("hsb");if(r.h===i.h&&r.s===i.s&&r.b===i.b)return!0;var s=d(r),o=e(t.data("colorPicker"));o.css("top",s.y+"px").css("left",s.x+"px");var u=v(r),a=e(t.data("huePicker"));return a.css("top",u.y+"px"),c(t,r,!1),!0},d=function(e){var t=Math.ceil(e.s/.67);t<0&&(t=0),t>150&&(t=150);var n=150-Math.ceil(e.b/.67);return n<0&&(n=0),n>150&&(n=150),{x:t-5,y:n-5}},v=function(e){var t=150-e.h/2.4;return t<0&&(h=0),t>150&&(h=150),{y:t-1}},m=function(e){return e=e.replace(/[^A-Fa-f0-9]/,""),e.length==3&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),e.length===6?e:null},g=function(e){var t={},n=Math.round(e.h),r=Math.round(e.s*255/100),i=Math.round(e.b*255/100);if(r==0)t.r=t.g=t.b=i;else{var s=i,o=(255-r)*i/255,u=(s-o)*(n%60)/60;n==360&&(n=0),n<60?(t.r=s,t.b=o,t.g=o+u):n<120?(t.g=s,t.b=o,t.r=s-u):n<180?(t.g=s,t.r=o,t.b=o+u):n<240?(t.b=s,t.r=o,t.g=s-u):n<300?(t.b=s,t.g=o,t.r=o+u):n<360?(t.r=s,t.g=o,t.b=s-u):(t.r=0,t.g=0,t.b=0)}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}},y=function(t){var n=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];return e.each(n,function(e,t){t.length==1&&(n[e]="0"+t)}),n.join("")},b=function(e){var e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16);return{r:e>>16,g:(e&65280)>>8,b:e&255}},w=function(e){var t={h:0,s:0,b:0},n=Math.min(e.r,e.g,e.b),r=Math.max(e.r,e.g,e.b),i=r-n;return t.b=r,t.s=r!=0?255*i/r:0,t.s!=0?e.r==r?t.h=(e.g-e.b)/i:e.g==r?t.h=2+(e.b-e.r)/i:t.h=4+(e.r-e.g)/i:t.h=-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t},E=function(e){var t=w(b(e));return t.s===0&&(t.h=360),t},S=function(e){return y(g(e))};switch(t){case"readonly":return e(this).each(function(){e(this).attr("readonly",n)}),e(this);case"disabled":return e(this).each(function(){n?o(e(this)):s(e(this))}),e(this);case"value":return e(this).each(function(){e(this).val(n).trigger("keyup")}),e(this);case"destroy":return e(this).each(function(){i(e(this))}),e(this);default:return t||(t={}),e(this).each(function(){if(e(this)[0].tagName.toLowerCase()!=="input")return;if(e(this).data("trigger"))return;r(e(this),t,n)}),e(this)}}})}(jQuery),define("lib/jquery/jquery.miniColors.min",function(){}),function(e){var t=function(){var t={},n,r=65,i,s='<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_alpha"><canvas width="150" height="17"></canvas><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="8" size="8" /></div><div class="colorpicker_rgba_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgba_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgba_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgba_a colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsba_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsba_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsba_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsba_a colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_submit"></div></div>',o={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000ff",livePreview:!0,flat:!1},u=function(t,n){var r=W(t);e(n).data("colorpicker").fields.eq(1).val(Math.round(r.r)).end().eq(2).val(Math.round(r.g)).end().eq(3).val(Math.round(r.b)).end().eq(4).val(Math.round(r.a)).end()},a=function(t,n){e(n).data("colorpicker").fields.eq(5).val(Math.round(t.h)).end().eq(6).val(Math.round(t.s)).end().eq(7).val(Math.round(t.b)).end().eq(8).val(Math.round(t.a)).end()},f=function(t,n){e(n).data("colorpicker").fields.eq(0).val(V(t)).end()},l=function(t,n){e(n).data("colorpicker").selector.css("backgroundColor",J({h:t.h,s:100,b:100,a:255})),e(n).data("colorpicker").selectorIndic.css({left:parseInt(150*t.s/100,10),top:parseInt(150*(100-t.b)/100,10)})},c=function(t,n){e(n).data("colorpicker").hue.css("top",parseInt(150-150*t.h/360,10));var r=e(n).data("colorpicker").alphaCtx,i=r.createLinearGradient(0,0,150,0);i.addColorStop(0,J({h:t.h,s:t.s,b:t.b,a:0})),i.addColorStop(1,J({h:t.h,s:t.s,b:t.b,a:100})),r.clearRect(0,0,150,17),r.fillStyle=i,r.fillRect(0,0,150,17)},h=function(t,n){e(n).data("colorpicker").alpha.css("left",parseInt(150*t.a/100,10))},p=function(t,n){e(n).data("colorpicker").currentColor.css("backgroundColor",J(t))},d=function(t,n){e(n).data("colorpicker").newColor.css("backgroundColor",J(t))},v=function(t){var n=t.charCode||t.keyCode||-1;if(n>r&&n<=90||n==32)return!1;var i=e(this).parent().parent();i.data("colorpicker").livePreview===!0&&m.apply(this)},m=function(t){var n=e(this).parent().parent(),r;this.parentNode.className.indexOf("_hex")>0?n.data("colorpicker").color=r=U(q(this.value)):this.parentNode.className.indexOf("_hsba")>0?n.data("colorpicker").color=r=F({h:parseInt(n.data("colorpicker").fields.eq(5).val(),10),s:parseInt(n.data("colorpicker").fields.eq(6).val(),10),b:parseInt(n.data("colorpicker").fields.eq(7).val(),10),a:parseInt(n.data("colorpicker").fields.eq(8).val(),10)}):n.data("colorpicker").color=r=z(I({r:parseInt(n.data("colorpicker").fields.eq(1).val(),10),g:parseInt(n.data("colorpicker").fields.eq(2).val(),10),b:parseInt(n.data("colorpicker").fields.eq(3).val(),10),a:parseInt(n.data("colorpicker").fields.eq(4).val(),10)})),t&&(u(r,n.get(0)),f(r,n.get(0)),a(r,n.get(0))),l(r,n.get(0)),c(r,n.get(0)),h(r,n.get(0)),d(r,n.get(0)),n.data("colorpicker").onChange.apply(n,[r,V(r),W(r)])},g=function(t){var n=e(this).parent().parent();n.data("colorpicker").fields.parent().removeClass("colorpicker_focus")},y=function(){r=this.parentNode.className.indexOf("_hex")>0?70:65,e(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus"),e(this).parent().addClass("colorpicker_focus")},b=function(t){var n=e(this).parent().find("input").focus(),r={el:e(this).parent().addClass("colorpicker_slider"),max:this.parentNode.className.indexOf("_hsba_h")>0?360:this.parentNode.className.indexOf("_hsba")>0?100:255,y:t.pageY,field:n,val:parseInt(n.val(),10),preview:e(this).parent().parent().data("colorpicker").livePreview};return e(document).bind("mouseup",r,E),e(document).bind("mousemove",r,w),!1},w=function(e){return e.data.field.val(Math.max(0,Math.min(e.data.max,parseInt(e.data.val+e.pageY-e.data.y,10)))),e.data.preview&&m.apply(e.data.field.get(0),[!0]),!1},E=function(t){return m.apply(t.data.field.get(0),[!0]),t.data.el.removeClass("colorpicker_slider").find("input").focus(),e(document).unbind("mouseup",E),e(document).unbind("mousemove",w),!1},S=function(t){var n={cal:e(this).parent(),y:e(this).offset().top};return n.preview=n.cal.data("colorpicker").livePreview,e(document).bind("mouseup",n,T),e(document).bind("mousemove",n,x),t.data=n,x(t),!1},x=function(e){return m.apply(e.data.cal.data("colorpicker").fields.eq(5).val(parseInt(360*(150-Math.max(0,Math.min(150,e.pageY-e.data.y)))/150,10)).get(0),[e.data.preview]),!1},T=function(t){return u(t.data.cal.data("colorpicker").color,t.data.cal.get(0)),f(t.data.cal.data("colorpicker").color,t.data.cal.get(0)),e(document).unbind("mouseup",T),e(document).unbind("mousemove",x),!1},N=function(t){var n={cal:e(this).parent(),x:e(this).offset().left};return n.preview=n.cal.data("colorpicker").livePreview,e(document).bind("mouseup",n,k),e(document).bind("mousemove",n,C),t.data=n,C(t),!1},C=function(e){return m.apply(e.data.cal.data("colorpicker").fields.eq(8).val(parseInt(100*Math.max(0,Math.min(150,e.pageX-e.data.x))/150,10)).get(0),[e.data.preview]),!1},k=function(t){return u(t.data.cal.data("colorpicker").color,t.data.cal.get(0)),f(t.data.cal.data("colorpicker").color,t.data.cal.get(0)),e(document).unbind("mouseup",k),e(document).unbind("mousemove",C),!1},L=function(t){var n={cal:e(this).parent(),pos:e(this).offset()};return n.preview=n.cal.data("colorpicker").livePreview,e(document).bind("mouseup",n,O),e(document).bind("mousemove",n,A),t.data=n,A(t),!1},A=function(e){return m.apply(e.data.cal.data("colorpicker").fields.eq(7).val(parseInt(100*(150-Math.max(0,Math.min(150,e.pageY-e.data.pos.top)))/150,10)).end().eq(6).val(parseInt(100*Math.max(0,Math.min(150,e.pageX-e.data.pos.left))/150,10)).get(0),[e.data.preview]),!1},O=function(t){return u(t.data.cal.data("colorpicker").color,t.data.cal.get(0)),f(t.data.cal.data("colorpicker").color,t.data.cal.get(0)),e(document).unbind("mouseup",O),e(document).unbind("mousemove",A),!1},M=function(t){e(this).addClass("colorpicker_focus")},_=function(t){e(this).removeClass("colorpicker_focus")},D=function(t){var n=e(this).parent(),r=n.data("colorpicker").color;n.data("colorpicker").origColor=r,p(r,n.get(0)),n.data("colorpicker").onSubmit(r,V(r),W(r),n.data("colorpicker").el)},P=function(t){var n=e("#"+e(this).data("colorpickerId"));n.data("colorpicker").onBeforeShow.apply(this,[n.get(0)]);var r=e(this).offset(),i=j(),s=r.top+this.offsetHeight,o=r.left;return s+176>i.t+i.h&&(s-=this.offsetHeight+176),o+356>i.l+i.w&&(o-=356),n.css({left:o+"px",top:s+"px"}),n.data("colorpicker").onShow.apply(this,[n.get(0)])!=0&&n.show(),e(document).bind("mousedown",{cal:n},H),!1},H=function(t){B(t.data.cal.get(0),t.target,t.data.cal.get(0))||(t.data.cal.data("colorpicker").onHide.apply(this,[t.data.cal.get(0)])!=0&&t.data.cal.hide(),e(document).unbind("mousedown",H))},B=function(e,t,n){if(e==t)return!0;if(e.contains)return e.contains(t);if(e.compareDocumentPosition)return!!(e.compareDocumentPosition(t)&16);var r=t.parentNode;while(r&&r!=n){if(r==e)return!0;r=r.parentNode}return!1},j=function(){var e=document.compatMode=="CSS1Compat";return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(e?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(e?document.documentElement.clientHeight:document.body.clientHeight)}},F=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b)),a:Math.min(100,Math.max(0,e.a))}},I=function(e){return{r:Math.min(255,Math.max(0,e.r)),g:Math.min(255,Math.max(0,e.g)),b:Math.min(255,Math.max(0,e.b)),a:Math.min(255,Math.max(0,e.a))}},q=function(e){var t=8-e.length;if(t>0){var n=[];for(var r=0;r<t;r++)n.push("0");n.push(e),e=n.join("")}return e},R=function(e){var e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16);return{r:e>>24,g:(e&16711680)>>16,b:(e&255)>>8,a:e&255}},U=function(e){return z(R(e))},z=function(e){var t={h:0,s:0,b:0,a:0},n=Math.min(e.r,e.g,e.b),r=Math.max(e.r,e.g,e.b),i=r-n;return t.b=r,r!=0,t.s=r!=0?255*i/r:0,t.s!=0?e.r==r?t.h=(e.g-e.b)/i:e.g==r?t.h=2+(e.b-e.r)/i:t.h=4+(e.r-e.g)/i:t.h=-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t.a=e.a*100/255,t},W=function(e){var t={},n=Math.round(e.h),r=Math.round(e.s*255/100),i=Math.round(e.b*255/100),s=Math.round(e.a*255/100);t.a=s;if(r==0)t.r=t.g=t.b=i;else{var o=i,u=(255-r)*i/255,a=(o-u)*(n%60)/60;n==360&&(n=0),n<60?(t.r=o,t.b=u,t.g=u+a):n<120?(t.g=o,t.b=u,t.r=o-a):n<180?(t.g=o,t.r=u,t.b=u+a):n<240?(t.b=o,t.r=u,t.g=o-a):n<300?(t.b=o,t.g=u,t.r=u+a):n<360?(t.r=o,t.g=u,t.b=o-a):(t.r=0,t.g=0,t.b=0)}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b),a:Math.round(t.a)}},X=function(t){var n=[t.r.toString(16),t.g.toString(16),t.b.toString(16),t.a.toString(16)];return e.each(n,function(e,t){t.length==1&&(n[e]="0"+t)}),n.join("")},V=function(e){return X(W(e))},J=function(e){var t=W(e),n="rgba("+Math.round(t.r)+","+Math.round(t.g)+","+Math.round(t.b)+","+Math.round(t.a/255)+")";return n},K=function(){var t=e(this).parent(),n=t.data("colorpicker").origColor;t.data("colorpicker").color=n,u(n,t.get(0)),f(n,t.get(0)),a(n,t.get(0)),l(n,t.get(0)),c(n,t.get(0)),h(n,t.get(0)),d(n,t.get(0))};return{init:function(t){t=e.extend({},o,t||{});if(typeof t.color=="string")t.color=U(t.color);else if(t.color.r!=undefined&&t.color.g!=undefined&&t.color.b!=undefined&&t.color.a!=undefined)t.color=z(t.color);else{if(t.color.h==undefined||t.color.s==undefined||t.color.b==undefined||t.color.a==undefined)return this;t.color=F(t.color)}return this.each(function(){if(!e(this).data("colorpickerId")){var n=e.extend({},t);n.origColor=t.color;var r="collorpicker_"+parseInt(Math.random()*1e3);e(this).data("colorpickerId",r);var i=e(s).attr("id",r);n.flat?i.appendTo(this).show():i.appendTo(document.body),n.fields=i.find("input").bind("keyup",v).bind("change",m).bind("blur",g).bind("focus",y),i.find("span").bind("mousedown",b).end().find(">div.colorpicker_current_color").bind("click",K),n.selector=i.find("div.colorpicker_color").bind("mousedown",L),n.selectorIndic=n.selector.find("div div"),n.el=this,n.hue=i.find("div.colorpicker_hue div"),i.find("div.colorpicker_hue").bind("mousedown",S),n.alpha=i.find("div.colorpicker_alpha div"),i.find("div.colorpicker_alpha").bind("mousedown",N),n.alphaCanvas=i.find("div.colorpicker_alpha canvas").get()[0],n.alphaCtx=n.alphaCanvas.getContext("2d"),n.newColor=i.find("div.colorpicker_new_color"),n.currentColor=i.find("div.colorpicker_current_color"),i.data("colorpicker",n),i.find("div.colorpicker_submit").bind("mouseenter",M).bind("mouseleave",_).bind("click",D),u(n.color,i.get(0)),a(n.color,i.get(0)),f(n.color,i.get(0)),c(n.color,i.get(0)),h(n.color,i.get(0)),l(n.color,i.get(0)),p(n.color,i.get(0)),d(n.color,i.get(0)),n.flat?i.css({position:"relative",display:"block"}):e(this).bind(n.eventName,P)}})},showPicker:function(){return this.each(function(){e(this).data("colorpickerId")&&P.apply(this)})},hidePicker:function(){return this.each(function(){e(this).data("colorpickerId")&&e("#"+e(this).data("colorpickerId")).hide()})},setColor:function(t){if(typeof t=="string")t=U(t);else if(t.r!=undefined&&t.g!=undefined&&t.b!=undefined&&t.a!=undefined)t=z(t);else{if(t.h==undefined||t.s==undefined||t.b==undefined||t.a==undefined)return this;t=F(t)}return this.each(function(){if(e(this).data("colorpickerId")){var n=e("#"+e(this).data("colorpickerId"));n.data("colorpicker").color=t,n.data("colorpicker").origColor=t,u(t,n.get(0)),a(t,n.get(0)),f(t,n.get(0)),c(t,n.get(0)),h(t,n.get(0)),l(t,n.get(0)),p(t,n.get(0)),d(t,n.get(0))}})}}}();e.fn.extend({ColorPicker:t.init,ColorPickerHide:t.hidePicker,ColorPickerShow:t.showPicker,ColorPickerSetColor:t.setColor})}(jQuery),define("lib/colorpicker/js/colorpicker",function(){});var locale={ABBR_MONTH_NAMES:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],MONTH_NAMES:["January","February","March","April","May","June","July","August","September","October","November","December"],formats:{DATE_SHORT:"YYYY/MM/DD",DATE_TIME:"YYYY/MM/DD HH:mm:ss"},strings:{}};define("locale",[],function(){return locale}),require.config({paths:{jqueryui:"lib/jquery-ui/js/jquery-ui-1.10.3.custom.min",underscore:"lib/underscore/underscore-min",backbone:"lib/backbone/backbone",bootstrap:"lib/bootstrap/dist/js/bootstrap.min",d3:"lib/d3/d3.v2.min",text:"lib/require/text",locale:"locale/locale.en",deepextend:"lib/backbone-deep-model/lib/underscore.mixin.deepExtend",deepmodel:"lib/backbone-deep-model/src/deep-model",backbone_super:"lib/backbone_super/backbone_super",moment:"lib/moment/moment.min",spin:"lib/spin/spin.min"},shim:{spin:{exports:"Spinner"},underscore:{exports:"_"},backbone:{deps:["underscore","jquery"],exports:"Backbone"},d3:{exports:"d3"},deepextend:{deps:["underscore"]},backbone_super:{deps:["backbone"]}}}),define("main",["jquery","underscore","backbone","map-router","jqueryui","bootstrap","backbone_super","lib/jquery/jquery.color","lib/jquery/jquery.glowing","lib/jquery/jquery.miniColors.min","lib/colorpicker/js/colorpicker","locale"],function(e,t,n,r){return r});
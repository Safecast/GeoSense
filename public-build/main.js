//     Underscore.js 1.3.1
//     (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore is freely distributable under the MIT license.
//     Portions of Underscore are inspired or borrowed from Prototype,
//     Oliver Steele's Functional, and John Resig's Micro-Templating.
//     For all details and documentation:
//     http://documentcloud.github.com/underscore

// (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.
// Backbone may be freely distributed under the MIT license.
// For all details and documentation:
// http://backbonejs.org

/**
 * @license RequireJS text 2.0.4 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/*!
 * jQuery UI 1.8.9
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 */

/*
 * jQuery Color Animations
 * Copyright 2007 John Resig
 * Released under the MIT and GPL licenses.
 */

/*!
* Bootstrap.js by @fat & @mdo
* Copyright 2012 Twitter, Inc.
* http://www.apache.org/licenses/LICENSE-2.0.txt
*/

function formatLargeNumber(e){if(e>1e6)e=Math.round(e/1e6*10)/10+"M";else if(e>5e3)e=Math.round(e/1e3)+"K";else if(e>1e3)return parseInt(e);return e}function formatDecimalNumber(e,t){if(e<10){t==null&&(t=2);var n=Math.pow(10,t);return Math.round(e*n)/n}return Math.round(e)}function autoFormatNumber(e){return e>1e3?formatLargeNumber(e):e%1!=0?formatDecimalNumber(e):e}function getURLParameter(e){var t=window.location.search.substring(1),n,r,i=t.split("&");for(n=0;n<i.length;n++){r=i[n].split("=");if(r[0]==e)return unescape(r[1])}return null}function genQueryString(e,t){var n="";if(e instanceof Array)for(var r=0;r<e.length;r++)n+=(n!=""?"&":"")+t+"="+e[r];else for(var t in e)e[t]instanceof Array?n+=(n!=""?"&":"")+genQueryString(e[t],t):n+=(n!=""?"&":"")+t+"="+e[t];return n}function nl2p(e){return e="<p>"+e.replace(/(\s*\n\s*){2}/,"</p><p>")+"</p>",e=e.replace(/(\s*\n\s*){1}/,"<br />"),e}function mathEval(exp){var reg=/(?:[a-z$_][a-z0-9$_]*)|(?:[;={}\[\]"'!&<>^\\?:])/ig,valid=!0;exp=exp.replace(reg,function(e){if(Math.hasOwnProperty(e))return"Math."+e;valid=!1});if(!valid)return console.log("Invalid arithmetic expression"),!1;try{return eval(exp)}catch(e){return console.log("Invalid arithmetic expression"),!1}}function ValFormatter(e){this.eq=e.eq,this.formatStr=e.formatStr,this.unit=e.unit}function __(e,t){var n=locale.strings[e]||e;return t?n.format(t):n}function zeroPad(e,t){return(new Array(e.length<t?t+1-e.length:0)).join("0")+e}function multRGB(e,t){var n=parseInt(e.replace("#","0x")),r=[(n&16711680)>>16,(n&65280)>>8,n&255];for(var i=r.length-1;i>=0;i--)r[i]=Math.min(255,Math.round(r[i]*t));return n=(r[0]<<16)+(r[1]<<8)+r[2],"#"+zeroPad(n.toString(16),6)}function wktCircle(e,t,n,r){var i=[],s=2*Math.PI/r;for(var o=0;o<Math.PI*2;o+=s)i.push(e.x+Math.cos(o)*t+" "+(e.y+Math.sin(o)*n));return"POLYGON(("+i.join(", ")+"))"}function genMapURI(e,t,n,r,i){var s=(r?"/admin":"")+(i?"/"+e[i]:"")+(t&&t!=""?"/"+t:"");return n&&n.x!=undefined&&n.y!=undefined&&(s+="/%(x)s,%(y)s",n.zoom!=undefined&&(s+=",%(zoom)s")),s.format(n)}function genMapURL(e,t,n){var r=!DEV&&!n&&e.host&&e.host!="";if(r)var i="http://"+e.host;else var i=BASE_URL;return i+genMapURI(e,t?t.mapViewName:null,t,n,r?!1:n?"adminslug":"publicslug")}(function(){function C(e,t,n){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e._chain&&(e=e._wrapped),t._chain&&(t=t._wrapped);if(e.isEqual&&S.isFunction(e.isEqual))return e.isEqual(t);if(t.isEqual&&S.isFunction(t.isEqual))return t.isEqual(e);var r=a.call(e);if(r!=a.call(t))return!1;switch(r){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var i=n.length;while(i--)if(n[i]==e)return!0;n.push(e);var s=0,o=!0;if(r=="[object Array]"){s=e.length,o=s==t.length;if(o)while(s--)if(!(o=s in e==s in t&&C(e[s],t[s],n)))break}else{if("constructor"in e!="constructor"in t||e.constructor!=t.constructor)return!1;for(var u in e)if(S.has(e,u)){s++;if(!(o=S.has(t,u)&&C(e[u],t[u],n)))break}if(o){for(u in t)if(S.has(t,u)&&!(s--))break;o=!s}}return n.pop(),o}var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.slice,u=r.unshift,a=i.toString,f=i.hasOwnProperty,l=r.forEach,c=r.map,h=r.reduce,p=r.reduceRight,d=r.filter,v=r.every,m=r.some,g=r.indexOf,y=r.lastIndexOf,b=Array.isArray,w=Object.keys,E=s.bind,S=function(e){return new O(e)};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=S),exports._=S):e._=S,S.VERSION="1.3.1";var x=S.each=S.forEach=function(e,t,r){if(e==null)return;if(l&&e.forEach===l)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(i in e&&t.call(r,e[i],i,e)===n)return}else for(var o in e)if(S.has(e,o)&&t.call(r,e[o],o,e)===n)return};S.map=S.collect=function(e,t,n){var r=[];return e==null?r:c&&e.map===c?e.map(t,n):(x(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),e.length===+e.length&&(r.length=e.length),r)},S.reduce=S.foldl=S.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(h&&e.reduce===h)return r&&(t=S.bind(t,r)),i?e.reduce(t,n):e.reduce(t);x(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},S.reduceRight=S.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduceRight===p)return r&&(t=S.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=S.toArray(e).reverse();return r&&!i&&(t=S.bind(t,r)),i?S.reduce(s,t,n,r):S.reduce(s,t)},S.find=S.detect=function(e,t,n){var r;return T(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},S.filter=S.select=function(e,t,n){var r=[];return e==null?r:d&&e.filter===d?e.filter(t,n):(x(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},S.reject=function(e,t,n){var r=[];return e==null?r:(x(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r)},S.every=S.all=function(e,t,r){var i=!0;return e==null?i:v&&e.every===v?e.every(t,r):(x(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),i)};var T=S.some=S.any=function(e,t,r){t||(t=S.identity);var i=!1;return e==null?i:m&&e.some===m?e.some(t,r):(x(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};S.include=S.contains=function(e,t){var n=!1;return e==null?n:g&&e.indexOf===g?e.indexOf(t)!=-1:(n=T(e,function(e){return e===t}),n)},S.invoke=function(e,t){var n=o.call(arguments,2);return S.map(e,function(e){return(S.isFunction(t)?t||e:e[t]).apply(e,n)})},S.pluck=function(e,t){return S.map(e,function(e){return e[t]})},S.max=function(e,t,n){if(!t&&S.isArray(e))return Math.max.apply(Math,e);if(!t&&S.isEmpty(e))return-Infinity;var r={computed:-Infinity};return x(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},S.min=function(e,t,n){if(!t&&S.isArray(e))return Math.min.apply(Math,e);if(!t&&S.isEmpty(e))return Infinity;var r={computed:Infinity};return x(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},S.shuffle=function(e){var t=[],n;return x(e,function(e,r,i){r==0?t[0]=e:(n=Math.floor(Math.random()*(r+1)),t[r]=t[n],t[n]=e)}),t},S.sortBy=function(e,t,n){return S.pluck(S.map(e,function(e,r,i){return{value:e,criteria:t.call(n,e,r,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;return n<r?-1:n>r?1:0}),"value")},S.groupBy=function(e,t){var n={},r=S.isFunction(t)?t:function(e){return e[t]};return x(e,function(e,t){var i=r(e,t);(n[i]||(n[i]=[])).push(e)}),n},S.sortedIndex=function(e,t,n){n||(n=S.identity);var r=0,i=e.length;while(r<i){var s=r+i>>1;n(e[s])<n(t)?r=s+1:i=s}return r},S.toArray=function(e){return e?e.toArray?e.toArray():S.isArray(e)?o.call(e):S.isArguments(e)?o.call(e):S.values(e):[]},S.size=function(e){return S.toArray(e).length},S.first=S.head=function(e,t,n){return t!=null&&!n?o.call(e,0,t):e[0]},S.initial=function(e,t,n){return o.call(e,0,e.length-(t==null||n?1:t))},S.last=function(e,t,n){return t!=null&&!n?o.call(e,Math.max(e.length-t,0)):e[e.length-1]},S.rest=S.tail=function(e,t,n){return o.call(e,t==null||n?1:t)},S.compact=function(e){return S.filter(e,function(e){return!!e})},S.flatten=function(e,t){return S.reduce(e,function(e,n){return S.isArray(n)?e.concat(t?n:S.flatten(n)):(e[e.length]=n,e)},[])},S.without=function(e){return S.difference(e,o.call(arguments,1))},S.uniq=S.unique=function(e,t,n){var r=n?S.map(e,n):e,i=[];return S.reduce(r,function(n,r,s){if(0==s||(t===!0?S.last(n)!=r:!S.include(n,r)))n[n.length]=r,i[i.length]=e[s];return n},[]),i},S.union=function(){return S.uniq(S.flatten(arguments,!0))},S.intersection=S.intersect=function(e){var t=o.call(arguments,1);return S.filter(S.uniq(e),function(e){return S.every(t,function(t){return S.indexOf(t,e)>=0})})},S.difference=function(e){var t=S.flatten(o.call(arguments,1));return S.filter(e,function(e){return!S.include(t,e)})},S.zip=function(){var e=o.call(arguments),t=S.max(S.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=S.pluck(e,""+r);return n},S.indexOf=function(e,t,n){if(e==null)return-1;var r,i;if(n)return r=S.sortedIndex(e,t),e[r]===t?r:-1;if(g&&e.indexOf===g)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(r in e&&e[r]===t)return r;return-1},S.lastIndexOf=function(e,t){if(e==null)return-1;if(y&&e.lastIndexOf===y)return e.lastIndexOf(t);var n=e.length;while(n--)if(n in e&&e[n]===t)return n;return-1},S.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var N=function(){};S.bind=function(t,n){var r,i;if(t.bind===E&&E)return E.apply(t,o.call(arguments,1));if(!S.isFunction(t))throw new TypeError;return i=o.call(arguments,2),r=function(){if(this instanceof r){N.prototype=t.prototype;var e=new N,s=t.apply(e,i.concat(o.call(arguments)));return Object(s)===s?s:e}return t.apply(n,i.concat(o.call(arguments)))}},S.bindAll=function(e){var t=o.call(arguments,1);return t.length==0&&(t=S.functions(e)),x(t,function(t){e[t]=S.bind(e[t],e)}),e},S.memoize=function(e,t){var n={};return t||(t=S.identity),function(){var r=t.apply(this,arguments);return S.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},S.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(e,n)},t)},S.defer=function(e){return S.delay.apply(S,[e,1].concat(o.call(arguments,1)))},S.throttle=function(e,t){var n,r,i,s,o,u=S.debounce(function(){o=s=!1},t);return function(){n=this,r=arguments;var a=function(){i=null,o&&e.apply(n,r),u()};i||(i=setTimeout(a,t)),s?o=!0:e.apply(n,r),u(),s=!0}},S.debounce=function(e,t){var n;return function(){var r=this,i=arguments,s=function(){n=null,e.apply(r,i)};clearTimeout(n),n=setTimeout(s,t)}},S.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments))}},S.wrap=function(e,t){return function(){var n=[e].concat(o.call(arguments,0));return t.apply(this,n)}},S.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},S.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},S.keys=w||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)S.has(e,n)&&(t[t.length]=n);return t},S.values=function(e){return S.map(e,S.identity)},S.functions=S.methods=function(e){var t=[];for(var n in e)S.isFunction(e[n])&&t.push(n);return t.sort()},S.extend=function(e){return x(o.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},S.defaults=function(e){return x(o.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},S.clone=function(e){return S.isObject(e)?S.isArray(e)?e.slice():S.extend({},e):e},S.tap=function(e,t){return t(e),e},S.isEqual=function(e,t){return C(e,t,[])},S.isEmpty=function(e){if(S.isArray(e)||S.isString(e))return e.length===0;for(var t in e)if(S.has(e,t))return!1;return!0},S.isElement=function(e){return!!e&&e.nodeType==1},S.isArray=b||function(e){return a.call(e)=="[object Array]"},S.isObject=function(e){return e===Object(e)},S.isArguments=function(e){return a.call(e)=="[object Arguments]"},S.isArguments(arguments)||(S.isArguments=function(e){return!!e&&!!S.has(e,"callee")}),S.isFunction=function(e){return a.call(e)=="[object Function]"},S.isString=function(e){return a.call(e)=="[object String]"},S.isNumber=function(e){return a.call(e)=="[object Number]"},S.isNaN=function(e){return e!==e},S.isBoolean=function(e){return e===!0||e===!1||a.call(e)=="[object Boolean]"},S.isDate=function(e){return a.call(e)=="[object Date]"},S.isRegExp=function(e){return a.call(e)=="[object RegExp]"},S.isNull=function(e){return e===null},S.isUndefined=function(e){return e===void 0},S.has=function(e,t){return f.call(e,t)},S.noConflict=function(){return e._=t,this},S.identity=function(e){return e},S.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},S.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},S.mixin=function(e){x(S.functions(e),function(t){_(t,S[t]=e[t])})};var k=0;S.uniqueId=function(e){var t=k++;return e?e+t:t},S.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/.^/,A=function(e){return e.replace(/\\\\/g,"\\").replace(/\\'/g,"'")};S.template=function(e,t){var n=S.templateSettings,r="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(n.escape||L,function(e,t){return"',_.escape("+A(t)+"),'"}).replace(n.interpolate||L,function(e,t){return"',"+A(t)+",'"}).replace(n.evaluate||L,function(e,t){return"');"+A(t).replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",i=new Function("obj","_",r);return t?i(t,S):function(e){return i.call(this,e,S)}},S.chain=function(e){return S(e).chain()};var O=function(e){this._wrapped=e};S.prototype=O.prototype;var M=function(e,t){return t?S(e).chain():e},_=function(e,t){O.prototype[e]=function(){var e=o.call(arguments);return u.call(e,this._wrapped),M(t.apply(S,e),this._chain)}};S.mixin(S),x(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];O.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);var r=n.length;return(e=="shift"||e=="splice")&&r===0&&delete n[0],M(n,this._chain)}}),x(["concat","join","slice"],function(e){var t=r[e];O.prototype[e]=function(){return M(t.apply(this._wrapped,arguments),this._chain)}}),O.prototype.chain=function(){return this._chain=!0,this},O.prototype.value=function(){return this._wrapped}}).call(this),define("underscore",function(e){return function(){var t,n;return t||e._}}(this)),function(){var e=this,t=e.Backbone,n=Array.prototype.slice,r=Array.prototype.splice,i;i="undefined"!=typeof exports?exports:e.Backbone={},i.VERSION="0.9.1";var s=e._;!s&&"undefined"!=typeof require&&(s=require("underscore"));var o=e.jQuery||e.Zepto||e.ender;i.setDomLibrary=function(e){o=e},i.noConflict=function(){return e.Backbone=t,this},i.emulateHTTP=!1,i.emulateJSON=!1,i.Events={on:function(e,t,n){for(var r,e=e.split(/\s+/),i=this._callbacks||(this._callbacks={});r=e.shift();){r=i[r]||(i[r]={});var s=r.tail||(r.tail=r.next={});s.callback=t,s.context=n,r.tail=s.next={}}return this},off:function(e,t,n){var r,i,s;if(e){if(i=this._callbacks)for(e=e.split(/\s+/);r=e.shift();)if(s=i[r],delete i[r],t&&s)for(;(s=s.next)&&s.next;)(s.callback!==t||!!n&&s.context!==n)&&this.on(r,s.callback,s.context)}else delete this._callbacks;return this},trigger:function(e){var t,r,i,s;if(!(i=this._callbacks))return this;s=i.all;for((e=e.split(/\s+/)).push(null);t=e.shift();)s&&e.push({next:s.next,tail:s.tail,event:t}),(r=i[t])&&e.push({next:r.next,tail:r.tail});for(s=n.call(arguments,1);r=e.pop();){t=r.tail;for(i=r.event?[r.event].concat(s):s;(r=r.next)!==t;)r.callback.apply(r.context||this,i)}return this}},i.Events.bind=i.Events.on,i.Events.unbind=i.Events.off,i.Model=function(e,t){var n;e||(e={}),t&&t.parse&&(e=this.parse(e));if(n=y(this,"defaults"))e=s.extend({},n,e);t&&t.collection&&(this.collection=t.collection),this.attributes={},this._escapedAttributes={},this.cid=s.uniqueId("c");if(!this.set(e,{silent:!0}))throw Error("Can't create an invalid model");delete this._changed,this._previousAttributes=s.clone(this.attributes),this.initialize.apply(this,arguments)},s.extend(i.Model.prototype,i.Events,{idAttribute:"id",initialize:function(){},toJSON:function(){return s.clone(this.attributes)},get:function(e){return this.attributes[e]},escape:function(e){var t;return(t=this._escapedAttributes[e])?t:(t=this.attributes[e],this._escapedAttributes[e]=s.escape(null==t?"":""+t))},has:function(e){return null!=this.attributes[e]},set:function(e,t,n){var r,o;s.isObject(e)||null==e?(r=e,n=t):(r={},r[e]=t),n||(n={});if(!r)return this;r instanceof i.Model&&(r=r.attributes);if(n.unset)for(o in r)r[o]=void 0;if(!this._validate(r,n))return!1;this.idAttribute in r&&(this.id=r[this.idAttribute]);var t=this.attributes,u=this._escapedAttributes,a=this._previousAttributes||{},f=this._setting;this._changed||(this._changed={}),this._setting=!0;for(o in r)if(e=r[o],s.isEqual(t[o],e)||delete u[o],n.unset?delete t[o]:t[o]=e,this._changing&&!s.isEqual(this._changed[o],e)&&(this.trigger("change:"+o,this,e,n),this._moreChanges=!0),delete this._changed[o],!s.isEqual(a[o],e)||s.has(t,o)!=s.has(a,o))this._changed[o]=e;return f||(!n.silent&&this.hasChanged()&&this.change(n),this._setting=!1),this},unset:function(e,t){return(t||(t={})).unset=!0,this.set(e,null,t)},clear:function(e){return(e||(e={})).unset=!0,this.set(s.clone(this.attributes),e)},fetch:function(e){var e=e?s.clone(e):{},t=this,n=e.success;return e.success=function(r,i,s){if(!t.set(t.parse(r,s),e))return!1;n&&n(t,r)},e.error=i.wrapError(e.error,t,e),(this.sync||i.sync).call(this,"read",this,e)},save:function(e,t,n){var r,o;s.isObject(e)||null==e?(r=e,n=t):(r={},r[e]=t),n=n?s.clone(n):{},n.wait&&(o=s.clone(this.attributes)),e=s.extend({},n,{silent:!0});if(r&&!this.set(r,n.wait?e:n))return!1;var u=this,a=n.success;return n.success=function(e,t,i){t=u.parse(e,i),n.wait&&(t=s.extend(r||{},t));if(!u.set(t,n))return!1;a?a(u,e):u.trigger("sync",u,e,n)},n.error=i.wrapError(n.error,u,n),t=this.isNew()?"create":"update",t=(this.sync||i.sync).call(this,t,this,n),n.wait&&this.set(o,e),t},destroy:function(e){var e=e?s.clone(e):{},t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};if(this.isNew())return r();e.success=function(i){e.wait&&r(),n?n(t,i):t.trigger("sync",t,i,e)},e.error=i.wrapError(e.error,t,e);var o=(this.sync||i.sync).call(this,"delete",this,e);return e.wait||r(),o},url:function(){var e=y(this.collection,"url")||y(this,"urlRoot")||b();return this.isNew()?e:e+("/"==e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(e){if(this._changing||!this.hasChanged())return this;this._moreChanges=this._changing=!0;for(var t in this._changed)this.trigger("change:"+t,this,this._changed[t],e);for(;this._moreChanges;)this._moreChanges=!1,this.trigger("change",this,e);return this._previousAttributes=s.clone(this.attributes),delete this._changed,this._changing=!1,this},hasChanged:function(e){return arguments.length?this._changed&&s.has(this._changed,e):!s.isEmpty(this._changed)},changedAttributes:function(e){if(!e)return this.hasChanged()?s.clone(this._changed):!1;var t,n=!1,r=this._previousAttributes,i;for(i in e)s.isEqual(r[i],t=e[i])||((n||(n={}))[i]=t);return n},previous:function(e){return!arguments.length||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return s.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(e,t){if(t.silent||!this.validate)return!0;var e=s.extend({},this.attributes,e),n=this.validate(e,t);return n?(t&&t.error?t.error(this,n,t):this.trigger("error",this,n,t),!1):!0}}),i.Collection=function(e,t){t||(t={}),t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,{silent:!0,parse:t.parse})},s.extend(i.Collection.prototype,i.Events,{model:i.Model,initialize:function(){},toJSON:function(){return this.map(function(e){return e.toJSON()})},add:function(e,t){var n,i,o,u,a,f={},l={};t||(t={}),e=s.isArray(e)?e.slice():[e];for(n=0,i=e.length;n<i;n++){if(!(o=e[n]=this._prepareModel(e[n],t)))throw Error("Can't add an invalid model to a collection");if(f[u=o.cid]||this._byCid[u]||null!=(a=o.id)&&(l[a]||this._byId[a]))throw Error("Can't add the same model to a collection twice");f[u]=l[a]=o}for(n=0;n<i;n++)(o=e[n]).on("all",this._onModelEvent,this),this._byCid[o.cid]=o,null!=o.id&&(this._byId[o.id]=o);this.length+=i,r.apply(this.models,[null!=t.at?t.at:this.models.length,0].concat(e)),this.comparator&&this.sort({silent:!0});if(t.silent)return this;for(n=0,i=this.models.length;n<i;n++)f[(o=this.models[n]).cid]&&(t.index=n,o.trigger("add",o,this,t));return this},remove:function(e,t){var n,r,i,o;t||(t={}),e=s.isArray(e)?e.slice():[e];for(n=0,r=e.length;n<r;n++)if(o=this.getByCid(e[n])||this.get(e[n]))delete this._byId[o.id],delete this._byCid[o.cid],i=this.indexOf(o),this.models.splice(i,1),this.length--,t.silent||(t.index=i,o.trigger("remove",o,this,t)),this._removeReference(o);return this},get:function(e){return null==e?null:this._byId[null!=e.id?e.id:e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},sort:function(e){e||(e={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");var t=s.bind(this.comparator,this);return 1==this.comparator.length?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("reset",this,e),this},pluck:function(e){return s.map(this.models,function(t){return t.get(e)})},reset:function(e,t){e||(e=[]),t||(t={});for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return this._reset(),this.add(e,{silent:!0,parse:t.parse}),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?s.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r,i,s){t[e.add?"add":"reset"](t.parse(r,s),e),n&&n(t,r)},e.error=i.wrapError(e.error,t,e),(this.sync||i.sync).call(this,"read",this,e)},create:function(e,t){var n=this,t=t?s.clone(t):{},e=this._prepareModel(e,t);if(!e)return!1;t.wait||n.add(e,t);var r=t.success;return t.success=function(i,s){t.wait&&n.add(i,t),r?r(i,s):i.trigger("sync",e,s,t)},e.save(null,t),e},parse:function(e){return e},chain:function(){return s(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,t){return e instanceof i.Model?e.collection||(e.collection=this):(t.collection=this,e=new this.model(e,t),e._validate(e.attributes,t)||(e=!1)),e},_removeReference:function(e){this==e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){("add"==e||"remove"==e)&&n!=this||("destroy"==e&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],this._byId[t.id]=t),this.trigger.apply(this,arguments))}}),s.each("forEach,each,map,reduce,reduceRight,find,detect,filter,select,reject,every,all,some,any,include,contains,invoke,max,min,sortBy,sortedIndex,toArray,size,first,initial,rest,last,without,indexOf,shuffle,lastIndexOf,isEmpty,groupBy".split(","),function(e){i.Collection.prototype[e]=function(){return s[e].apply(s,[this.models].concat(s.toArray(arguments)))}}),i.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)};var u=/:\w+/g,a=/\*\w+/g,f=/[-[\]{}()+?.,\\^$|#\s]/g;s.extend(i.Router.prototype,i.Events,{initialize:function(){},route:function(e,t,n){return i.history||(i.history=new i.History),s.isRegExp(e)||(e=this._routeToRegExp(e)),n||(n=this[t]),i.history.route(e,s.bind(function(r){r=this._extractParameters(e,r),n&&n.apply(this,r),this.trigger.apply(this,["route:"+t].concat(r)),i.history.trigger("route",this,t,r)},this)),this},navigate:function(e,t){i.history.navigate(e,t)},_bindRoutes:function(){if(this.routes){var e=[],t;for(t in this.routes)e.unshift([t,this.routes[t]]);t=0;for(var n=e.length;t<n;t++)this.route(e[t][0],e[t][1],this[e[t][1]])}},_routeToRegExp:function(e){return e=e.replace(f,"\\$&").replace(u,"([^/]+)").replace(a,"(.*?)"),RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}}),i.History=function(){this.handlers=[],s.bindAll(this,"checkUrl")};var l=/^[#\/]/,c=/msie [\w.]+/,h=!1;s.extend(i.History.prototype,i.Events,{interval:50,getFragment:function(e,t){if(null==e)if(this._hasPushState||t){var e=window.location.pathname,n=window.location.search;n&&(e+=n)}else e=window.location.hash;return e=decodeURIComponent(e),e.indexOf(this.options.root)||(e=e.substr(this.options.root.length)),e.replace(l,"")},start:function(e){if(h)throw Error("Backbone.history has already been started");this.options=s.extend({},{root:"/"},this.options,e),this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.options.pushState||!window.history||!window.history.pushState);var e=this.getFragment(),t=document.documentMode;if(t=c.exec(navigator.userAgent.toLowerCase())&&(!t||7>=t))this.iframe=o('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(e);this._hasPushState?o(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!t?o(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=e,h=!0,e=window.location,t=e.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!t)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&t&&e.hash&&(this.fragment=e.hash.replace(l,""),window.history.replaceState({},document.title,e.protocol+"//"+e.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){o(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),h=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();e==this.fragment&&this.iframe&&(e=this.getFragment(this.iframe.location.hash));if(e==this.fragment||e==decodeURIComponent(this.fragment))return!1;this.iframe&&this.navigate(e),this.loadUrl()||this.loadUrl(window.location.hash)},loadUrl:function(e){var t=this.fragment=this.getFragment(e);return s.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0})},navigate:function(e,t){if(!h)return!1;if(!t||!0===t)t={trigger:t};var n=(e||"").replace(l,"");this.fragment==n||this.fragment==decodeURIComponent(n)||(this._hasPushState?(0!=n.indexOf(this.options.root)&&(n=this.options.root+n),this.fragment=n,window.history[t.replace?"replaceState":"pushState"]({},document.title,n)):this._wantsHashChange?(this.fragment=n,this._updateHash(window.location,n,t.replace),this.iframe&&n!=this.getFragment(this.iframe.location.hash)&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,n,t.replace))):window.location.assign(this.options.root+e),t.trigger&&this.loadUrl(e))},_updateHash:function(e,t,n){n?e.replace(e.toString().replace(/(javascript:|#).*$/,"")+"#"+t):e.hash=t}}),i.View=function(e){this.cid=s.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()};var p=/^(\S+)\s*(.*)$/,d="model,collection,el,id,attributes,className,tagName".split(",");s.extend(i.View.prototype,i.Events,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(e,t,n){return e=document.createElement(e),t&&o(e).attr(t),n&&o(e).html(n),e},setElement:function(e,t){return this.$el=o(e),this.el=this.$el[0],!1!==t&&this.delegateEvents(),this},delegateEvents:function(e){if(e||(e=y(this,"events"))){this.undelegateEvents();for(var t in e){var n=e[t];s.isFunction(n)||(n=this[e[t]]);if(!n)throw Error('Event "'+e[t]+'" does not exist');var r=t.match(p),i=r[1],r=r[2],n=s.bind(n,this),i=i+(".delegateEvents"+this.cid);""===r?this.$el.bind(i,n):this.$el.delegate(r,i,n)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=s.extend({},this.options,e));for(var t=0,n=d.length;t<n;t++){var r=d[t];e[r]&&(this[r]=e[r])}this.options=e},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var e=y(this,"attributes")||{};this.id&&(e.id=this.id),this.className&&(e["class"]=this.className),this.setElement(this.make(this.tagName,e),!1)}}}),i.Model.extend=i.Collection.extend=i.Router.extend=i.View.extend=function(e,t){var n=g(this,e,t);return n.extend=this.extend,n};var v={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};i.sync=function(e,t,n){var r=v[e],u={type:r,dataType:"json"};return n.url||(u.url=y(t,"url")||b()),!n.data&&t&&("create"==e||"update"==e)&&(u.contentType="application/json",u.data=JSON.stringify(t.toJSON())),i.emulateJSON&&(u.contentType="application/x-www-form-urlencoded",u.data=u.data?{model:u.data}:{}),i.emulateHTTP&&("PUT"===r||"DELETE"===r)&&(i.emulateJSON&&(u.data._method=r),u.type="POST",u.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r)}),"GET"!==u.type&&!i.emulateJSON&&(u.processData=!1),o.ajax(s.extend(u,n))},i.wrapError=function(e,t,n){return function(r,i){i=r===t?i:r,e?e(t,i,n):t.trigger("error",t,i,n)}};var m=function(){},g=function(e,t,n){var r;return r=t&&t.hasOwnProperty("constructor")?t.constructor:function(){e.apply(this,arguments)},s.extend(r,e),m.prototype=e.prototype,r.prototype=new m,t&&s.extend(r.prototype,t),n&&s.extend(r,n),r.prototype.constructor=r,r.__super__=e.prototype,r},y=function(e,t){return!e||!e[t]?null:s.isFunction(e[t])?e[t]():e[t]},b=function(){throw Error('A "url" property or function must be specified')}}.call(this),define("backbone",["underscore","jquery"],function(e){return function(){var t,n;return t||e.Backbone}}(this));var IS_BROWSER=this.Document&&!0;IS_BROWSER&&define("config",[],function(){return{}});var DEV=IS_BROWSER&&window.location.href.indexOf(":3000")!=-1,DEBUG=DEV,BASE_URL="http://"+(DEV?"localhost:3000":"geosense.herokuapp.com"),CLOUDMADE_KEY="0a77f5f7d290465f9fe419f4ee788c50",MapStatus={PRIVATE:"P",PUBLIC:"A"};DataStatus={IMPORTING:"I",UNREDUCED:"U",REDUCING:"R",COMPLETE:"C",UNREDUCED_INC:"UI"};var FeatureType={POINTS:"P",CELLS:"C",BUBBLES:"B",POLYGONS:"Y"};FeatureType.DEFAULT=FeatureType.CELLS;var MapLayerType={POINTS:"P",SHAPES:"S"},ColorType={SOLID:"S",LINEAR_GRADIENT:"L",PALETTE:"P"};ColorType.DEFAULT=ColorType.SOLID;var UnitFormat={LEGEND:"%(value)s"},COLOR_GRADIENT_STEP=null,DEFAULT_FEATURE_OPACITY=.75,DEFAULT_SELECTED_FEATURE_OPACITY=DEFAULT_FEATURE_OPACITY+(1-DEFAULT_FEATURE_OPACITY)/2,MIN_BUBBLE_SIZE=2,MAX_BUBBLE_SIZE=60,DEFAULT_SELECTED_STROKE_COLOR="#eee",DEFAULT_POINT_RADIUS=7,DEFAULT_POINT_STROKE_WIDTH=1,DEFAULT_SELECTED_STROKE_WIDTH=2,MIN_POLYGON_STROKE_WIDTH=2,MAX_POLYGON_STROKE_WIDTH=DEFAULT_POINT_RADIUS*4,CROP_DISTRIBUTION_RATIO=.1,DEFAULT_MAP_VIEW_BASE="gm",DEFAULT_MAP_STYLE="dark",DEFAULT_MAP_AREA={center:[0,0],zoom:0},MAP_NUM_ZOOM_LEVELS=20;if(!IS_BROWSER)module.exports={MapStatus:MapStatus,FeatureType:FeatureType,ColorType:ColorType,MapLayerType:MapLayerType};else if(!DEBUG||typeof console=="undefined"||typeof console.log=="undefined")var console={log:function(){}};define("utils",[],function(){return{}}),$.fn.updateFeedback=function(){this.each(function(){$(this).tempGlow({textColor:"#00C9FF",haloColor:"#008cbf",duration:1e3})})},$.fn.blink=function(){var e;(e=function(){progressElement.delay(1e3).animate({opacity:1},"slow").delay(1e3).animate({opacity:.2},"slow",e)})()};var lpad=function(e,t,n){var r=new String(e);while(r.length<n)r=t+r;return r};ValFormatter.prototype.format=function(e){if(this.eq){var t=this.eq.format({val:e});e=mathEval(t)}return this.formatStr?this.formatStr.format({val:e}):autoFormatNumber(e)},String.prototype.format=function(e){return this.replace(/\%\(([a-z0-9_]+)\)([sif])/ig,function(t,n,r){return typeof e[n]!="undefined"?e[n]:t})},Date.prototype.format=function(e){var t=this;return e.replace(/\%([a-z0-9_]+)/ig,function(e,n,r){return typeof t.formatReplacements[n]!="undefined"?t.formatReplacements[n].call(t):e})},Date.prototype.formatReplacements={d:function(){return lpad(this.getDate(),"0",2)},m:function(){return lpad(this.getMonth()+1,"0",2)},Y:function(){return this.getFullYear()},y:function(){return(new String(this.getFullYear())).substr(2,2)},B:function(){return locale.MONTH_NAMES[this.getMonth()]},b:function(){return locale.ABBR_MONTH_NAMES[this.getMonth()]}},define("text",["module"],function(e){var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,o=typeof location!="undefined"&&location.href,u=o&&location.protocol&&location.protocol.replace(/\:/,""),a=o&&location.hostname,f=o&&(location.port||undefined),l=[],c=e.config&&e.config()||{};t={version:"2.0.4",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:c.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,c.isBuild&&(l[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}c.isBuild=i.isBuild;var s=t.parseName(e),l=s.moduleName+(s.ext?"."+s.ext:""),h=n.toUrl(l),p=c.useXhr||t.useXhr;!o||p(h,u,a,f)?t.get(h,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([l],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(l.hasOwnProperty(n)){var s=t.jsEscape(l[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(c.env==="node"||!c.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("﻿")===0&&(r=r.substring(1)),t(r)};else if(c.env==="xhr"||!c.env&&t.createXhr())t.get=function(e,n,r){var i=t.createXhr();i.open("GET",e,!0),c.onXhr&&c.onXhr(i,e),i.onreadystatechange=function(t){var s,o;i.readyState===4&&(s=i.status,s>399&&s<600?(o=new Error(e+" HTTP status: "+s),o.xhr=i,r(o)):n(i.responseText))},i.send(null)};else if(c.env==="rhino"||!c.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};return t}),define("text!templates/homepage.html",[],function(){return'<div class=\'header\'>\n	<div class=\'mit-logo\'></div>\n	<div class=\'links\'>\n		<div class=\'link\'><a href="http://media.mit.edu" target="_blank">A MEDIA LAB PROJECT</a></div>\n		<div class=\'divider\'></div>\n		<div class=\'link\'><a data-toggle="modal" href="#aboutModal">ABOUT GEOSENSE</a></div>\n		<div class=\'divider\'></div>\n		<div class=\'link\'><a data-toggle="modal" href="#usageModal">USAGE POLICY</a></div>\n	</div>\n	<div class=\'git-logo\'><a href="https://github.com/tonydevincenzi/geo" target="_blank">GITHUB</a></div>\n</div>\n<div class=\'hero-dark\'>\n	<div class=\'type\'>\n		<h1>GeoSense</h1>\n		<h2>Create and share beautiful geospatial visualizations</h2>\n	</div>\n	<div class="create">\n		<div class="label label-important" id=\'errorMessage\'>Oops. That\'s not a valid map name.</div>\n		\n		<div class="fields">\n			<input id="appendedPrependedInput" placeholder="What should we call your map?" type="text">\n			<button class="btn" id="createMap" type="button">create</button>\n		</div>\n		\n	</div>\n</div>\n<div class=\'learn\'>\n	<div class="learn-container">\n		<div class="navigator">\n			<div class=\'title\'><p>Using GeoSense</p></div>\n			<div class=\'step\'><h2 class=\'active\'>CREATE A MAP</h2></div>\n			<div class=\'arrow\'></div>\n			<div class=\'step\'><h2>LOAD YOUR DATA</h2></div>\n			<div class=\'arrow\'></div>\n			<div class=\'step\'><h2>SHARE AND DISCUSS</h2></div>\n		</div>\n		<div class="section one">\n			<div class="image"></div>\n			<!--<div class="title"><h2>See your data in 2d (Google Maps) and 3D (webGL)</h2></div>-->\n			<div class="description"><p>Easily add your data as json, xml, or csv, and see it come to life on 2D and 3D maps.</p></div>\n		</div>\n	</div>\n</div>\n<div class=\'recent\'>\n	<div class=\'type\'>\n		<h1>RECENT & AWESOME</h1><br>\n		<h2>Maps we think you’ll love, because we do.</h2>\n	</div>\n	<div class=\'super-feature\'>\n		<div class=\'feature\'><p>Super Feature Name</p></div>\n		<div class=\'feature two\'><p>Super Feature Name</p></div>	\n	</div>\n	<div class=\'recent-table\'>\n		<table id=\'mapTable\' class="map-table">\n			<tr>\n		    	<th>Map Name</th>\n		    	<th>Unique URL</th>\n		   	</tr>\n		</table>\n		<ul class="pager">\n		  <li class="next">\n		    <a id="nextMapSet">More &rarr;</a>\n		  </li>\n		</ul>\n	</div>\n	  	\n</div>\n	\n<div class="modal fade" id="aboutModal">\n  <div class="modal-header">\n    <a class="close" data-dismiss="modal">×</a>\n    <h3>About GeoSense</h3>\n  </div>\n  <div class="modal-body">\n       <p>GeoSense is an open publishing platform for visualization, social sharing, and data analysis of geospatial data. It explores the power of data analysis through robust layering and highly customizable data visualization. GeoSense supports the simultaneous comparison and individual styling for multiple massive data sources ranging from 10 thousand to 10 million geolocated points.\n\n    It was developed by Anthony DeVincenzi and Samuel Luescher of the MIT Media Lab, alongside Hiroshi Ishii and Safecast.org.\n    </p>\n  </div>\n  <div class="modal-footer">\n    <a href="#" class="btn">Close</a>\n    <a href="#" class="btn btn-primary">Save changes</a>\n  </div>\n</div>\n\n<div class="modal fade" id="usageModal">\n  <div class="modal-header">\n    <a class="close" data-dismiss="modal">×</a>\n    <h3>Using GeoSense</h3>\n  </div>\n  <div class="modal-body">\n    <p>Be nice!</p>\n  </div>\n  <div class="modal-footer">\n    <a href="#" class="btn">Close</a>\n    <a href="#" class="btn btn-primary">Save changes</a>\n  </div>\n</div>'}),define("views/homepage-view",["jquery","underscore","backbone","config","utils","text!templates/homepage.html"],function(e,t,n,r,s,o){var u=n.View.extend({tagName:"div",className:"homepage-view",events:{"click #createMap":"createMapButtonClicked","click #nextMapSet":"nextMapSetClicked"},initialize:function(e){this.template=t.template(o),this.fetchFeaturedMaps(),this.featuredMaps=[],this.featuredMapSet=0,this.numberOfMapsDisplay=5},render:function(){return console.log(this.el),e(this.el).html(this.template()),this},fetchFeaturedMaps:function(){var t=this;e.ajax({type:"GET",url:"/api/maps/featured",success:function(e){for(i=0;i<e.length;i++){var n=genMapURL(e[i]);t.featuredMaps.push("<tr><td>"+e[i].title+'</td><td><a target="_self" href="'+n+'">'+n+"</a></td><tr>")}t.showRecentMaps()},error:function(){console.error("failed to fetch unique map")}})},showRecentMaps:function(){this.featuredMapSet+this.numberOfMapsDisplay>=this.featuredMaps.length&&this.$("#nextMapSet").fadeOut("fast");var e=this;e.$("#mapTable").fadeOut("fast",function(){e.$("#mapTable").empty();for(i=e.featuredMapSet;i<e.numberOfMapsDisplay+e.featuredMapSet;i++)e.$("#mapTable").append(e.featuredMaps[i]);e.$("#mapTable").fadeIn("fast")})},nextMapSetClicked:function(){this.featuredMapSet+=this.numberOfMapsDisplay,this.showRecentMaps()},createMapButtonClicked:function(){var t=this,n={title:this.$("#appendedPrependedInput").val()};!n.title||n.title==""?this.$("#errorMessage").show():(console.log("creating map",n),e.ajax({type:"POST",url:"/api/map",data:n,success:function(e){window.location.href="/admin/"+e.publicslug+"/setup"},error:function(){console.error("failed to create a new map")}}))}});return u}),define("text!templates/header.html",[],function(){return'<div class="navbar navbar-fixed-top">\n	<div class="state" id="stateIndicator">\n		<div class="message">\n			<h4 id="stateIndicatorMessage"><h4>\n		</div>\n	</div>\n	<div class="navbar-inner">\n		<div class="container-fluid">\n			<a class="brand" href="#"></a>\n			<div class="nav-collapse">\n				<ul class="nav">\n					<li class="divider-vertical"></li>\n					<li class="dropdown">\n						<a href="#"\n							class="dropdown-toggle"\n							data-toggle="dropdown">About\n							<b class="caret"></b>\n						</a>\n						<ul class="dropdown-menu">\n							<li id="aboutMap"><a href="#">About this map</a></li>\n							<li id="authorLink"><a href="#"><span class="text"></span> <span class="icon icon-chevron-right half-opacity" /></span></a></li>\n							<li class="divider"></li>\n							<li id="aboutGeoSense"><a href="#">About GeoSense</a></li>\n							<li><a href="http://www.media.mit.edu/" target="_blank">MIT Media Lab <span class="icon icon-chevron-right half-opacity" /></a></li>\n						</ul>\n					</li>\n					<li class="dropdown">\n						<a class="dropdown-toggle"\n							data-toggle="dropdown">Share\n							<b class="caret"></b>\n						</a>\n						<ul class="dropdown-menu">\n							<li id="shareLink"><a href="#">Link or embed</a></li>\n							<li id="postTwitter"><a href="#">Post to Twitter</a></li>\n							<li id="postFacebook"><a href="#">Share on Facebook</a></li>\n						</ul>\n					</li>\n					<li class="divider-vertical"></li>\n\n				</ul>\n\n				<ul id="mapView" class="nav nav-pills">\n					<li id="navMap" class="active">\n				    	<a href="#map">Map</a>\n				  	</li>\n				  	<!--<li id="navGlobe"  class="">\n				    	<a href="#globe">3D Globe</a>\n					</li>-->\n				</ul>\n				<ul id="viewStyle" class="nav">\n					<li class="dropdown">\n						<a href="#"\n							class="dropdown-toggle"\n							data-toggle="dropdown">Style: <span id="viewStyleCurrent"></span>\n							<b class="caret"></b>\n						</a>\n						<ul class="dropdown-menu">\n						</ul>\n					</li>\n				</ul>\n				<ul id="viewBase" class="nav">\n					<li class="dropdown">\n						<a href="#"\n							class="dropdown-toggle"\n							data-toggle="dropdown">Base: <span id="viewBaseCurrent"></span>\n							<b class="caret"></b>\n						</a>\n						<ul class="dropdown-menu">\n						</ul>\n					</li>\n				</ul>\n\n<!-- 				<div class=\'graph\' id=\'graphButton\'><div class=\'icon\'></div></div>\n -->				<div class=\'setup\' id=\'setupButton\'><div class=\'icon\'></div></div>\n				<input type="text" class="search-query" id="search" placeholder="Search address">\n			</div>\n		</div>\n	</div>\n</div>\n'}),define("views/header-view",["jquery","underscore","backbone","config","utils","text!templates/header.html"],function(e,t,n,r,i,s){var o=n.View.extend({tagName:"div",className:"header-view",events:{"click #aboutMap":"aboutMapClicked","click #aboutGeoSense":"aboutGeoSenseClicked","click #shareLink":"shareLinkClicked","click #postFacebook":"postFacebookClicked","click #postTwitter":"postTwitterClicked","click #setupButton":"setupButtonClicked","click #graphButton":"graphButtonClicked","click #mapView a":"mapViewToggleClicked","click #viewBase .dropdown-menu a":"viewBaseToggleClicked","click #viewStyle .dropdown-menu a":"viewStyleToggleClicked","keypress input":"keyEvent"},initialize:function(e){this.template=t.template(s),this.vent=e.vent,this.mapInfo=e.mapInfo,t.bindAll(this,"setStateType"),this.vent.bind("setStateType",this.setStateType),t.bindAll(this,"updateMapInfo"),e.vent.bind("updateMapInfo",this.updateMapInfo)},render:function(){return e(this.el).html(this.template()),this.updateMapInfo(),app.isMapAdmin()||(this.$("#setupButton").remove(),this.$("#graphButton").css("right",270)),this},keyEvent:function(t){if(t.keyCode==13&&this.$("#search").is(":focus")){this.$("#search").blur();var n=e("#search").val();n!=""&&this.vent.trigger("geocodeAndSetMapLocation",n)}},updateMapInfo:function(e){e&&(this.mapInfo=e),this.$(".brand").attr("href",app.genPublicURL()),this.$(".brand").click(function(){return app.mapView.setVisibleMapArea(app.getDefaultVisibleMapArea()),!1}),this.mapInfo.linkURL?(this.$("#authorLink").show(),this.$("#authorLink a").attr("href",this.mapInfo.linkURL),this.$("#authorLink .text").text(this.mapInfo.linkTitle||this.mapInfo.title)):this.$("#authorLink").hide(),this.$(".brand").html("<h1>GeoSense</h1><h3>"+this.mapInfo.title+"</h3>")},mapViewToggleClicked:function(e){var t=e.currentTarget,n=t.href.split("#")[1];n!=app.mapViewName&&app.navigate(app.genMapURI(n),{trigger:!0}),e.preventDefault()},viewBaseToggleClicked:function(e){var t=e.currentTarget,n=t.href.split("#")[1];app.setViewBase(n),e.preventDefault()},viewStyleToggleClicked:function(e){var t=e.currentTarget,n=t.href.split("#")[1];app.setViewStyle(n),e.preventDefault()},graphButtonClicked:function(t){app.graphVisible==1?(app.graphVisible=!1,e(".graph-view").removeClass("visible"),e(".header-view .graph").removeClass("active")):(app.graphVisible=!0,e(".graph-view").addClass("visible"),e(".header-view .graph").addClass("active"),this.vent.trigger("drawGraph")),t.preventDefault()},setupButtonClicked:function(e){app.showSetupView(),e.preventDefault()},aboutGeoSenseClicked:function(e){app.showAbout(),e.preventDefault()},aboutMapClicked:function(e){app.showMapInfo(),e.preventDefault()},shareLinkClicked:function(e){app.showShareLink(),e.preventDefault()},postTwitterClicked:function(t){var n={},r=app.genPublicURL(!0);n.url=r,n.text=__("Check out the %(title)s map:",{url:r,title:this.mapInfo.title}),this.mapInfo.twitter&&(n.via=this.mapInfo.twitter);var r="https://twitter.com/share?"+e.param(n);window.open(r,__("Tweet this post"),"width=650,height=251,toolbar=0,scrollbars=0,status=0,resizable=0,location=0,menuBar=0"),t.preventDefault()},postFacebookClicked:function(e){var t="http://www.facebook.com/sharer.php?u=";t+=encodeURIComponent(app.genPublicURL(!0)),t+="&t="+encodeURIComponent(__("Check out the %(title)s map",{title:this.mapInfo.title})),window.open(""+t,__("Share it on Facebook"),"width=650,height=251,toolbar=0,scrollbars=0,status=0,resizable=0,location=0,menuBar=0"),e.preventDefault()},setStateType:function(e,t){var n=this.$("#stateIndicator"),r=this.$("#stateIndicatorMessage")},remove:function(){return e(window).unbind(),e(this.el).remove(),this}});return o}),define("text!templates/sidebar.html",[],function(){return'<div class="settings-tab" id="settingsTab"><h4 id="settingsTabText">HIDE</h4></div>\n<div class="data-container" id="dataContainer">\n	<div class="accordion">\n		<!-- <div class="accordion-group" id="comments">			\n		  <div class="accordion-heading">\n		    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseOne">Comments</a>\n		  </div>\n		  <div id="collapseOne" class="accordion-body collapse">\n		    <div class="accordion-inner">\n				<div class="data-toggle">\n					<div class="btn-group" data-toggle="buttons-radio">\n					  <button class="btn active" id="toggleCommentsVisible">Visible</button>\n					  <button class="btn" id="toggleCommentsHidden">Hidden</button>\n					</div>\n				</div>\n		    </div>\n		  </div>\n		</div> -->\n	</div>\n	<div class="toggle-group" id="dataManager">\n		<div class="data-toggle double">\n			<button class="btn data first" id="addData">Add New Data</button>\n			<button class="btn data second" id="addDataLibrary">Browse Data Library</button>\n		</div>\n	</div>\n	<div class="toggle-group">\n		<div class="data-toggle">\n			<button class="btn data third" id="savePosition" disabled="disabled">Save default position</button>\n		</div>\n	</div>\n</div>'}),define("text!templates/add-data.html",[],function(){return'<div class="modal fade" id="addDataModal">\n  <div class="modal-header">\n    <a class="close" data-dismiss="modal">×</a>\n    <h3 class="title">Add Your Awesome Data</h3>\n  </div>\n  <div class="modal-body">\n\n	<!-- Selecting Data Source/File -->\n    <div class="add">\n		<div class="well form-inline">\n			\n		  <input type="text" id="titleInput" class="input-small" placeholder="Enter a title for your dataset" value=""></input> \n		  <textarea id="descriptionInput" class="input-small" placeholder="Enter a description of your dataset" value=""></textarea> \n		</div>\n		<ul id="tab" class="nav nav-tabs">\n			<li><span class="label">Select a data type</span></li>\n			<li class="active"><a href="#JSON" data-toggle="tab">JSON</a></li>\n		 	<li><a href="#XML" data-toggle="tab">XML</a></li>\n		 	<li><a href="#CSV" data-toggle="tab">CSV</a></li>\n			<li><a href="#GoogleFusion" data-toggle="tab">Google Fusion</a></li>\n		</ul>\n		<div id="myTabContent" class="tab-content">\n			<div class="tab-pane fade" id="XML">\n			</div>\n			<div class="tab-pane fade" id="CSV">\n			</div>\n			<div class="tab-pane fade active in" id="JSON">\n				<div class="form-inline">\n					<input type="text" id="fileInput" class="input-large" placeholder="Select a file..." value=""></input>\n					<a href="#" class="btn large"><p>Browse</p></a>\n			    </div><br>\n				<select id="converter">\n					<option value="earthquakes">Earthquake Dataset</option>\n	             	<option value="">Standard (loc, val, date)</option>            	\n	             	<option value="reactors">Nuclear Reactors</option>\n	             	<option value="safecast" selected="selected">Safecast Dataset</option>\n				 </select>\n			</div>\n			<div class="tab-pane fade" id="GoogleFusion">\n			</div>\n		</div>\n    </div>\n\n	<!-- Review data -->\n	<div class="review">\n		<label>Almost there! Drag the labels below onto their matching columns</label>\n    	<div class="well">\n			<div>\n			    <span class="label lat" id="dragLabel">Latitude</span>\n			    <span class="label lng" id="dragLabel">Longitude</span>\n			    <span class="label location" id="dragLabel">Latitude, Longitude</span>\n			    <span class="label name" id="dragLabel">Name</span>\n			    <span class="label intensity" id="dragLabel">Intensity</span>\n			</div>\n		</div>	\n		<div class="data-table" id="dataTable"></div>\n    </div>\n\n	<!-- Alerts -->\n	<div class="alert alert-error">\n	        <a class="close" data-dismiss="alert">×</a>\n	        <strong>Oops</strong> both a title and valid path are required to add a data set.\n	   </div>\n  </div>\n  <div class="modal-footer">\n	<a href="#"  id="dataConfirmButton" class="btn btn-success">Confirm and Add</a>\n	<a href="#"  id="dataButton" class="btn btn-primary">Next: Review Data</a>\n    <a href="#" data-dismiss="modal" class="btn">Close</a>\n  </div>\n</div>'}),define("views/add-data-view",["jquery","underscore","backbone","config","utils","text!templates/add-data.html"],function(e,t,n,r,i,s){var o=n.View.extend({tagName:"div",className:"add-data-view",events:{"click #dataButton":"dataButtonClicked","click #dataConfirmButton":"dataConfirmButtonClicked"},initialize:function(e){this.template=t.template(s),this.vent=e.vent,this.responseData=null,this.dataTitle="",this.dataDescription=""},render:function(){e(this.el).html(this.template());var t=this;return this.$("#dragLabel").draggable({revert:!0,stack:"#dragLabel"}),this.$("#map_canvas").droppable({accept:"#dragLabel",hoverClass:"",drop:t.handleCardDrop}),this},handleCardDrop:function(e,t){var n=t.draggable;alert('The square with ID "'+n.attr("id")+'" was dropped onto me!')},dataButtonClicked:function(){var e=this;this.dataTitle=this.$("#titleInput").val(),this.dataDescription=this.$("#descriptionInput").val(),this.requestData(),this.$(".modal-body .alert").hide()},dataConfirmButtonClicked:function(){},requestData:function(t){var n=this;dataType="csv",dataType=="csv"&&e.ajax({type:"POST",url:"/api/import/",data:{file:this.$("#fileInput").val(),title:this.$("#titleInput").val(),description:this.$("#descriptionInput").val(),converter:this.$("#converter").val()},success:function(t){t.pointCollectionId&&(app.bindCollectionToMap(t.pointCollectionId),e("#addDataModal").modal("hide"))},error:function(){console.error("failed to fetch unique map")}})},showDataReview:function(t){var n=this;this.$("#dataButton").hide(),this.$("#dataConfirmButton").show(),this.$(".modal").addClass("large"),this.$(".modal-body .add").fadeOut(function(){n.$(".modal-body .review").fadeIn(function(){e(".add-data-view .modal-body .review .data-table").append('<table class="table table-striped table-bordered table-condensed"></table>');var n;for(var r=0;r<50;++r)n+="<tr>",e.each(t[r],function(e,t){n+='<td rel="tooltip" title="'+e+'" class="tooltip-test">'+t+"</td>"}),n+="</tr>";e(".add-data-view .modal-body .review .data-table .table").append(n)})})}});return o}),define("text!templates/data-library.html",[],function(){return'<div class="well">\n	<button class="btn" id="closeDatalibrary"><i class="icon-arrow-left"></i>&nbsp;&nbsp;Close Library</button>\n</div>\n<div class="data-search">\n	<input type="text" placeholder="Search data library" />\n</div>\n<div class="instructions">Drag and drop right onto your map</div>\n<div class="data-container"></div>'}),define("views/data-library-view",["jquery","underscore","backbone","config","utils","text!templates/data-library.html"],function(e,t,n,r,i,s){var o=n.View.extend({tagName:"div",className:"data-library",events:{"click #closeDatalibrary":"closeButtonClicked"},initialize:function(e){this.template=t.template(s)},render:function(){var t=this;return e(this.el).html(this.template()),this.fetchDataCollections(),e(this.el).animate({left:-350},1,function(){e(t.el).css("display","block"),e(t.el).animate({left:0},400,"easeOutQuad",function(){})}),e("body").append('<div class="drop-zone" id="dropZone"><h3 class="instruction">DROP HERE</h3></div>'),this},show:function(){e(this.el).addClass("visible")},fetchDataCollections:function(){var t=this;e.ajax({type:"GET",url:"/api/pointcollections",success:function(n){e.each(n,function(e,n){app.pointCollections[n._id]||t.drawDataSource(n)}),t.$("#dragLabel").draggable({revert:!0,stack:"#dragLabel",start:function(t,n){var r="blah";e("#dropZone").addClass("visible"),e(this).css("opacity",".9")},stop:function(t,n){e("#dropZone").removeClass("visible")}}),e("#dropZone").droppable({accept:"#dragLabel",hoverClass:"",drop:t.dataDrop})},error:function(){console.error("failed to fetch collections")}})},drawDataSource:function(e){dataDiv='<div class="data-item" id="dragLabel" data="'+e._id+'">'+'<div class="clearfix"><div class="data-icon"></div><h4 class="data-title">'+e.title+"</h4></div>"+(e.fullCount?'<p class="data-count micro">'+formatLargeNumber(e.fullCount)+"</p>":"")+(e.description?'<p class="data-description micro">'+e.description+"</p>":"")+(e.source?'<h5 class="data-source micro">Source: '+e.source+"</p>":"")+"</div>",this.$(".data-container").append(dataDiv)},dataDrop:function(t,n){var r=n.draggable,i=r.attr("data");app.bindCollectionToMap(i),e(n.draggable).css("display","none")},closeButtonClicked:function(){this.remove()},remove:function(){var t=this;e(t.el).animate({left:-350},400,"easeOutQuad",function(){return e("#dropZone").remove(),app.dataLibraryVisible=!1,e(window).unbind(),e(t.el).remove(),this})}});return o}),define("views/sidebar-view",["jquery","underscore","backbone","config","utils","text!templates/sidebar.html","views/add-data-view","views/data-library-view"],function(e,t,n,r,i,s,o,u){var a=n.View.extend({tagName:"div",className:"sidebar-view",events:{"click #addData":"addDataClicked","click #addDataLibrary":"addDataLibraryClicked","click #scale_linear":"scaleLinearClicked","click #scale_log":"scaleLogClicked","click #tweetButton":"tweetButtonClicked","click #toggleCommentsVisible":"toggleCommentsVisibleClicked","click #toggleCommentsHidden":"toggleCommentsHiddenClicked","click #settingsTab":"settingsTabClicked","click #savePosition":"savePositionClicked"},initialize:function(e){this.template=t.template(s),this.vent=e.vent,t.bindAll(this,"mapAreaChanged"),e.vent.bind("mapAreaChanged",this.mapAreaChanged)},mapAreaChanged:function(e){this.enableSavePositionButton(),this.initialArea={center:e.center,zoom:e.zoom}},enableSavePositionButton:function(){this.$("#savePosition").attr("disabled",!1),this.$("#savePosition").removeClass("disabled")},disableSavePositionButton:function(){this.$("#savePosition").attr("disabled",!0),this.$("#savePosition").addClass("disabled")},savePositionClicked:function(){var t=this;this.colorType==ColorType.SOLID&&(this.colors=[{color:this.$("#colorInput").val()}]);var n={initialArea:this.initialArea};e.ajax({type:"POST",url:"/api/map/"+app.mapInfo._id,dataType:"json",data:n,success:function(e){t.disableSavePositionButton()},error:function(){console.error("failed to update map")}})},render:function(){var t=this;return e(this.el).html(this.template()),this.$("#scale_linear").addClass("active"),app.isMapAdmin()||this.$("#dataManager").remove(),this.updateAppLayout(),this},settingsTabClicked:function(){app.settingsVisible=!app.settingsVisible,this.vent.trigger("redrawMap"),this.updateAppLayout()},updateAppLayout:function(){app.settingsVisible?(e("#settingsTabText").html("HIDE"),e("#settingsTab").removeClass("hidden"),e(".sidebar-view").removeClass("visible"),e(".sidebar-view .black-overlay").removeClass("visible"),e("#app").addClass("sidebar-visible"),e(".map-view").addClass("full"),app.settingsVisible=!0):(e("#settingsTabText").html("SHOW"),e("#settingsTab").addClass("hidden"),e(".sidebar-view").addClass("visible"),e(".sidebar-view .black-overlay").addClass("visible"),e("#app").removeClass("sidebar-visible"),e(".map-view").removeClass("full"))},addDataLibraryClicked:function(){this.toggleDataLibrary()},toggleDataLibrary:function(){app.dataLibraryVisible==0?(this.dataLibraryView=new u,e(this.el).append(this.dataLibraryView.render().el),app.dataLibraryVisible=!0):app.dataLibraryVisible=!1},addDataClicked:function(){this.addDataView&&this.addDataView.remove(),this.addDataView=new o({vent:this.vent}),e("body").append(this.addDataView.render().el),e("#addDataModal").modal("toggle")},scaleLinearClicked:function(){this.vent.trigger("updateValueScale","linear")},scaleLogClicked:function(){this.vent.trigger("updateValueScale","log")},tweetButtonClicked:function(){var e=new TweetCollection({})},toggleCommentsVisibleClicked:function(){this.toggleCommentVisibility(1)},toggleCommentsHiddenClicked:function(){this.toggleCommentVisibility(0)},toggleCommentVisibility:function(e){this.vent.trigger("toggleLayerVisibility",null,e,"comments")},addOne:function(e){var t=this},addAll:function(){var e=this;this.collection.each(function(t){e.addOne(t)})},remove:function(){return e(window).unbind(),e(this.el).remove(),this}});return a}),define("text!templates/setup.html",[],function(){return'<div class="modal-header">\n  <a class="close" data-dismiss="modal">×</a>\n  <h2 class="map-name"></h2>\n</div>\n\n<div class="modal-body">\n\n  <ul class="nav nav-tabs">\n    <li class="active"><a href="#setup-urls" data-toggle="tab">Map URLs</a></li>\n    <li><a id="tab-setup-metadata" href="#setup-metadata" data-toggle="tab">Edit map info</a></li>\n    <li><a id="tab-setup-metadata" href="#setup-custom-domain" data-toggle="tab">Custom domain</a></li>\n  </ul>\n\n  <form class="well">\n    <div class="tab-content">\n      <div class="tab-pane active" id="setup-urls">\n        <p>You\'ll be able to access this map from the following URLs. We will email you this information if you <a href="#" class="enter-email">enter your email address</a> on the next tab.</p>\n        <div class="urls">\n          <h3><i class="icon-pencil"></i> ADMIN URL – keep this link private:</h3>\n          <input class="map-admin-url" readonly="readonly"></input>\n          <h3><i class="icon-eye-open"></i> PUBLIC URL – share this link with others:</h3>\n          <input class="map-url" readonly="readonly"></input>\n        </div>\n      </div>\n      <div class="tab-pane" id="setup-metadata">\n        <fieldset>\n          <h3>Map Title</h3>\n          <input name="title"></input>\n          <h3>Description</h3>\n          <textarea name="description"></textarea>\n        </fieldset>\n        <fieldset class="two-column">\n          <div>\n            <h3>Author Info</h3>\n            <input name="author"></input>\n          </div>\n          <div>\n            <h3>Your email adress (won\'t be displayed)</h3>\n            <input name="createdBy.email"></input>\n          </div>\n        </fieldset>\n        <fieldset class="two-column">\n          <div>\n            <h3>Link URL</h3>\n            <input name="linkURL"></input>\n          </div>\n          <div>\n            <h3>Link Title</h3>\n            <input name="linkTitle"></input>\n          </div>\n          <div>\n            <h3>Twitter handle</h3>\n            <input name="twitter"></input>\n          </div>\n        </fieldset>\n      </div>\n      <div class="tab-pane" id="setup-custom-domain">\n        <fieldset>\n          <h3>Your custom domain name</h3>\n          <input name="host" placeholder="Example: your-domain.com"></input>\n          <p>If you would like to have your custom domain point to this map, you can enter the domain name here.</p>\n        </fieldset>\n      </div>\n    </div>\n  </form>\n\n</div>\n\n<div class="modal-footer">\n<a href="#" id="deleteMapButton" class="btn btn-danger delete">Delete Map</a>\n  <a href="#" id="saveCloseButton" class="btn btn-success">Start Mapping!</a>\n</div>\n'}),define("text!templates/modal.html",[],function(){return'<div class="modal-header">\n  <a class="close" data-dismiss="modal">×</a>\n  <h3 class="title">About GeoSense</h3>\n</div>\n<div class="modal-body">\n  <p class="body">\n  </p>\n</div>\n<div class="modal-footer">\n  <a href="#" data-dismiss="modal" class="btn">Close</a>\n</div>\n'}),define("views/modal-view",["jquery","underscore","backbone","config","utils","text!templates/modal.html"],function(e,t,n,r,i,s){var o=n.View.extend({tagName:"div",className:"modal fade",events:{},initialize:function(e){this.template=t.template(s)},render:function(){return e(this.el).html(this.template()),this},setTitle:function(e){this.$(".modal-header .title").html(e)},setBody:function(e){this.$(".modal-body .body").html(e)},show:function(){var t=this;e("body").append(this.el),e(this.el).modal("show"),e(this.el).on("hidden",function(){e(t.el).detach()})},close:function(){e(this.el).modal("hide")}});return o}),define("views/setup-view",["jquery","underscore","backbone","config","utils","text!templates/setup.html","views/modal-view"],function(e,t,n,r,i,s,o){var u=o.extend({tagName:"div",className:"setup-view modal fade",events:{"click #deleteMapButton":"deleteMapClicked","click #saveCloseButton":"saveClicked"},initialize:function(e){this.template=t.template(s),this.vent=e.vent,this.mapInfo=e.mapInfo,this.mapInfoChanged=!1,t.bindAll(this,"updateMapInfo"),e.vent.bind("updateMapInfo",this.updateMapInfo)},updateMapInfo:function(t){var n=this;t&&(this.mapInfo=t),this.$(".map-name").html(this.mapInfo.title+" Setup"),this.mapInfoFields.each(function(){e(this).removeClass("error");var t=this.name.split(".");t.length==2?n.mapInfo[t[0]]&&e(this).val(n.mapInfo[t[0]][t[1]]):e(this).val(n.mapInfo[this.name])}),this.$(".map-url").val(app.genPublicURL()),this.$(".map-admin-url").val(app.genAdminURL())},render:function(){var t=this;return e(this.el).html(this.template()),this.$(".map-url, .map-admin-url").click(function(){e(this).select()}),this.$(".enter-email").click(function(){return e("#tab-setup-metadata").trigger("click"),!1}),this.mapInfoFields=this.$("#setup-metadata input, #setup-metadata textarea, #setup-custom-domain input"),this.mapInfoFields.each(function(){e(this).on("change keydown",function(){t.mapInfoChanged=!0,t.$("#saveCloseButton").text(__("Save & close"))})}),e(this.el).on("hidden",function(){app.navigate(app.genMapURI(null))}),this.updateMapInfo(),this},saveClicked:function(){console.log("saveClicked",this.mapInfoChanged);if(!this.mapInfoChanged)return this.close(),!1;var t={};this.mapInfoFields.each(function(){t[this.name]=e(this).val()});var n=this;return this.$("#saveCloseButton").attr("disabled",!0),e.ajax({type:"POST",url:"/api/map/"+n.mapInfo._id,data:t,success:function(e){n.close(),n.vent.trigger("updateMapInfo",e),n.$("#saveCloseButton").attr("disabled",!1),n.mapInfoChanged=!1},error:function(t,r,i){var s=e.parseJSON(t.responseText);console.error("failed to update map: "+n.mapInfo._id);if(s&&s.errors){n.mapInfoFields.removeClass("error");for(var o in s.errors)e('[name="'+s.errors[o].path+'"]',this.mapInfoFields).addClass("error");console.error("errors:",s.errors)}n.$("#saveCloseButton").attr("disabled",!1)}}),!1},deleteMapClicked:function(t){var n=this;return window.confirm(__("Are you sure you want to delete this map? This action cannot be reversed!"))&&e.ajax({type:"DELETE",url:"/api/map/"+n.mapInfo._id,success:function(){console.log("deleted map: "+n.mapInfo._id),window.location="/"},error:function(e){console.error("failed to delete map: "+n.mapInfo._id)}}),!1}});return u}),define("text!templates/map-ol.html",[],function(){return'<div id="map_canvas" class="map"></div>\n'}),define("lib/color-gradient/color-gradient",[],function(){var e=function(e,t){this.colors=[],this.gradientCache={};if(e)for(var n=e.length-1;n>=0;n--){var r=parseInt(e[n].color[0]=="#"?e[n].color.replace("#","0x"):e[n].color);this.colors[n]={position:e[n].position,color:r,interpolation:t||e[n].interpolation,channels:this.getChannels(r)}}this.colors.sort(function(e,t){return e.position-t.position})};e.prototype.getChannels=function(e){return[(e&16711680)>>16,(e&65280)>>8,e&255]};var t=function(e,t,n){return Math.round(t+(n-t)*e)};return e.prototype.interpolation={lerpRGB:function(n,r,i){var s=r.channels||e.prototype.getChannels(r.color),o=i.channels||e.prototype.getChannels(i.color);return(t(n,s[0],o[0])<<16)+(t(n,s[1],o[1])<<8)+t(n,s[2],o[2])},threshold:function(e,t,n){return t.color}},e.prototype.interpolation.default="lerpRGB",e.prototype.intColorAt=function(e,t){if(t){e=(e-e%t)/1;if(!this.gradientCache[t])this.gradientCache[t]={};else if(this.gradientCache[t][e]!=null)return this.gradientCache[t][e]}for(var n=this.colors.length-1;n>0;n--)if(this.colors[n].position<e)break;var r=n,i=n+1>=this.colors.length||this.colors[r].position>e?n:n+1,s=this.colors[i].position==this.colors[r].position?0:(e-this.colors[r].position)/(this.colors[i].position-this.colors[r].position),o=this.colors[r].interpolation;o?f=this.interpolation[o]:f=this.interpolation[this.interpolation.default];var u=f(s,this.colors[r],this.colors[i]);return t&&(this.gradientCache[t][e]=u),u},e.prototype.zeroPad=function(e,t){return(new Array(e.length<t?t+1-e.length:0)).join("0")+e},e.prototype.intToHexColor=function(e){return"#"+this.zeroPad(e.toString(16),6)},e.prototype.colorAt=function(e,t){return this.intToHexColor(this.intColorAt(e,t))},e}),define("views/map-view-base",["jquery","underscore","backbone","config","utils","text!templates/homepage.html","lib/color-gradient/color-gradient"],function(e,t,n,r,i,s,o){var u=n.View.extend({initialize:function(e){var n=this;this.collections={},this.featureLayers={},this.vent=e.vent,this.layerOptions={},t.bindAll(this,"geocodeAndSetMapLocation"),e.vent.bind("geocodeAndSetMapLocation",this.geocodeAndSetMapLocation),t.bindAll(this,"redrawMapLayer"),e.vent.bind("redrawMapLayer",this.redrawMapLayer),e.visibleMapArea&&(this.initialVisibleMapArea=e.visibleMapArea),t.bindAll(this,"toggleLayerVisibility"),e.vent.bind("toggleLayerVisibility",this.toggleLayerVisibility)},geocodeAndSetMapLocation:function(e){var t=this;geocoder=new google.maps.Geocoder,geocoder.geocode({address:e},function(n,r){console.log(n),r==google.maps.GeocoderStatus.OK?(n.type="google",t.setVisibleMapArea(n)):alert("Cannot find "+e+"! Status: "+r)})},getVisibleMapArea:function(){return{bounds:null,zoom:null}},setVisibleMapArea:function(e){},start:function(e,t){this.initialVisibleMapArea&&(this.MapAreaChangedInitially=!0,this.setVisibleMapArea(this.initialVisibleMapArea))},mapAreaChanged:function(t){var n=this;e.each(this.collections,function(e,t){var r=app.getMapLayer(t.pointCollectionId);app.fetchMapLayer(t.pointCollectionId),n.vent.trigger("hideDetailData",t.pointCollectionId)}),this.MapAreaChangedInitially||app.navigate(app.genMapURIForVisibleArea(t)),this.MapAreaChangedInitially=!1,this.vent.trigger("updateGraphCollections",t),this.vent.trigger("mapAreaChanged",t)},redrawMapLayer:function(e){this.initFeatureLayerOptions(this.collections[e.pointCollection._id]),e.sessionOptions.visible&&this.vent.trigger("setStateType","drawing",pointCollectionId)},addCollection:function(e){console.log("addCollection "+e.pointCollectionId),this.collections[e.pointCollectionId]=e,e.bind("reset",this.reset,this),e.bind("add",this.addOne,this),this.addCollectionToMap(e)},addOne:function(e,t){var n=this.collections[t],r=this.collections[t].mapLayer.options,i=this.collections[t].mapLayer.pointCollection.minVal,s=this.collections[t].mapLayer.pointCollection.maxVal,o=e.get("val");o&&o.avg!=null&&(o=o.avg);var u=e.get("count"),a=(o-i)/(s-i),f=u/this.collections[t].maxReducedCount,l,c=o!=null?r.colorType:ColorType.SOLID,h;switch(c){case ColorType.SOLID:l=r.colors[0].color;break;case ColorType.LINEAR_GRADIENT:case ColorType.PALETTE:l=this.layerOptions[t].colorGradient.colorAt(a,COLOR_GRADIENT_STEP)}if(r.featureSizeAttr==0)h=0;else switch(r.featureSizeAttr){default:case"count":h=f;break;case"val":h=a}this.addFeatureToLayer(e,{pointCollectionId:t,color:l,darkerColor:multRGB(l,.75),min:i,max:s,model:e,data:{val:o,normVal:a,count:u},size:h},t)},addAll:function(e){var t=this,n=e.pointCollectionId;e.each(function(e){t.addOne(e,n)}),t.drawLayerForCollection(e)},reset:function(e){var t=e.pointCollectionId;this.addAll(e)},addCollectionToMap:function(e){var t=this,n=e.pointCollectionId;t.initFeatureLayerOptions(e),t.initFeatureLayer(e),t.addAll(e)},initFeatureLayerOptions:function(e){var t=e.pointCollectionId;this.layerOptions[t]={};var n=this.layerOptions[t];n.opacity=e.mapLayer.options.opacity;switch(e.mapLayer.options.colorType){case ColorType.PALETTE:case ColorType.LINEAR_GRADIENT:n.colorGradient=new o(e.mapLayer.options.colors)}},initFeatureLayer:function(e){},addFeatureToLayer:function(e,t,n){},drawLayerForCollection:function(e){},toggleLayerVisibility:function(e,t){}});return u}),OpenLayers.Layer.CloudMade=OpenLayers.Class(OpenLayers.Layer.TMS,{initialize:function(e,t){if(!t.key)throw"Please provide key property in options (your API key).";t=OpenLayers.Util.extend({attribution:"Data &copy; 2009 <a href='http://openstreetmap.org/'>OpenStreetMap</a>. Rendering &copy; 2009 <a href='http://cloudmade.com'>CloudMade</a>.",maxExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),maxResolution:156543.0339,units:"m",projection:"EPSG:900913",isBaseLayer:!0,numZoomLevels:19,displayOutsideMaxExtent:!0,wrapDateLine:!0,styleId:1},t);var n=[t.key,t.styleId,256].join("/")+"/",r=["http://a.tile.cloudmade.com/"+n,"http://b.tile.cloudmade.com/"+n,"http://c.tile.cloudmade.com/"+n],i=[e,r,t];OpenLayers.Layer.TMS.prototype.initialize.apply(this,i)},getURL:function(e){var t=this.map.getResolution(),n=Math.round((e.left-this.maxExtent.left)/(t*this.tileSize.w)),r=Math.round((this.maxExtent.top-e.top)/(t*this.tileSize.h)),i=this.map.getZoom(),s=Math.pow(2,i);if(r<0||r>=s)return"http://cloudmade.com/js-api/images/empty-tile.png";n=(n%s+s)%s;var o=this.url,u=i+"/"+n+"/"+r+".png";return o instanceof Array&&(o=this.selectUrl(u,o)),o+u},CLASS_NAME:"OpenLayers.Layer.CloudMade"}),define("lib/openlayers/cloudmade",function(){}),define("views/map-ol-view",["jquery","underscore","backbone","config","utils","text!templates/map-ol.html","views/map-view-base","lib/openlayers/cloudmade"],function(e,t,n,r,i,s,o){var u=o.extend({tagName:"div",className:"map-view",addFeatures:{},initialize:function(e){u.__super__.initialize.call(this,e),this.template=t.template(s),t.bindAll(this,"updateViewStyle"),e.vent.bind("updateViewStyle",this.updateViewStyle),t.bindAll(this,"updateViewBase"),e.vent.bind("updateViewBase",this.updateViewBase),t.bindAll(this,"redrawMap"),e.vent.bind("redrawMap",this.redrawMap),Feature=OpenLayers.Feature.Vector,Geometry=OpenLayers.Geometry,Rule=OpenLayers.Rule,Filter=OpenLayers.Filter,previousKey=0,scope=this,OpenLayers.ImgPath="/assets/openlayers-light/"},render:function(){return e(this.el).html(this.template()),this},getVisibleMapArea:function(){var e=this.map,t=e.getZoom(),n=e.getExtent(),r=e.getCenter();r.transform(new OpenLayers.Projection("EPSG:900913"),new OpenLayers.Projection("EPSG:4326"));var i=new OpenLayers.Geometry.Point(n.left,n.bottom);i.transform(new OpenLayers.Projection("EPSG:900913"),new OpenLayers.Projection("EPSG:4326"));var s=new OpenLayers.Geometry.Point(n.right,n.top);s.transform(new OpenLayers.Projection("EPSG:900913"),new OpenLayers.Projection("EPSG:4326"));var o=[[i.x,i.y],[s.x,s.y]];return{center:[r.lon,r.lat],zoom:t,bounds:o}},start:function(e,t){var n=this;map_controls=[new OpenLayers.Control.PanZoomBar,new OpenLayers.Control.Navigation],this.map=new OpenLayers.Map({div:"map_canvas",projection:new OpenLayers.Projection("EPSG:900913"),displayProjection:new OpenLayers.Projection("EPSG:4326"),numZoomLevels:MAP_NUM_ZOOM_LEVELS,controls:map_controls,scope:this,eventListeners:{moveend:function(e){n.mapAreaChanged(n.getVisibleMapArea())}}}),this.updateViewBase(e,t);var r=new OpenLayers.Control.ScaleLine;this.map.addControl(r),this.map.addControl(new OpenLayers.Control.Attribution);var i=this.baselayer.mapLayer.resolutions,s=[];for(var o=0;o<i.length;o++){var a=new OpenLayers.Geometry.Point(i[o],0);s.push(a.transform(new OpenLayers.Projection("EPSG:900913"),new OpenLayers.Projection("EPSG:4326")).x)}DEBUG&&this.map.addControl(new OpenLayers.Control.MousePosition),u.__super__.start.call(this),this.add30kmtemp()},getItems:function(e,t,n){var r=this;e=new Geometry.Vector2(e,t),r.quadTreeRetrieve(e.x,e.y);if(t==null)return[];n*=n;for(var i=Number.MAX_VALUE,s=[],o=0;o<t.length;o++){var u=t[o],a=(e.x-u.x)*(e.x-u.x)+(e.y-u.y)*(e.y-u.y);a<n&&(s.push(u.id),a<i&&(i=a))}return s},addKMLLayer:function(e){kml=new OpenLayers.Layer.Vector("KML",{projection:new OpenLayers.Projection("EPSG:4326"),strategies:[new OpenLayers.Strategy.Fixed],renderers:["Canvas"],opacity:.3,protocol:new OpenLayers.Protocol.HTTP({url:e,format:new OpenLayers.Format.KML({extractStyles:!0,extractAttributes:!0,maxDepth:2})})}),this.map.addLayers([kml])},destroyFeatureLayer:function(e){var t=e.pointCollectionId;this.featureLayers[t].destroyFeatures()},reset:function(e){var t=e.pointCollectionId;this.featureLayers[t].destroyFeatures(),u.__super__.reset.call(this,e)},initFeatureLayer:function(e){u.__super__.initFeatureLayer.call(this,e);var n=this,r=e.pointCollectionId,i={getColor:function(e){return e.attributes.color},getDarkerColor:function(e){return e.attributes.darkerColor},getBubbleRadius:function(e){return MIN_BUBBLE_SIZE+e.attributes.size*(MAX_BUBBLE_SIZE-MIN_BUBBLE_SIZE)/2},getStrokeWidth:function(e){return MIN_POLYGON_STROKE_WIDTH+e.attributes.size*(MAX_POLYGON_STROKE_WIDTH-MIN_POLYGON_STROKE_WIDTH)}},s,o={fillOpacity:DEFAULT_SELECTED_FEATURE_OPACITY,strokeColor:DEFAULT_SELECTED_STROKE_COLOR,strokeOpacity:1,strokeWidth:DEFAULT_SELECTED_STROKE_WIDTH},a={};switch(e.mapLayer.options.featureType){case FeatureType.POINTS:var f=new OpenLayers.Style({fillColor:"${getColor}",strokeColor:"${getDarkerColor}",pointRadius:DEFAULT_POINT_RADIUS,strokeWidth:DEFAULT_POINT_STROKE_WIDTH,fillOpacity:this.layerOptions[r].opacity||DEFAULT_FEATURE_OPACITY,strokeOpacity:(this.layerOptions[r].opacity||DEFAULT_FEATURE_OPACITY)*.8},{context:i});s=new OpenLayers.Layer.Vector(null,{projection:new OpenLayers.Projection("EPSG:4326"),sphericalMercator:!0,styleMap:new OpenLayers.StyleMap({"default":f,temporary:a,select:o}),renderers:["Canvas"],wrapDateLine:!0});break;default:case FeatureType.CELLS:var f=new OpenLayers.Style({fillColor:"${getColor}",fillOpacity:this.layerOptions[r].opacity||DEFAULT_FEATURE_OPACITY,strokeOpacity:0},{context:i});s=new OpenLayers.Layer.Vector(null,{styleMap:new OpenLayers.StyleMap({"default":f,temporary:a,select:o}),renderers:["Canvas"],wrapDateLine:!0});break;case FeatureType.POLYGONS:var f=new OpenLayers.Style({fillColor:"${getColor}",fillOpacity:this.layerOptions[r].opacity||DEFAULT_FEATURE_OPACITY,strokeOpacity:this.layerOptions[r].opacity||DEFAULT_FEATURE_OPACITY,strokeColor:"${getColor}",strokeWidth:"${getStrokeWidth}"},{context:i}),o=new OpenLayers.Style(t.extend(o,{strokeColor:"${getColor}",strokeWidth:"${getStrokeWidth}"}),{context:i});s=new OpenLayers.Layer.Vector(null,{styleMap:new OpenLayers.StyleMap({"default":f,temporary:a,select:o}),renderers:["Canvas"],wrapDateLine:!0});break;case FeatureType.BUBBLES:var f=new OpenLayers.Style({pointRadius:"${getBubbleRadius}",strokeOpacity:0,fillColor:"${getColor}",fillOpacity:this.layerOptions[r].opacity||DEFAULT_FEATURE_OPACITY},{context:i});s=new OpenLayers.Layer.Vector(null,{styleMap:new OpenLayers.StyleMap({"default":f,temporary:a,select:o}),renderers:["Canvas"],wrapDateLine:!0})}this.featureLayers[r]=s,this.map.addLayers([s]);var l=new OpenLayers.Control.SelectFeature(s,{clickout:!0,multiple:!1,hover:!1,box:!1,onBeforeSelect:function(e){},onSelect:function(e){n.featureSelected(e)},onUnselect:function(e){n.featureUnselected(e)}});this.map.addControl(l),l.activate()},add30kmtemp:function(){var e=new OpenLayers.Style({strokeColor:"#999999",pointRadius:7,fillOpacity:0,strokeOpacity:.8,strokeWidth:1},{context:{}});layer=new OpenLayers.Layer.Vector(null,{projection:new OpenLayers.Projection("EPSG:4326"),sphericalMercator:!0,styleMap:new OpenLayers.StyleMap({"default":e}),renderers:["Canvas"],wrapDateLine:!0}),this.map.addLayers([layer]);var t=new OpenLayers.Geometry.Point(141.033247,37.425252);t.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"));var n,r=3e4,i=50,s=wktCircle(t,r,r,i),n=OpenLayers.Geometry.fromWKT(s),o=new OpenLayers.Feature.Vector(n,{});layer.addFeatures([o])},featureSelected:function(e){var t=e.attributes.model;this.vent.trigger("showDetailData",e.attributes.pointCollectionId,t)},featureUnselected:function(e){this.vent.trigger("hideDetailData",e.attributes.pointCollectionId)},addFeatureToLayer:function(e,t,n){var r=this.collections[n],i=e.get("loc"),s=e.get("extra"),o=i[0],u=i[1],a=new OpenLayers.Geometry.Point(o,u),f,l;switch(r.mapLayer.options.featureType){default:a.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913")),l=a;break;case FeatureType.POLYGONS:s&&s.min&&s.min.endLoc&&(f=[a,new OpenLayers.Geometry.Point(s.min.endLoc[0],s.min.endLoc[1])]);case FeatureType.CELLS:if(!f){var c=r.gridSize/2;f=[new OpenLayers.Geometry.Point(a.x-c,a.y-c),new OpenLayers.Geometry.Point(a.x-c,a.y+c),new OpenLayers.Geometry.Point(a.x+c,a.y+c),new OpenLayers.Geometry.Point(a.x+c,a.y-c)]}var h=[];for(var p=0;p<f.length;p++){var a=f[p];a.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913")),h.push(a.x+" "+a.y)}var d="POLYGON("+h.join(", ")+")",l=OpenLayers.Geometry.fromWKT(d)}var v=new OpenLayers.Feature.Vector(l,t);this.addFeatures[n]||(this.addFeatures[n]=[]),this.addFeatures[n].push(v)},drawLayerForCollection:function(e){var t=e.pointCollectionId;this.addFeatures[t]&&(this.featureLayers[t].addFeatures(this.addFeatures[t]),delete this.addFeatures[t]),this.featureLayers[t].redraw()},toggleLayerVisibility:function(e,t){this.featureLayers[e].setVisibility(t)},updateViewBase:function(e,t){if(!e||!this.ViewBase[e])e=DEFAULT_MAP_VIEW_BASE;if(e==this.viewBase)return;this.baselayer&&this.map.removeLayer(this.baselayer.mapLayer),this.baselayer=new this.ViewBase[e](this.map,this,t||this.viewStyle),this.viewBase=e,this.viewStyles=this.baselayer.mapStyles,this.viewStyle=this.baselayer.mapStyle,console.log(this.viewStyle,"viewStyle"),this.defaultViewStyle=this.baselayer.defaultMapStyle,this.map.addLayer(this.baselayer.mapLayer),this.vent.trigger("viewOptionsChanged",this)},updateViewStyle:function(e){this.baselayer.setMapStyle&&this.baselayer.setMapStyle(e)&&(this.viewStyle=this.baselayer.mapStyle,this.vent.trigger("viewOptionsChanged",this))},redrawMapLayer:function(e){u.__super__.redrawMapLayer.call(this,e);var t=e.pointCollection._id;this.destroyFeatureLayer(this.collections[t]),this.addCollectionToMap(this.collections[t])},redrawMap:function(){},toWebMercator:function(t){props=[];for(prop in t)t.hasOwnProperty(prop)&&props.push(prop);return e.each(t,function(e,t){e==props[0]?lat=t:e==props[1]&&(lng=t)}),translation=new Geometry.Point(lng,lat),translation.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913")),[translation.x,translation.y]},setVisibleMapArea:function(e){var t,n;console.log("setVisibleMapArea",e);switch(e.type){case"google":var r=e[0],t=this.toWebMercator(r.geometry.location),i=r.geometry.viewport,s=i.getSouthWest(),o=i.getNorthEast(),u=this.toWebMercator(s),a=this.toWebMercator(o),n=this.map.getZoomForExtent(new OpenLayers.Bounds(u[0],u[1],a[0],a[1]));break;default:translation=new Geometry.Point(e.center[0],e.center[1]),translation.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913")),t=[translation.x,translation.y],e.zoom!=undefined&&(n=e.zoom)}t&&this.map.setCenter(new OpenLayers.LonLat(t[0],t[1]),n)}}),a=u.prototype.Baselayer=OpenLayers.Class({initialize:function(e,t,n){this.map=e,this.mapView=t,this.setMapStyle(n),this.initMapLayer()},initMapLayer:function(e){},setMapStyle:function(e){var t=this.mapStyle;return this.mapStyles&&this.mapStyles[e]?this.mapStyle=e:this.mapStyle=this.defaultMapStyle,t!=this.mapStyle?(this.mapLayer&&this.applyMapStyle(),!0):!1},applyMapStyle:function(){return this.mapLayer&&(this.map.removeLayer(this.mapLayer),this.initMapLayer(!0),this.map.addLayer(this.mapLayer)),!0},mapStyles:null,defaultMapStyle:DEFAULT_MAP_STYLE,mapStyle:null}),f=u.prototype.ViewBase={};return f.gm=OpenLayers.Class(a,{providerName:"Google Maps",initMapLayer:function(e){var t=this,n=this.mapLayer=new OpenLayers.Layer.Google("Google Maps",{type:"styled",wrapDateLine:!0,sphericalMercator:!0,baselayer:!0,numZoomLevels:MAP_NUM_ZOOM_LEVELS});e||this.map.events.on({addlayer:function(e){e.layer.baselayer&&e.layer==n&&(t.applyMapStyle(),google.maps.event.addListenerOnce(e.layer.mapObject,"idle",function(){t.mapView.vent.trigger("mapViewReady")}))}})},applyMapStyle:function(){var e="simplified";switch(this.mapStyle){case"dark":var t=[{stylers:[{saturation:-100},{visibility:e},{lightness:45},{invert_lightness:!0},{gamma:1.1}]},{elementType:"labels",stylers:[{visibility:"off"}]}];break;case"light":var t=[{stylers:[{saturation:-100},{visibility:e},{lightness:8},{gamma:1.31}]},{elementType:"labels",stylers:[{visibility:"off"}]}];break;case"full":var t=[{stylers:[]}]}var n=t,r={name:"Styled Map"},i=new google.maps.StyledMapType(n,r);this.mapLayer.mapObject.mapTypes.set("styled",i),this.mapLayer.mapObject.setMapTypeId("styled")},mapStyles:{dark:"Dark",light:"Light",full:"Full"}}),f.cm=OpenLayers.Class(a,{providerName:"CloudMade",initMapLayer:function(e){var t=this;this.mapLayer=this.mapLayer=new OpenLayers.Layer.CloudMade("CloudMade",{key:CLOUDMADE_KEY,styleId:this.styleIds[this.mapStyle],baselayer:!0,numZoomLevels:MAP_NUM_ZOOM_LEVELS,eventListeners:{loadend:function(){e||t.mapView.vent.trigger("mapViewReady")}}})},mapStyles:{dark:"Dark",light:"Light",full:"Full"},styleIds:{dark:74569,light:74513,full:998}}),f.osm=OpenLayers.Class(a,{providerName:"OpenStreetMap",initMapLayer:function(e){var t=this;this.mapLayer=this.mapLayer=new OpenLayers.Layer.OSM(null,null,{baselayer:!0,numZoomLevels:MAP_NUM_ZOOM_LEVELS,eventListeners:{loadend:function(){e||t.mapView.vent.trigger("mapViewReady")}}})},defaultMapStyle:null}),f.stm=OpenLayers.Class(a,{providerName:"Stamen",initMapLayer:function(e){var t=this;this.mapLayer=this.mapLayer=new OpenLayers.Layer.Stamen(this.styleIds[this.mapStyle],{baselayer:!0,numZoomLevels:MAP_NUM_ZOOM_LEVELS,eventListeners:{loadend:function(){e||t.mapView.vent.trigger("mapViewReady")}}})},mapStyles:{dark:"Toner",light:"Toner Lite",watercolor:"Watercolor"},styleIds:{dark:"toner",light:"toner-lite",watercolor:"watercolor"}}),u}),define("text!templates/data-info.html",[],function(){return'<div id="data-info-view">\n	<div class="panel-header">\n		<div class="frame clearfix">\n			<h3>Datasets</h3>\n			<ul class="buttons">\n				<li><a href="#" class="collapse"><span>collapse</span></a></li>\n				<li><a href="#" class="extend"><span>extend</span></a></li>\n			</ul>\n		</div>\n	</div>\n	<div id="data-info-accordion" class="accordion panel-body">\n	</div>\n</div>\n'}),define("views/panel-view-base",["jquery","underscore","backbone","config","utils","text!templates/homepage.html"],function(e,t,n,r,i,s){var o=n.View.extend({tagName:"div",setPanelState:function(t){var n=this;t==null&&(t=e(n.el).is(".collapsed")),t?e(n.el).removeClass("collapsed"):e(n.el).addClass("collapsed"),e(n.el).is(".collapsed")?n.$(".panel-body").hide("fast"):n.$(".panel-body").show("fast")},setTitle:function(e){this.$("h3").html(e)},render:function(){e(this.el).html(this.template());var t=this;return e(this.el).draggable({start:function(){e(this).css("bottom","auto")},stop:function(){var t=e(this).position().left+e(this).outerWidth();t==e(".snap.right").position().left&&e(this).css("left","auto")},snap:".snap, .panel",snapMode:"outer"}),e(this.el).css("position","absolute"),this.$("a.extend").click(function(){return e(t.el).toggleClass("extended"),e(t.el).is(".extended")&&t.setPanelState(!0),t.vent.trigger("dataInfoViewResized"),!1}),this.$("a.collapse").click(function(){return t.setPanelState(),!1}),this.$("a.close").click(function(){return e(t.el).hide(),!1}),this}});return o}),define("views/data-info-view",["jquery","underscore","backbone","config","utils","text!templates/data-info.html","views/panel-view-base"],function(e,t,n,r,i,s,o){var u=o.extend({className:"panel data-info",events:{},initialize:function(e){this.template=t.template(s),this.vent=e.vent,this.responseData=null,this.dataTitle="",this.dataColor="#ffffff",t.bindAll(this,"showDetailData"),e.vent.bind("showDetailData",this.showDetailData),t.bindAll(this,"hideDetailData"),e.vent.bind("hideDetailData",this.hideDetailData),t.bindAll(this,"toggleValFormatter"),this.vent.bind("toggleValFormatter",this.toggleValFormatter),this.visibleDetailModels={}},compileDetailDataForModel:function(e,t){var n=app.getMapLayer(e),r=n.pointCollection,i=t.get("val"),s=i&&i.avg!=null,o=t.get("altVal"),u=t.get("label"),a=t.get("datetime"),f=t.get("count"),l=s?a.max:a,c=s?a.min:a,h=l?(new Date(l)).format(n.options.datetimeFormat||locale.formats.DATE_SHORT):null,p=c?(new Date(c)).format(n.options.datetimeFormat||locale.formats.DATE_SHORT):null,d=n.sessionOptions.valFormatter,v=[];if(p)var m=p!=h?__("%(minDate)s–%(maxDate)s",{minDate:p,maxDate:h}):p;else var m="";u?v.push({label:u.min+"<br />"+m}):v.push({label:m}),v.push({label:d.unit,value:d.format(s?i.avg:i)});var g=r.reduce?[{label:__("no. of ")+(n.options.itemTitlePlural||"samples"),value:formatLargeNumber(f)}]:[];return f>1&&(g=g.concat([{label:__("peak",{unit:r.unit}),value:d.format(i.max)},{label:__("minimum",{unit:r.unit}),value:d.format(i.min)},{label:__("average",{unit:r.unit}),value:d.format(i.avg)}])),{data:v,metadata:g}},showDetailData:function(t,n,r){r=r||r==undefined,this.visibleDetailModels[t]=n;var i=this.compileDetailDataForModel(t,n),s=this.$(".data-legend."+t),o=function(e){return e.label&&e.value!=null?'<tr><th class="value-label">'+e.label+'</th><td class="value">'+e.value+"</td></tr>":e.label?'<tr><td colspan="2" class="value-label single"><h5>'+e.label+"</h5></td></tr>":e.value!=undefined?'<tr><td colspan="2" class="value single">'+e.value+"</td></tr>":""},u=e(".detail-data",s),a="";for(var f=0;f<i.data.length;f++)a+=o(i.data[f]);u.html(a);var u=e(".detail-metadata",s),a="";for(var f=0;f<i.metadata.length;f++)a+=o(i.metadata[f]);u.html(a);if(r){this.setPanelState(!0);var l=e(".collapse",s);e(".detail",l).show(),!l.is(".in"),this.$(".data-legend .collapse").each(function(){this!=l[0]})}},hideDetailData:function(t){this.visibleDetailModels[t]=null;var n=this.$(".data-legend."+t),r=e(".collapse",n);e(".detail",r).hide()},toggleValFormatter:function(e,t){var n=e.pointCollection._id;this.visibleDetailModels[n]&&this.showDetailData(n,this.visibleDetailModels[n],!1)}});return u}),define("text!templates/map-info-modal.html",[],function(){return'<div class="modal-header">\n  <a class="close" data-dismiss="modal">×</a>\n  <h3 class="title"></h3>\n</div>\n<div class="modal-body">\n<div class="panel-body">\n	<div class="description"></div>\n	<p class="author"><span class="content"></span></p>\n  <p class="linkURL"><a class="content" href="#"></a></p>\n  <p class="twitter"><a class="content" href="#"></a></p>\n</div>\n</div>\n<div class="modal-footer">\n  <a href="#" data-dismiss="modal" class="btn">Close</a>\n</div>\n'}),define("views/map-info-view",["jquery","underscore","backbone","config","utils","text!templates/map-info-modal.html","views/modal-view"],function(e,t,n,r,i,s,o){var u=o.extend({events:{},initialize:function(e){this.template=t.template(s),this.vent=e.vent,t.bindAll(this,"updateMapInfo"),e.vent.bind("updateMapInfo",this.updateMapInfo),this.mapInfo=e.mapInfo},updateMapInfo:function(t){t&&(this.mapInfo=t),this.setTitle(this.mapInfo.title);var n=["description","author","linkURL","twitter"];for(var r=n.length-1;r>=0;r--){var i=this.$("."+n[r]),s=e(".content",i);s.length||(s=i);var o=this.mapInfo[n[r]];o&&o!=""?(n[r]=="description"&&(o=nl2p(o)),n[r]=="twitter"&&(o="https://twitter.com/"+o),s.html(o),s[0].tagName=="A"&&s.attr("href",o),i.show()):i.hide()}},render:function(){return u.__super__.render.call(this),this.updateMapInfo(),this}});return u.templateHtml=s,u}),define("text!templates/data-inspector.html",[],function(){return'<div class="accordion-group">\n	<div class="accordion-heading">\n		<a class="title accordion-toggle" data-toggle="collapse" data-parent="#dataContainer" href="#collapse"></a>\n	</div>\n	<div id="collapse" class="accordion-body collapse">\n	    <div class="accordion-inner">\n\n	    	<form class="tabbable tabs-below">\n\n			    <div class="tab-content">\n					<div class="tab-pane active" id="map-features">\n\n						<div class="data-toggle">\n							<div id="dataToggle" class="btn-group" data-toggle="buttons-radio">\n							  <button class="btn visibility" value="1">Visible</button>\n							  <button class="btn visibility" value="0">Hidden</button>\n							</div>\n						</div>\n						<div class="collection-metadata" style="display: none">\n							<label for="title">Title</label> <input name="title" type="text" />\n							<label for="unit">Unit</label> <input name="unit" type="text" />\n							<label for="description">Description</label> <textarea name="description" rows=10></textarea>\n							<label for="altUnit">Alt. unit</label> <textarea name="altUnit" rows=3></textarea>\n						</div>\n						<div class="data-controls">\n							<div class="features">\n								<div class="data-toggle">\n									<div id="dataToggle" class="btn-group features" data-toggle="buttons-radio">\n									  <button class="btn feature-type points" value="P"></button>\n									  <button class="btn feature-type cells" value="C"></button>\n									  <button class="btn feature-type bubbles" value="B"></button>\n									</div>\n								</div>\n							</div>\n							<div class="feature-settings B">\n								<div>\n									<label for="feature-size">Bubble size</label>\n									<input name="feature-size" class="feature-size" type="text" value="min/max slider" />\n								</div>\n								<label for="map-size">Map size to</label>\n								<select name="map-size" class="map-size">\n									<option value="count">sample size</option>\n								</select>\n							</div>\n							<div class="divider"></div>\n							<div class="data-toggle">\n								<div id="dataToggle" class="btn-group colors" data-toggle="buttons-radio">\n								  <button class="btn color-type" value="S">Solid Color</button>\n								  <button class="btn color-type" value="L">Gradient</button>\n								  <button class="btn color-type" value="P">Palette</button>\n								</div>\n							</div>\n							<div class="color-gradient">\n								<div class="histogram"></div>\n								<div id="gradientEditor"></div>\n							</div>\n							<div class="color-solid">\n								<input type="text" id="colorInput" class="color-picker black" size="6" placeholder="hex color"/>\n							</div>\n							<div class="color-palette">\n								<table>\n									<thead>\n										<th>Color</th>\n										<th>Value</th>\n										<th>Transition</th>\n									</thead>\n									<tbody>\n										<tr class="template" style="display: none">\n											<td><input name="color" type="text" class="color-picker black" size="6" placeholder="hex color" /></td>\n											<td><input name="absPosition" type="text" class="number" size="6" placeholder="position" /></td>\n											<td>\n												<select name="interpolation" class="min-width">\n													<option value="threshold">threshold</option>\n													<option value="lerpRGB">linear interpolation</option>\n													<option value="">default</option>\n												</select>\n											</td>\n										</tr>\n									</tbody>\n								</table>\n							</div>\n							<div class="color-options">\n								<label for="opacity">Opacity</label>\n								<input name="opacity" class="opacity" type="text" value="opacity slider" />\n							</div>\n							<div class="map-color">\n								<label for="map-color">Map color to</label>\n								<select name="map-color" class="map-color">\n									<option value="avg">average value</option>\n								</select>\n							</div>\n							<div class="divider"></div>\n							<div class="map-details">\n								<label for="map-detail-data">Detailed data</label>\n								<select name="map-detail-data" class="">\n									<option value="">do not display</option>\n									<option selected="selected" value="C">reveal on click</option>\n									<option value="M">display on map</option>\n								</select>\n							</div>\n						</div>\n				    </div>\n\n					<div class="tab-pane active" id="data-info">\n					</div>\n\n			    </div>\n\n			    <ul class="nav nav-tabs">\n					<li class="active"><a href="#map-features" data-toggle="tab">Map Features</a></li>\n					<li><a id="tab-setup-metadata" href="#data-info" data-toggle="tab">Data Info</a></li>\n			    </ul>\n		    \n		    </form>\n\n			<div id="adminDataControls">\n				<div class="divider"></div>\n		        <div id="dataToggleEdit" class="data-toggle edit">\n					<button class="btn" id="removeData">Remove</button>\n					<button class="btn disabled" id="updateData">Save and Update</button>\n				</div>\n			</div>\n\n	    </div>\n    </div>\n</div>'}),function(){function e(e,t){try{for(var n in t)Object.defineProperty(e.prototype,n,{value:t[n],enumerable:!1})}catch(r){e.prototype=t}}function t(e){var t=-1,n=e.length,r=[];while(++t<n)r.push(e[t]);return r}function n(e){return Array.prototype.slice.call(e)}function r(){}function i(){return this}function s(e,t,n){return function(){var r=n.apply(t,arguments);return arguments.length?e:r}}function o(e){return e!=null&&!isNaN(e)}function u(e){return e.length}function a(e){return e==null}function f(e){return e.replace(/(^\s+)|(\s+$)/g,"").replace(/\s+/g," ")}function l(e){var t=1;while(e*t%1)t*=10;return t}function c(){}function h(e){function t(){var t=n,r=-1,i=t.length,s;while(++r<i)(s=t[r].on)&&s.apply(this,arguments);return e}var n=[],i=new r;return t.on=function(t,r){var s=i.get(t),o;return arguments.length<2?s&&s.on:(s&&(s.on=null,n=n.slice(0,o=n.indexOf(s)).concat(n.slice(o+1)),i.remove(t)),r&&n.push(i.set(t,{on:r})),e)},t}function p(e,t){return t-(e?1+Math.floor(Math.log(e+Math.pow(10,1+Math.floor(Math.log(e)/Math.LN10)-t))/Math.LN10):1)}function v(e){return e+""}function m(e){var t=e.lastIndexOf("."),n=t>=0?e.substring(t):(t=e.length,""),r=[];while(t>0)r.push(e.substring(t-=3,t+3));return r.reverse().join(",")+n}function g(e,t){return{scale:Math.pow(10,(8-t)*3),symbol:e}}function y(e){return function(t){return t<=0?0:t>=1?1:e(t)}}function b(e){return function(t){return 1-e(1-t)}}function w(e){return function(t){return.5*(t<.5?e(2*t):2-e(2-2*t))}}function E(e){return e}function S(e){return function(t){return Math.pow(t,e)}}function x(e){return 1-Math.cos(e*Math.PI/2)}function T(e){return Math.pow(2,10*(e-1))}function N(e){return 1-Math.sqrt(1-e*e)}function C(e,t){var n;return arguments.length<2&&(t=.45),arguments.length<1?(e=1,n=t/4):n=t/(2*Math.PI)*Math.asin(1/e),function(r){return 1+e*Math.pow(2,10*-r)*Math.sin((r-n)*2*Math.PI/t)}}function k(e){return e||(e=1.70158),function(t){return t*t*((e+1)*t-e)}}function L(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}function A(){d3.event.stopPropagation(),d3.event.preventDefault()}function O(){var e=d3.event,t;while(t=e.sourceEvent)e=t;return e}function M(e){var t=new c,n=0,r=arguments.length;while(++n<r)t[arguments[n]]=h(t);return t.of=function(n,r){return function(i){try{var s=i.sourceEvent=d3.event;i.target=e,d3.event=i,t[i.type].apply(n,r)}finally{d3.event=s}}},t}function _(e){return e=="transform"?d3.interpolateTransform:d3.interpolate}function D(e,t){return t=t-(e=+e)?1/(t-e):0,function(n){return(n-e)*t}}function P(e,t){return t=t-(e=+e)?1/(t-e):0,function(n){return Math.max(0,Math.min(1,(n-e)*t))}}function H(e,t,n){return new B(e,t,n)}function B(e,t,n){this.r=e,this.g=t,this.b=n}function j(e){return e<16?"0"+Math.max(0,e).toString(16):Math.min(255,e).toString(16)}function F(e,t,n){var r=0,i=0,s=0,o,u,a;o=/([a-z]+)\((.*)\)/i.exec(e);if(o){u=o[2].split(",");switch(o[1]){case"hsl":return n(parseFloat(u[0]),parseFloat(u[1])/100,parseFloat(u[2])/100);case"rgb":return t(q(u[0]),q(u[1]),q(u[2]))}}return(a=Ui.get(e))?t(a.r,a.g,a.b):(e!=null&&e.charAt(0)==="#"&&(e.length===4?(r=e.charAt(1),r+=r,i=e.charAt(2),i+=i,s=e.charAt(3),s+=s):e.length===7&&(r=e.substring(1,3),i=e.substring(3,5),s=e.substring(5,7)),r=parseInt(r,16),i=parseInt(i,16),s=parseInt(s,16)),t(r,i,s))}function I(e,t,n){var r=Math.min(e/=255,t/=255,n/=255),i=Math.max(e,t,n),s=i-r,o,u,a=(i+r)/2;return s?(u=a<.5?s/(i+r):s/(2-i-r),e==i?o=(t-n)/s+(t<n?6:0):t==i?o=(n-e)/s+2:o=(e-t)/s+4,o*=60):u=o=0,R(o,u,a)}function q(e){var t=parseFloat(e);return e.charAt(e.length-1)==="%"?Math.round(t*2.55):t}function R(e,t,n){return new U(e,t,n)}function U(e,t,n){this.h=e,this.s=t,this.l=n}function z(e,t,n){function r(e){return e>360?e-=360:e<0&&(e+=360),e<60?s+(o-s)*e/60:e<180?o:e<240?s+(o-s)*(240-e)/60:s}function i(e){return Math.round(r(e)*255)}var s,o;return e%=360,e<0&&(e+=360),t=t<0?0:t>1?1:t,n=n<0?0:n>1?1:n,o=n<=.5?n*(1+t):n+t-n*t,s=2*n-o,H(i(e+120),i(e),i(e-120))}function W(e){return ki(e,Ji),e}function X(e){return function(){return zi(e,this)}}function V(e){return function(){return Wi(e,this)}}function $(e,t){function n(){if(t=this.classList)return t.add(e);var t=this.className,n=t.baseVal!=null,r=n?t.baseVal:t;s.lastIndex=0,s.test(r)||(r=f(r+" "+e),n?t.baseVal=r:this.className=r)}function r(){if(t=this.classList)return t.remove(e);var t=this.className,n=t.baseVal!=null,r=n?t.baseVal:t;r=f(r.replace(s," ")),n?t.baseVal=r:this.className=r}function i(){(t.apply(this,arguments)?n:r).call(this)}var s=new RegExp("(^|\\s+)"+d3.requote(e)+"(\\s+|$)","g");if(arguments.length<2){var o=this.node();if(u=o.classList)return u.contains(e);var u=o.className;return s.lastIndex=0,s.test(u.baseVal!=null?u.baseVal:u)}return this.each(typeof t=="function"?i:t?n:r)}function J(e){return{__data__:e}}function K(e){return function(){return $i(this,e)}}function Q(e){return arguments.length||(e=d3.ascending),function(t,n){return e(t&&t.__data__,n&&n.__data__)}}function G(e){return ki(e,Gi),e}function Y(e,t,n){ki(e,Zi);var i=new r,s=d3.dispatch("start","end"),o=us;return e.id=t,e.time=n,e.tween=function(t,n){return arguments.length<2?i.get(t):(n==null?i.remove(t):i.set(t,n),e)},e.ease=function(t){return arguments.length?(o=typeof t=="function"?t:d3.ease.apply(d3,arguments),e):o},e.each=function(t,n){return arguments.length<2?tt.call(e,t):(s.on(t,n),e)},d3.timer(function(r){return e.each(function(u,a,f){function l(e){return y.active>t?h():(y.active=t,i.forEach(function(e,t){(tween=t.call(v,u,a))&&p.push(tween)}),s.start.call(v,u,a),c(e)||d3.timer(c,0,n),1)}function c(e){if(y.active!==t)return h();var n=(e-m)/g,r=o(n),i=p.length;while(i>0)p[--i].call(v,r);if(n>=1)return h(),ts=t,s.end.call(v,u,a),ts=0,1}function h(){return--y.count||delete v.__transition__,1}var p=[],v=this,m=e[f][a].delay,g=e[f][a].duration,y=v.__transition__||(v.__transition__={active:0,count:0});++y.count,m<=r?l(r):d3.timer(l,m,n)}),1},0,n),e}function Z(e,t,n){return n!=""&&Yi}function et(e,t){function n(e,n,r){var s=t.call(this,e,n);return s==null?r!=""&&Yi:r!=s&&i(r,s)}function r(e,n,r){return r!=t&&i(r,t)}var i=_(e);return typeof t=="function"?n:t==null?Z:(t+="",r)}function tt(e){var t=ts,n=us,r=ss,i=os;ts=this.id,us=this.ease();for(var s=0,o=this.length;s<o;s++)for(var u=this[s],a=0,f=u.length;a<f;a++){var l=u[a];l&&(ss=this[s][a].delay,os=this[s][a].duration,e.call(l=l.node,l.__data__,a,s))}return ts=t,us=n,ss=r,os=i,this}function nt(){var e,t=Date.now(),n=as;while(n)e=t-n.then,e>=n.delay&&(n.flush=n.callback(e)),n=n.next;var r=rt()-t;r>24?(isFinite(r)&&(clearTimeout(ls),ls=setTimeout(nt,r)),fs=0):(fs=1,cs(nt))}function rt(){var e=null,t=as,n=Infinity;while(t)t.flush?t=e?e.next=t.next:as=t.next:(n=Math.min(n,t.then+t.delay),t=(e=t).next);return n}function it(e){var t=[e.a,e.b],n=[e.c,e.d],r=ot(t),i=st(t,n),s=ot(ut(n,t,-i))||0;t[0]*n[1]<n[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,i*=-1),this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-n[0],n[1]))*hs,this.translate=[e.e,e.f],this.scale=[r,s],this.skew=s?Math.atan2(i,s)*hs:0}function st(e,t){return e[0]*t[0]+e[1]*t[1]}function ot(e){var t=Math.sqrt(st(e,e));return t&&(e[0]/=t,e[1]/=t),t}function ut(e,t,n){return e[0]+=n*t[0],e[1]+=n*t[1],e}function at(e,t){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();if(ps<0&&(window.scrollX||window.scrollY)){n=d3.select(document.body).append("svg").style("position","absolute").style("top",0).style("left",0);var i=n[0][0].getScreenCTM();ps=!i.f&&!i.e,n.remove()}return ps?(r.x=t.pageX,r.y=t.pageY):(r.x=t.clientX,r.y=t.clientY),r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}var s=e.getBoundingClientRect();return[t.clientX-s.left-e.clientLeft,t.clientY-s.top-e.clientTop]}function ft(){}function lt(e){var t=e[0],n=e[e.length-1];return t<n?[t,n]:[n,t]}function ct(e){return e.rangeExtent?e.rangeExtent():lt(e.range())}function ht(e,t){var n=0,r=e.length-1,i=e[n],s=e[r],o;s<i&&(o=n,n=r,r=o,o=i,i=s,s=o);if(o=s-i)t=t(o),e[n]=t.floor(i),e[r]=t.ceil(s);return e}function pt(){return Math}function dt(e,t,n,r){function i(){var i=Math.min(e.length,t.length)>2?Et:wt,a=r?P:D;return o=i(e,t,a,n),u=i(t,e,a,d3.interpolate),s}function s(e){return o(e)}var o,u;return s.invert=function(e){return u(e)},s.domain=function(t){return arguments.length?(e=t.map(Number),i()):e},s.range=function(e){return arguments.length?(t=e,i()):t},s.rangeRound=function(e){return s.range(e).interpolate(d3.interpolateRound)},s.clamp=function(e){return arguments.length?(r=e,i()):r},s.interpolate=function(e){return arguments.length?(n=e,i()):n},s.ticks=function(t){return yt(e,t)},s.tickFormat=function(t){return bt(e,t)},s.nice=function(){return ht(e,mt),i()},s.copy=function(){return dt(e,t,n,r)},i()}function vt(e,t){return d3.rebind(e,t,"range","rangeRound","interpolate","clamp")}function mt(e){return e=Math.pow(10,Math.round(Math.log(e)/Math.LN10)-1),{floor:function(t){return Math.floor(t/e)*e},ceil:function(t){return Math.ceil(t/e)*e}}}function gt(e,t){var n=lt(e),r=n[1]-n[0],i=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),s=t/r*i;return s<=.15?i*=10:s<=.35?i*=5:s<=.75&&(i*=2),n[0]=Math.ceil(n[0]/i)*i,n[1]=Math.floor(n[1]/i)*i+i*.5,n[2]=i,n}function yt(e,t){return d3.range.apply(d3,gt(e,t))}function bt(e,t){return d3.format(",."+Math.max(0,-Math.floor(Math.log(gt(e,t)[2])/Math.LN10+.01))+"f")}function wt(e,t,n,r){var i=n(e[0],e[1]),s=r(t[0],t[1]);return function(e){return s(i(e))}}function Et(e,t,n,r){var i=[],s=[],o=0,u=Math.min(e.length,t.length)-1;e[u]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());while(++o<=u)i.push(n(e[o-1],e[o])),s.push(r(t[o-1],t[o]));return function(t){var n=d3.bisect(e,t,1,u)-1;return s[n](i[n](t))}}function St(e,t){function n(n){return e(t(n))}var r=t.pow;return n.invert=function(t){return r(e.invert(t))},n.domain=function(i){return arguments.length?(t=i[0]<0?Tt:xt,r=t.pow,e.domain(i.map(t)),n):e.domain().map(r)},n.nice=function(){return e.domain(ht(e.domain(),pt)),n},n.ticks=function(){var n=lt(e.domain()),i=[];if(n.every(isFinite)){var s=Math.floor(n[0]),o=Math.ceil(n[1]),u=r(n[0]),a=r(n[1]);if(t===Tt){i.push(r(s));for(;s++<o;)for(var f=9;f>0;f--)i.push(r(s)*f)}else{for(;s<o;s++)for(var f=1;f<10;f++)i.push(r(s)*f);i.push(r(s))}for(s=0;i[s]<u;s++);for(o=i.length;i[o-1]>a;o--);i=i.slice(s,o)}return i},n.tickFormat=function(e,i){arguments.length<2&&(i=ds);if(arguments.length<1)return i;var s=e/n.ticks().length,o=t===Tt?(u=-1e-12,Math.floor):(u=1e-12,Math.ceil),u;return function(e){return e/r(o(t(e)+u))<s?i(e):""}},n.copy=function(){return St(e.copy(),t)},vt(n,e)}function xt(e){return Math.log(e<0?0:e)/Math.LN10}function Tt(e){return-Math.log(e>0?0:-e)/Math.LN10}function Nt(e,t){function n(t){return e(r(t))}var r=Ct(t),i=Ct(1/t);return n.invert=function(t){return i(e.invert(t))},n.domain=function(t){return arguments.length?(e.domain(t.map(r)),n):e.domain().map(i)},n.ticks=function(e){return yt(n.domain(),e)},n.tickFormat=function(e){return bt(n.domain(),e)},n.nice=function(){return n.domain(ht(n.domain(),mt))},n.exponent=function(e){if(!arguments.length)return t;var s=n.domain();return r=Ct(t=e),i=Ct(1/t),n.domain(s)},n.copy=function(){return Nt(e.copy(),t)},vt(n,e)}function Ct(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function kt(e,t){function n(t){return o[((s.get(t)||s.set(t,e.push(t)))-1)%o.length]}function i(t,n){return d3.range(e.length).map(function(e){return t+n*e})}var s,o,u;return n.domain=function(i){if(!arguments.length)return e;e=[],s=new r;var o=-1,u=i.length,a;while(++o<u)s.has(a=i[o])||s.set(a,e.push(a));return n[t.t](t.x,t.p)},n.range=function(e){return arguments.length?(o=e,u=0,t={t:"range",x:e},n):o},n.rangePoints=function(r,s){arguments.length<2&&(s=0);var a=r[0],f=r[1],l=(f-a)/(e.length-1+s);return o=i(e.length<2?(a+f)/2:a+l*s/2,l),u=0,t={t:"rangePoints",x:r,p:s},n},n.rangeBands=function(r,s){arguments.length<2&&(s=0);var a=r[1]<r[0],f=r[a-0],l=r[1-a],c=(l-f)/(e.length+s);return o=i(f+c*s,c),a&&o.reverse(),u=c*(1-s),t={t:"rangeBands",x:r,p:s},n},n.rangeRoundBands=function(r,s){arguments.length<2&&(s=0);var a=r[1]<r[0],f=r[a-0],l=r[1-a],c=Math.floor((l-f)/(e.length+s)),h=l-f-(e.length-s)*c;return o=i(f+Math.round(h/2),c),a&&o.reverse(),u=Math.round(c*(1-s)),t={t:"rangeRoundBands",x:r,p:s},n},n.rangeBand=function(){return u},n.rangeExtent=function(){return lt(t.x)},n.copy=function(){return kt(e,t)},n.domain(e)}function Lt(e,t){function n(){var n=0,s=e.length,o=t.length;i=[];while(++n<o)i[n-1]=d3.quantile(e,n/o);return r}function r(e){return isNaN(e=+e)?NaN:t[d3.bisect(i,e)]}var i;return r.domain=function(t){return arguments.length?(e=t.filter(function(e){return!isNaN(e)}).sort(d3.ascending),n()):e},r.range=function(e){return arguments.length?(t=e,n()):t},r.quantiles=function(){return i},r.copy=function(){return Lt(e,t)},n()}function At(e,t,n){function r(t){return n[Math.max(0,Math.min(o,Math.floor(s*(t-e))))]}function i(){return s=n.length/(t-e),o=n.length-1,r}var s,o;return r.domain=function(n){return arguments.length?(e=+n[0],t=+n[n.length-1],i()):[e,t]},r.range=function(e){return arguments.length?(n=e,i()):n},r.copy=function(){return At(e,t,n)},i()}function Ot(e){function t(e){return+e}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=n.map(t),t):e},t.ticks=function(t){return yt(e,t)},t.tickFormat=function(t){return bt(e,t)},t.copy=function(){return Ot(e)},t}function Mt(e){return e.innerRadius}function _t(e){return e.outerRadius}function Dt(e){return e.startAngle}function Pt(e){return e.endAngle}function Ht(e){function t(t){return t.length<1?null:"M"+s(e(Bt(this,t,n,r)),o)}var n=jt,r=Ft,i=Es,s=Ss.get(i),o=.7;return t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(r=e,t):r},t.interpolate=function(e){return arguments.length?(Ss.has(e+="")||(e=Es),s=Ss.get(i=e),t):i},t.tension=function(e){return arguments.length?(o=e,t):o},t}function Bt(e,t,n,r){var i=[],s=-1,o=t.length,u=typeof n=="function",a=typeof r=="function",f;if(u&&a)while(++s<o)i.push([n.call(e,f=t[s],s),r.call(e,f,s)]);else if(u)while(++s<o)i.push([n.call(e,t[s],s),r]);else if(a)while(++s<o)i.push([n,r.call(e,t[s],s)]);else while(++s<o)i.push([n,r]);return i}function jt(e){return e[0]}function Ft(e){return e[1]}function It(e){var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];while(++t<n)i.push("L",(r=e[t])[0],",",r[1]);return i.join("")}function qt(e){var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];while(++t<n)i.push("V",(r=e[t])[1],"H",r[0]);return i.join("")}function Rt(e){var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];while(++t<n)i.push("H",(r=e[t])[0],"V",r[1]);return i.join("")}function Ut(e,t){return e.length<4?It(e):e[1]+Xt(e.slice(1,e.length-1),Vt(e,t))}function zt(e,t){return e.length<3?It(e):e[0]+Xt((e.push(e[0]),e),Vt([e[e.length-2]].concat(e,[e[1]]),t))}function Wt(e,t,n){return e.length<3?It(e):e[0]+Xt(e,Vt(e,t))}function Xt(e,t){if(t.length<1||e.length!=t.length&&e.length!=t.length+2)return It(e);var n=e.length!=t.length,r="",i=e[0],s=e[1],o=t[0],u=o,a=1;n&&(r+="Q"+(s[0]-o[0]*2/3)+","+(s[1]-o[1]*2/3)+","+s[0]+","+s[1],i=e[1],a=2);if(t.length>1){u=t[1],s=e[a],a++,r+="C"+(i[0]+o[0])+","+(i[1]+o[1])+","+(s[0]-u[0])+","+(s[1]-u[1])+","+s[0]+","+s[1];for(var f=2;f<t.length;f++,a++)s=e[a],u=t[f],r+="S"+(s[0]-u[0])+","+(s[1]-u[1])+","+s[0]+","+s[1]}if(n){var l=e[a];r+="Q"+(s[0]+u[0]*2/3)+","+(s[1]+u[1]*2/3)+","+l[0]+","+l[1]}return r}function Vt(e,t){var n=[],r=(1-t)/2,i,s=e[0],o=e[1],u=1,a=e.length;while(++u<a)i=s,s=o,o=e[u],n.push([r*(o[0]-i[0]),r*(o[1]-i[1])]);return n}function $t(e){if(e.length<3)return It(e);var t=1,n=e.length,r=e[0],i=r[0],s=r[1],o=[i,i,i,(r=e[1])[0]],u=[s,s,s,r[1]],a=[i,",",s];Yt(a,o,u);while(++t<n)r=e[t],o.shift(),o.push(r[0]),u.shift(),u.push(r[1]),Yt(a,o,u);t=-1;while(++t<2)o.shift(),o.push(r[0]),u.shift(),u.push(r[1]),Yt(a,o,u);return a.join("")}function Jt(e){if(e.length<4)return It(e);var t=[],n=-1,r=e.length,i,s=[0],o=[0];while(++n<3)i=e[n],s.push(i[0]),o.push(i[1]);t.push(Gt(Ns,s)+","+Gt(Ns,o)),--n;while(++n<r)i=e[n],s.shift(),s.push(i[0]),o.shift(),o.push(i[1]),Yt(t,s,o);return t.join("")}function Kt(e){var t,n=-1,r=e.length,i=r+4,s,o=[],u=[];while(++n<4)s=e[n%r],o.push(s[0]),u.push(s[1]);t=[Gt(Ns,o),",",Gt(Ns,u)],--n;while(++n<i)s=e[n%r],o.shift(),o.push(s[0]),u.shift(),u.push(s[1]),Yt(t,o,u);return t.join("")}function Qt(e,t){var n=e.length-1,r=e[0][0],i=e[0][1],s=e[n][0]-r,o=e[n][1]-i,u=-1,a,f;while(++u<=n)a=e[u],f=u/n,a[0]=t*a[0]+(1-t)*(r+f*s),a[1]=t*a[1]+(1-t)*(i+f*o);return $t(e)}function Gt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Yt(e,t,n){e.push("C",Gt(xs,t),",",Gt(xs,n),",",Gt(Ts,t),",",Gt(Ts,n),",",Gt(Ns,t),",",Gt(Ns,n))}function Zt(e,t){return(t[1]-e[1])/(t[0]-e[0])}function en(e){var t=0,n=e.length-1,r=[],i=e[0],s=e[1],o=r[0]=Zt(i,s);while(++t<n)r[t]=o+(o=Zt(i=s,s=e[t+1]));return r[t]=o,r}function tn(e){var t=[],n,r,i,s,o=en(e),u=-1,a=e.length-1;while(++u<a)n=Zt(e[u],e[u+1]),Math.abs(n)<1e-6?o[u]=o[u+1]=0:(r=o[u]/n,i=o[u+1]/n,s=r*r+i*i,s>9&&(s=n*3/Math.sqrt(s),o[u]=s*r,o[u+1]=s*i));u=-1;while(++u<=a)s=(e[Math.min(a,u+1)][0]-e[Math.max(0,u-1)][0])/(6*(1+o[u]*o[u])),t.push([s||0,o[u]*s||0]);return t}function nn(e){return e.length<3?It(e):e[0]+Xt(e,tn(e))}function rn(e){var t,n=-1,r=e.length,i,s;while(++n<r)t=e[n],i=t[0],s=t[1]+bs,t[0]=i*Math.cos(s),t[1]=i*Math.sin(s);return e}function sn(e){function t(t){if(t.length<1)return null;var o=Bt(this,t,n,i),l=Bt(this,t,n===r?on(o):r,i===s?un(o):s);return"M"+u(e(l),f)+"L"+a(e(o.reverse()),f)+"Z"}var n=jt,r=jt,i=0,s=Ft,o,u,a,f=.7;return t.x=function(e){return arguments.length?(n=r=e,t):r},t.x0=function(e){return arguments.length?(n=e,t):n},t.x1=function(e){return arguments.length?(r=e,t):r},t.y=function(e){return arguments.length?(i=s=e,t):s},t.y0=function(e){return arguments.length?(i=e,t):i},t.y1=function(e){return arguments.length?(s=e,t):s},t.interpolate=function(e){return arguments.length?(Ss.has(e+="")||(e=Es),u=Ss.get(o=e),a=u.reverse||u,t):o},t.tension=function(e){return arguments.length?(f=e,t):f},t.interpolate("linear")}function on(e){return function(t,n){return e[n][0]}}function un(e){return function(t,n){return e[n][1]}}function an(e){return e.source}function fn(e){return e.target}function ln(e){return e.radius}function cn(e){return e.startAngle}function hn(e){return e.endAngle}function pn(e){return[e.x,e.y]}function dn(e){return function(){var t=e.apply(this,arguments),n=t[0],r=t[1]+bs;return[n*Math.cos(r),n*Math.sin(r)]}}function vn(){return 64}function mn(){return"circle"}function gn(e){var t=Math.sqrt(e/Math.PI);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+ -t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function yn(e,t){e.attr("transform",function(e){return"translate("+t(e)+",0)"})}function bn(e,t){e.attr("transform",function(e){return"translate(0,"+t(e)+")"})}function wn(e,t,n){i=[];if(n&&t.length>1){var r=lt(e.domain()),i,s=-1,o=t.length,u=(t[1]-t[0])/++n,a,f;while(++s<o)for(a=n;--a>0;)(f=+t[s]-a*u)>=r[0]&&i.push(f);for(--s,a=0;++a<n&&(f=+t[s]+a*u)<r[1];)i.push(f)}return i}function En(){Ms||(Ms=d3.select("body").append("div").style("visibility","hidden").style("top",0).style("height",0).style("width",0).style("overflow-y","scroll").append("div").style("height","2000px").node().parentNode);var e=d3.event,t;try{Ms.scrollTop=1e3,Ms.dispatchEvent(e),t=1e3-Ms.scrollTop}catch(n){t=e.wheelDelta||-e.detail*5}return t}function Sn(e){var t=e.source,n=e.target,r=Tn(t,n),i=[t];while(t!==r)t=t.parent,i.push(t);var s=i.length;while(n!==r)i.splice(s,0,n),n=n.parent;return i}function xn(e){var t=[],n=e.parent;while(n!=null)t.push(e),e=n,n=n.parent;return t.push(e),t}function Tn(e,t){if(e===t)return e;var n=xn(e),r=xn(t),i=n.pop(),s=r.pop(),o=null;while(i===s)o=i,i=n.pop(),s=r.pop();return o}function Nn(e){e.fixed|=2}function Cn(e){e!==Ps&&(e.fixed&=1)}function kn(){Ps.fixed&=1,Ds=Ps=null}function Ln(){Ps.px=d3.event.x,Ps.py=d3.event.y,Ds.resume()}function An(e,t,n){var r=0,i=0;e.charge=0;if(!e.leaf){var s=e.nodes,o=s.length,u=-1,a;while(++u<o){a=s[u];if(a==null)continue;An(a,t,n),e.charge+=a.charge,r+=a.charge*a.cx,i+=a.charge*a.cy}}if(e.point){e.leaf||(e.point.x+=Math.random()-.5,e.point.y+=Math.random()-.5);var f=t*n[e.point.index];e.charge+=e.pointCharge=f,r+=f*e.point.x,i+=f*e.point.y}e.cx=r/e.charge,e.cy=i/e.charge}function On(e){return 20}function Mn(e){return 1}function _n(e){return e.x}function Dn(e){return e.y}function Pn(e,t,n){e.y0=t,e.y=n}function Hn(e){return d3.range(e.length)}function Bn(e){var t=-1,n=e[0].length,r=[];while(++t<n)r[t]=0;return r}function jn(e){var t=1,n=0,r=e[0][1],i,s=e.length;for(;t<s;++t)(i=e[t][1])>r&&(n=t,r=i);return n}function Fn(e){return e.reduce(In,0)}function In(e,t){return e+t[1]}function qn(e,t){return Rn(e,Math.ceil(Math.log(t.length)/Math.LN2+1))}function Rn(e,t){var n=-1,r=+e[0],i=(e[1]-r)/t,s=[];while(++n<=t)s[n]=i*n+r;return s}function Un(e){return[d3.min(e),d3.max(e)]}function zn(e,t){return d3.rebind(e,t,"sort","children","value"),e.links=$n,e.nodes=function(t){return Fs=!0,(e.nodes=e)(t)},e}function Wn(e){return e.children}function Xn(e){return e.value}function Vn(e,t){return t.value-e.value}function $n(e){return d3.merge(e.map(function(e){return(e.children||[]).map(function(t){return{source:e,target:t}})}))}function Jn(e,t){return e.value-t.value}function Kn(e,t){var n=e._pack_next;e._pack_next=t,t._pack_prev=e,t._pack_next=n,n._pack_prev=t}function Qn(e,t){e._pack_next=t,t._pack_prev=e}function Gn(e,t){var n=t.x-e.x,r=t.y-e.y,i=e.r+t.r;return i*i-n*n-r*r>.001}function Yn(e){function t(e){n=Math.min(e.x-e.r,n),r=Math.max(e.x+e.r,r),i=Math.min(e.y-e.r,i),s=Math.max(e.y+e.r,s)}var n=Infinity,r=-Infinity,i=Infinity,s=-Infinity,o=e.length,u,a,f,l,c;e.forEach(Zn),u=e[0],u.x=-u.r,u.y=0,t(u);if(o>1){a=e[1],a.x=a.r,a.y=0,t(a);if(o>2){f=e[2],rr(u,a,f),t(f),Kn(u,f),u._pack_prev=f,Kn(f,a),a=u._pack_next;for(var h=3;h<o;h++){rr(u,a,f=e[h]);var p=0,d=1,v=1;for(l=a._pack_next;l!==a;l=l._pack_next,d++)if(Gn(l,f)){p=1;break}if(p==1)for(c=u._pack_prev;c!==l._pack_prev;c=c._pack_prev,v++)if(Gn(c,f))break;p?(d<v||d==v&&a.r<u.r?Qn(u,a=l):Qn(u=c,a),h--):(Kn(u,f),a=f,t(f))}}}var m=(n+r)/2,g=(i+s)/2,y=0;for(var h=0;h<o;h++){var b=e[h];b.x-=m,b.y-=g,y=Math.max(y,b.r+Math.sqrt(b.x*b.x+b.y*b.y))}return e.forEach(er),y}function Zn(e){e._pack_next=e._pack_prev=e}function er(e){delete e._pack_next,delete e._pack_prev}function tr(e){var t=e.children;t&&t.length?(t.forEach(tr),e.r=Yn(t)):e.r=Math.sqrt(e.value)}function nr(e,t,n,r){var i=e.children;e.x=t+=r*e.x,e.y=n+=r*e.y,e.r*=r;if(i){var s=-1,o=i.length;while(++s<o)nr(i[s],t,n,r)}}function rr(e,t,n){var r=e.r+n.r,i=t.x-e.x,s=t.y-e.y;if(r&&(i||s)){var o=t.r+n.r,u=Math.sqrt(i*i+s*s),a=Math.max(-1,Math.min(1,(r*r+u*u-o*o)/(2*r*u))),f=Math.acos(a),l=a*(r/=u),c=Math.sin(f)*r;n.x=e.x+l*i+c*s,n.y=e.y+l*s-c*i}else n.x=e.x+r,n.y=e.y}function ir(e){return 1+d3.max(e,function(e){return e.y})}function sr(e){return e.reduce(function(e,t){return e+t.x},0)/e.length}function or(e){var t=e.children;return t&&t.length?or(t[0]):e}function ur(e){var t=e.children,n;return t&&(n=t.length)?ur(t[n-1]):e}function ar(e,t){return e.parent==t.parent?1:2}function fr(e){var t=e.children;return t&&t.length?t[0]:e._tree.thread}function lr(e){var t=e.children,n;return t&&(n=t.length)?t[n-1]:e._tree.thread}function cr(e,t){var n=e.children;if(n&&(i=n.length)){var r,i,s=-1;while(++s<i)t(r=cr(n[s],t),e)>0&&(e=r)}return e}function hr(e,t){return e.x-t.x}function pr(e,t){return t.x-e.x}function dr(e,t){return e.depth-t.depth}function vr(e,t){function n(e,r){var i=e.children;if(i&&(a=i.length)){var s,o=null,u=-1,a;while(++u<a)s=i[u],n(s,o),o=s}t(e,r)}n(e,null)}function mr(e){var t=0,n=0,r=e.children,i=r.length,s;while(--i>=0)s=r[i]._tree,s.prelim+=t,s.mod+=t,t+=s.shift+(n+=s.change)}function gr(e,t,n){e=e._tree,t=t._tree;var r=n/(t.number-e.number);e.change+=r,t.change-=r,t.shift+=n,t.prelim+=n,t.mod+=n}function yr(e,t,n){return e._tree.ancestor.parent==t.parent?e._tree.ancestor:n}function br(e){return{x:e.x,y:e.y,dx:e.dx,dy:e.dy}}function wr(e,t){var n=e.x+t[3],r=e.y+t[0],i=e.dx-t[1]-t[3],s=e.dy-t[0]-t[2];return i<0&&(n+=i/2,i=0),s<0&&(r+=s/2,s=0),{x:n,y:r,dx:i,dy:s}}function Er(e){return e.map(Sr).join(",")}function Sr(e){return/[",\n]/.test(e)?'"'+e.replace(/\"/g,'""')+'"':e}function xr(e,t){return function(n){return n&&e.hasOwnProperty(n.type)?e[n.type](n):t}}function Tr(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+ -2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function Nr(e,t){qs.hasOwnProperty(e.type)&&qs[e.type](e,t)}function Cr(e,t){Nr(e.geometry,t)}function kr(e,t){for(var n=e.features,r=0,i=n.length;r<i;r++)Nr(n[r].geometry,t)}function Lr(e,t){for(var n=e.geometries,r=0,i=n.length;r<i;r++)Nr(n[r],t)}function Ar(e,t){for(var n=e.coordinates,r=0,i=n.length;r<i;r++)t.apply(null,n[r])}function Or(e,t){for(var n=e.coordinates,r=0,i=n.length;r<i;r++)for(var s=n[r],o=0,u=s.length;o<u;o++)t.apply(null,s[o])}function Mr(e,t){for(var n=e.coordinates,r=0,i=n.length;r<i;r++)for(var s=n[r][0],o=0,u=s.length;o<u;o++)t.apply(null,s[o])}function _r(e,t){t.apply(null,e.coordinates)}function Dr(e,t){for(var n=e.coordinates[0],r=0,i=n.length;r<i;r++)t.apply(null,n[r])}function Pr(e){return e.source}function Hr(e){return e.target}function Br(e,t){function n(e){var t=Math.sin(v-(e*=v))/m,n=Math.sin(e)/m,r=t*u*i+n*p*l,o=t*u*s+n*p*c,f=t*a+n*d;return[Math.atan2(o,r)/Is,Math.atan2(f,Math.sqrt(r*r+o*o))/Is]}var r=e[0]*Is,i=Math.cos(r),s=Math.sin(r),o=e[1]*Is,u=Math.cos(o),a=Math.sin(o),f=t[0]*Is,l=Math.cos(f),c=Math.sin(f),h=t[1]*Is,p=Math.cos(h),d=Math.sin(h),v=n.d=Math.acos(Math.max(-1,Math.min(1,a*d+u*p*Math.cos(f-r)))),m=Math.sin(v);return n}function jr(e){var t=0,n=0;for(;;){if(e(t,n))return[t,n];t===0?(t=n+1,n=0):(t-=1,n+=1)}}function Fr(e,t,n,r){var i,s,o,u,a,f,l;return i=r[e],s=i[0],o=i[1],i=r[t],u=i[0],a=i[1],i=r[n],f=i[0],l=i[1],(l-o)*(u-s)-(a-o)*(f-s)>0}function Ir(e,t,n){return(n[0]-t[0])*(e[1]-t[1])<(n[1]-t[1])*(e[0]-t[0])}function qr(e,t,n,r){var i=e[0],s=t[0],o=n[0],u=r[0],a=e[1],f=t[1],l=n[1],c=r[1],h=i-o,p=s-i,d=u-o,v=a-l,m=f-a,g=c-l,y=(d*v-g*h)/(g*p-d*m);return[i+y*p,a+y*m]}function Rr(e,t){var n={list:e.map(function(e,t){return{index:t,x:e[0],y:e[1]}}).sort(function(e,t){return e.y<t.y?-1:e.y>t.y?1:e.x<t.x?-1:e.x>t.x?1:0}),bottomSite:null},r={list:[],leftEnd:null,rightEnd:null,init:function(){r.leftEnd=r.createHalfEdge(null,"l"),r.rightEnd=r.createHalfEdge(null,"l"),r.leftEnd.r=r.rightEnd,r.rightEnd.l=r.leftEnd,r.list.unshift(r.leftEnd,r.rightEnd)},createHalfEdge:function(e,t){return{edge:e,side:t,vertex:null,l:null,r:null}},insert:function(e,t){t.l=e,t.r=e.r,e.r.l=t,e.r=t},leftBound:function(e){var t=r.leftEnd;do t=t.r;while(t!=r.rightEnd&&i.rightOf(t,e));return t=t.l,t},del:function(e){e.l.r=e.r,e.r.l=e.l,e.edge=null},right:function(e){return e.r},left:function(e){return e.l},leftRegion:function(e){return e.edge==null?n.bottomSite:e.edge.region[e.side]},rightRegion:function(e){return e.edge==null?n.bottomSite:e.edge.region[zs[e.side]]}},i={bisect:function(e,t){var n={region:{l:e,r:t},ep:{l:null,r:null}},r=t.x-e.x,i=t.y-e.y,s=r>0?r:-r,o=i>0?i:-i;return n.c=e.x*r+e.y*i+(r*r+i*i)*.5,s>o?(n.a=1,n.b=i/r,n.c/=r):(n.b=1,n.a=r/i,n.c/=i),n},intersect:function(e,t){var n=e.edge,r=t.edge;if(!n||!r||n.region.r==r.region.r)return null;var i=n.a*r.b-n.b*r.a;if(Math.abs(i)<1e-10)return null;var s=(n.c*r.b-r.c*n.b)/i,o=(r.c*n.a-n.c*r.a)/i,u=n.region.r,a=r.region.r,f,l;u.y<a.y||u.y==a.y&&u.x<a.x?(f=e,l=n):(f=t,l=r);var c=s>=l.region.r.x;return c&&f.side==="l"||!c&&f.side==="r"?null:{x:s,y:o}},rightOf:function(e,t){var n=e.edge,r=n.region.r,i=t.x>r.x;if(i&&e.side==="l")return 1;if(!i&&e.side==="r")return 0;if(n.a===1){var s=t.y-r.y,o=t.x-r.x,u=0,a=0;!i&&n.b<0||i&&n.b>=0?a=u=s>=n.b*o:(a=t.x+t.y*n.b>n.c,n.b<0&&(a=!a),a||(u=1));if(!u){var f=r.x-n.region.l.x;a=n.b*(o*o-s*s)<f*s*(1+2*o/f+n.b*n.b),n.b<0&&(a=!a)}}else{var l=n.c-n.a*t.x,c=t.y-l,h=t.x-r.x,p=l-r.y;a=c*c>h*h+p*p}return e.side==="l"?a:!a},endPoint:function(e,n,r){e.ep[n]=r;if(!e.ep[zs[n]])return;t(e)},distance:function(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}},s={list:[],insert:function(e,t,n){e.vertex=t,e.ystar=t.y+n;for(var r=0,i=s.list,o=i.length;r<o;r++){var u=i[r];if(e.ystar>u.ystar||e.ystar==u.ystar&&t.x>u.vertex.x)continue;break}i.splice(r,0,e)},del:function(e){for(var t=0,n=s.list,r=n.length;t<r&&n[t]!=e;++t);n.splice(t,1)},empty:function(){return s.list.length===0},nextEvent:function(e){for(var t=0,n=s.list,r=n.length;t<r;++t)if(n[t]==e)return n[t+1];return null},min:function(){var e=s.list[0];return{x:e.vertex.x,y:e.ystar}},extractMin:function(){return s.list.shift()}};r.init(),n.bottomSite=n.list.shift();var o=n.list.shift(),u,a,f,l,c,h,p,d,v,m,g,y,b;for(;;){s.empty()||(u=s.min());if(o&&(s.empty()||o.y<u.y||o.y==u.y&&o.x<u.x))a=r.leftBound(o),f=r.right(a),p=r.rightRegion(a),y=i.bisect(p,o),h=r.createHalfEdge(y,"l"),r.insert(a,h),m=i.intersect(a,h),m&&(s.del(a),s.insert(a,m,i.distance(m,o))),a=h,h=r.createHalfEdge(y,"r"),r.insert(a,h),m=i.intersect(h,f),m&&s.insert(h,m,i.distance(m,o)),o=n.list.shift();else{if(!!s.empty())break;a=s.extractMin(),l=r.left(a),f=r.right(a),c=r.right(f),p=r.leftRegion(a),d=r.rightRegion(f),g=a.vertex,i.endPoint(a.edge,a.side,g),i.endPoint(f.edge,f.side,g),r.del(a),s.del(f),r.del(f),b="l",p.y>d.y&&(v=p,p=d,d=v,b="r"),y=i.bisect(p,d),h=r.createHalfEdge(y,b),r.insert(l,h),i.endPoint(y,zs[b],g),m=i.intersect(l,h),m&&(s.del(l),s.insert(l,m,i.distance(m,p))),m=i.intersect(h,c),m&&s.insert(h,m,i.distance(m,p))}}for(a=r.right(r.leftEnd);a!=r.rightEnd;a=r.right(a))t(a.edge)}function Ur(){return{leaf:!0,nodes:[],point:null}}function zr(e,t,n,r,i,s){if(!e(t,n,r,i,s)){var o=(n+i)*.5,u=(r+s)*.5,a=t.nodes;a[0]&&zr(e,a[0],n,r,o,u),a[1]&&zr(e,a[1],o,r,i,u),a[2]&&zr(e,a[2],n,u,o,s),a[3]&&zr(e,a[3],o,u,i,s)}}function Wr(e){return{x:e[0],y:e[1]}}function Xr(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Vr(e,t,n,r){var i,s,o=0,u=t.length,a=n.length;while(o<u){if(r>=a)return-1;i=t.charCodeAt(o++);if(i==37){s=Gs[t.charAt(o++)];if(!s||(r=s(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}function $r(e,t,n){return Ys.test(t.substring(n,n+=3))?n:-1}function Jr(e,t,n){Zs.lastIndex=0;var r=Zs.exec(t.substring(n,n+10));return r?n+=r[0].length:-1}function Kr(e,t,n){var r=eo.get(t.substring(n,n+=3).toLowerCase());return r==null?-1:(e.m=r,n)}function Qr(e,t,n){to.lastIndex=0;var r=to.exec(t.substring(n,n+12));return r?(e.m=no.get(r[0].toLowerCase()),n+=r[0].length):-1}function Gr(e,t,n){return Vr(e,Qs.c.toString(),t,n)}function Yr(e,t,n){return Vr(e,Qs.x.toString(),t,n)}function Zr(e,t,n){return Vr(e,Qs.X.toString(),t,n)}function ei(e,t,n){io.lastIndex=0;var r=io.exec(t.substring(n,n+4));return r?(e.y=+r[0],n+=r[0].length):-1}function ti(e,t,n){io.lastIndex=0;var r=io.exec(t.substring(n,n+2));return r?(e.y=ni()+ +r[0],n+=r[0].length):-1}function ni(){return~~((new Date).getFullYear()/1e3)*1e3}function ri(e,t,n){io.lastIndex=0;var r=io.exec(t.substring(n,n+2));return r?(e.m=r[0]-1,n+=r[0].length):-1}function ii(e,t,n){io.lastIndex=0;var r=io.exec(t.substring(n,n+2));return r?(e.d=+r[0],n+=r[0].length):-1}function si(e,t,n){io.lastIndex=0;var r=io.exec(t.substring(n,n+2));return r?(e.H=+r[0],n+=r[0].length):-1}function oi(e,t,n){io.lastIndex=0;var r=io.exec(t.substring(n,n+2));return r?(e.M=+r[0],n+=r[0].length):-1}function ui(e,t,n){io.lastIndex=0;var r=io.exec(t.substring(n,n+2));return r?(e.S=+r[0],n+=r[0].length):-1}function ai(e,t,n){io.lastIndex=0;var r=io.exec(t.substring(n,n+3));return r?(e.L=+r[0],n+=r[0].length):-1}function fi(e,t,n){var r=so.get(t.substring(n,n+=2).toLowerCase());return r==null?-1:(e.p=r,n)}function li(e){var t=e.getTimezoneOffset(),n=t>0?"-":"+",r=~~(Math.abs(t)/60),i=Math.abs(t)%60;return n+Vs(r)+Vs(i)}function ci(e){return e.toISOString()}function hi(e,t,n){function r(t){var n=e(t),r=s(n,1);return t-n<r-t?n:r}function i(n){return t(n=e(new Ws(n-1)),1),n}function s(e,n){return t(e=new Ws(+e),n),e}function o(e,r,s){var o=i(e),u=[];if(s>1)while(o<r)n(o)%s||u.push(new Date(+o)),t(o,1);else while(o<r)u.push(new Date(+o)),t(o,1);return u}function u(e,t,n){try{Ws=Xr;var r=new Xr;return r._=e,o(r,t,n)}finally{Ws=Date}}e.floor=e,e.round=r,e.ceil=i,e.offset=s,e.range=o;var a=e.utc=pi(e);return a.floor=a,a.round=pi(r),a.ceil=pi(i),a.offset=pi(s),a.range=u,e}function pi(e){return function(t,n){try{Ws=Xr;var r=new Xr;return r._=t,e(r,n)._}finally{Ws=Date}}}function di(e,t,n){function r(t){return e(t)}return r.invert=function(t){return mi(e.invert(t))},r.domain=function(t){return arguments.length?(e.domain(t),r):e.domain().map(mi)},r.nice=function(e){var t=vi(r.domain());return r.domain([e.floor(t[0]),e.ceil(t[1])])},r.ticks=function(n,i){var s=vi(r.domain());if(typeof n!="function"){var o=s[1]-s[0],u=o/n,a=d3.bisect(uo,u);if(a==uo.length)return t.year(s,n);if(!a)return e.ticks(n).map(mi);Math.log(u/uo[a-1])<Math.log(uo[a]/u)&&--a,n=t[a],i=n[1],n=n[0].range}return n(s[0],new Date(+s[1]+1),i)},r.tickFormat=function(){return n},r.copy=function(){return di(e.copy(),t,n)},d3.rebind(r,e,"range","rangeRound","interpolate","clamp")}function vi(e){var t=e[0],n=e[e.length-1];return t<n?[t,n]:[n,t]}function mi(e){return new Date(e)}function gi(e){return function(t){var n=e.length-1,r=e[n];while(!r[1](t))r=e[--n];return r[0](t)}}function yi(e){var t=new Date(e,0,1);return t.setFullYear(e),t}function bi(e){var t=e.getFullYear(),n=yi(t),r=yi(t+1);return t+(e-n)/(r-n)}function wi(e){var t=new Date(Date.UTC(e,0,1));return t.setUTCFullYear(e),t}function Ei(e){var t=e.getUTCFullYear(),n=wi(t),r=wi(t+1);return t+(e-n)/(r-n)}Date.now||(Date.now=function(){return+(new Date)});try{document.createElement("div").style.setProperty("opacity",0,"")}catch(Si){var xi=CSSStyleDeclaration.prototype,Ti=xi.setProperty;xi.setProperty=function(e,t,n){Ti.call(this,e,t+"",n)}}d3={version:"2.8.1"};var Ni=n;try{Ni(document.documentElement.childNodes)[0].nodeType}catch(Ci){Ni=t}var ki=[].__proto__?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)e[n]=t[n]};d3.map=function(e){var t=new r;for(var n in e)t.set(n,e[n]);return t},e(r,{has:function(e){return Li+e in this},get:function(e){return this[Li+e]},set:function(e,t){return this[Li+e]=t},remove:function(e){return e=Li+e,e in this&&delete this[e]},keys:function(){var e=[];return this.forEach(function(t){e.push(t)}),e},values:function(){var e=[];return this.forEach(function(t,n){e.push(n)}),e},entries:function(){var e=[];return this.forEach(function(t,n){e.push({key:t,value:n})}),e},forEach:function(e){for(var t in this)t.charCodeAt(0)===Ai&&e.call(this,t.substring(1),this[t])}});var Li="\0",Ai=Li.charCodeAt(0);d3.functor=function(e){return typeof e=="function"?e:function(){return e}},d3.rebind=function(e,t){var n=1,r=arguments.length,i;while(++n<r)e[i=arguments[n]]=s(e,t,t[i]);return e},d3.ascending=function(e,t){return e<t?-1:e>t?1:e>=t?0:NaN},d3.descending=function(e,t){return t<e?-1:t>e?1:t>=e?0:NaN},d3.mean=function(e,t){var n=e.length,r,i=0,s=-1,u=0;if(arguments.length===1)while(++s<n)o(r=e[s])&&(i+=(r-i)/++u);else while(++s<n)o(r=t.call(e,e[s],s))&&(i+=(r-i)/++u);return u?i:undefined},d3.median=function(e,t){return arguments.length>1&&(e=e.map(t)),e=e.filter(o),e.length?d3.quantile(e.sort(d3.ascending),.5):undefined},d3.min=function(e,t){var n=-1,r=e.length,i,s;if(arguments.length===1){while(++n<r&&((i=e[n])==null||i!=i))i=undefined;while(++n<r)(s=e[n])!=null&&i>s&&(i=s)}else{while(++n<r&&((i=t.call(e,e[n],n))==null||i!=i))i=undefined;while(++n<r)(s=t.call(e,e[n],n))!=null&&i>s&&(i=s)}return i},d3.max=function(e,t){var n=-1,r=e.length,i,s;if(arguments.length===1){while(++n<r&&((i=e[n])==null||i!=i))i=undefined;while(++n<r)(s=e[n])!=null&&s>i&&(i=s)}else{while(++n<r&&((i=t.call(e,e[n],n))==null||i!=i))i=undefined;while(++n<r)(s=t.call(e,e[n],n))!=null&&s>i&&(i=s)}return i},d3.extent=function(e,t){var n=-1,r=e.length,i,s,o;if(arguments.length===1){while(++n<r&&((i=o=e[n])==null||i!=i))i=o=undefined;while(++n<r)(s=e[n])!=null&&(i>s&&(i=s),o<s&&(o=s))}else{while(++n<r&&((i=o=t.call(e,e[n],n))==null||i!=i))i=undefined;while(++n<r)(s=t.call(e,e[n],n))!=null&&(i>s&&(i=s),o<s&&(o=s))}return[i,o]},d3.random={normal:function(e,t){return arguments.length<2&&(t=1),arguments.length<1&&(e=0),function(){var n,r,i;do n=Math.random()*2-1,r=Math.random()*2-1,i=n*n+r*r;while(!i||i>1);return e+t*n*Math.sqrt(-2*Math.log(i)/i)}}},d3.sum=function(e,t){var n=0,r=e.length,i,s=-1;if(arguments.length===1)while(++s<r)isNaN(i=+e[s])||(n+=i);else while(++s<r)isNaN(i=+t.call(e,e[s],s))||(n+=i);return n},d3.quantile=function(e,t){var n=(e.length-1)*t+1,r=Math.floor(n),i=e[r-1],s=n-r;return s?i+s*(e[r]-i):i},d3.transpose=function(e){return d3.zip.apply(d3,e)},d3.zip=function(){if(!(i=arguments.length))return[];for(var e=-1,t=d3.min(arguments,u),n=new Array(t);++e<t;)for(var r=-1,i,s=n[e]=new Array(i);++r<i;)s[r]=arguments[r][e];return n},d3.bisector=function(e){return{left:function(t,n,r,i){arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);while(r<i){var s=r+i>>1;e.call(t,t[s],s)<n?r=s+1:i=s}return r},right:function(t,n,r,i){arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);while(r<i){var s=r+i>>1;n<e.call(t,t[s],s)?i=s:r=s+1}return r}}};var Oi=d3.bisector(function(e){return e});d3.bisectLeft=Oi.left,d3.bisect=d3.bisectRight=Oi.right,d3.first=function(e,t){var n=0,r=e.length,i=e[0],s;arguments.length===1&&(t=d3.ascending);while(++n<r)t.call(e,i,s=e[n])>0&&(i=s);return i},d3.last=function(e,t){var n=0,r=e.length,i=e[0],s;arguments.length===1&&(t=d3.ascending);while(++n<r)t.call(e,i,s=e[n])<=0&&(i=s);return i},d3.nest=function(){function e(t,s){if(s>=i.length)return u?u.call(n,t):o?t.sort(o):t;var a=-1,f=t.length,l=i[s++],c,h,p=new r,v,m={};while(++a<f)(v=p.get(c=l(h=t[a])))?v.push(h):p.set(c,[h]);return p.forEach(function(t){m[t]=e(p.get(t),s)}),m}function t(e,n){if(n>=i.length)return e;var r=[],o=s[n++],u;for(u in e)r.push({key:u,values:t(e[u],n)});return o&&r.sort(function(e,t){return o(e.key,t.key)}),r}var n={},i=[],s=[],o,u;return n.map=function(t){return e(t,0)},n.entries=function(n){return t(e(n,0),0)},n.key=function(e){return i.push(e),n},n.sortKeys=function(e){return s[i.length-1]=e,n},n.sortValues=function(e){return o=e,n},n.rollup=function(e){return u=e,n},n},d3.keys=function(e){var t=[];for(var n in e)t.push(n);return t},d3.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t},d3.entries=function(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t},d3.permute=function(e,t){var n=[],r=-1,i=t.length;while(++r<i)n[r]=e[t[r]];return n},d3.merge=function(e){return Array.prototype.concat.apply([],e)},d3.split=function(e,t){var n=[],r=[],i,s=-1,o=e.length;arguments.length<2&&(t=a);while(++s<o)t.call(r,i=e[s],s)?r=[]:(r.length||n.push(r),r.push(i));return n},d3.range=function(e,t,n){arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0));if((t-e)/n===Infinity)throw new Error("infinite range");var r=[],i=l(Math.abs(n)),s=-1,o;e*=i,t*=i,n*=i;if(n<0)while((o=e+n*++s)>t)r.push(o/i);else while((o=e+n*++s)<t)r.push(o/i);return r},d3.requote=function(e){return e.replace(Mi,"\\$&")};var Mi=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;d3.round=function(e,t){return t?Math.round(e*(t=Math.pow(10,t)))/t:Math.round(e)},d3.xhr=function(e,t,n){var r=new XMLHttpRequest;arguments.length<3?(n=t,t=null):t&&r.overrideMimeType&&r.overrideMimeType(t),r.open("GET",e,!0),t&&r.setRequestHeader("Accept",t),r.onreadystatechange=function(){r.readyState===4&&n(r.status<300?r:null)},r.send(null)},d3.text=function(e,t,n){function r(e){n(e&&e.responseText)}arguments.length<3&&(n=t,t=null),d3.xhr(e,t,r)},d3.json=function(e,t){d3.text(e,"application/json",function(e){t(e?JSON.parse(e):null)})},d3.html=function(e,t){d3.text(e,"text/html",function(e){if(e!=null){var n=document.createRange();n.selectNode(document.body),e=n.createContextualFragment(e)}t(e)})},d3.xml=function(e,t,n){function r(e){n(e&&e.responseXML)}arguments.length<3&&(n=t,t=null),d3.xhr(e,t,r)};var _i={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};d3.ns={prefix:_i,qualify:function(e){var t=e.indexOf(":"),n=e;return t>=0&&(n=e.substring(0,t),e=e.substring(t+1)),_i.hasOwnProperty(n)?{space:_i[n],local:e}:e}},d3.dispatch=function(){var e=new c,t=-1,n=arguments.length;while(++t<n)e[arguments[t]]=h(e);return e},c.prototype.on=function(e,t){var n=e.indexOf("."),r="";return n>0&&(r=e.substring(n+1),e=e.substring(0,n)),arguments.length<2?this[e].on(r):this[e].on(r,t)},d3.format=function(e){var t=Di.exec(e),n=t[1]||" ",r=t[3]||"",i=t[5],s=+t[6],o=t[7],u=t[8],a=t[9],f=1,l="",c=!1;u&&(u=+u.substring(1)),i&&(n="0",o&&(s-=Math.floor((s-1)/4)));switch(a){case"n":o=!0,a="g";break;case"%":f=100,l="%",a="f";break;case"p":f=100,l="%",a="r";break;case"d":c=!0,u=0;break;case"s":f=-1,a="r"}return a=="r"&&!u&&(a="g"),a=Pi.get(a)||v,function(e){if(c&&e%1)return"";var t=e<0&&(e=-e)?"−":r;if(f<0){var h=d3.formatPrefix(e,u);e*=h.scale,l=h.symbol}else e*=f;e=a(e,u);if(i){var p=e.length+t.length;p<s&&(e=(new Array(s-p+1)).join(n)+e),o&&(e=m(e)),e=t+e}else{o&&(e=m(e)),e=t+e;var p=e.length;p<s&&(e=(new Array(s-p+1)).join(n)+e)}return e+l}};var Di=/(?:([^{])?([<>=^]))?([+\- ])?(#)?(0)?([0-9]+)?(,)?(\.[0-9]+)?([a-zA-Z%])?/,Pi=d3.map({g:function(e,t){return e.toPrecision(t)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},r:function(e,t){return d3.round(e,t=p(e,t)).toFixed(Math.max(0,Math.min(20,t)))}}),Hi=["y","z","a","f","p","n","μ","m","","k","M","G","T","P","E","Z","Y"].map(g);d3.formatPrefix=function(e,t){var n=0;return e&&(e<0&&(e*=-1),t&&(e=d3.round(e,p(e,t))),n=1+Math.floor(1e-12+Math.log(e)/Math.LN10),n=Math.max(-24,Math.min(24,Math.floor((n<=0?n+1:n-1)/3)*3))),Hi[8+n/3]};var Bi=S(2),ji=S(3),Fi=function(){return E},Ii=d3.map({linear:Fi,poly:S,quad:function(){return Bi},cubic:function(){return ji},sin:function(){return x},exp:function(){return T},circle:function(){return N},elastic:C,back:k,bounce:function(){return L}}),qi=d3.map({"in":E,out:b,"in-out":w,"out-in":function(e){return w(b(e))}});d3.ease=function(e){var t=e.indexOf("-"),n=t>=0?e.substring(0,t):e,r=t>=0?e.substring(t+1):"in";return n=Ii.get(n)||Fi,r=qi.get(r)||E,y(r(n.apply(null,Array.prototype.slice.call(arguments,1))))},d3.event=null,d3.interpolate=function(e,t){var n=d3.interpolators.length,r;while(--n>=0&&!(r=d3.interpolators[n](e,t)));return r},d3.interpolateNumber=function(e,t){return t-=e,function(n){return e+t*n}},d3.interpolateRound=function(e,t){return t-=e,function(n){return Math.round(e+t*n)}},d3.interpolateString=function(e,t){var n,r,i,s=0,o=0,u=[],a=[],f,l;Ri.lastIndex=0;for(r=0;n=Ri.exec(t);++r)n.index&&u.push(t.substring(s,o=n.index)),a.push({i:u.length,x:n[0]}),u.push(null),s=Ri.lastIndex;s<t.length&&u.push(t.substring(s));for(r=0,f=a.length;(n=Ri.exec(e))&&r<f;++r){l=a[r];if(l.x==n[0]){if(l.i)if(u[l.i+1]==null){u[l.i-1]+=l.x,u.splice(l.i,1);for(i=r+1;i<f;++i)a[i].i--}else{u[l.i-1]+=l.x+u[l.i+1],u.splice(l.i,2);for(i=r+1;i<f;++i)a[i].i-=2}else if(u[l.i+1]==null)u[l.i]=l.x;else{u[l.i]=l.x+u[l.i+1],u.splice(l.i+1,1);for(i=r+1;i<f;++i)a[i].i--}a.splice(r,1),f--,r--}else l.x=d3.interpolateNumber(parseFloat(n[0]),parseFloat(l.x))}while(r<f)l=a.pop(),u[l.i+1]==null?u[l.i]=l.x:(u[l.i]=l.x+u[l.i+1],u.splice(l.i+1,1)),f--;return u.length===1?u[0]==null?a[0].x:function(){return t}:function(e){for(r=0;r<f;++r)u[(l=a[r]).i]=l.x(e);return u.join("")}},d3.interpolateTransform=function(e,t){var n=[],r=[],i,s=d3.transform(e),o=d3.transform(t),u=s.translate,a=o.translate,f=s.rotate,l=o.rotate,c=s.skew,h=o.skew,p=s.scale,d=o.scale;return u[0]!=a[0]||u[1]!=a[1]?(n.push("translate(",null,",",null,")"),r.push({i:1,x:d3.interpolateNumber(u[0],a[0])},{i:3,x:d3.interpolateNumber(u[1],a[1])})):a[0]||a[1]?n.push("translate("+a+")"):n.push(""),f!=l?r.push({i:n.push(n.pop()+"rotate(",null,")")-2,x:d3.interpolateNumber(f,l)}):l&&n.push(n.pop()+"rotate("+l+")"),c!=h?r.push({i:n.push(n.pop()+"skewX(",null,")")-2,x:d3.interpolateNumber(c,h)}):h&&n.push(n.pop()+"skewX("+h+")"),p[0]!=d[0]||p[1]!=d[1]?(i=n.push(n.pop()+"scale(",null,",",null,")"),r.push({i:i-4,x:d3.interpolateNumber(p[0],d[0])},{i:i-2,x:d3.interpolateNumber(p[1],d[1])})):(d[0]!=1||d[1]!=1)&&n.push(n.pop()+"scale("+d+")"),i=r.length,function(e){var t=-1,s;while(++t<i)n[(s=r[t]).i]=s.x(e);return n.join("")}},d3.interpolateRgb=function(e,t){e=d3.rgb(e),t=d3.rgb(t);var n=e.r,r=e.g,i=e.b,s=t.r-n,o=t.g-r,u=t.b-i;return function(e){return"#"+j(Math.round(n+s*e))+j(Math.round(r+o*e))+j(Math.round(i+u*e))}},d3.interpolateHsl=function(e,t){e=d3.hsl(e),t=d3.hsl(t);var n=e.h,r=e.s,i=e.l,s=t.h-n,o=t.s-r,u=t.l-i;return function(e){return z(n+s*e,r+o*e,i+u*e).toString()}},d3.interpolateArray=function(e,t){var n=[],r=[],i=e.length,s=t.length,o=Math.min(e.length,t.length),u;for(u=0;u<o;++u)n.push(d3.interpolate(e[u],t[u]));for(;u<i;++u)r[u]=e[u];for(;u<s;++u)r[u]=t[u];return function(e){for(u=0;u<o;++u)r[u]=n[u](e);return r}},d3.interpolateObject=function(e,t){var n={},r={},i;for(i in e)i in t?n[i]=_(i)(e[i],t[i]):r[i]=e[i];for(i in t)i in e||(r[i]=t[i]);return function(e){for(i in n)r[i]=n[i](e);return r}};var Ri=/[-+]?(?:\d*\.?\d+)(?:[eE][-+]?\d+)?/g;d3.interpolators=[d3.interpolateObject,function(e,t){return t instanceof Array&&d3.interpolateArray(e,t)},function(e,t){return(typeof e=="string"||typeof t=="string")&&d3.interpolateString(e+"",t+"")},function(e,t){return(typeof t=="string"?Ui.has(t)||/^(#|rgb\(|hsl\()/.test(t):t instanceof B||t instanceof U)&&d3.interpolateRgb(e,t)},function(e,t){return!isNaN(e=+e)&&!isNaN(t=+t)&&d3.interpolateNumber(e,t)}],d3.rgb=function(e,t,n){return arguments.length===1?e instanceof B?H(e.r,e.g,e.b):F(""+e,H,z):H(~~e,~~t,~~n)},B.prototype.brighter=function(e){e=Math.pow(.7,arguments.length?e:1);var t=this.r,n=this.g,r=this.b,i=30;return!t&&!n&&!r?H(i,i,i):(t&&t<i&&(t=i),n&&n<i&&(n=i),r&&r<i&&(r=i),H(Math.min(255,Math.floor(t/e)),Math.min(255,Math.floor(n/e)),Math.min(255,Math.floor(r/e))))},B.prototype.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),H(Math.floor(e*this.r),Math.floor(e*this.g),Math.floor(e*this.b))},B.prototype.hsl=function(){return I(this.r,this.g,this.b)},B.prototype.toString=function(){return"#"+j(this.r)+j(this.g)+j(this.b)};var Ui=d3.map({aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"});Ui.forEach(function(e,t){Ui.set(e,F(t,H,z))}),d3.hsl=function(e,t,n){return arguments.length===1?e instanceof U?R(e.h,e.s,e.l):F(""+e,I,R):R(+e,+t,+n)},U.prototype.brighter=function(e){return e=Math.pow(.7,arguments.length?e:1),R(this.h,this.s,this.l/e)},U.prototype.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),R(this.h,this.s,e*this.l)},U.prototype.rgb=function(){return z(this.h,this.s,this.l)},U.prototype.toString=function(){return this.rgb().toString()};var zi=function(e,t){return t.querySelector(e)},Wi=function(e,t){return t.querySelectorAll(e)},Xi=document.documentElement,Vi=Xi.matchesSelector||Xi.webkitMatchesSelector||Xi.mozMatchesSelector||Xi.msMatchesSelector||Xi.oMatchesSelector,$i=function(e,t){return Vi.call(e,t)};typeof Sizzle=="function"&&(zi=function(e,t){return Sizzle(e,t)[0]},Wi=function(e,t){return Sizzle.uniqueSort(Sizzle(e,t))},$i=Sizzle.matchesSelector);var Ji=[];d3.selection=function(){return Qi},d3.selection.prototype=Ji,Ji.select=function(e){var t=[],n,r,i,s;typeof e!="function"&&(e=X(e));for(var o=-1,u=this.length;++o<u;){t.push(n=[]),n.parentNode=(i=this[o]).parentNode;for(var a=-1,f=i.length;++a<f;)(s=i[a])?(n.push(r=e.call(s,s.__data__,a)),r&&"__data__"in s&&(r.__data__=s.__data__)):n.push(null)}return W(t)},Ji.selectAll=function(e){var t=[],n,r;typeof e!="function"&&(e=V(e));for(var i=-1,s=this.length;++i<s;)for(var o=this[i],u=-1,a=o.length;++u<a;)if(r=o[u])t.push(n=Ni(e.call(r,r.__data__,u))),n.parentNode=r;return W(t)},Ji.attr=function(e,t){function n(){this.removeAttribute(e)}function r(){this.removeAttributeNS(e.space,e.local)}function i(){this.setAttribute(e,t)}function s(){this.setAttributeNS(e.space,e.local,t)}function o(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}function u(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}e=d3.ns.qualify(e);if(arguments.length<2){var a=this.node();return e.local?a.getAttributeNS(e.space,e.local):a.getAttribute(e)}return this.each(t==null?e.local?r:n:typeof t=="function"?e.local?u:o:e.local?s:i)},Ji.classed=function(e,t){var n=e.split(Ki),r=n.length,i=-1;if(arguments.length>1){while(++i<r)$.call(this,n[i],t);return this}while(++i<r)if(!$.call(this,n[i]))return!1;return!0};var Ki=/\s+/g;Ji.style=function(e,t,n){function r(){this.style.removeProperty(e)}function i(){this.style.setProperty(e,t,n)}function s(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}return arguments.length<3&&(n=""),arguments.length<2?window.getComputedStyle(this.node(),null).getPropertyValue(e):this.each(t==null?r:typeof t=="function"?s:i)},Ji.property=function(e,t){function n(){delete this[e]}function r(){this[e]=t}function i(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}return arguments.length<2?this.node()[e]:this.each(t==null?n:typeof t=="function"?i:r)},Ji.text=function(e){return arguments.length<1?this.node().textContent:this.each(typeof e=="function"?function(){var t=e.apply(this,arguments);this.textContent=t==null?"":t}:e==null?function(){this.textContent=""}:function(){this.textContent=e})},Ji.html=function(e){return arguments.length<1?this.node().innerHTML:this.each(typeof e=="function"?function(){var t=e.apply(this,arguments);this.innerHTML=t==null?"":t}:e==null?function(){this.innerHTML=""}:function(){this.innerHTML=e})},Ji.append=function(e){function t(){return this.appendChild(document.createElementNS(this.namespaceURI,e))}function n(){return this.appendChild(document.createElementNS(e.space,e.local))}return e=d3.ns.qualify(e),this.select(e.local?n:t)},Ji.insert=function(e,t){function n(){return this.insertBefore(document.createElementNS(this.namespaceURI,e),zi(t,this))}function r(){return this.insertBefore(document.createElementNS(e.space,e.local),zi(t,this))}return e=d3.ns.qualify(e),this.select(e.local?r:n)},Ji.remove=function(){return this.each(function(){var e=this.parentNode;e&&e.removeChild(this)})},Ji.data=function(e,t){function n(e,n){var i,s=e.length,o=n.length,u=Math.min(s,o),c=Math.max(s,o),h=[],p=[],d=[],v,m;if(t){var g=new r,y=[],b,w=n.length;for(i=-1;++i<s;)b=t.call(v=e[i],v.__data__,i),g.has(b)?d[w++]=v:g.set(b,v),y.push(b);for(i=-1;++i<o;)b=t.call(n,m=n[i],i),g.has(b)?(h[i]=v=g.get(b),v.__data__=m,p[i]=d[i]=null):(p[i]=J(m),h[i]=d[i]=null),g.remove(b);for(i=-1;++i<s;)g.has(y[i])&&(d[i]=e[i])}else{for(i=-1;++i<u;)v=e[i],m=n[i],v?(v.__data__=m,h[i]=v,p[i]=d[i]=null):(p[i]=J(m),h[i]=d[i]=null);for(;i<o;++i)p[i]=J(n[i]),h[i]=d[i]=null;for(;i<c;++i)d[i]=e[i],p[i]=h[i]=null}p.update=h,p.parentNode=h.parentNode=d.parentNode=e.parentNode,a.push(p),f.push(h),l.push(d)}var i=-1,s=this.length,o,u;if(!arguments.length){e=new Array(s=(o=this[0]).length);while(++i<s)if(u=o[i])e[i]=u.__data__;return e}var a=G([]),f=W([]),l=W([]);if(typeof e=="function")while(++i<s)n(o=this[i],e.call(o,o.parentNode.__data__,i));else while(++i<s)n(o=this[i],e);return f.enter=function(){return a},f.exit=function(){return l},f},Ji.datum=Ji.map=function(e){return arguments.length<1?this.property("__data__"):this.property("__data__",e)},Ji.filter=function(e){var t=[],n,r,i;typeof e!="function"&&(e=K(e));for(var s=0,o=this.length;s<o;s++){t.push(n=[]),n.parentNode=(r=this[s]).parentNode;for(var u=0,a=r.length;u<a;u++)(i=r[u])&&e.call(i,i.__data__,u)&&n.push(i)}return W(t)},Ji.order=function(){for(var e=-1,t=this.length;++e<t;)for(var n=this[e],r=n.length-1,i=n[r],s;--r>=0;)if(s=n[r])i&&i!==s.nextSibling&&i.parentNode.insertBefore(s,i),i=s;return this},Ji.sort=function(e){e=Q.apply(this,arguments);for(var t=-1,n=this.length;++t<n;)this[t].sort(e);return this.order()},Ji.on=function(e,t,n){arguments.length<3&&(n=!1);var r="__on"+e,i=e.indexOf(".");return i>0&&(e=e.substring(0,i)),arguments.length<2?(i=this.node()[r])&&i._:this.each(function(i,s){function o(e){var n=d3.event;d3.event=e;try{t.call(u,u.__data__,s)}finally{d3.event=n}}var u=this,a=u[r];a&&(u.removeEventListener(e,a,a.$),delete u[r]),t&&(u.addEventListener(e,u[r]=o,o.$=n),o._=t)})},Ji.each=function(e){for(var t=-1,n=this.length;++t<n;)for(var r=this[t],i=-1,s=r.length;++i<s;){var o=r[i];o&&e.call(o,o.__data__,i,t)}return this},Ji.call=function(e){return e.apply(this,(arguments[0]=this,arguments)),this},Ji.empty=function(){return!this.node()},Ji.node=function(e){for(var t=0,n=this.length;t<n;t++)for(var r=this[t],i=0,s=r.length;i<s;i++){var o=r[i];if(o)return o}return null},Ji.transition=function(){var e=[],t,n;for(var r=-1,i=this.length;++r<i;){e.push(t=[]);for(var s=this[r],o=-1,u=s.length;++o<u;)t.push((n=s[o])?{node:n,delay:ss,duration:os}:null)}return Y(e,ts||++es,Date.now())};var Qi=W([[document]]);Qi[0].parentNode=Xi,d3.select=function(e){return typeof e=="string"?Qi.select(e):W([[e]])},d3.selectAll=function(e){return typeof e=="string"?Qi.selectAll(e):W([Ni(e)])};var Gi=[];d3.selection.enter=G,d3.selection.enter.prototype=Gi,Gi.append=Ji.append,Gi.insert=Ji.insert,Gi.empty=Ji.empty,Gi.node=Ji.node,Gi.select=function(e){var t=[],n,r,i,s,o;for(var u=-1,a=this.length;++u<a;){i=(s=this[u]).update,t.push(n=[]),n.parentNode=s.parentNode;for(var f=-1,l=s.length;++f<l;)(o=s[f])?(n.push(i[f]=r=e.call(s.parentNode,o.__data__,f)),r.__data__=o.__data__):n.push(null)}return W(t)};var Yi={},Zi=[],es=0,ts=0,ns=0,rs=250,is=d3.ease("cubic-in-out"),ss=ns,os=rs,us=is;Zi.call=Ji.call,d3.transition=function(e){return arguments.length?ts?e.transition():e:Qi.transition()},d3.transition.prototype=Zi,Zi.select=function(e){var t=[],n,r,i;typeof e!="function"&&(e=X(e));for(var s=-1,o=this.length;++s<o;){t.push(n=[]);for(var u=this[s],a=-1,f=u.length;++a<f;)(i=u[a])&&(r=e.call(i.node,i.node.__data__,a))?("__data__"in i.node&&(r.__data__=i.node.__data__),n.push({node:r,delay:i.delay,duration:i.duration})):n.push(null)}return Y(t,this.id,this.time).ease(this.ease())},Zi.selectAll=function(e){var t=[],n,r,i;typeof e!="function"&&(e=V(e));for(var s=-1,o=this.length;++s<o;)for(var u=this[s],a=-1,f=u.length;++a<f;)if(i=u[a]){r=e.call(i.node,i.node.__data__,a),t.push(n=[]);for(var l=-1,c=r.length;++l<c;)n.push({node:r[l],delay:i.delay,duration:i.duration})}return Y(t,this.id,this.time).ease(this.ease())},Zi.attr=function(e,t){return this.attrTween(e,et(e,t))},Zi.attrTween=function(e,t){function n(e,n){var r=t.call(this,e,n,this.getAttribute(i));return r===Yi?(this.removeAttribute(i),null):r&&function(e){this.setAttribute(i,r(e))}}function r(e,n){var r=t.call(this,e,n,this.getAttributeNS(i.space,i.local));return r===Yi?(this.removeAttributeNS(i.space,i.local),null):r&&function(e){this.setAttributeNS(i.space,i.local,r(e))}}var i=d3.ns.qualify(e);return this.tween("attr."+e,i.local?r:n)},Zi.style=function(e,t,n){return arguments.length<3&&(n=""),this.styleTween(e,et(e,t),n)},Zi.styleTween=function(e,t,n){return arguments.length<3&&(n=""),this.tween("style."+e,function(r,i){var s=t.call(this,r,i,window.getComputedStyle(this,null).getPropertyValue(e));return s===Yi?(this.style.removeProperty(e),null):s&&function(t){this.style.setProperty(e,s(t),n)}})},Zi.text=function(e){return this.tween("text",function(t,n){this.textContent=typeof e=="function"?e.call(this,t,n):e})},Zi.remove=function(){return this.each("end.transition",function(){var e;!this.__transition__&&(e=this.parentNode)&&e.removeChild(this)})},Zi.delay=function(e){var t=this;return t.each(typeof e=="function"?function(n,r,i){t[i][r].delay=e.apply(this,arguments)|0}:(e|=0,function(n,r,i){t[i][r].delay=e}))},Zi.duration=function(e){var t=this;return t.each(typeof e=="function"?function(n,r,i){t[i][r].duration=Math.max(1,e.apply(this,arguments)|0)}:(e=Math.max(1,e|0),function(n,r,i){t[i][r].duration=e}))},Zi.transition=function(){return this.select(i)};var as=null,fs,ls;d3.timer=function(e,t,n){var r=!1,i,s=as;if(arguments.length<3){if(arguments.length<2)t=0;else if(!isFinite(t))return;n=Date.now()}while(s){if(s.callback===e){s.then=n,s.delay=t,r=!0;break}i=s,s=s.next}r||(as={callback:e,then:n,delay:t,next:as}),fs||(ls=clearTimeout(ls),fs=1,cs(nt))},d3.timer.flush=function(){var e,t=Date.now(),n=as;while(n)e=t-n.then,n.delay||(n.flush=n.callback(e)),n=n.next;rt()};var cs=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,17)};d3.transform=function(e){var t=document.createElementNS(d3.ns.prefix.svg,"g"),n={a:1,b:0,c:0,d:1,e:0,f:0};return(d3.transform=function(e){t.setAttribute("transform",e);var r=t.transform.baseVal.consolidate();return new it(r?r.matrix:n)})(e)},it.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var hs=180/Math.PI;d3.mouse=function(e){return at(e,O())};var ps=/WebKit/.test(navigator.userAgent)?-1:0;d3.touches=function(e,t){return arguments.length<2&&(t=O().touches),t?Ni(t).map(function(t){var n=at(e,t);return n.identifier=t.identifier,n}):[]},d3.scale={},d3.scale.linear=function(){return dt([0,1],[0,1],d3.interpolate,!1)},d3.scale.log=function(){return St(d3.scale.linear(),xt)};var ds=d3.format(".0e");xt.pow=function(e){return Math.pow(10,e)},Tt.pow=function(e){return-Math.pow(10,-e)},d3.scale.pow=function(){return Nt(d3.scale.linear(),1)},d3.scale.sqrt=function(){return d3.scale.pow().exponent(.5)},d3.scale.ordinal=function(){return kt([],{t:"range",x:[]})},d3.scale.category10=function(){return d3.scale.ordinal().range(vs)},d3.scale.category20=function(){return d3.scale.ordinal().range(ms)},d3.scale.category20b=function(){return d3.scale.ordinal().range(gs)},d3.scale.category20c=function(){return d3.scale.ordinal().range(ys)};var vs=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],ms=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],gs=["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"],ys=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"];d3.scale.quantile=function(){return Lt([],[])},d3.scale.quantize=function(){return At(0,1,[0,1])},d3.scale.identity=function(){return Ot([0,1])},d3.svg={},d3.svg.arc=function(){function e(){var e=t.apply(this,arguments),s=n.apply(this,arguments),o=r.apply(this,arguments)+bs,u=i.apply(this,arguments)+bs,a=(u<o&&(a=o,o=u,u=a),u-o),f=a<Math.PI?"0":"1",l=Math.cos(o),c=Math.sin(o),h=Math.cos(u),p=Math.sin(u);return a>=ws?e?"M0,"+s+"A"+s+","+s+" 0 1,1 0,"+ -s+"A"+s+","+s+" 0 1,1 0,"+s+"M0,"+e+"A"+e+","+e+" 0 1,0 0,"+ -e+"A"+e+","+e+" 0 1,0 0,"+e+"Z":"M0,"+s+"A"+s+","+s+" 0 1,1 0,"+ -s+"A"+s+","+s+" 0 1,1 0,"+s+"Z":e?"M"+s*l+","+s*c+"A"+s+","+s+" 0 "+f+",1 "+s*h+","+s*p+"L"+e*h+","+e*p+"A"+e+","+e+" 0 "+f+",0 "+e*l+","+e*c+"Z":"M"+s*l+","+s*c+"A"+s+","+s+" 0 "+f+",1 "+s*h+","+s*p+"L0,0"+"Z"}var t=Mt,n=_t,r=Dt,i=Pt;return e.innerRadius=function(n){return arguments.length?(t=d3.functor(n),e):t},e.outerRadius=function(t){return arguments.length?(n=d3.functor(t),e):n},e.startAngle=function(t){return arguments.length?(r=d3.functor(t),e):r},e.endAngle=function(t){return arguments.length?(i=d3.functor(t),e):i},e.centroid=function(){var e=(t.apply(this,arguments)+n.apply(this,arguments))/2,s=(r.apply(this,arguments)+i.apply(this,arguments))/2+bs;return[Math.cos(s)*e,Math.sin(s)*e]},e};var bs=-Math.PI/2,ws=2*Math.PI-1e-6;d3.svg.line=function(){return Ht(Object)};var Es="linear",Ss=d3.map({linear:It,"step-before":qt,"step-after":Rt,basis:$t,"basis-open":Jt,"basis-closed":Kt,bundle:Qt,cardinal:Wt,"cardinal-open":Ut,"cardinal-closed":zt,monotone:nn}),xs=[0,2/3,1/3,0],Ts=[0,1/3,2/3,0],Ns=[0,1/6,2/3,1/6];d3.svg.line.radial=function(){var e=Ht(rn);return e.radius=e.x,delete e.x,e.angle=e.y,delete e.y,e},qt.reverse=Rt,Rt.reverse=qt,d3.svg.area=function(){return sn(Object)},d3.svg.area.radial=function(){var e=sn(rn);return e.radius=e.x,delete e.x,e.innerRadius=e.x0,delete e.x0,e.outerRadius=e.x1,delete e.x1,e.angle=e.y,delete e.y,e.startAngle=e.y0,delete e.y0,e.endAngle=e.y1,delete e.y1,e},d3.svg.chord=function(){function e(e,u){var a=t(this,s,e,u),f=t(this,o,e,u);return"M"+a.p0+r(a.r,a.p1,a.a1-a.a0)+(n(a,f)?i(a.r,a.p1,a.r,a.p0):i(a.r,a.p1,f.r,f.p0)+r(f.r,f.p1,f.a1-f.a0)+i(f.r,f.p1,a.r,a.p0))+"Z"}function t(e,t,n,r){var i=t.call(e,n,r),s=u.call(e,i,r),o=a.call(e,i,r)+bs,l=f.call(e,i,r)+bs;return{r:s,a0:o,a1:l,p0:[s*Math.cos(o),s*Math.sin(o)],p1:[s*Math.cos(l),s*Math.sin(l)]}}function n(e,t){return e.a0==t.a0&&e.a1==t.a1}function r(e,t,n){return"A"+e+","+e+" 0 "+ +(n>Math.PI)+",1 "+t}function i(e,t,n,r){return"Q 0,0 "+r}var s=an,o=fn,u=ln,a=Dt,f=Pt;return e.radius=function(t){return arguments.length?(u=d3.functor(t),e):u},e.source=function(t){return arguments.length?(s=d3.functor(t),e):s},e.target=function(t){return arguments.length?(o=d3.functor(t),e):o},e.startAngle=function(t){return arguments.length?(a=d3.functor(t),e):a},e.endAngle=function(t){return arguments.length?(f=d3.functor(t),e):f},e},d3.svg.diagonal=function(){function e(e,i){var s=t.call(this,e,i),o=n.call(this,e,i),u=(s.y+o.y)/2,a=[s,{x:s.x,y:u},{x:o.x,y:u},o];return a=a.map(r),"M"+a[0]+"C"+a[1]+" "+a[2]+" "+a[3]}var t=an,n=fn,r=pn;return e.source=function(n){return arguments.length?(t=d3.functor(n),e):t},e.target=function(t){return arguments.length?(n=d3.functor(t),e):n},e.projection=function(t){return arguments.length?(r=t,e):r},e},d3.svg.diagonal.radial=function(){var e=d3.svg.diagonal(),t=pn,n=e.projection;return e.projection=function(e){return arguments.length?n(dn(t=e)):t},e},d3.svg.mouse=d3.mouse,d3.svg.touches=d3.touches,d3.svg.symbol=function(){function e(e,r){return(Cs.get(t.call(this,e,r))||gn)(n.call(this,e,r))}var t=mn,n=vn;return e.type=function(n){return arguments.length?(t=d3.functor(n),e):t},e.size=function(t){return arguments.length?(n=d3.functor(t),e):n},e};var Cs=d3.map({circle:gn,cross:function(e){var t=Math.sqrt(e/5)/2;return"M"+ -3*t+","+ -t+"H"+ -t+"V"+ -3*t+"H"+t+"V"+ -t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+ -t+"V"+t+"H"+ -3*t+"Z"},diamond:function(e){var t=Math.sqrt(e/(2*Ls)),n=t*Ls;return"M0,"+ -t+"L"+n+",0"+" 0,"+t+" "+ -n+",0"+"Z"},square:function(e){var t=Math.sqrt(e)/2;return"M"+ -t+","+ -t+"L"+t+","+ -t+" "+t+","+t+" "+ -t+","+t+"Z"},"triangle-down":function(e){var t=Math.sqrt(e/ks),n=t*ks/2;return"M0,"+n+"L"+t+","+ -n+" "+ -t+","+ -n+"Z"},"triangle-up":function(e){var t=Math.sqrt(e/ks),n=t*ks/2;return"M0,"+ -n+"L"+t+","+n+" "+ -t+","+n+"Z"}});d3.svg.symbolTypes=Cs.keys();var ks=Math.sqrt(3),Ls=Math.tan(30*Math.PI/180);d3.svg.axis=function(){function e(e){e.each(function(){var e=d3.select(this),c=a==null?t.ticks?t.ticks.apply(t,u):t.domain():a,h=f==null?t.tickFormat?t.tickFormat.apply(t,u):String:f,p=wn(t,c,l),v=e.selectAll(".minor").data(p,String),m=v.enter().insert("line","g").attr("class","tick minor").style("opacity",1e-6),g=d3.transition(v.exit()).style("opacity",1e-6).remove(),y=d3.transition(v).style("opacity",1),b=e.selectAll("g").data(c,String),w=b.enter().insert("g","path").style("opacity",1e-6),E=d3.transition(b.exit()).style("opacity",1e-6).remove(),S=d3.transition(b).style("opacity",1),x,T=ct(t),N=e.selectAll(".domain").data([0]),C=N.enter().append("path").attr("class","domain"),k=d3.transition(N),L=t.copy(),A=this.__chart__||L;this.__chart__=L,w.append("line").attr("class","tick"),w.append("text"),S.select("text").text(h);switch(n){case"bottom":x=yn,m.attr("y2",i),y.attr("x2",0).attr("y2",i),w.select("line").attr("y2",r),w.select("text").attr("y",Math.max(r,0)+o),S.select("line").attr("x2",0).attr("y2",r),S.select("text").attr("x",0).attr("y",Math.max(r,0)+o).attr("dy",".71em").attr("text-anchor","middle"),k.attr("d","M"+T[0]+","+s+"V0H"+T[1]+"V"+s);break;case"top":x=yn,m.attr("y2",-i),y.attr("x2",0).attr("y2",-i),w.select("line").attr("y2",-r),w.select("text").attr("y",-(Math.max(r,0)+o)),S.select("line").attr("x2",0).attr("y2",-r),S.select("text").attr("x",0).attr("y",-(Math.max(r,0)+o)).attr("dy","0em").attr("text-anchor","middle"),k.attr("d","M"+T[0]+","+ -s+"V0H"+T[1]+"V"+ -s);break;case"left":x=bn,m.attr("x2",-i),y.attr("x2",-i).attr("y2",0),w.select("line").attr("x2",-r),w.select("text").attr("x",-(Math.max(r,0)+o)),S.select("line").attr("x2",-r).attr("y2",0),S.select("text").attr("x",-(Math.max(r,0)+o)).attr("y",0).attr("dy",".32em").attr("text-anchor","end"),k.attr("d","M"+ -s+","+T[0]+"H0V"+T[1]+"H"+ -s);break;case"right":x=bn,m.attr("x2",i),y.attr("x2",i).attr("y2",0),w.select("line").attr("x2",r),w.select("text").attr("x",Math.max(r,0)+o),S.select("line").attr("x2",r).attr("y2",0),S.select("text").attr("x",Math.max(r,0)+o).attr("y",0).attr("dy",".32em").attr("text-anchor","start"),k.attr("d","M"+s+","+T[0]+"H0V"+T[1]+"H"+s)}if(t.ticks)w.call(x,A),S.call(x,L),E.call(x,L),m.call(x,A),y.call(x,L),g.call(x,L);else{var O=L.rangeBand()/2,M=function(e){return L(e)+O};w.call(x,M),S.call(x,M)}})}var t=d3.scale.linear(),n="bottom",r=6,i=6,s=6,o=3,u=[10],a=null,f,l=0;return e.scale=function(n){return arguments.length?(t=n,e):t},e.orient=function(t){return arguments.length?(n=t,e):n},e.ticks=function(){return arguments.length?(u=arguments,e):u},e.tickValues=function(t){return arguments.length?(a=t,e):a},e.tickFormat=function(t){return arguments.length?(f=t,e):f},e.tickSize=function(t,n,o){if(!arguments.length)return r;var u=arguments.length-1;return r=+t,i=u>1?+n:r,s=u>0?+arguments[u]:r,e},e.tickPadding=function(t){return arguments.length?(o=+t,e):o},e.tickSubdivide=function(t){return arguments.length?(l=+t,e):l},e},d3.svg.brush=function(){function e(s){s.each(function(){var s=d3.select(this),f=s.selectAll(".background").data([0]),l=s.selectAll(".extent").data([0]),c=s.selectAll(".resize").data(a,String),h;s.style("pointer-events","all").on("mousedown.brush",i).on("touchstart.brush",i),f.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),l.enter().append("rect").attr("class","extent").style("cursor","move"),c.enter().append("g").attr("class",function(e){return"resize "+e}).style("cursor",function(e){return As[e]}).append("rect").attr("x",function(e){return/[ew]$/.test(e)?-3:null}).attr("y",function(e){return/^[ns]/.test(e)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),c.style("display",e.empty()?"none":null),c.exit().remove(),o&&(h=ct(o),f.attr("x",h[0]).attr("width",h[1]-h[0]),n(s)),u&&(h=ct(u),f.attr("y",h[0]).attr("height",h[1]-h[0]),r(s)),t(s)})}function t(e){e.selectAll(".resize").attr("transform",function(e){return"translate("+f[+/e$/.test(e)][0]+","+f[+/^s/.test(e)][1]+")"})}function n(e){e.select(".extent").attr("x",f[0][0]),e.selectAll(".extent,.n>rect,.s>rect").attr("width",f[1][0]-f[0][0])}function r(e){e.select(".extent").attr("y",f[0][1]),e.selectAll(".extent,.e>rect,.w>rect").attr("height",f[1][1]-f[0][1])}function i(){function i(){var e=d3.event.changedTouches;return e?d3.touches(v,e)[0]:d3.mouse(v)}function a(){d3.event.keyCode==32&&(S||(x=null,T[0]-=f[1][0],T[1]-=f[1][1],S=2),A())}function c(){d3.event.keyCode==32&&S==2&&(T[0]+=f[1][0],T[1]+=f[1][1],S=0,A())}function h(){var e=i(),s=!1;N&&(e[0]+=N[0],e[1]+=N[1]),S||(d3.event.altKey?(x||(x=[(f[0][0]+f[1][0])/2,(f[0][1]+f[1][1])/2]),T[0]=f[+(e[0]<x[0])][0],T[1]=f[+(e[1]<x[1])][1]):x=null),w&&p(e,o,0)&&(n(y),s=!0),E&&p(e,u,1)&&(r(y),s=!0),s&&(t(y),g({type:"brush",mode:S?"move":"resize"}))}function p(e,t,n){var r=ct(t),i=r[0],s=r[1],o=T[n],u=f[1][n]-f[0][n],a,c;S&&(i-=o,s-=u+o),a=Math.max(i,Math.min(s,e[n])),S?c=(a+=o)+u:(x&&(o=Math.max(i,Math.min(s,2*x[n]-a))),o<a?(c=a,a=o):c=o);if(f[0][n]!==a||f[1][n]!==c)return l=null,f[0][n]=a,f[1][n]=c,!0}function d(){h(),y.style("pointer-events","all").selectAll(".resize").style("display",e.empty()?"none":null),d3.select("body").style("cursor",null),C.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),g({type:"brushend"}),A()}var v=this,m=d3.select(d3.event.target),g=s.of(v,arguments),y=d3.select(v),b=m.datum(),w=!/^(n|s)$/.test(b)&&o,E=!/^(e|w)$/.test(b)&&u,S=m.classed("extent"),x,T=i(),N,C=d3.select(window).on("mousemove.brush",h).on("mouseup.brush",d).on("touchmove.brush",h).on("touchend.brush",d).on("keydown.brush",a).on("keyup.brush",c);if(S)T[0]=f[0][0]-T[0],T[1]=f[0][1]-T[1];else if(b){var k=+/w$/.test(b),L=+/^n/.test(b);N=[f[1-k][0]-T[0],f[1-L][1]-T[1]],T[0]=f[k][0],T[1]=f[L][1]}else d3.event.altKey&&(x=T.slice());y.style("pointer-events","none").selectAll(".resize").style("display",null),d3.select("body").style("cursor",m.style("cursor")),g({type:"brushstart"}),h(),A()}var s=M(e,"brushstart","brush","brushend"),o=null,u=null,a=Os[0],f=[[0,0],[0,0]],l;return e.x=function(t){return arguments.length?(o=t,a=Os[!o<<1|!u],e):o},e.y=function(t){return arguments.length?(u=t,a=Os[!o<<1|!u],e):u},e.extent=function(t){var n,r,i,s,a;return arguments.length?(l=[[0,0],[0,0]],o&&(n=t[0],r=t[1],u&&(n=n[0],r=r[0]),l[0][0]=n,l[1][0]=r,o.invert&&(n=o(n),r=o(r)),r<n&&(a=n,n=r,r=a),f[0][0]=n|0,f[1][0]=r|0),u&&(i=t[0],s=t[1],o&&(i=i[1],s=s[1]),l[0][1]=i,l[1][1]=s,u.invert&&(i=u(i),s=u(s)),s<i&&(a=i,i=s,s=a),f[0][1]=i|0,f[1][1]=s|0),e):(t=l||f,o&&(n=t[0][0],r=t[1][0],l||(n=f[0][0],r=f[1][0],o.invert&&(n=o.invert(n),r=o.invert(r)),r<n&&(a=n,n=r,r=a))),u&&(i=t[0][1],s=t[1][1],l||(i=f[0][1],s=f[1][1],u.invert&&(i=u.invert(i),s=u.invert(s)),s<i&&(a=i,i=s,s=a))),o&&u?[[n,i],[r,s]]:o?[n,r]:u&&[i,s])},e.clear=function(){return l=null,f[0][0]=f[0][1]=f[1][0]=f[1][1]=0,e},e.empty=function(){return o&&f[0][0]===f[1][0]||u&&f[0][1]===f[1][1]},d3.rebind(e,s,"on")};var As={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Os=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];d3.behavior={},d3.behavior.drag=function(){function e(){this.on("mousedown.drag",t).on("touchstart.drag",t)}function t(){function e(){var e=o.parentNode,t=d3.event.changedTouches;return t?d3.touches(e,t)[0]:d3.mouse(e)}function t(){if(!o.parentNode)return i();var t=e(),n=t[0]-l[0],r=t[1]-l[1];c|=n|r,l=t,A(),u({type:"drag",x:t[0]+f[0],y:t[1]+f[1],dx:n,dy:r})}function i(){u({type:"dragend"}),c&&(A(),d3.event.target===a&&h.on("click.drag",s,!0)),h.on("mousemove.drag",null).on("touchmove.drag",null).on("mouseup.drag",null).on("touchend.drag",null)}function s(){A(),h.on("click.drag",null)}var o=this,u=n.of(o,arguments),a=d3.event.target,f,l=e(),c=0,h=d3.select(window).on("mousemove.drag",t).on("touchmove.drag",t).on("mouseup.drag",i,!0).on("touchend.drag",i,!0);r?(f=r.apply(o,arguments),f=[f.x-l[0],f.y-l[1]]):f=[0,0],u({type:"dragstart"})}var n=M(e,"drag","dragstart","dragend"),r=null;return e.origin=function(t){return arguments.length?(r=t,e):r},d3.rebind(e,n,"on")},d3.behavior.zoom=function(){function e(){this.on("mousedown.zoom",o).on("mousewheel.zoom",u).on("mousemove.zoom",a).on("DOMMouseScroll.zoom",u).on("dblclick.zoom",f).on("touchstart.zoom",l).on("touchmove.zoom",c).on("touchend.zoom",l)}function t(e){return[(e[0]-h[0])/d,(e[1]-h[1])/d]}function n(e){return[e[0]*d+h[0],e[1]*d+h[1]]}function r(e){d=Math.max(m[0],Math.min(m[1],e))}function i(e,t){t=n(t),h[0]+=e[0]-t[0],h[1]+=e[1]-t[1]}function s(e){b&&b.domain(y.range().map(function(e){return(e-h[0])/d}).map(y.invert)),E&&E.domain(w.range().map(function(e){return(e-h[1])/d}).map(w.invert)),d3.event.preventDefault(),e({type:"zoom",scale:d,translate:h})}function o(){function e(){f=1,i(d3.mouse(o),c),s(u)}function n(){f&&A(),l.on("mousemove.zoom",null).on("mouseup.zoom",null),f&&d3.event.target===a&&l.on("click.zoom",r)}function r(){A(),l.on("click.zoom",null)}var o=this,u=g.of(o,arguments),a=d3.event.target,f=0,l=d3.select(window).on("mousemove.zoom",e).on("mouseup.zoom",n),c=t(d3.mouse(o));window.focus(),A()}function u(){p||(p=t(d3.mouse(this))),r(Math.pow(2,En()*.002)*d),i(d3.mouse(this),p),s(g.of(this,arguments))}function a(){p=null}function f(){var e=d3.mouse(this),n=t(e);r(d3.event.shiftKey?d/2:d*2),i(e,n),s(g.of(this,arguments))}function l(){var e=d3.touches(this),n=Date.now();v=d,p={},e.forEach(function(e){p[e.identifier]=t(e)}),A();if(e.length===1&&n-S<500){var o=e[0],u=t(e[0]);r(d*2),i(o,u),s(g.of(this,arguments))}S=n}function c(){var e=d3.touches(this),t=e[0],n=p[t.identifier];if(o=e[1]){var o,u=p[o.identifier];t=[(t[0]+o[0])/2,(t[1]+o[1])/2],n=[(n[0]+u[0])/2,(n[1]+u[1])/2],r(d3.event.scale*v)}i(t,n),s(g.of(this,arguments))}var h=[0,0],p,d=1,v,m=_s,g=M(e,"zoom"),y,b,w,E,S;return e.translate=function(t){return arguments.length?(h=t.map(Number),e):h},e.scale=function(t){return arguments.length?(d=+t,e):d},e.scaleExtent=function(t){return arguments.length?(m=t==null?_s:t.map(Number),e):m},e.x=function(t){return arguments.length?(b=t,y=t.copy(),e):b},e.y=function(t){return arguments.length?(E=t,w=t.copy(),e):E},d3.rebind(e,g,"on")};var Ms,_s=[0,Infinity];d3.layout={},d3.layout.bundle=function(){return function(e){var t=[],n=-1,r=e.length;while(++n<r)t.push(Sn(e[n]));return t}},d3.layout.chord=function(){function e(){var e={},n=[],c=d3.range(o),h=[],p,v,m,g,y;r=[],i=[],p=0,g=-1;while(++g<o){v=0,y=-1;while(++y<o)v+=s[g][y];n.push(v),h.push(d3.range(o)),p+=v}a&&c.sort(function(e,t){return a(n[e],n[t])}),f&&h.forEach(function(e,t){e.sort(function(e,n){return f(s[t][e],s[t][n])})}),p=(2*Math.PI-u*o)/p,v=0,g=-1;while(++g<o){m=v,y=-1;while(++y<o){var b=c[g],w=h[b][y],E=s[b][w],S=v,x=v+=E*p;e[b+"-"+w]={index:b,subindex:w,startAngle:S,endAngle:x,value:E}}i.push({index:b,startAngle:m,endAngle:v,value:(v-m)/p}),v+=u}g=-1;while(++g<o){y=g-1;while(++y<o){var T=e[g+"-"+y],N=e[y+"-"+g];(T.value||N.value)&&r.push(T.value<N.value?{source:N,target:T}:{source:T,target:N})}}l&&t()}function t(){r.sort(function(e,t){return l((e.source.value+e.target.value)/2,(t.source.value+t.target.value)/2)})}var n={},r,i,s,o,u=0,a,f,l;return n.matrix=function(e){return arguments.length?(o=(s=e)&&s.length,r=i=null,n):s},n.padding=function(e){return arguments.length?(u=e,r=i=null,n):u},n.sortGroups=function(e){return arguments.length?(a=e,r=i=null,n):a},n.sortSubgroups=function(e){return arguments.length?(f=e,r=null,n):f},n.sortChords=function(e){return arguments.length?(l=e,r&&t(),n):l},n.chords=function(){return r||e(),r},n.groups=function(){return i||e(),i},n},d3.layout.force=function(){function e(e){return function(t,n,r,i,s){if(t.point!==e){var o=t.cx-e.x,u=t.cy-e.y,a=1/Math.sqrt(o*o+u*u);if((i-n)*a<h){var f=t.charge*a*a;return e.px-=o*f,e.py-=u*f,!0}if(t.point&&isFinite(a)){var f=t.pointCharge*a*a;e.px-=o*f,e.py-=u*f}}return!t.charge}}function t(e){Nn(Ps=e),Ds=n}var n={},r=d3.dispatch("start","tick","end"),i=[1,1],s,o,u=.9,a=On,f=Mn,l=-30,c=.1,h=.8,p,d=[],v=[],m,g,y;return n.tick=function(){if((o*=.99)<.005)return r.end({type:"end",alpha:o=0}),!0;var t=d.length,n=v.length,s,a,f,h,p,b,w,E,S;for(a=0;a<n;++a){f=v[a],h=f.source,p=f.target,E=p.x-h.x,S=p.y-h.y;if(b=E*E+S*S)b=o*g[a]*((b=Math.sqrt(b))-m[a])/b,E*=b,S*=b,p.x-=E*(w=h.weight/(p.weight+h.weight)),p.y-=S*w,h.x+=E*(w=1-w),h.y+=S*w}if(w=o*c){E=i[0]/2,S=i[1]/2,a=-1;if(w)while(++a<t)f=d[a],f.x+=(E-f.x)*w,f.y+=(S-f.y)*w}if(l){An(s=d3.geom.quadtree(d),o,y),a=-1;while(++a<t)(f=d[a]).fixed||s.visit(e(f))}a=-1;while(++a<t)f=d[a],f.fixed?(f.x=f.px,f.y=f.py):(f.x-=(f.px-(f.px=f.x))*u,f.y-=(f.py-(f.py=f.y))*u);r.tick({type:"tick",alpha:o})},n.nodes=function(e){return arguments.length?(d=e,n):d},n.links=function(e){return arguments.length?(v=e,n):v},n.size=function(e){return arguments.length?(i=e,n):i},n.linkDistance=function(e){return arguments.length?(a=d3.functor(e),n):a},n.distance=n.linkDistance,n.linkStrength=function(e){return arguments.length?(f=d3.functor(e),n):f},n.friction=function(e){return arguments.length?(u=e,n):u},n.charge=function(e){return arguments.length?(l=typeof e=="function"?e:+e,n):l},n.gravity=function(e){return arguments.length?(c=e,n):c},n.theta=function(e){return arguments.length?(h=e,n):h},n.alpha=function(e){return arguments.length?(o?e>0?o=e:o=0:e>0&&(r.start({type:"start",alpha:o=e}),d3.timer(n.tick)),n):o},n.start=function(){function e(e,n){var i=t(r),s=-1,o=i.length,u;while(++s<o)if(!isNaN(u=i[s][e]))return u;return Math.random()*n}function t(){if(!p){p=[];for(s=0;s<o;++s)p[s]=[];for(s=0;s<u;++s){var e=v[s];p[e.source.index].push(e.target),p[e.target.index].push(e.source)}}return p[r]}var r,s,o=d.length,u=v.length,c=i[0],h=i[1],p,b;for(r=0;r<o;++r)(b=d[r]).index=r,b.weight=0;m=[],g=[];for(r=0;r<u;++r)b=v[r],typeof b.source=="number"&&(b.source=d[b.source]),typeof b.target=="number"&&(b.target=d[b.target]),m[r]=a.call(this,b,r),g[r]=f.call(this,b,r),++b.source.weight,++b.target.weight;for(r=0;r<o;++r)b=d[r],isNaN(b.x)&&(b.x=e("x",c)),isNaN(b.y)&&(b.y=e("y",h)),isNaN(b.px)&&(b.px=b.x),isNaN(b.py)&&(b.py=b.y);y=[];if(typeof l=="function")for(r=0;r<o;++r)y[r]=+l.call(this,d[r],r);else for(r=0;r<o;++r)y[r]=l;return n.resume()},n.resume=function(){return n.alpha(.1)},n.stop=function(){return n.alpha(0)},n.drag=function(){s||(s=d3.behavior.drag().origin(Object).on("dragstart",t).on("drag",Ln).on("dragend",kn)),this.on("mouseover.force",Nn).on("mouseout.force",Cn).call(s)},d3.rebind(n,r,"on")};var Ds,Ps;d3.layout.partition=function(){function e(t,n,r,i){var s=t.children;t.x=n,t.y=t.depth*i,t.dx=r,t.dy=i;if(s&&(u=s.length)){var o=-1,u,a,f;r=t.value?r/t.value:0;while(++o<u)e(a=s[o],n,f=a.value*r,i),n+=f}}function t(e){var n=e.children,r=0;if(n&&(s=n.length)){var i=-1,s;while(++i<s)r=Math.max(r,t(n[i]))}return 1+r}function n(n,s){var o=r.call(this,n,s);return e(o[0],0,i[0],i[1]/t(o[0])),o}var r=d3.layout.hierarchy(),i=[1,1];return n.size=function(e){return arguments.length?(i=e,n):i},zn(n,r)},d3.layout.pie=function(){function e(s,o){var u=s.map(function(n,r){return+t.call(e,n,r)}),a=+(typeof r=="function"?r.apply(this,arguments):r),f=((typeof i=="function"?i.apply(this,arguments):i)-r)/d3.sum(u),l=d3.range(s.length);n!=null&&l.sort(n===Hs?function(e,t){return u[t]-u[e]}:function(e,t){return n(s[e],s[t])});var c=[];return l.forEach(function(e){c[e]={data:s[e],value:d=u[e],startAngle:a,endAngle:a+=d*f}}),c}var t=Number,n=Hs,r=0,i=2*Math.PI;return e.value=function(n){return arguments.length?(t=n,e):t},e.sort=function(t){return arguments.length?(n=t,e):n},e.startAngle=function(t){return arguments.length?(r=t,e):r},e.endAngle=function(t){return arguments.length?(i=t,e):i},e};var Hs={};d3.layout.stack=function(){function e(u,a){var f=u.map(function(n,r){return t.call(e,n,r)}),l=f.map(function(t,n){return t.map(function(t,n){return[s.call(e,t,n),o.call(e,t,n)]})}),c=n.call(e,l,a);f=d3.permute(f,c),l=d3.permute(l,c);var h=r.call(e,l,a),p=f.length,v=f[0].length,m,g,y;for(g=0;g<v;++g){i.call(e,f[0][g],y=h[g],l[0][g][1]);for(m=1;m<p;++m)i.call(e,f[m][g],y+=l[m-1][g][1],l[m][g][1])}return u}var t=Object,n=Hn,r=Bn,i=Pn,s=_n,o=Dn;return e.values=function(n){return arguments.length?(t=n,e):t},e.order=function(t){return arguments.length?(n=typeof t=="function"?t:Bs.get(t)||Hn,e):n},e.offset=function(t){return arguments.length?(r=typeof t=="function"?t:js.get(t)||Bn,e):r},e.x=function(t){return arguments.length?(s=t,e):s},e.y=function(t){return arguments.length?(o=t,e):o},e.out=function(t){return arguments.length?(i=t,e):i},e};var Bs=d3.map({"inside-out":function(e){var t=e.length,n,r,i=e.map(jn),s=e.map(Fn),o=d3.range(t).sort(function(e,t){return i[e]-i[t]}),u=0,a=0,f=[],l=[];for(n=0;n<t;++n)r=o[n],u<a?(u+=s[r],f.push(r)):(a+=s[r],l.push(r));return l.reverse().concat(f)},reverse:function(e){return d3.range(e.length).reverse()},"default":Hn}),js=d3.map({silhouette:function(e){var t=e.length,n=e[0].length,r=[],i=0,s,o,u,a=[];for(o=0;o<n;++o){for(s=0,u=0;s<t;s++)u+=e[s][o][1];u>i&&(i=u),r.push(u)}for(o=0;o<n;++o)a[o]=(i-r[o])/2;return a},wiggle:function(e){var t=e.length,n=e[0],r=n.length,i=0,s,o,u,a,f,l,c,h,p,d=[];d[0]=h=p=0;for(o=1;o<r;++o){for(s=0,a=0;s<t;++s)a+=e[s][o][1];for(s=0,f=0,c=n[o][0]-n[o-1][0];s<t;++s){for(u=0,l=(e[s][o][1]-e[s][o-1][1])/(2*c);u<s;++u)l+=(e[u][o][1]-e[u][o-1][1])/c;f+=l*e[s][o][1]}d[o]=h-=a?f/a*c:0,h<p&&(p=h)}for(o=0;o<r;++o)d[o]-=p;return d},expand:function(e){var t=e.length,n=e[0].length,r=1/t,i,s,o,u=[];for(s=0;s<n;++s){for(i=0,o=0;i<t;i++)o+=e[i][s][1];if(o)for(i=0;i<t;i++)e[i][s][1]/=o;else for(i=0;i<t;i++)e[i][s][1]=r}for(s=0;s<n;++s)u[s]=0;return u},zero:Bn});d3.layout.histogram=function(){function e(e,s){var o=[],u=e.map(n,this),a=r.call(this,u,s),f=i.call(this,a,u,s),l,s=-1,c=u.length,h=f.length-1,p=t?1:1/c,v;while(++s<h)l=o[s]=[],l.dx=f[s+1]-(l.x=f[s]),l.y=0;s=-1;while(++s<c)v=u[s],v>=a[0]&&v<=a[1]&&(l=o[d3.bisect(f,v,1,h)-1],l.y+=p,l.push(e[s]));return o}var t=!0,n=Number,r=Un,i=qn;return e.value=function(t){return arguments.length?(n=t,e):n},e.range=function(t){return arguments.length?(r=d3.functor(t),e):r},e.bins=function(t){return arguments.length?(i=typeof t=="number"?function(e){return Rn(e,t)}:d3.functor(t),e):i},e.frequency=function(n){return arguments.length?(t=!!n,e):t},e},d3.layout.hierarchy=function(){function e(t,o,u){var a=i.call(n,t,o),f=Fs?t:{data:t};f.depth=o,u.push(f);if(a&&(c=a.length)){var l=-1,c,h=f.children=[],p=0,v=o+1;while(++l<c)d=e(a[l],v,u),d.parent=f,h.push(d),p+=d.value;r&&h.sort(r),s&&(f.value=p)}else s&&(f.value=+s.call(n,t,o)||0);return f}function t(e,r){var i=e.children,o=0;if(i&&(a=i.length)){var u=-1,a,f=r+1;while(++u<a)o+=t(i[u],f)}else s&&(o=+s.call(n,Fs?e:e.data,r)||0);return s&&(e.value=o),o}function n(t){var n=[];return e(t,0,n),n}var r=Vn,i=Wn,s=Xn;return n.sort=function(e){return arguments.length?(r=e,n):r},n.children=function(e){return arguments.length?(i=e,n):i},n.value=function(e){return arguments.length?(s=e,n):s},n.revalue=function(e){return t(e,0),e},n};var Fs=!1;d3.layout.pack=function(){function e(e,r){var i=t.call(this,e,r),s=i[0];s.x=0,s.y=0,tr(s);var o=n[0],u=n[1],a=1/Math.max(2*s.r/o,2*s.r/u);return nr(s,o/2,u/2,a),i}var t=d3.layout.hierarchy().sort(Jn),n=[1,1];return e.size=function(t){return arguments.length?(n=t,e):n},zn(e,t)},d3.layout.cluster=function(){function e(e,i){var s=t.call(this,e,i),o=s[0],u,a=0,f,l;vr(o,function(e){var t=e.children;t&&t.length?(e.x=sr(t),e.y=ir(t)):(e.x=u?a+=n(e,u):0,e.y=0,u=e)});var c=or(o),h=ur(o),p=c.x-n(c,h)/2,d=h.x+n(h,c)/2;return vr(o,function(e){e.x=(e.x-p)/(d-p)*r[0],e.y=(1-(o.y?e.y/o.y:1))*r[1]}),s}var t=d3.layout.hierarchy().sort(null).value(null),n=ar,r=[1,1];return e.separation=function(t){return arguments.length?(n=t,e):n},e.size=function(t){return arguments.length?(r=t,e):r},zn(e,t)},d3.layout.tree=function(){function e(e,i){function s(e,t){var r=e.children,i=e._tree;if(r&&(o=r.length)){var o,a=r[0],f,l=a,c,h=-1;while(++h<o)c=r[h],s(c,f),l=u(c,f,l),f=c;mr(e);var p=.5*(a._tree.prelim+c._tree.prelim);t?(i.prelim=t._tree.prelim+n(e,t),i.mod=i.prelim-p):i.prelim=p}else t&&(i.prelim=t._tree.prelim+n(e,t))}function o(e,t){e.x=e._tree.prelim+t;var n=e.children;if(n&&(i=n.length)){var r=-1,i;t+=e._tree.mod;while(++r<i)o(n[r],t)}}function u(e,t,r){if(t){var i=e,s=e,o=t,u=e.parent.children[0],a=i._tree.mod,f=s._tree.mod,l=o._tree.mod,c=u._tree.mod,h;while(o=lr(o),i=fr(i),o&&i)u=fr(u),s=lr(s),s._tree.ancestor=e,h=o._tree.prelim+l-i._tree.prelim-a+n(o,i),h>0&&(gr(yr(o,e,r),e,h),a+=h,f+=h),l+=o._tree.mod,a+=i._tree.mod,c+=u._tree.mod,f+=s._tree.mod;o&&!lr(s)&&(s._tree.thread=o,s._tree.mod+=l-f),i&&!fr(u)&&(u._tree.thread=i,u._tree.mod+=a-c,r=e)}return r}var a=t.call(this,e,i),f=a[0];vr(f,function(e,t){e._tree={ancestor:e,prelim:0,mod:0,change:0,shift:0,number:t?t._tree.number+1:0}}),s(f),o(f,-f._tree.prelim);var l=cr(f,pr),c=cr(f,hr),h=cr(f,dr),p=l.x-n(l,c)/2,d=c.x+n(c,l)/2,v=h.depth||1;return vr(f,function(e){e.x=(e.x-p)/(d-p)*r[0],e.y=e.depth/v*r[1],delete e._tree}),a}var t=d3.layout.hierarchy().sort(null).value(null),n=ar,r=[1,1];return e.separation=function(t){return arguments.length?(n=t,e):n},e.size=function(t){return arguments.length?(r=t,e):r},zn(e,t)},d3.layout.treemap=function(){function e(e,t){var n=-1,r=e.length,i,s;while(++n<r)s=(i=e[n]).value*(t<0?0:t),i.area=isNaN(s)||s<=0?0:s}function t(n){var s=n.children;if(s&&s.length){var o=l(n),u=[],a=s.slice(),f,c=Infinity,h,p=Math.min(o.dx,o.dy),d;e(a,o.dx*o.dy/n.value),u.area=0;while((d=a.length)>0)u.push(f=a[d-1]),u.area+=f.area,(h=r(u,p))<=c?(a.pop(),c=h):(u.area-=u.pop().area,i(u,p,o,!1),p=Math.min(o.dx,o.dy),u.length=u.area=0,c=Infinity);u.length&&(i(u,p,o,!0),u.length=u.area=0),s.forEach(t)}}function n(t){var r=t.children;if(r&&r.length){var s=l(t),o=r.slice(),u,a=[];e(o,s.dx*s.dy/t.value),a.area=0;while(u=o.pop())a.push(u),a.area+=u.area,u.z!=null&&(i(a,u.z?s.dx:s.dy,s,!o.length),a.length=a.area=0);r.forEach(n)}}function r(e,t){var n=e.area,r,i=0,s=Infinity,o=-1,u=e.length;while(++o<u){if(!(r=e[o].area))continue;r<s&&(s=r),r>i&&(i=r)}return n*=n,t*=t,n?Math.max(t*i*p/n,n/(t*s*p)):Infinity}function i(e,t,n,r){var i=-1,s=e.length,o=n.x,a=n.y,f=t?u(e.area/t):0,l;if(t==n.dx){if(r||f>n.dy)f=n.dy;while(++i<s)l=e[i],l.x=o,l.y=a,l.dy=f,o+=l.dx=Math.min(n.x+n.dx-o,f?u(l.area/f):0);l.z=!0,l.dx+=n.x+n.dx-o,n.y+=f,n.dy-=f}else{if(r||f>n.dx)f=n.dx;while(++i<s)l=e[i],l.x=o,l.y=a,l.dx=f,a+=l.dy=Math.min(n.y+n.dy-a,f?u(l.area/f):0);l.z=!1,l.dy+=n.y+n.dy-a,n.x+=f,n.dx-=f}}function s(r){var i=h||o(r),s=i[0];return s.x=0,s.y=0,s.dx=a[0],s.dy=a[1],h&&o.revalue(s),e([s],s.dx*s.dy/s.value),(h?n:t)(s),c&&(h=i),i}var o=d3.layout.hierarchy(),u=Math.round,a=[1,1],f=null,l=br,c=!1,h,p=.5*(1+Math.sqrt(5));return s.size=function(e){return arguments.length?(a=e,s):a},s.padding=function(e){function t(t){var n=e.call(s,t,t.depth);return n==null?br(t):wr(t,typeof n=="number"?[n,n,n,n]:n)}function n(t){return wr(t,e)}if(!arguments.length)return f;var r;return l=(f=e)==null?br:(r=typeof e)==="function"?t:r==="number"?(e=[e,e,e,e],n):n,s},s.round=function(e){return arguments.length?(u=e?Math.round:Number,s):u!=Number},s.sticky=function(e){return arguments.length?(c=e,h=null,s):c},s.ratio=function(e){return arguments.length?(p=e,s):p},zn(s,o)},d3.csv=function(e,t){d3.text(e,"text/csv",function(e){t(e&&d3.csv.parse(e))})},d3.csv.parse=function(e){var t;return d3.csv.parseRows(e,function(e,n){if(n){var r={},i=-1,s=t.length;while(++i<s)r[t[i]]=e[i];return r}return t=e,null})},d3.csv.parseRows=function(e,t){function n(){if(o.lastIndex>=e.length)return i;if(f)return f=!1,r;var t=o.lastIndex;if(e.charCodeAt(t)===34){var n=t;while(n++<e.length)if(e.charCodeAt(n)===34){if(e.charCodeAt(n+1)!==34)break;n++}o.lastIndex=n+2;var s=e.charCodeAt(n+1);return s===13?(f=!0,e.charCodeAt(n+2)===10&&o.lastIndex++):s===10&&(f=!0),e.substring(t+1,n).replace(/""/g,'"')}var u=o.exec(e);return u?(f=u[0].charCodeAt(0)!==44,e.substring(t,u.index)):(o.lastIndex=e.length,e.substring(t))}var r={},i={},s=[],o=/\r\n|[,\r\n]/g,u=0,a,f;o.lastIndex=0;while((a=n())!==i){var l=[];while(a!==r&&a!==i)l.push(a),a=n();if(t&&!(l=t(l,u++)))continue;s.push(l)}return s},d3.csv.format=function(e){return e.map(Er).join("\n")},d3.geo={};var Is=Math.PI/180;d3.geo.azimuthal=function(){function e(e){var n=e[0]*Is-s,o=e[1]*Is,f=Math.cos(n),l=Math.sin(n),c=Math.cos(o),h=Math.sin(o),p=t!=="orthographic"?a*h+u*c*f:null,v,m=t==="stereographic"?1/(1+p):t==="gnomonic"?1/p:t==="equidistant"?(v=Math.acos(p),v?v/Math.sin(v):0):t==="equalarea"?Math.sqrt(2/(1+p)):1,g=m*c*l,y=m*(a*c*f-u*h);return[r*g+i[0],r*y+i[1]]}var t="orthographic",n,r=200,i=[480,250],s,o,u,a;return e.invert=function(e){var n=(e[0]-i[0])/r,o=(e[1]-i[1])/r,f=Math.sqrt(n*n+o*o),l=t==="stereographic"?2*Math.atan(f):t==="gnomonic"?Math.atan(f):t==="equidistant"?f:t==="equalarea"?2*Math.asin(.5*f):Math.asin(f),c=Math.sin(l),h=Math.cos(l);return[(s+Math.atan2(n*c,f*u*h+o*a*c))/Is,Math.asin(h*a-(f?o*c*u/f:0))/Is]},e.mode=function(n){return arguments.length?(t=n+"",e):t},e.origin=function(t){return arguments.length?(n=t,s=n[0]*Is,o=n[1]*Is,u=Math.cos(o),a=Math.sin(o),e):n},e.scale=function(t){return arguments.length?(r=+t,e):r},e.translate=function(t){return arguments.length?(i=[+t[0],+t[1]],e):i},e.origin([0,0])},d3.geo.albers=function(){function e(e){var t=u*(Is*e[0]-o),n=Math.sqrt(a-2*u*Math.sin(Is*e[1]))/u;return[i*n*Math.sin(t)+s[0],i*(n*Math.cos(t)-f)+s[1]]}function t(){var t=Is*r[0],i=Is*r[1],s=Is*n[1],l=Math.sin(t),c=Math.cos(t);return o=Is*n[0],u=.5*(l+Math.sin(i)),a=c*c+2*u*l,f=Math.sqrt(a-2*u*Math.sin(s))/u,e}var n=[-98,38],r=[29.5,45.5],i=1e3,s=[480,250],o,u,a,f;return e.invert=function(e){var t=(e[0]-s[0])/i,n=(e[1]-s[1])/i,r=f+n,l=Math.atan2(t,r),c=Math.sqrt(t*t+r*r);return[(o+l/u)/Is,Math.asin((a-c*c*u*u)/(2*u))/Is]},e.origin=function(e){return arguments.length?(n=[+e[0],+e[1]],t()):n},e.parallels=function(e){return arguments.length?(r=[+e[0],+e[1]],t()):r},e.scale=function(t){return arguments.length?(i=+t,e):i},e.translate=function(t){return arguments.length?(s=[+t[0],+t[1]],e):s},t()},d3.geo.albersUsa=function(){function e(e){var s=e[0],o=e[1];return(o>50?n:s<-140?r:o<21?i:t)(e)}var t=d3.geo.albers(),n=d3.geo.albers().origin([-160,60]).parallels([55,65]),r=d3.geo.albers().origin([-160,20]).parallels([8,18]),i=d3.geo.albers().origin([-60,10]).parallels([8,18]);return e.scale=function(s){return arguments.length?(t.scale(s),n.scale(s*.6),r.scale(s),i.scale(s*1.5),e.translate(t.translate())):t.scale()},e.translate=function(s){if(!arguments.length)return t.translate();var o=t.scale()/1e3,u=s[0],a=s[1];return t.translate(s),n.translate([u-400*o,a+170*o]),r.translate([u-190*o,a+200*o]),i.translate([u+580*o,a+430*o]),e},e.scale(t.scale())},d3.geo.bonne=function(){function e(e){var u=e[0]*Is-r,a=e[1]*Is-i;if(s){var f=o+s-a,l=u*Math.cos(a)/f;u=f*Math.sin(l),a=f*Math.cos(l)-o}else u*=Math.cos(a),a*=-1;return[t*u+n[0],t*a+n[1]]}var t=200,n=[480,250],r,i,s,o;return e.invert=function(e){var i=(e[0]-n[0])/t,u=(e[1]-n[1])/t;if(s){var a=o+u,f=Math.sqrt(i*i+a*a);u=o+s-f,i=r+f*Math.atan2(i,a)/Math.cos(u)}else u*=-1,i/=Math.cos(u);return[i/Is,u/Is]},e.parallel=function(t){return arguments.length?(o=1/Math.tan(s=t*Is),e):s/Is},e.origin=function(t){return arguments.length?(r=t[0]*Is,i=t[1]*Is,e):[r/Is,i/Is]},e.scale=function(n){return arguments.length?(t=+n,e):t},e.translate=function(t){return arguments.length?(n=[+t[0],+t[1]],e):n},e.origin([0,0]).parallel(45)},d3.geo.equirectangular=function(){function e(e){var r=e[0]/360,i=-e[1]/360;return[t*r+n[0],t*i+n[1]]}var t=500,n=[480,250];return e.invert=function(e){var r=(e[0]-n[0])/t,i=(e[1]-n[1])/t;return[360*r,-360*i]},e.scale=function(n){return arguments.length?(t=+n,e):t},e.translate=function(t){return arguments.length?(n=[+t[0],+t[1]],e):n},e},d3.geo.mercator=function(){function e(e){var r=e[0]/360,i=-(Math.log(Math.tan(Math.PI/4+e[1]*Is/2))/Is)/360;return[t*r+n[0],t*Math.max(-0.5,Math.min(.5,i))+n[1]]}var t=500,n=[480,250];return e.invert=function(e){var r=(e[0]-n[0])/t,i=(e[1]-n[1])/t;return[360*r,2*Math.atan(Math.exp(-360*i*Is))/Is-90]},e.scale=function(n){return arguments.length?(t=+n,e):t},e.translate=function(t){return arguments.length?(n=[+t[0],+t[1]],e):n},e},d3.geo.path=function(){function e(e,t){return typeof s=="function"&&(o=Tr(s.apply(this,arguments))),a(e)||null}function t(e){return u(e).join(",")}function n(e){var t=i(e[0]),n=0,r=e.length;while(++n<r)t-=i(e[n]);return t}function r(e){var t=d3.geom.polygon(e[0].map(u)),n=t.area(),r=t.centroid(n<0?(n*=-1,1):-1),i=r[0],s=r[1],o=n,a=0,f=e.length;while(++a<f)t=d3.geom.polygon(e[a].map(u)),n=t.area(),r=t.centroid(n<0?(n*=-1,1):-1),i-=r[0],s-=r[1],o-=n;return[i,s,6*o]}function i(e){return Math.abs(d3.geom.polygon(e.map(u)).area())}var s=4.5,o=Tr(s),u=d3.geo.albersUsa(),a=xr({FeatureCollection:function(e){var t=[],n=e.features,r=-1,i=n.length;while(++r<i)t.push(a(n[r].geometry));return t.join("")},Feature:function(e){return a(e.geometry)},Point:function(e){return"M"+t(e.coordinates)+o},MultiPoint:function(e){var n=[],r=e.coordinates,i=-1,s=r.length;while(++i<s)n.push("M",t(r[i]),o);return n.join("")},LineString:function(e){var n=["M"],r=e.coordinates,i=-1,s=r.length;while(++i<s)n.push(t(r[i]),"L");return n.pop(),n.join("")},MultiLineString:function(e){var n=[],r=e.coordinates,i=-1,s=r.length,o,u,a;while(++i<s){o=r[i],u=-1,a=o.length,n.push("M");while(++u<a)n.push(t(o[u]),"L");n.pop()}return n.join("")},Polygon:function(e){var n=[],r=e.coordinates,i=-1,s=r.length,o,u,a;while(++i<s){o=r[i],u=-1;if((a=o.length-1)>0){n.push("M");while(++u<a)n.push(t(o[u]),"L");n[n.length-1]="Z"}}return n.join("")},MultiPolygon:function(e){var n=[],r=e.coordinates,i=-1,s=r.length,o,u,a,f,l,c;while(++i<s){o=r[i],u=-1,a=o.length;while(++u<a){f=o[u],l=-1;if((c=f.length-1)>0){n.push("M");while(++l<c)n.push(t(f[l]),"L");n[n.length-1]="Z"}}}return n.join("")},GeometryCollection:function(e){var t=[],n=e.geometries,r=-1,i=n.length;while(++r<i)t.push(a(n[r]));return t.join("")}}),f=e.area=xr({FeatureCollection:function(e){var t=0,n=e.features,r=-1,i=n.length;while(++r<i)t+=f(n[r]);return t},Feature:function(e){return f(e.geometry)},Polygon:function(e){return n(e.coordinates)},MultiPolygon:function(e){var t=0,r=e.coordinates,i=-1,s=r.length;while(++i<s)t+=n(r[i]);return t},GeometryCollection:function(e){var t=0,n=e.geometries,r=-1,i=n.length;while(++r<i)t+=f(n[r]);return t}},0),l=e.centroid=xr({Feature:function(e){return l(e.geometry)},Polygon:function(e){var t=r(e.coordinates);return[t[0]/t[2],t[1]/t[2]]},MultiPolygon:function(e){var t=0,n=e.coordinates,i,s=0,o=0,u=0,a=-1,f=n.length;while(++a<f)i=r(n[a]),s+=i[0],o+=i[1],u+=i[2];return[s/u,o/u]}});return e.projection=function(t){return u=t,e},e.pointRadius=function(t){return typeof t=="function"?s=t:(s=+t,o=Tr(s)),e},e},d3.geo.bounds=function(e){var t=Infinity,n=Infinity,r=-Infinity,i=-Infinity;return Nr(e,function(e,s){e<t&&(t=e),e>r&&(r=e),s<n&&(n=s),s>i&&(i=s)}),[[t,n],[r,i]]};var qs={Feature:Cr,FeatureCollection:kr,GeometryCollection:Lr,LineString:Ar,MultiLineString:Or,MultiPoint:Ar,MultiPolygon:Mr,Point:_r,Polygon:Dr};d3.geo.circle=function(){function e(){}function t(e){return u.distance(e)<o}function n(e){var t=-1,n=e.length,i=[],s,a,f,l,c;while(++t<n)c=u.distance(f=e[t]),c<o?(a&&i.push(Br(a,f)((l-o)/(l-c))),i.push(f),s=a=null):(a=f,!s&&i.length&&(i.push(Br(i[i.length-1],a)((o-l)/(c-l))),s=a)),l=c;return a&&i.length&&(c=u.distance(f=i[0]),i.push(Br(a,f)((l-o)/(l-c)))),r(i)}function r(e){var t=0,n=e.length,r,i,s=n?[e[0]]:e,o,a=u.source();while(++t<n){o=u.source(e[t-1])(e[t]).coordinates;for(r=0,i=o.length;++r<i;)s.push(o[r])}return u.source(a),s}var i=[0,0],s=89.99,o=s*Is,u=d3.geo.greatArc().target(Object);e.clip=function(e){return u.source(typeof i=="function"?i.apply(this,arguments):i),a(e)};var a=xr({FeatureCollection:function(e){var t=e.features.map(a).filter(Object);return t&&(e=Object.create(e),e.features=t,e)},Feature:function(e){var t=a(e.geometry);return t&&(e=Object.create(e),e.geometry=t,e)},Point:function(e){return t(e.coordinates)&&e},MultiPoint:function(e){var n=e.coordinates.filter(t);return n.length&&{type:e.type,coordinates:n}},LineString:function(e){var t=n(e.coordinates);return t.length&&(e=Object.create(e),e.coordinates=t,e)},MultiLineString:function(e){var t=e.coordinates.map(n).filter(function(e){return e.length});return t.length&&(e=Object.create(e),e.coordinates=t,e)},Polygon:function(e){var t=e.coordinates.map(n);return t[0].length&&(e=Object.create(e),e.coordinates=t,e)},MultiPolygon:function(e){var t=e.coordinates.map(function(e){return e.map(n)}).filter(function(e){return e[0].length});return t.length&&(e=Object.create(e),e.coordinates=t,e)},GeometryCollection:function(e){var t=e.geometries.map(a).filter(Object);return t.length&&(e=Object.create(e),e.geometries=t,e)}});return e.origin=function(t){return arguments.length?(i=t,e):i},e.angle=function(t){return arguments.length?(o=(s=+t)*Is,e):s},e.precision=function(t){return arguments.length?(u.precision(t),e):u.precision()},e},d3.geo.greatArc=function(){function e(){var e=typeof t=="function"?t.apply(this,arguments):t,i=typeof n=="function"?n.apply(this,arguments):n,s=Br(e,i),o=r/s.d,u=0,a=[e];while((u+=o)<1)a.push(s(u));return a.push(i),{type:"LineString",coordinates:a}}var t=Pr,n=Hr,r=6*Is;return e.distance=function(){var e=typeof t=="function"?t.apply(this,arguments):t,r=typeof n=="function"?n.apply(this,arguments):n;return Br(e,r).d},e.source=function(n){return arguments.length?(t=n,e):t},e.target=function(t){return arguments.length?(n=t,e):n},e.precision=function(t){return arguments.length?(r=t*Is,e):r/Is},e},d3.geo.greatCircle=d3.geo.circle,d3.geom={},d3.geom.contour=function(e,t){var n=t||jr(e),r=[],i=n[0],s=n[1],o=0,u=0,a=NaN,f=NaN,l=0;do l=0,e(i-1,s-1)&&(l+=1),e(i,s-1)&&(l+=2),e(i-1,s)&&(l+=4),e(i,s)&&(l+=8),l===6?(o=f===-1?-1:1,u=0):l===9?(o=0,u=a===1?-1:1):(o=Rs[l],u=Us[l]),o!=a&&u!=f&&(r.push([i,s]),a=o,f=u),i+=o,s+=u;while(n[0]!=i||n[1]!=s);return r};var Rs=[1,0,1,1,-1,0,-1,1,0,0,0,0,-1,0,-1,NaN],Us=[0,-1,0,0,0,-1,0,0,1,-1,1,1,0,-1,0,NaN];d3.geom.hull=function(e){if(e.length<3)return[];var t=e.length,n=t-1,r=[],i=[],s,o,u=0,a,f,l,c,h,p,d,v;for(s=1;s<t;++s)e[s][1]<e[u][1]?u=s:e[s][1]==e[u][1]&&(u=e[s][0]<e[u][0]?s:u);for(s=0;s<t;++s){if(s===u)continue;f=e[s][1]-e[u][1],a=e[s][0]-e[u][0],r.push({angle:Math.atan2(f,a),index:s})}r.sort(function(e,t){return e.angle-t.angle}),d=r[0].angle,p=r[0].index,h=0;for(s=1;s<n;++s)o=r[s].index,d==r[s].angle?(a=e[p][0]-e[u][0],f=e[p][1]-e[u][1],l=e[o][0]-e[u][0],c=e[o][1]-e[u][1],a*a+f*f>=l*l+c*c?r[s].index=-1:(r[h].index=-1,d=r[s].angle,h=s,p=o)):(d=r[s].angle,h=s,p=o);i.push(u);for(s=0,o=0;s<2;++o)r[o].index!==-1&&(i.push(r[o].index),s++);v=i.length;for(;o<n;++o){if(r[o].index===-1)continue;while(!Fr(i[v-2],i[v-1],r[o].index,e))--v;i[v++]=r[o].index}var m=[];for(s=0;s<v;++s)m.push(e[i[s]]);return m},d3.geom.polygon=function(e){return e.area=function(){var t=0,n=e.length,r=e[n-1][0]*e[0][1],i=e[n-1][1]*e[0][0];while(++t<n)r+=e[t-1][0]*e[t][1],i+=e[t-1][1]*e[t][0];return(i-r)*.5},e.centroid=function(t){var n=-1,r=e.length,i=0,s=0,o,u=e[r-1],a;arguments.length||(t=-1/(6*e.area()));while(++n<r)o=u,u=e[n],a=o[0]*u[1]-u[0]*o[1],i+=(o[0]+u[0])*a,s+=(o[1]+u[1])*a;return[i*t,s*t]},e.clip=function(t){var n,r=-1,i=e.length,s,o,u=e[i-1],a,f,l;while(++r<i){n=t.slice(),t.length=0,a=e[r],f=n[(o=n.length)-1],s=-1;while(++s<o)l=n[s],Ir(l,u,a)?(Ir(f,u,a)||t.push(qr(f,l,u,a)),t.push(l)):Ir(f,u,a)&&t.push(qr(f,l,u,a)),f=l;u=a}return t},e},d3.geom.voronoi=function(e){var t=e.map(function(){return[]});return Rr(e,function(e){var n,r,i,s,o,u;e.a===1&&e.b>=0?(n=e.ep.r,r=e.ep.l):(n=e.ep.l,r=e.ep.r),e.a===1?(o=n?n.y:-1e6,i=e.c-e.b*o,u=r?r.y:1e6,s=e.c-e.b*u):(i=n?n.x:-1e6,o=e.c-e.a*i,s=r?r.x:1e6,u=e.c-e.a*s);var a=[i,o],f=[s,u];t[e.region.l.index].push(a,f),t[e.region.r.index].push(a,f)}),t.map(function(t,n){var r=e[n][0],i=e[n][1];return t.forEach(function(e){e.angle=Math.atan2(e[0]-r,e[1]-i)}),t.sort(function(e,t){return e.angle-t.angle}).filter(function(e,n){return!n||e.angle-t[n-1].angle>1e-10})})};var zs={l:"r",r:"l"};d3.geom.delaunay=function(e){var t=e.map(function(){return[]}),n=[];return Rr(e,function(n){t[n.region.l.index].push(e[n.region.r.index])}),t.forEach(function(t,r){var i=e[r],s=i[0],o=i[1];t.forEach(function(e){e.angle=Math.atan2(e[0]-s,e[1]-o)}),t.sort(function(e,t){return e.angle-t.angle});for(var u=0,a=t.length-1;u<a;u++)n.push([i,t[u],t[u+1]])}),n},d3.geom.quadtree=function(e,t,n,r,i){function s(e,t,n,r,i,s){if(isNaN(t.x)||isNaN(t.y))return;if(e.leaf){var u=e.point;u?Math.abs(u.x-t.x)+Math.abs(u.y-t.y)<.01?o(e,t,n,r,i,s):(e.point=null,o(e,u,n,r,i,s),o(e,t,n,r,i,s)):e.point=t}else o(e,t,n,r,i,s)}function o(e,t,n,r,i,o){var u=(n+i)*.5,a=(r+o)*.5,f=t.x>=u,l=t.y>=a,c=(l<<1)+f;e.leaf=!1,e=e.nodes[c]||(e.nodes[c]=Ur()),f?n=u:i=u,l?r=a:o=a,s(e,t,n,r,i,o)}var u,a=-1,f=e.length;f&&isNaN(e[0].x)&&(e=e.map(Wr));if(arguments.length<5)if(arguments.length===3)i=r=n,n=t;else{t=n=Infinity,r=i=-Infinity;while(++a<f)u=e[a],u.x<t&&(t=u.x),u.y<n&&(n=u.y),u.x>r&&(r=u.x),u.y>i&&(i=u.y);var l=r-t,c=i-n;l>c?i=n+l:r=t+c}var h=Ur();return h.add=function(e){s(h,e,t,n,r,i)},h.visit=function(e){zr(e,h,t,n,r,i)},e.forEach(h.add),h},d3.time={};var Ws=Date;Xr.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){Xs.setUTCDate.apply(this._,arguments)},setDay:function(){Xs.setUTCDay.apply(this._,arguments)},setFullYear:function(){Xs.setUTCFullYear.apply(this._,arguments)},setHours:function(){Xs.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){Xs.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){Xs.setUTCMinutes.apply(this._,arguments)},setMonth:function(){Xs.setUTCMonth.apply(this._,arguments)},setSeconds:function(){Xs.setUTCSeconds.apply(this._,arguments)},setTime:function(){Xs.setTime.apply(this._,arguments)}};var Xs=Date.prototype;d3.time.format=function(e){function t(t){var r=[],i=-1,s=0,o,u;while(++i<n)e.charCodeAt(i)==37&&(r.push(e.substring(s,i),(u=Qs[o=e.charAt(++i)])?u(t):o),s=i+1);return r.push(e.substring(s,i)),r.join("")}var n=e.length;return t.parse=function(t){var n={y:1900,m:0,d:1,H:0,M:0,S:0,L:0},r=Vr(n,e,t,0);if(r!=t.length)return null;"p"in n&&(n.H=n.H%12+n.p*12);var i=new Ws;return i.setFullYear(n.y,n.m,n.d),i.setHours(n.H,n.M,n.S,n.L),i},t.toString=function(){return e},t};var Vs=d3.format("02d"),$s=d3.format("03d"),Js=d3.format("04d"),Ks=d3.format("2d"),Qs={a:function(e){return d3_time_weekdays[e.getDay()].substring(0,3)},A:function(e){return d3_time_weekdays[e.getDay()]},b:function(e){return ro[e.getMonth()].substring(0,3)},B:function(e){return ro[e.getMonth()]},c:d3.time.format("%a %b %e %H:%M:%S %Y"),d:function(e){return Vs(e.getDate())},e:function(e){return Ks(e.getDate())},H:function(e){return Vs(e.getHours())},I:function(e){return Vs(e.getHours()%12||12)},j:function(e){return $s(1+d3.time.dayOfYear(e))},L:function(e){return $s(e.getMilliseconds())},m:function(e){return Vs(e.getMonth()+1)},M:function(e){return Vs(e.getMinutes())},p:function(e){return e.getHours()>=12?"PM":"AM"},S:function(e){return Vs(e.getSeconds())},U:function(e){return Vs(d3.time.sundayOfYear(e))},w:function(e){return e.getDay()},W:function(e){return Vs(d3.time.mondayOfYear(e))},x:d3.time.format("%m/%d/%y"),X:d3.time.format("%H:%M:%S"),y:function(e){return Vs(e.getFullYear()%100)},Y:function(e){return Js(e.getFullYear()%1e4)},Z:li,"%":function(e){return"%"}},Gs={a:$r,A:Jr,b:Kr,B:Qr,c:Gr,d:ii,e:ii,H:si,I:si,L:ai,m:ri,M:oi,p:fi,S:ui,x:Yr,X:Zr,y:ti,Y:ei},Ys=/^(?:sun|mon|tue|wed|thu|fri|sat)/i,Zs=/^(?:Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday)/i;d3_time_weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var eo=d3.map({jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11}),to=/^(?:January|February|March|April|May|June|July|August|September|October|November|December)/ig,no=d3.map({january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11}),ro=["January","February","March","April","May","June","July","August","September","October","November","December"],io=/\s*\d+/,so=d3.map({am:0,pm:1});d3.time.format.utc=function(e){function t(e){try{Ws=Xr;var t=new Ws;return t._=e,n(t)}finally{Ws=Date}}var n=d3.time.format(e);return t.parse=function(e){try{Ws=Xr;var t=n.parse(e);return t&&t._}finally{Ws=Date}},t.toString=n.toString,t};var oo=d3.time.format.utc("%Y-%m-%dT%H:%M:%S.%LZ");d3.time.format.iso=Date.prototype.toISOString?ci:oo,ci.parse=function(e){return new Date(e)},ci.toString=oo.toString,d3.time.second=hi(function(e){return new Ws(Math.floor(e/1e3)*1e3)},function(e,t){e.setTime(e.getTime()+Math.floor(t)*1e3)},function(e){return e.getSeconds()}),d3.time.seconds=d3.time.second.range,d3.time.seconds.utc=d3.time.second.utc.range,d3.time.minute=hi(function(e){return new Ws(Math.floor(e/6e4)*6e4)},function(e,t){e.setTime(e.getTime()+Math.floor(t)*6e4)},function(e){return e.getMinutes()}),d3.time.minutes=d3.time.minute.range,d3.time.minutes.utc=d3.time.minute.utc.range,d3.time.hour=hi(function(e){var t=e.getTimezoneOffset()/60;return new Ws((Math.floor(e/36e5-t)+t)*36e5)},function(e,t){e.setTime(e.getTime()+Math.floor(t)*36e5)},function(e){return e.getHours()}),d3.time.hours=d3.time.hour.range,d3.time.hours.utc=d3.time.hour.utc.range,d3.time.day=hi(function(e){return new Ws(e.getFullYear(),e.getMonth(),e.getDate())},function(e,t){e.setDate(e.getDate()+t)},function(e){return e.getDate()-1}),d3.time.days=d3.time.day.range,d3.time.days.utc=d3.time.day.utc.range,d3.time.dayOfYear=function(e){var t=d3.time.year(e);return Math.floor((e-t)/864e5-(e.getTimezoneOffset()-t.getTimezoneOffset())/1440)},d3_time_weekdays.forEach(function(e,t){e=e.toLowerCase(),t=7-t;var n=d3.time[e]=hi(function(e){return(e=d3.time.day(e)).setDate(e.getDate()-(e.getDay()+t)%7),e},function(e,t){e.setDate(e.getDate()+Math.floor(t)*7)},function(e){var n=d3.time.year(e).getDay();return Math.floor((d3.time.dayOfYear(e)+(n+t)%7)/7)-(n!==t)});d3.time[e+"s"]=n.range,d3.time[e+"s"].utc=n.utc.range,d3.time[e+"OfYear"]=function(e){var n=d3.time.year(e).getDay();return Math.floor((d3.time.dayOfYear(e)+(n+t)%7)/7)}}),d3.time.week=d3.time.sunday,d3.time.weeks=d3.time.sunday.range,d3.time.weeks.utc=d3.time.sunday.utc.range,d3.time.weekOfYear=d3.time.sundayOfYear,d3.time.month=hi(function(e){return new Ws(e.getFullYear(),e.getMonth(),1)},function(e,t){e.setMonth(e.getMonth()+t)},function(e){return e.getMonth()}),d3.time.months=d3.time.month.range,d3.time.months.utc=d3.time.month.utc.range,d3.time.year=hi(function(e){return new Ws(e.getFullYear(),0,1)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e){return e.getFullYear()}),d3.time.years=d3.time.year.range,d3.time.years.utc=d3.time.year.utc.range;var uo=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],ao=[[d3.time.second,1],[d3.time.second,5],[d3.time.second,15],[d3.time.second,30],[d3.time.minute,1],[d3.time.minute,5],[d3.time.minute,15],[d3.time.minute,30],[d3.time.hour,1],[d3.time.hour,3],[d3.time.hour,6],[d3.time.hour,12],[d3.time.day,1],[d3.time.day,2],[d3.time.week,1],[d3.time.month,1],[d3.time.month,3],[d3.time.year,1]],fo=[[d3.time.format("%Y"),function(e){return!0}],[d3.time.format("%B"),function(e){return e.getMonth()}],[d3.time.format("%b %d"),function(e){return e.getDate()!=1}],[d3.time.format("%a %d"),function(e){return e.getDay()&&e.getDate()!=1}],[d3.time.format("%I %p"),function(e){return e.getHours()}],[d3.time.format("%I:%M"),function(e){return e.getMinutes()}],[d3.time.format(":%S"),function(e){return e.getSeconds()}],[d3.time.format(".%L"),function(e){return e.getMilliseconds()}]],lo=d3.scale.linear(),co=gi(fo);ao.year=function(e,t){return lo.domain(e.map(bi)).ticks(t).map(yi)},d3.time.scale=function(){return di(d3.scale.linear(),ao,co)};var ho=ao.map(function(e){return[e[0].utc,e[1]]}),po=[[d3.time.format.utc("%Y"),function(e){return!0}],[d3.time.format.utc("%B"),function(e){return e.getUTCMonth()}],[d3.time.format.utc("%b %d"),function(e){return e.getUTCDate()!=1}],[d3.time.format.utc("%a %d"),function(e){return e.getUTCDay()&&e.getUTCDate()!=1}],[d3.time.format.utc("%I %p"),function(e){return e.getUTCHours()}],[d3.time.format.utc("%I:%M"),function(e){return e.getUTCMinutes()}],[d3.time.format.utc(":%S"),function(e){return e.getUTCSeconds()}],[d3.time.format.utc(".%L"),function(e){return e.getUTCMilliseconds()}]],vo=gi(po);ho.year=function(e,t){return lo.domain(e.map(Ei)).ticks(t).map(wi)},d3.time.scale.utc=function(){return di(d3.scale.linear(),ho,vo)}}(),define("d3",function(e){return function(){var t,n;return t||e.d3}}(this)),define("views/data-view-base",["jquery","underscore","backbone","config","utils","d3","lib/color-gradient/color-gradient"],function(e,n,r,i,s,o,u){var a=r.View.extend({tagName:"div",className:"data-inspector",events:{"click #removeData":"removeDataClicked","click #editData":"editDataClicked","click #updateData":"updateDataClicked","click .color-type":"colorTypeChanged","click .feature-type":"featureTypeChanged","click #colorInput":"colorInputClicked","click .visibility":"visibilityChanged"},initialize:function(e){this.vent=e.vent,this.title=e.mapLayer.pointCollection.title,this.collection=e.collection,this.mapLayer=e.mapLayer,this.colors=[],this.colorType=null,this.featureType=null,this.visible=!0,this.collection.bind("add",this.addOne,this),this.collection.bind("reset",this.addAll,this),n.bindAll(this,"setStateType"),this.vent.bind("setStateType",this.setStateType),n.bindAll(this,"toggleValFormatter"),this.vent.bind("toggleValFormatter",this.toggleValFormatter),n.bindAll(this,"toggleLayerVisibility"),e.vent.bind("toggleLayerVisibility",this.toggleLayerVisibility)},setStateType:function(e,t){if(!t||t!=this.mapLayer.pointCollection._id)return;this.updateStatus();switch(this.mapLayer.pointCollection.status){case DataStatus.COMPLETE:this.showLegend(!0)}var n=this.$(".state-indicator");if(n.length)switch(e){default:n.stop().fadeIn(0),n.addClass("loading"),this.$(".visibility.toggle").stop().fadeTo(0,0);break;case"complete":n.stop().fadeOut(300,function(){n.removeClass("loading")}),this.$(".visibility.toggle").stop().fadeTo(300,1)}},updateStatus:function(){var e="",t="",n=this.mapLayer.pointCollection.progress;switch(this.mapLayer.pointCollection.status){case DataStatus.COMPLETE:if(this.mapLayer.sessionOptions.visible)if(this.collection.fetched){e=__("%(number)i of %(total)i",{number:formatLargeNumber(this.collection.originalCount),total:formatLargeNumber(this.collection.fullCount)}),this.mapLayer.pointCollection.sync&&(e+=' <span class="updated micro">'+__("updated %(date)s",{date:(new Date(this.mapLayer.pointCollection.reduce?this.mapLayer.pointCollection.updatedAt<this.mapLayer.pointCollection.lastReducedAt||!this.mapLayer.pointCollection.lastReducedAt?this.mapLayer.pointCollection.updatedAt:this.mapLayer.pointCollection.lastReducedAt:this.mapLayer.pointCollection.updatedAt)).format(locale.formats.DATE_SHORT)})+"</span>");var r=this.collection.url();e+=' <a target="_blank" class="download-collection '+this.mapLayer.pointCollection._id+'" href="'+r+'"><span class="icon icon-white icon-download half-opacity"></span></a>'}else e="loading…";else e="";break;case DataStatus.IMPORTING:e=__(n?"importing… %(count)s":"importing…",{count:formatLargeNumber(this.mapLayer.pointCollection.progress)});break;case DataStatus.UNREDUCED:case DataStatus.UNREDUCED_INC:e=__("queued for crunching…");break;case DataStatus.REDUCING:if(this.mapLayer.pointCollection.numBusy){var i=Math.floor(n/this.mapLayer.pointCollection.numBusy*100);e=__(n?"crunching… %(percent)s%":"crunching…",{percent:i}),this.$(".progress .bar").css("width",i+"%"),this.$(".progress").show()}else e=__("crunching…",{})}var s=this.$(".status"),o=s.text();e==""?s.hide("fast"):s.show("fast"),s.html(e+(e==""&&o!=""?"&nbsp;":""))},updateToggleState:function(e){var t=this;e==undefined&&(e=t.$(".collapse").is(".in")),e?(t.$(".icon.in-out").removeClass("out"),t.$(".icon.in-out").addClass("in")):(t.$(".icon.in-out").addClass("out"),t.$(".icon.in-out").removeClass("in"))},render:function(){var t=this;return e(this.el).html(this.template()),this.$(".status").hide(),e(this.el).addClass(this.mapLayer.pointCollection._id),this.title!=""?dataTitle=this.title:dataTitle="Untitled Data",this.updateStatus(),this.$(".title").html(dataTitle),this.$(".accordion-toggle").attr("href","#collapse-"+this.className+"-"+this.mapLayer.pointCollection._id),this.$(".collapse").attr("id","collapse-"+this.className+"-"+this.mapLayer.pointCollection._id),this.$(".collapse").on("show",function(e){t.updateToggleState(!0),t.visible||(console.log("set to visible"),t.visible=!0,t.visibilityChanged())}),this.$(".collapse").on("hide",function(){t.updateToggleState(!1)}),app.isMapAdmin()||this.$("#adminDataControls").remove(),this.setParameters(),this},initHistogram:function(){var t=this,n=t.$(".histogram");n.show();if(!n.length)return;if(!this.histogramData){e.ajax({type:"GET",url:"/api/histogram/"+this.mapLayer.pointCollection._id,success:function(e){t.histogramData=e,t.initHistogram()},error:function(){console.error("failed to fetch histogram")}});return}var r=this.histogramData,i=r.length,s=t.mapLayer.pointCollection.maxVal,a=n.innerHeight(),f=n.innerWidth(),l=r[0].y,c=r[0].y,h=[],p=[];for(var d=1;d<i;d++)l=Math.max(l,r[d].y),c=Math.min(c,r[d].y);var v=c!=0?c:1,m=v/l,g;t.mapLayer.options.cropDistribution&&(g=1/a*CROP_DISTRIBUTION_RATIO);var y,b=!g||m>g?l:v*1/g,p=[],w=new u(this.histogramColors||this.colors),E;for(var d=0;d<i;d++)(y==null||r[d].val<y)&&p.push(r[d].y);n.html("");var S=o.select(n[0]).append("svg").attr("class","chart").attr("width",f).attr("height",a),x=o.scale.linear().domain([c,b]).range([0,a]).clamp(!0),T=f/p.length,N=p.length-1;S.selectAll("rect").data(p).enter().append("rect").attr("x",function(e,t){return t*T}).attr("y",function(e,t){return a-x(e)}).attr("height",x).attr("width",T).style("fill",function(e,t){return w.colorAt(t/N)}),n.append('<span class="graph-max-y">'+b+"</span>")},setParameters:function(){var t=this,n=this.mapLayer.options;this.colors=n.colors,this.colorType=n.colorType,this.featureType=n.featureType,this.visible=n.visible;for(var r in n){var i=this.$("[name="+r+"]");i.length&&(i.val(n[r]),i.change(function(){}))}e(this.el).delegate("input, select","change",function(){t.enableUpdateButton()});switch(this.mapLayer.pointCollection.status){case DataStatus.COMPLETE:case DataStatus.UNREDUCED_INC:this.updateLegend(!0);break;default:this.hideLegend()}console.log("disableUpdateButton"),this.disableUpdateButton()},removeDataClicked:function(t){var n=this;e(this.el).fadeOut("fast"),n.collection.reset(),n.collection.unbindCollection(),t&&t.preventDefault()},updateDataClicked:function(t){var n=this;switch(this.colorType){case ColorType.SOLID:this.colors=[{color:this.$("#colorInput").val()}];break;case ColorType.PALETTE:this.colors=this.getColorsFromPaletteEditor()}var r={visible:this.visible,colorType:this.colorType,colors:this.colors,featureType:this.featureType,opacity:this.$("[name=opacity]").val(),title:this.$("[name=title]").val(),description:this.$("[name=description]").val(),unit:this.$("[name=unit]").val(),altUnit:this.$("[name=altUnit]").val()};console.log("postData",r),e.ajax({type:"POST",url:"/api/updatemapcollection/"+app.mapInfo._id+"/"+this.mapLayer.pointCollection._id,dataType:"json",data:r,success:function(e){n.disableUpdateButton(),n.updateLegend(!0),n.vent.trigger("updateMapLayer",e)},error:function(){console.error("failed to update layer options")}}),t&&t.preventDefault()},editDataClicked:function(t){var n=this;this.editDataView&&this.editDataView.remove(),this.editDataView=new EditDataView({vent:this.vent,collection:this.collection}),e("body").append(this.editDataView.render().el),e("#editDataModal").modal("toggle"),t&&t.preventDefault()},showLegend:function(){this.$(".legend").show()},hideLegend:function(){this.$(".legend").hide()},updateLegend:function(n){var r=this;this.visible?(e(this.el).addClass("visible"),e(this.el).removeClass("hidden")):(e(this.el).removeClass("visible"),e(this.el).addClass("hidden")),this.mapLayer.options.description?(this.$(".description").show(),this.$(".description").html(this.mapLayer.options.description)):this.$(".description").hide(),this.mapLayer.pointCollection.source?(this.$(".source").show(),this.$(".source").html(__("Source: %(source)s",this.mapLayer.pointCollection))):this.$(".source").hide();switch(this.colorType){case ColorType.SOLID:this.$(".legend-button").css("background-color",this.colors[0].color);break;case ColorType.PALETTE:case ColorType.LINEAR_GRADIENT:this.$(".legend-button").css("background-color",this.colors[0].color)}for(t in FeatureType)FeatureType[t]==this.featureType?this.$(".legend-button").addClass(FeatureType[t]):this.$(".legend-button").removeClass(FeatureType[t]);var i=this.mapLayer.sessionOptions.valFormatter,s=i.unit,o=function(t){return function(n){return r.vent.trigger("toggleValFormatter",r.mapLayer,t),r.$(".unit-item").removeClass("active"),e(n.currentTarget).addClass("active"),!1}};if(s){var u=[],a=this.mapLayer.sessionOptions.valFormatters,f=this.$(".legend .unit ul");f.html("");for(var l=0;l<a.length;l++){var c=a[l],h='<li class="unit-item'+(a.length>1&&c==i?" active":"")+'">'+(a.length>1?'<a href="#" class="unit-toggle">':"<span>")+c.unit+(a.length>1?"</a>":"</span>")+"</li>",h=e(h);a.length>1&&h.on("click",o(c)),f.append(h)}this.$(".legend .unit").show()}else this.$(".legend .unit").hide();if(n&&this.$(".color-bar").length){this.mapLayer.options.histogram&&this.initHistogram();var p=[];for(var l=0;l<this.colors.length;l++){var d=this.colors[l].color,v=multRGB(d,.85);p.push('<li style="width: '+Math.round(100/this.colors.length*100)/100+'%;">'+'<div class="segment" style="background: '+d+"; background: linear-gradient(top, "+d+" 40%, "+v+" 80%)"+"; background: -webkit-gradient(linear, left top, left bottom, color-stop(.4, "+d+"), color-stop(.8, "+v+"))"+'">'+"</div>"+"</li>")}this.$(".color-bar").html(p.join("")),this.setColorBarLabels()}},toggleValFormatter:function(e,t){if(e!=this.mapLayer)return;this.setColorBarLabels()},setColorBarLabels:function(){var t=this.colors.length>1&&(this.colorType==ColorType.LINEAR_GRADIENT||this.colorType==ColorType.PALETTE),n=this.$(".color-bar .segment"),r=this.mapLayer.sessionOptions.valFormatter,i=!1;for(var s=0;s<this.colors.length;s++){var o;this.colors[s].title?o=this.colors[s].title:(i=!0,t?(o=r.format(this.mapLayer.pointCollection.minVal+this.colors[s].position*(this.mapLayer.pointCollection.maxVal-this.mapLayer.pointCollection.minVal)),s==this.colors.length-1&&this.colors[s].position<1&&(o+="+")):o=r.format(this.mapLayer.pointCollection.minVal)+"–"+r.format(this.mapLayer.pointCollection.maxVal),s==0&&(o=UnitFormat.LEGEND.format({value:o,unit:this.mapLayer.pointCollection.unit}))),e(n[s]).text(o)}i?this.$(".legend .unit").show():this.$(".legend .unit").hide()},addOne:function(e){var t=this},addAll:function(){this.updateStatus()},enableUpdateButton:function(){console.log("enableUpdateButton"),this.$("#updateData").attr("disabled",!1),this.$("#updateData").removeClass("disabled"),this.$("#updateData").addClass("btn-primary")},disableUpdateButton:function(){this.$("#updateData").attr("disabled",!0),this.$("#updateData").removeClass("btn-primary"),this.$("#updateData").addClass("disabled")},colorInputClicked:function(e){this.enableUpdateButton(),e&&e.preventDefault()},featureTypeChanged:function(t){var n=this;if(t){var r=e(t.currentTarget).val();if(r==this.colorType)return;this.featureType=r,this.enableUpdateButton()}this.$(".feature-type").each(function(){e(this).val()==n.featureType?e(this).addClass("active"):e(this).removeClass("active")}),this.$(".feature-settings").each(function(){e(this).hasClass(n.featureType)?e(this).show():e(this).hide()}),t&&t.preventDefault()},colorTypeChanged:function(t){var n=this;if(t){var r=e(t.currentTarget).val();if(r==this.colorType)return;this.colorType=r,this.enableUpdateButton()}this.$(".color-type").each(function(){e(this).val()==n.colorType?e(this).addClass("active"):e(this).removeClass("active")});switch(this.colorType){case ColorType.SOLID:this.$(".color-gradient").hide(),this.$(".color-palette").hide(),this.$(".color-solid").show(),this.updateLegend(!0);break;case ColorType.LINEAR_GRADIENT:this.$(".color-gradient").show(),this.$(".color-palette").hide(),this.$(".color-solid").hide(),this.updateLegend(!0);break;case ColorType.PALETTE:this.$(".color-gradient").hide(),this.$(".color-palette").show(),this.$(".color-solid").hide(),this.updateLegend(!0)}t&&t.preventDefault()},toggleLayerVisibility:function(t,n,r){var i=this;if(t!=this.mapLayer.pointCollection._id)return;this.visible=n,this.$(".visibility").each(function(){var t=e(this).val();t=Number(t)!=0,t==i.visible?e(this).addClass("active"):e(this).removeClass("active")}),i.visible?(this.$(".icon.visibility.toggle").addClass("icon-eye-open"),this.$(".icon.visibility.toggle").removeClass("icon-eye-close"),e(this.el).show()):(this.$(".icon.visibility.toggle").removeClass("icon-eye-open"),this.$(".icon.visibility.toggle").addClass("icon-eye-close"),r&&e(this.el).hide()),this.updateStatus(),this.updateToggleState()},visibilityChanged:function(t){var n=this;if(t){if(!e(t.currentTarget).hasClass("toggle")){var r=e(t.currentTarget).val();r=Number(r)!=0;if(r==this.visible)return;this.visible=r}else this.visible=!this.visible;this.enableUpdateButton()}this.vent.trigger("toggleLayerVisibility",this.mapLayer.pointCollection._id,this.visible),this.updateLegend(),t&&t.preventDefault()}});return a}),define("views/data-inspector-view",["jquery","underscore","backbone","config","utils","text!templates/data-inspector.html","views/data-view-base"],function(e,t,n,r,i,s,o){var u=o.extend({className:"data-inspector",events:{"click #removeData":"removeDataClicked","click #editData":"editDataClicked","click #updateData":"updateDataClicked","click .color-type":"colorTypeChanged","click .feature-type":"featureTypeChanged","click .legend-button":"visibilityChanged","click .visibility":"visibilityChanged","click #colorInput":"colorInputClicked"},initialize:function(e){u.__super__.initialize.call(this,e),this.template=t.template(s),this.histogramColors=[{color:"#666666"}]},setParameters:function(){u.__super__.setParameters.call(this),this.initGradientEditor(),this.initPaletteEditor(),this.featureTypeChanged(),this.colorTypeChanged(),this.initColorPicker(this.$("#colorInput"))},initColorPicker:function(t,n){var r=this;e(t).miniColors("value",n),e(t).miniColors({change:function(e,t){r.enableUpdateButton()}}),n||(n="#0aa5ff")},initGradientEditor:function(){var e=[],t=this;for(var n=0;n<this.colors.length;n++)e[n]={color:this.colors[n].color,position:this.colors[n].position||0};e.length==1&&(e[1]={color:e[0].color,position:1}),this.$("#gradientEditor").gradientEditor({width:220,height:30,stopWidth:12,stopHeight:10,initialColor:"#ff00ff",onChange:function(e){t.colors=e,t.enableUpdateButton()},colors:e})},initPaletteEditor:function(){var t=[],n=this,r=this.$(".color-palette tbody"),i=this.$(".color-palette tr.template").clone();i.removeClass("template"),i.show();for(var s=0;s<this.colors.length;s++){var o={color:this.colors[s].color,absPosition:this.colors[s].absPosition||0,interpolation:this.colors[s].interpolation||""},u=i.clone();this.initColorPicker(e(".color-picker",u),o.color),e("[name=absPosition]",u).val(o.absPosition),e("[name=interpolation] option",u).each(function(){e(this).attr("selected",e(this).val()==o.interpolation||o.interpolation==""&&e(this).val()==ColorGradient.prototype.interpolation.default)}),r.append(u)}},getColorsFromPaletteEditor:function(){var t=[];return this.$(".color-palette tbody tr").each(function(){if(e(this).is(".template"))return;var n={color:e(".color-picker",this).val(),absPosition:parseFloat(e("[name=absPosition]",this).val()),interpolation:e("[name=interpolation]",this).val()};t.push(n)}),t}});return u}),define("text!templates/data-legend.html",[],function(){return'<div class="accordion-group">\n  <div class="accordion-heading">\n    <h4>\n      <a class="accordion-toggle" data-toggle="collapse" href="#collapse">\n        <span class="icon in-out"></span><span class="title"></span>\n      </a>\n    </h4>\n    <a class="icon visibility toggle icon-eye-open icon-white" href="#"></a>\n    <div class="state-indicator"></div>\n    <div class="status"></div>\n    <div class="progress progress-striped active" style="display: none">\n      <div class="bar" style="width: 40%;"></div>\n    </div>\n    <a class="legend-button toggle"></a>\n  </div>\n  <div id="collapse" class="accordion-body collapse">\n    <div class="accordion-body-content">\n      <div class="legend">\n        <div class="histogram"></div>\n        <ul class="color-bar clearfix condensed"></ul>\n        <div class="unit">\n          <ul class="nav nav-pills">\n          </ul>\n        </div>\n        </ul>\n        <div class="meta description"></div>\n        <div class="meta source"></div>\n      </div>\n      <div class="detail">\n        <table class="detail-data"></table>\n        <table class="detail-metadata micro"></table>\n      </div>\n    </div>\n  </div>\n</div>'}),define("views/data-legend-view",["jquery","underscore","backbone","config","utils","text!templates/data-legend.html","views/data-view-base"],function(e,t,n,r,i,s,o){var u=o.extend({className:"data-legend",events:{"click .visibility":"visibilityChanged"},initialize:function(e){u.__super__.initialize.call(this,e),this.template=t.template(s),this.vent=e.vent,t.bindAll(this,"dataInfoViewResized"),e.vent.bind("dataInfoViewResized",this.dataInfoViewResized)},updateStatus:function(){u.__super__.updateStatus.call(this)},dataInfoViewResized:function(e){this.mapLayer.options.histogram&&this.initHistogram()},toggleLayerVisibility:function(t,n,r){if(t!=this.mapLayer.pointCollection._id)return;u.__super__.toggleLayerVisibility.call(this,t,n,r);var i=this.$(".collapse");if(n||!r)this.visible?(e(this.el).css("opacity",1),i.is(".in")||i.collapse("show")):(e(this.el).css("opacity",.4),i.is(".in")&&i.collapse("hide"))}});return u}),define("text!templates/share.html",[],function(){return'<div class="modal-header">\n  <a class="close" data-dismiss="modal">×</a>\n  <h2>Share current view</h2>\n</div>\n\n<div class="modal-body">\n    <form class="well urls">\n      <h3>Paste link in email or IM:</h3>\n      <textarea class="public-url" rows="2" spellcheck="false"></textarea>\n      <h3>Paste HTML to embed in website:</h3>\n      <textarea class="iframe" rows="4" spellcheck="false"></textarea>\n    </form>\n  </div>\n</div>\n\n<div class="modal-footer">\n  <a href="#" data-dismiss="modal" class="btn">Close</a>\n\n\n</div>\n'}),define("views/share-view",["jquery","underscore","backbone","config","utils","text!templates/share.html","views/modal-view"],function(e,t,n,r,i,s,o){var u=o.extend({events:{},initialize:function(e){this.template=t.template(s)},render:function(){return u.__super__.render.call(this),this.$(".public-url, .iframe").click(function(){e(this).select()}),this},show:function(){var e=app.genPublicURL(!0);this.$(".public-url").val(e),this.$(".iframe").val('<iframe width="920" height="640" frameborder="0" scrolling="auto" marginwidth="0" marginheight="0" src="%(url)s"></iframe>'.format({url:e})),u.__super__.show.call(this)}});return u}),define("models/point",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({idAttribute:"_id",defaults:function(){return{datetime:Date,loc:[0,0],val:null}}});return r}),define("collections/map-point-collection",["jquery","underscore","backbone","models/point"],function(e,t,n,r){var i=n.Collection.extend({model:r,comparator:function(e){return e.get("datetime")},initialize:function(t){this.pointCollectionId=t.pointCollectionId,this.baseUrl="/api/mappoints/"+t.mapId+"/"+this.pointCollectionId,this.mapLayer=t.mapLayer,this.urlParams=t.urlParams?e.extend({},t.urlParams):{},this.fetched=this.visibleMapAreaFetched=!1},url:function(){return this.baseUrl+"?"+genQueryString(this.urlParams)},setVisibleMapArea:function(e){console.log("MapPointCollection.setVisibleMapArea "+this.pointCollectionId),this.urlParams.b=[e.bounds[0][0],e.bounds[0][1],e.bounds[1][0],e.bounds[1][1]],this.urlParams.z=e.zoom,this.visibleMapAreaFetched=!1},fetch:function(e){return console.log("MapPointCollection.fetch "+this.pointCollectionId),i.__super__.fetch.call(this,e)},parse:function(e,t){return e.items&&(this.fullCount=e.fullCount,this.maxReducedCount=e.maxReducedCount,this.resultCount=e.resultCount,this.originalCount=e.originalCount,this.gridSize=e.gridSize,e=e.items),this.fetched=this.visibleMapAreaFetched=!0,i.__super__.parse.call(this,e,t)},addData:function(t,n){var r=this;e.ajax({type:"POST",dataType:"json",data:t,url:"/api/addpoints/"+this.pointCollectionId,success:function(){console.log("Adding points for: "+r.pointCollectionId),n()},error:function(){console.error("failed to add point bundle")}})},unbindCollection:function(){console.log("unbinding "+this.pointCollectionId);var t=this;e.ajax({type:"POST",url:"/api/unbindmapcollection/"+app.mapInfo._id+"/"+t.pointCollectionId,success:function(e){},error:function(){console.error("failed to unbind collection")}})},destroy:function(t){var n=this;e.ajax({type:"DELETE",url:this.url,success:function(){console.log("Removed collection: "+n.pointCollectionId)},error:function(){console.error("failed to remove collection: "+n.pointCollectionId)}}),this.destroyAssociativeIndex(t)},destroyAssociativeIndex:function(){var t=this;e.ajax({type:"DELETE",url:"/api/pointcollection/"+this.pointCollectionId,success:function(e){console.log("Destroyed associated collection: "+t.pointCollectionId)},error:function(){console.error("Failed to destroy associated collection: "+t.pointCollectionId)}})}});return i}),define("models/map",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({idAttribute:"_id"});return r}),define("router",["jquery","underscore","backbone","views/homepage-view","views/header-view","views/sidebar-view","views/setup-view","views/map-ol-view","views/data-info-view","views/map-info-view","views/data-inspector-view","views/data-legend-view","views/modal-view","views/share-view","collections/map-point-collection","models/map","models/point"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){var g=n.Router.extend({routes:{},defaultRoutes:{"":"homeRoute",removed:"homeRoute","admin/:slug":"mapAdminRoute","admin/:slug/:view":"mapAdminRoute","admin/:slug/:view/:pos":"mapAdminRoute",":slug":"mapRoute",":slug/:view":"mapRoute",":slug/:view/:pos":"mapRoute"},byHostRoutes:{removed:"homeRoute",admin:"mapAdminRouteByHost","admin/:view":"mapAdminRouteByHost","admin/:view/:pos":"mapAdminRouteByHost","":"mapRouteByHost",":view":"mapRouteByHost",":view/:pos":"mapRouteByHost"},getRoutes:function(){var e;window.MAP_SLUG?(console.log("route by custom host"),e=this.byHostRoutes):(console.log("route by slug"),e=this.defaultRoutes);var t=[];for(var n in e)t.unshift([n,e[n]]);return t},initialize:function(){var r=this;t.each(this.getRoutes(),function(e){r.route.apply(r,e)}),this.firstLoad=!0,this.pointCollections={},this.timeBasedPointCollections={},this.isRendered=!1,this.mapLayersInitialized=!1,this.settingsVisible=!0,this.graphVisible=!1,this.dataLibraryVisible=!1,this.chatVisible=!1,this.vent=t.extend({},n.Events),this.vent.bind("mapViewReady",function(){e("#loading-indicator").remove(),r.mapLayersInitialized||r.initMapLayers()}),this.adminRoute=!1,this.routingByHost=!1,t.bindAll(this,"updateMapLayer"),this.vent.bind("updateMapLayer",this.updateMapLayer),t.bindAll(this,"toggleValFormatter"),this.vent.bind("toggleValFormatter",this.toggleValFormatter),t.bindAll(this,"toggleLayerVisibility"),this.vent.bind("toggleLayerVisibility",this.toggleLayerVisibility),t.bindAll(this,"viewOptionsChanged"),this.vent.bind("viewOptionsChanged",this.viewOptionsChanged),t.bindAll(this,"updateVisibleDate"),this.vent.bind("updateVisibleDate",this.updateVisibleDate),this.isEmbedded=window!=window.top},mapRoute:function(t,n,r){var i,s,o,u,a;if(n){this.setupRoute=n=="setup";if(!this.setupRoute){var f=n.split(":");i=f.shift(),f.length>1&&(s=f.shift()),f.length&&(o=f.shift())}else e("#app").empty()}if(r!=undefined){var f=r.split(",");f.length==3&&(a=f.pop()),f.length==2&&(x=parseFloat(f.shift()),y=parseFloat(f.shift()),!isNaN(x)&&!isNaN(y)&&(u=[x,y]))}console.log("slug:",t,"mapViewName:",i,"viewBase:",s,"viewStyle:",o,"center:",u,"zoom:",a),this.loadAndInitMap(t,i,u,a,s,o)},mapAdminRoute:function(e,t,n){this.adminRoute=!0,this.mapRoute(e,t,n)},mapRouteByHost:function(e,t){return this.routingByHost=!0,this.mapRoute(window.MAP_SLUG,e,t)},mapAdminRouteByHost:function(e,t){return this.routingByHost=!0,this.mapAdminRoute(window.MAP_SLUG,e,t)},homeRoute:function(){this.firstLoad?(this.firstLoad=!1,this.homepageView=new r,e("#app").append(this.homepageView.render().el)):window.location.reload(!0)},genMapViewParam:function(e){if(!e||e=="map"){var t=this.mapView.viewBase&&this.mapView.viewBase!=DEFAULT_MAP_VIEW_BASE,n=t||this.mapView.viewStyle&&this.mapView.viewStyle!=this.mapView.defaultViewStyle;e=this.mapViewName+(n||t?":":"")+(t?this.mapView.viewBase+":":"")+(n?this.mapView.viewStyle?this.mapView.viewStyle:"default":"")}return e},genMapURI:function(e,t,n){var n=(n||n==undefined)&&this.adminRoute;return e=this.genMapViewParam(e),genMapURI(this.mapInfo,e,t,n,this.routingByHost?!1:"publicslug")},genPublicURL:function(e){return genMapURL(this.mapInfo,e?this.getURIOptsForVisibleMapArea():!1,!1)},getURIOptsForVisibleMapArea:function(e){if(!e)var e=this.mapView.getVisibleMapArea();var t={x:e.center[0],y:e.center[1],zoom:e.zoom,mapViewName:this.genMapViewParam("map")},n={x:this.mapInfo.initialArea.center.length?this.mapInfo.initialArea.center[0]:0,y:this.mapInfo.initialArea.center.length?this.mapInfo.initialArea.center[1]:0,zoom:this.mapInfo.initialArea.zoom!=undefined?this.mapInfo.initialArea.zoom:0};return n.x!=t.x||n.y!=t.y||n.zoom!=t.zoom?t:{mapViewName:t.mapViewName}},genMapURIForVisibleArea:function(e){return app.genMapURI(null,this.getURIOptsForVisibleMapArea(e))},genAdminURL:function(){return genMapURL(this.mapInfo,!1,!0)},loadAndInitMap:function(t,n,r,i,s,o){var u=this;switch(n){default:n="map";break;case"map":break;case"globe":}if(!u.mapInfo){e.ajax({type:"GET",url:"/api/map/"+t,success:function(e){u.initMapInfo(e),u.initMapView(n,r,i,s,o)},error:function(){console.error("failed to load map",t)}});return}u.initMapView(n,r,i,s,o)},initMapInfo:function(e){var t=this;t.mapInfo=e;for(var n=t.mapInfo.layers.length-1;n>=0;n--){var r=t.mapInfo.layers[n];r.sessionOptions={visible:r.options.visible};if(r.options.valFormat){r.sessionOptions.valFormatters=[];for(var i=0;i==0||i<r.options.valFormat.length;i++){var s=null;i<r.options.valFormat.length&&(s=r.options.valFormat[i]),s||(s={}),s.unit||(s.unit=r.pointCollection.unit),r.sessionOptions.valFormatters.push(new ValFormatter(s))}r.sessionOptions.valFormatter=r.sessionOptions.valFormatters[0]}}},toggleLayerVisibility:function(e,t){var n=this,r=this.pointCollections[e],i=this.getMapLayer(e);i.sessionOptions.visible=t,console.log("toggleLayerVisibility "+e,t,t?"fetched: "+r.visibleMapAreaFetched:""),t&&!r.visibleMapAreaFetched&&setTimeout(function(){n.fetchMapLayer(e)},300)},toggleValFormatter:function(e,t){e.sessionOptions.valFormatter=t},getDefaultVisibleMapArea:function(){var e=DEFAULT_MAP_AREA;return this.mapInfo.initialArea&&this.mapInfo.initialArea.center.length&&(e.center=this.mapInfo.initialArea.center),this.mapInfo.initialArea.zoom!=undefined&&(e.zoom=this.mapInfo.initialArea.zoom),e},initMapView:function(t,n,r,i,s){var o=this;o.isRendered||o.render(t),this.mapViewName=t,this.mapView&&(this.mapView.remove(),this.mapView=null);switch(this.mapViewName){case"map":var l=u;e("#navMap").addClass("active"),e("#navGlobe").removeClass("active");break;case"globe":var l=MapGLView;e("#navMap").removeClass("active"),e("#navGlobe").addClass("active")}var c=this.getDefaultVisibleMapArea();n&&(c.center=n),r&&(c.zoom=r),this.mapView=new l({vent:o.vent,visibleMapArea:c});var h=this.mapView.render().el;e("#app").append(h),this.mapView.start(i,s),this.viewOptionsChanged(this.mapView);var p=e('<div class="snap top" /><div class="snap right" />');e(h).append(p),this.dataInfoView=new a({vent:this.vent}),e(h).append(this.dataInfoView.render().el),this.mapInfoView=new f({vent:this.vent,mapInfo:this.mapInfo}),this.mapInfoView.render()},viewOptionsChanged:function(t){var n=this;if(t==this.mapView){e("#app").removeClass(function(e,t){return(t.match(/\bmap-style-\S+/g)||[]).join(" ")});if(this.mapView.viewStyles){e("#app").addClass("map-style-"+this.mapView.viewStyle);var r=[];e.each(this.mapView.viewStyles,function(e,t){var i=e;r.push("<li"+(i==n.mapView.viewStyle?' class="inactive"':"")+">"+'<a href="#'+i+'">'+t+"</a></li>")}),e("#viewStyle .dropdown-menu").html(r.join("")),e("#viewStyleCurrent").text(this.mapView.viewStyles[this.mapView.viewStyle]),e("#viewStyle").show()}else e("#viewStyle").hide();if(this.mapView.viewBase){var r=[];for(var i in this.mapView.ViewBase){var s=this.mapView.ViewBase[i].prototype;r.push("<li"+(i==n.mapView.viewBase?' class="inactive"':"")+">"+'<a href="#'+i+'">'+'<span class="view-base-thumb" style="background: url(/assets/baselayer-thumbs/'+i+'.png)"></span>'+'<span class="view-base-caption">'+s.providerName+"</span>"+"</a></li>")}e("#viewBase .dropdown-menu").html(r.join("")),e("#viewBaseCurrent").text(this.mapView.ViewBase[this.mapView.viewBase].prototype.providerName),e("#viewBaselayer").show()}else e("#viewBaselayer").hide()}},setViewStyle:function(e,t){this.vent.trigger("updateViewStyle",e),(t||t==undefined)&&app.navigate(app.genMapURIForVisibleArea(),{trigger:!1})},setViewBase:function(e,t){this.vent.trigger("updateViewBase",e),(t||t==undefined)&&app.navigate(app.genMapURIForVisibleArea(),{trigger:!1})},showMapInfo:function(){this.mapInfoView.show()},showShareLink:function(){var e=(new p).render();e.show()},showAbout:function(){var e=(new h).render();e.setTitle("About GeoSense"),e.setBody(nl2p("GeoSense is an open publishing platform for visualization, social sharing, and data analysis of geospatial data. It explores the power of data analysis through robust layering and highly customizable data visualization. GeoSense supports the simultaneous comparison and individual styling for multiple massive data sources ranging from 10 thousand to 10 million geolocated points.\n\nDeveloped by Anthony DeVincenzi and Samuel Luescher of the MIT Media Lab, alongside Hiroshi Ishii and Safecast.org.")),e.show()},showSetupView:function(){this.setupView.show()},isMapAdmin:function(){return this.adminRoute&&this.mapInfo.admin},render:function(){console.log("app.render");var t=this;window.document.title=this.mapInfo.title+" – GeoSense",this.isEmbedded&&e("body").addClass("embed"),this.headerView=new i({vent:this.vent,mapInfo:this.mapInfo}),e("#app").append(this.headerView.render().el),e("body").css("overflow","hidden"),window.location.href.indexOf("4D4R0IjQJYzGP0m")!=-1&&e("body").addClass("embed"),this.isMapAdmin()&&(this.sideBarView=new s({vent:this.vent}),e("#app").append(this.sideBarView.render().el),e("#app").addClass("with-sidebar"),this.setupView=(new o({vent:this.vent,mapInfo:this.mapInfo})).render(),this.setupRoute&&this.showSetupView()),t.isRendered=!0},getURLParameter:function(e){return decodeURI((RegExp(e+"="+"(.+?)(&|$)").exec(location.search)||[,null])[1])},initMapLayers:function(){if(this.mapInfo.layers)for(var t=0;t<this.mapInfo.layers.length;t++){var n=this.mapInfo.layers[t].pointCollection._id;this.initMapLayer(n)}this.mapLayersInitialized=!0;if(this.mapInfo.tour&&this.mapInfo.tour.steps.length){var r=this.mapView.el;this.mapTourView=new MapTourView({vent:this.vent,mapInfo:this.mapInfo}),e(r).append(this.mapTourView.render().el)}else if(this.mapInfo.layers)for(var t=0;t<this.mapInfo.layers.length;t++){var n=this.mapInfo.layers[t].pointCollection._id,i=this.getMapLayer(n);this.vent.trigger("toggleLayerVisibility",n,i.sessionOptions.visible)}},initMapLayer:function(t){var n=this,r=this.getMapLayer(t);console.log("initMapLayer "+t,r);var i=n.mapView.getVisibleMapArea(),s={pointCollectionId:t,mapId:app.mapInfo._id,mapLayer:r},o=this.pointCollections[t]=new d(s);n.addDataPanelViews(t),n.mapView.addCollection(o),e(".data-info").show()},updateVisibleDate:function(t,n){var r=this;e.each(this.pointCollections,function(e,i){i.urlParams.t="w",i.urlParams.from=t.format("%Y-%m-%d"),i.urlParams.to=n.format("%Y-%m-%d"),r.fetchMapLayer(i.pointCollectionId),console.log(i.urlParams)})},updateMapLayer:function(e){console.log("updateMapLayer",e);var t=this.getMapLayer(e.pointCollection._id);for(var n in e)t[n]=e[n];this.vent.trigger("redrawMapLayer",t)},pollForNewPointCollection:function(t,n){var r=this;if(n){setTimeout(function(){r.pollForNewPointCollection(t)},n);return}console.log("pollForNewPointCollection: "+t),e.ajax({type:"GET",url:"/api/pointcollection/"+t,error:function(){console.error("Failed to fetch new collection, trying again after timeout...")},success:function(e){r.updatePointCollectionAfterPolling(e)}})},updatePointCollectionAfterPolling:function(e){var t=e._id,n=this.getMapLayer(t);n.pointCollection=e,e.status!==DataStatus.COMPLETE?(console.log("Collection "+t+" is busy, polling again after timeout..."),this.pollForNewPointCollection(t,POLL_INTERVAL),this.vent.trigger("setStateType","loading",n.pointCollection._id)):this.fetchMapLayer(t)},fetchPointCollection:function(e,t){var n=this;n.vent.trigger("setStateType","loading",e),t.fetch({success:function(t){n.vent.trigger("setStateType","complete",e)}})},fetchMapLayer:function(e){var t=this,n=this.getMapLayer(e),r=this.pointCollections[e];r.setVisibleMapArea(this.mapView.getVisibleMapArea()),console.log("fetch",n),n.sessionOptions.visible&&this.fetchPointCollection(e,r)},bindCollectionToMap:function(t){var n=this;e.ajax({type:"POST",url:"/api/bindmapcollection/"+this.mapInfo._id+"/"+t,success:function(e){n.initMapInfo(e),n.initMapLayer(t)},error:function(){console.error("failed to join map with collection")}})},getMapLayer:function(e){for(var t=0;t<this.mapInfo.layers.length;t++)if(e==this.mapInfo.layers[t].pointCollection._id)return this.mapInfo.layers[t]},addDataPanelViews:function(t){var n={vent:this.vent,collection:this.pointCollections[t],collectionId:t,mapLayer:this.getMapLayer(t)};if(this.isMapAdmin()){var r=new l(n);e("#dataContainer .accordion").append(r.render().el)}var i=new c(n),s=i.render().el;e("#data-info-view .accordion").append(s)}}),b=function(){app=new g,n.history.start({pushState:!0})||e("#app").html("page not found")};return{initialize:b}}),define("app",["jquery","underscore","backbone","router"],function(e,t,n,r){var i=function(){r.initialize()};return{initialize:i}}),function(e,t){function n(t){return!e(t).parents().andSelf().filter(function(){return e.curCSS(this,"visibility")==="hidden"||e.expr.filters.hidden(this)}).length}e.ui=e.ui||{},e.ui.version||(e.extend(e.ui,{version:"1.8.9",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),e.fn.extend({_focus:e.fn.focus,focus:function(t,n){return typeof t=="number"?this.each(function(){var r=this;setTimeout(function(){e(r).focus(),n&&n.call(r)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return t=e.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.curCSS(this,"position",1))&&/(auto|scroll)/.test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length){n=e(this[0]);for(var r;n.length&&n[0]!==document;){r=n.css("position");if(r==="absolute"||r==="relative"||r==="fixed"){r=parseInt(n.css("zIndex"),10);if(!isNaN(r)&&r!==0)return r}n=n.parent()}}return 0},disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.each(["Width","Height"],function(n,r){function i(t,n,r,i){return e.each(s,function(){n-=parseFloat(e.curCSS(t,"padding"+this,!0))||0,r&&(n-=parseFloat(e.curCSS(t,"border"+this+"Width",!0))||0),i&&(n-=parseFloat(e.curCSS(t,"margin"+this,!0))||0)}),n}var s=r==="Width"?["Left","Right"]:["Top","Bottom"],o=r.toLowerCase(),u={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?u["inner"+r].call(this):this.each(function(){e(this).css(o,i(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return typeof t!="number"?u["outer"+r].call(this,t):this.each(function(){e(this).css(o,i(this,t,!0,n)+"px")})}}),e.extend(e.expr[":"],{data:function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){var r=t.nodeName.toLowerCase(),i=e.attr(t,"tabindex");return"area"===r?(r=t.parentNode,i=r.name,!t.href||!i||r.nodeName.toLowerCase()!=="map"?!1:(t=e("img[usemap=#"+i+"]")[0],!!t&&n(t))):(/input|select|textarea|button|object/.test(r)?!t.disabled:"a"==r?t.href||!isNaN(i):!isNaN(i))&&n(t)},tabbable:function(t){var n=e.attr(t,"tabindex");return(isNaN(n)||n>=0)&&e(t).is(":focusable")}}),e(function(){var t=document.body,n=t.appendChild(n=document.createElement("div"));e.extend(n.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),e.support.minHeight=n.offsetHeight===100,e.support.selectstart="onselectstart"in n,t.removeChild(n).style.display="none"}),e.extend(e.ui,{plugin:{add:function(t,n,r){t=e.ui[t].prototype;for(var i in r)t.plugins[i]=t.plugins[i]||[],t.plugins[i].push([n,r[i]])},call:function(e,t,n){if((t=e.plugins[t])&&e.element[0].parentNode)for(var r=0;r<t.length;r++)e.options[t[r][0]]&&t[r][1].apply(e.element,n)}},contains:function(e,t){return document.compareDocumentPosition?e.compareDocumentPosition(t)&16:e!==t&&e.contains(t)},hasScroll:function(t,n){if(e(t).css("overflow")==="hidden")return!1;n=n&&n==="left"?"scrollLeft":"scrollTop";var r=!1;return t[n]>0?!0:(t[n]=1,r=t[n]>0,t[n]=0,r)},isOverAxis:function(e,t,n){return e>t&&e<t+n},isOver:function(t,n,r,i,s,o){return e.ui.isOverAxis(t,r,s)&&e.ui.isOverAxis(n,i,o)}}))}(jQuery),function(e,t){if(e.cleanData){var n=e.cleanData;e.cleanData=function(t){for(var r=0,i;(i=t[r])!=null;r++)e(i).triggerHandler("remove");n(t)}}else{var r=e.fn.remove;e.fn.remove=function(t,n){return this.each(function(){return n||(!t||e.filter(t,[this]).length)&&e("*",this).add([this]).each(function(){e(this).triggerHandler("remove")}),r.call(e(this),t,n)})}}e.widget=function(t,n,r){var i=t.split(".")[0],s;t=t.split(".")[1],s=i+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][s]=function(n){return!!e.data(n,t)},e[i]=e[i]||{},e[i][t]=function(e,t){arguments.length&&this._createWidget(e,t)},n=new n,n.options=e.extend(!0,{},n.options),e[i][t].prototype=e.extend(!0,n,{namespace:i,widgetName:t,widgetEventPrefix:e[i][t].prototype.widgetEventPrefix||t,widgetBaseClass:s},r),e.widget.bridge(t,e[i][t])},e.widget.bridge=function(n,r){e.fn[n]=function(i){var s=typeof i=="string",o=Array.prototype.slice.call(arguments,1),u=this;return i=!s&&o.length?e.extend.apply(null,[!0,i].concat(o)):i,s&&i.charAt(0)==="_"?u:(s?this.each(function(){var r=e.data(this,n),s=r&&e.isFunction(r[i])?r[i].apply(r,o):r;if(s!==r&&s!==t)return u=s,!1}):this.each(function(){var t=e.data(this,n);t?t.option(i||{})._init():e.data(this,n,new r(i,this))}),u)}},e.Widget=function(e,t){arguments.length&&this._createWidget(e,t)},e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(t,n){e.data(n,this.widgetName,this),this.element=e(n),this.options=e.extend(!0,{},this.options,this._getCreateOptions(),t);var r=this;this.element.bind("remove."+this.widgetName,function(){r.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(n,r){var i=n;if(arguments.length===0)return e.extend({},this.options);if(typeof n=="string"){if(r===t)return this.options[n];i={},i[n]=r}return this._setOptions(i),this},_setOptions:function(t){var n=this;return e.each(t,function(e,t){n._setOption(e,t)}),this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&this.widget()[t?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",t),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(t,n,r){var i=this.options[t];n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),r=r||{};if(n.originalEvent){t=e.event.props.length;for(var s;t;)s=e.event.props[--t],n[s]=n.originalEvent[s]}return this.element.trigger(n,r),!(e.isFunction(i)&&i.call(this.element[0],n,r)===!1||n.isDefaultPrevented())}}}(jQuery),function(e){e.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent"))return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName)},_mouseDown:function(t){t.originalEvent=t.originalEvent||{};if(!t.originalEvent.mouseHandled){this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var n=this,r=t.which==1,i=typeof this.options.cancel=="string"?e(t.target).parents().add(t.target).filter(this.options.cancel).length:!1;if(!r||i||!this._mouseCapture(t))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){n.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(t)!==!1;if(!this._mouseStarted)return t.preventDefault(),!0}return this._mouseMoveDelegate=function(e){return n._mouseMove(e)},this._mouseUpDelegate=function(e){return n._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),t.originalEvent.mouseHandled=!0}},_mouseMove:function(t){return!e.browser.msie||document.documentMode>=9||!!t.button?this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&((this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1)?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted):this._mouseUp(t)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target==this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e){e.widget("ui.draggable",e.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},destroy:function(){if(this.element.data("draggable"))return this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy(),this},_mouseCapture:function(t){var n=this.options;return this.helper||n.disabled||e(t.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(t),this.handle?!0:!1)},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),n.containment&&this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.helper.addClass("ui-draggable-dragging"),this._mouseDrag(t,!0),!0)},_mouseDrag:function(t,n){this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute");if(!n){n=this._uiHash();if(this._trigger("drag",t,n)===!1)return this._mouseUp({}),!1;this.position=n.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";return e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var n=!1;e.ui.ddmanager&&!this.options.dropBehaviour&&(n=e.ui.ddmanager.drop(this,t)),this.dropped&&(n=this.dropped,this.dropped=!1);if((!this.element[0]||!this.element[0].parentNode)&&this.options.helper=="original")return!1;if(this.options.revert=="invalid"&&!n||this.options.revert=="valid"&&n||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)){var r=this;e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){r._trigger("stop",t)!==!1&&r._clear()})}else this._trigger("stop",t)!==!1&&this._clear();return!1},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){var n=!this.options.handle||!e(this.options.handle,this.element).length?!0:!1;return e(this.options.handle,this.element).find("*").andSelf().each(function(){this==t.target&&(n=!0)}),n},_createHelper:function(t){var n=this.options;return t=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):n.helper=="clone"?this.element.clone():this.element,t.parents("body").length||t.appendTo(n.appendTo=="parent"?this.element[0].parentNode:n.appendTo),t[0]!=this.element[0]&&!/(fixed|absolute)/.test(t.css("position"))&&t.css("position","absolute"),t},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e.browser.msie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;t.containment=="parent"&&(t.containment=this.helper[0].parentNode);if(t.containment=="document"||t.containment=="window")this.containment=[(t.containment=="document"?0:e(window).scrollLeft())-this.offset.relative.left-this.offset.parent.left,(t.containment=="document"?0:e(window).scrollTop())-this.offset.relative.top-this.offset.parent.top,(t.containment=="document"?0:e(window).scrollLeft())+e(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(t.containment=="document"?0:e(window).scrollTop())+(e(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(t.containment)&&t.containment.constructor!=Array){var n=e(t.containment)[0];if(n){t=e(t.containment).offset();var r=e(n).css("overflow")!="hidden";this.containment=[t.left+(parseInt(e(n).css("borderLeftWidth"),10)||0)+(parseInt(e(n).css("paddingLeft"),10)||0)-this.margins.left,t.top+(parseInt(e(n).css("borderTopWidth"),10)||0)+(parseInt(e(n).css("paddingTop"),10)||0)-this.margins.top,t.left+(r?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(e(n).css("borderLeftWidth"),10)||0)-(parseInt(e(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,t.top+(r?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(e(n).css("borderTopWidth"),10)||0)-(parseInt(e(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}}else t.containment.constructor==Array&&(this.containment=t.containment)},_convertPositionTo:function(t,n){n||(n=this.position),t=t=="absolute"?1:-1;var r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(r[0].tagName);return{top:n.top+this.offset.relative.top*t+this.offset.parent.top*t-(e.browser.safari&&e.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop())*t),left:n.left+this.offset.relative.left*t+this.offset.parent.left*t-(e.browser.safari&&e.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())*t)}},_generatePosition:function(t){var n=this.options,r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(r[0].tagName),s=t.pageX,o=t.pageY;return this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(s=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(s=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),n.grid&&(o=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1],o=this.containment?o-this.offset.click.top<this.containment[1]||o-this.offset.click.top>this.containment[3]?o-this.offset.click.top<this.containment[1]?o+n.grid[1]:o-n.grid[1]:o:o,s=this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0],s=this.containment?s-this.offset.click.left<this.containment[0]||s-this.offset.click.left>this.containment[2]?s-this.offset.click.left<this.containment[0]?s+n.grid[0]:s-n.grid[0]:s:s)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(e.browser.safari&&e.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(e.browser.safari&&e.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,n,r){return r=r||this._uiHash(),e.ui.plugin.call(this,t,[n,r]),t=="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,n,r)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.extend(e.ui.draggable,{version:"1.8.9"}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n){var r=e(this).data("draggable"),i=r.options,s=e.extend({},n,{item:r.element});r.sortables=[],e(i.connectToSortable).each(function(){var n=e.data(this,"sortable");n&&!n.options.disabled&&(r.sortables.push({instance:n,shouldRevert:n.options.revert}),n._refreshItems(),n._trigger("activate",t,s))})},stop:function(t,n){var r=e(this).data("draggable"),i=e.extend({},n,{item:r.element});e.each(r.sortables,function(){this.instance.isOver?(this.instance.isOver=0,r.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,r.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,i))})},drag:function(t,n){var r=e(this).data("draggable"),i=this;e.each(r.sortables,function(){this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(i).clone().appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=r.offset.click.top,this.instance.offset.click.left=r.offset.click.left,this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top,r._trigger("toSortable",t),r.dropped=this.instance.element,r.currentItem=r.element,this.instance.fromOutside=r),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),r._trigger("fromSortable",t),r.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),n=e(this).data("draggable").options;t.css("cursor")&&(n._cursor=t.css("cursor")),t.css("cursor",n.cursor)},stop:function(){var t=e(this).data("draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","iframeFix",{start:function(){var t=e(this).data("draggable").options;e(t.iframeFix===!0?"iframe":t.iframeFix).each(function(){e('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")})},stop:function(){e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)})}}),e.ui.plugin.add("draggable","opacity",{start:function(t,n){t=e(n.helper),n=e(this).data("draggable").options,t.css("opacity")&&(n._opacity=t.css("opacity")),t.css("opacity",n.opacity)},stop:function(t,n){t=e(this).data("draggable").options,t._opacity&&e(n.helper).css("opacity",t._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("draggable");t.scrollParent[0]!=document&&t.scrollParent[0].tagName!="HTML"&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var n=e(this).data("draggable"),r=n.options,i=!1;if(n.scrollParent[0]!=document&&n.scrollParent[0].tagName!="HTML"){if(!r.axis||r.axis!="x")n.overflowOffset.top+n.scrollParent[0].offsetHeight-t.pageY<r.scrollSensitivity?n.scrollParent[0].scrollTop=i=n.scrollParent[0].scrollTop+r.scrollSpeed:t.pageY-n.overflowOffset.top<r.scrollSensitivity&&(n.scrollParent[0].scrollTop=i=n.scrollParent[0].scrollTop-r.scrollSpeed);if(!r.axis||r.axis!="y")n.overflowOffset.left+n.scrollParent[0].offsetWidth-t.pageX<r.scrollSensitivity?n.scrollParent[0].scrollLeft=i=n.scrollParent[0].scrollLeft+r.scrollSpeed:t.pageX-n.overflowOffset.left<r.scrollSensitivity&&(n.scrollParent[0].scrollLeft=i=n.scrollParent[0].scrollLeft-r.scrollSpeed)}else{if(!r.axis||r.axis!="x")t.pageY-e(document).scrollTop()<r.scrollSensitivity?i=e(document).scrollTop(e(document).scrollTop()-r.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<r.scrollSensitivity&&(i=e(document).scrollTop(e(document).scrollTop()+r.scrollSpeed));if(!r.axis||r.axis!="y")t.pageX-e(document).scrollLeft()<r.scrollSensitivity?i=e(document).scrollLeft(e(document).scrollLeft()-r.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<r.scrollSensitivity&&(i=e(document).scrollLeft(e(document).scrollLeft()+r.scrollSpeed))}i!==!1&&e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(n,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("draggable"),n=t.options;t.snapElements=[],e(n.snap.constructor!=String?n.snap.items||":data(draggable)":n.snap).each(function(){var n=e(this),r=n.offset();this!=t.element[0]&&t.snapElements.push({item:this,width:n.outerWidth(),height:n.outerHeight(),top:r.top,left:r.left})})},drag:function(t,n){for(var r=e(this).data("draggable"),i=r.options,s=i.snapTolerance,o=n.offset.left,u=o+r.helperProportions.width,a=n.offset.top,f=a+r.helperProportions.height,l=r.snapElements.length-1;l>=0;l--){var c=r.snapElements[l].left,h=c+r.snapElements[l].width,p=r.snapElements[l].top,d=p+r.snapElements[l].height;if(c-s<o&&o<h+s&&p-s<a&&a<d+s||c-s<o&&o<h+s&&p-s<f&&f<d+s||c-s<u&&u<h+s&&p-s<a&&a<d+s||c-s<u&&u<h+s&&p-s<f&&f<d+s){if(i.snapMode!="inner"){var v=Math.abs(p-f)<=s,m=Math.abs(d-a)<=s,g=Math.abs(c-u)<=s,y=Math.abs(h-o)<=s;v&&(n.position.top=r._convertPositionTo("relative",{top:p-r.helperProportions.height,left:0}).top-r.margins.top),m&&(n.position.top=r._convertPositionTo("relative",{top:d,left:0}).top-r.margins.top),g&&(n.position.left=r._convertPositionTo("relative",{top:0,left:c-r.helperProportions.width}).left-r.margins.left),y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h}).left-r.margins.left)}var w=v||m||g||y;i.snapMode!="outer"&&(v=Math.abs(p-a)<=s,m=Math.abs(d-f)<=s,g=Math.abs(c-o)<=s,y=Math.abs(h-u)<=s,v&&(n.position.top=r._convertPositionTo("relative",{top:p,left:0}).top-r.margins.top),m&&(n.position.top=r._convertPositionTo("relative",{top:d-r.helperProportions.height,left:0}).top-r.margins.top),g&&(n.position.left=r._convertPositionTo("relative",{top:0,left:c}).left-r.margins.left),y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h-r.helperProportions.width}).left-r.margins.left)),!r.snapElements[l].snapping&&(v||m||g||y||w)&&r.options.snap.snap&&r.options.snap.snap.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[l].item})),r.snapElements[l].snapping=v||m||g||y||w}else r.snapElements[l].snapping&&r.options.snap.release&&r.options.snap.release.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[l].item})),r.snapElements[l].snapping=!1}}}),e.ui.plugin.add("draggable","stack",{start:function(){var t=e(this).data("draggable").options;t=e.makeArray(e(t.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)});if(t.length){var n=parseInt(t[0].style.zIndex)||0;e(t).each(function(e){this.style.zIndex=n+e}),this[0].style.zIndex=n+t.length}}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,n){t=e(n.helper),n=e(this).data("draggable").options,t.css("zIndex")&&(n._zIndex=t.css("zIndex")),t.css("zIndex",n.zIndex)},stop:function(t,n){t=e(this).data("draggable").options,t._zIndex&&e(n.helper).css("zIndex",t._zIndex)}})}(jQuery),function(e){e.widget("ui.droppable",{widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var t=this.options,n=t.accept;this.isover=0,this.isout=1,this.accept=e.isFunction(n)?n:function(e){return e.is(n)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[],e.ui.ddmanager.droppables[t.scope].push(this),t.addClasses&&this.element.addClass("ui-droppable")},destroy:function(){for(var t=e.ui.ddmanager.droppables[this.options.scope],n=0;n<t.length;n++)t[n]==this&&t.splice(n,1);return this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable"),this},_setOption:function(t,n){t=="accept"&&(this.accept=e.isFunction(n)?n:function(e){return e.is(n)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),n&&this._trigger("activate",t,this.ui(n))},_deactivate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),n&&this._trigger("deactivate",t,this.ui(n))},_over:function(t){var n=e.ui.ddmanager.current;!!n&&(n.currentItem||n.element)[0]!=this.element[0]&&this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(n)))},_out:function(t){var n=e.ui.ddmanager.current;!!n&&(n.currentItem||n.element)[0]!=this.element[0]&&this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(n)))},_drop:function(t,n){var r=n||e.ui.ddmanager.current;if(!r||(r.currentItem||r.element)[0]==this.element[0])return!1;var i=!1;return this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"droppable");if(t.options.greedy&&!t.options.disabled&&t.options.scope==r.options.scope&&t.accept.call(t.element[0],r.currentItem||r.element)&&e.ui.intersect(r,e.extend(t,{offset:t.element.offset()}),t.options.tolerance))return i=!0,!1}),i?!1:this.accept.call(this.element[0],r.currentItem||r.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(r)),this.element):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.extend(e.ui.droppable,{version:"1.8.9"}),e.ui.intersect=function(t,n,r){if(!n.offset)return!1;var i=(t.positionAbs||t.position.absolute).left,s=i+t.helperProportions.width,o=(t.positionAbs||t.position.absolute).top,u=o+t.helperProportions.height,a=n.offset.left,f=a+n.proportions.width,l=n.offset.top,c=l+n.proportions.height;switch(r){case"fit":return a<=i&&s<=f&&l<=o&&u<=c;case"intersect":return a<i+t.helperProportions.width/2&&s-t.helperProportions.width/2<f&&l<o+t.helperProportions.height/2&&u-t.helperProportions.height/2<c;case"pointer":return e.ui.isOver((t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,l,a,n.proportions.height,n.proportions.width);case"touch":return(o>=l&&o<=c||u>=l&&u<=c||o<l&&u>c)&&(i>=a&&i<=f||s>=a&&s<=f||i<a&&s>f);default:return!1}},e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,n){var r=e.ui.ddmanager.droppables[t.options.scope]||[],i=n?n.type:null,s=(t.currentItem||t.element).find(":data(droppable)").andSelf(),o=0;e:for(;o<r.length;o++)if(!(r[o].options.disabled||t&&!r[o].accept.call(r[o].element[0],t.currentItem||t.element))){for(var u=0;u<s.length;u++)if(s[u]==r[o].element[0]){r[o].proportions.height=0;continue e}r[o].visible=r[o].element.css("display")!="none",r[o].visible&&(r[o].offset=r[o].element.offset(),r[o].proportions={width:r[o].element[0].offsetWidth,height:r[o].element[0].offsetHeight},i=="mousedown"&&r[o]._activate.call(r[o],n))}},drop:function(t,n){var r=!1;return e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(r=r||this._drop.call(this,n)),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,n)))}),r},drag:function(t,n){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,n),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!(this.options.disabled||this.greedyChild||!this.visible)){var r=e.ui.intersect(t,this,this.options.tolerance);if(r=!r&&this.isover==1?"isout":r&&this.isover==0?"isover":null){var i;if(this.options.greedy){var s=this.element.parents(":data(droppable):eq(0)");s.length&&(i=e.data(s[0],"droppable"),i.greedyChild=r=="isover"?1:0)}i&&r=="isover"&&(i.isover=0,i.isout=1,i._out.call(i,n)),this[r]=1,this[r=="isout"?"isover":"isout"]=0,this[r=="isover"?"_over":"_out"].call(this,n),i&&r=="isout"&&(i.isout=0,i.isover=1,i._over.call(i,n))}}})}}}(jQuery),function(e){e.widget("ui.resizable",e.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1e3},_create:function(){var t=this,n=this.options;this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!n.aspectRatio,aspectRatio:n.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:n.helper||n.ghost||n.animate?n.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(/relative/.test(this.element.css("position"))&&e.browser.opera&&this.element.css({position:"relative",top:"auto",left:"auto"}),this.element.wrap(e('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("resizable",this.element.data("resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=n.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se");if(this.handles.constructor==String){this.handles=="all"&&(this.handles="n,e,s,w,se,sw,ne,nw");var r=this.handles.split(",");this.handles={};for(var i=0;i<r.length;i++){var s=e.trim(r[i]),o=e('<div class="ui-resizable-handle '+("ui-resizable-"+s)+'"></div>');/sw|se|ne|nw/.test(s)&&o.css({zIndex:++n.zIndex}),"se"==s&&o.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[s]=".ui-resizable-"+s,this.element.append(o)}}this._renderAxis=function(t){t=t||this.element;for(var n in this.handles){this.handles[n].constructor==String&&(this.handles[n]=e(this.handles[n],this.element).show());if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var r=e(this.handles[n],this.element),i=0;i=/sw|ne|nw|se|n|s/.test(n)?r.outerHeight():r.outerWidth(),r=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join(""),t.css(r,i),this._proportionallyResize()}e(this.handles[n])}},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){if(!t.resizing){if(this.className)var e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);t.axis=e&&e[1]?e[1]:"se"}}),n.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").hover(function(){e(this).removeClass("ui-resizable-autohide"),t._handles.show()},function(){t.resizing||(e(this).addClass("ui-resizable-autohide"),t._handles.hide())})),this._mouseInit()},destroy:function(){this._mouseDestroy();var t=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){t(this.element);var n=this.element;n.after(this.originalElement.css({position:n.css("position"),width:n.outerWidth(),height:n.outerHeight(),top:n.css("top"),left:n.css("left")})).remove()}return this.originalElement.css("resize",this.originalResizeStyle),t(this.originalElement),this},_mouseCapture:function(t){var n=!1;for(var r in this.handles)e(this.handles[r])[0]==t.target&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(n){var r=this.options,i=this.element.position(),s=this.element;this.resizing=!0,this.documentScroll={top:e(document).scrollTop(),left:e(document).scrollLeft()},(s.is(".ui-draggable")||/absolute/.test(s.css("position")))&&s.css({position:"absolute",top:i.top,left:i.left}),e.browser.opera&&/relative/.test(s.css("position"))&&s.css({position:"relative",top:"auto",left:"auto"}),this._renderProxy(),i=t(this.helper.css("left"));var o=t(this.helper.css("top"));return r.containment&&(i+=e(r.containment).scrollLeft()||0,o+=e(r.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:o},this.size=this._helper?{width:s.outerWidth(),height:s.outerHeight()}:{width:s.width(),height:s.height()},this.originalSize=this._helper?{width:s.outerWidth(),height:s.outerHeight()}:{width:s.width(),height:s.height()},this.originalPosition={left:i,top:o},this.sizeDiff={width:s.outerWidth()-s.width(),height:s.outerHeight()-s.height()},this.originalMousePosition={left:n.pageX,top:n.pageY},this.aspectRatio=typeof r.aspectRatio=="number"?r.aspectRatio:this.originalSize.width/this.originalSize.height||1,r=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor",r=="auto"?this.axis+"-resize":r),s.addClass("ui-resizable-resizing"),this._propagate("start",n),!0},_mouseDrag:function(e){var t=this.helper,n=this.originalMousePosition,r=this._change[this.axis];if(!r)return!1;n=r.apply(this,[e,e.pageX-n.left||0,e.pageY-n.top||0]);if(this._aspectRatio||e.shiftKey)n=this._updateRatio(n,e);return n=this._respectSize(n,e),this._propagate("resize",e),t.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"}),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),this._updateCache(n),this._trigger("resize",e,this.ui()),!1},_mouseStop:function(t){this.resizing=!1;var n=this.options,r=this;if(this._helper){var i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName);i=s&&e.ui.hasScroll(i[0],"left")?0:r.sizeDiff.height,s={width:r.size.width-(s?0:r.sizeDiff.width),height:r.size.height-i},i=parseInt(r.element.css("left"),10)+(r.position.left-r.originalPosition.left)||null;var o=parseInt(r.element.css("top"),10)+(r.position.top-r.originalPosition.top)||null;n.animate||this.element.css(e.extend(s,{top:o,left:i})),r.helper.height(r.size.height),r.helper.width(r.size.width),this._helper&&!n.animate&&this._proportionallyResize()}return e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateCache:function(e){this.offset=this.helper.offset(),n(e.left)&&(this.position.left=e.left),n(e.top)&&(this.position.top=e.top),n(e.height)&&(this.size.height=e.height),n(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,n=this.size,r=this.axis;return e.height?e.width=n.height*this.aspectRatio:e.width&&(e.height=n.width/this.aspectRatio),r=="sw"&&(e.left=t.left+(n.width-e.width),e.top=null),r=="nw"&&(e.top=t.top+(n.height-e.height),e.left=t.left+(n.width-e.width)),e},_respectSize:function(e){var t=this.options,r=this.axis,i=n(e.width)&&t.maxWidth&&t.maxWidth<e.width,s=n(e.height)&&t.maxHeight&&t.maxHeight<e.height,o=n(e.width)&&t.minWidth&&t.minWidth>e.width,u=n(e.height)&&t.minHeight&&t.minHeight>e.height;o&&(e.width=t.minWidth),u&&(e.height=t.minHeight),i&&(e.width=t.maxWidth),s&&(e.height=t.maxHeight);var a=this.originalPosition.left+this.originalSize.width,l=this.position.top+this.size.height,c=/sw|nw|w/.test(r);return r=/nw|ne|n/.test(r),o&&c&&(e.left=a-t.minWidth),i&&c&&(e.left=a-t.maxWidth),u&&r&&(e.top=l-t.minHeight),s&&r&&(e.top=l-t.maxHeight),(t=!e.width&&!e.height)&&!e.left&&e.top?e.top=null:t&&!e.top&&e.left&&(e.left=null),e},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var t=this.helper||this.element,n=0;n<this._proportionallyResizeElements.length;n++){var r=this._proportionallyResizeElements[n];if(!this.borderDif){var i=[r.css("borderTopWidth"),r.css("borderRightWidth"),r.css("borderBottomWidth"),r.css("borderLeftWidth")],s=[r.css("paddingTop"),r.css("paddingRight"),r.css("paddingBottom"),r.css("paddingLeft")];this.borderDif=e.map(i,function(e,t){return e=parseInt(e,10)||0,t=parseInt(s[t],10)||0,e+t})}e.browser.msie&&(e(t).is(":hidden")||e(t).parents(":hidden").length)||r.css({height:t.height()-this.borderDif[0]-this.borderDif[2]||0,width:t.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var t=this.options;this.elementOffset=this.element.offset();if(this._helper){this.helper=this.helper||e('<div style="overflow:hidden;"></div>');var n=e.browser.msie&&e.browser.version<7,r=n?1:0;n=n?2:-1,this.helper.addClass(this._helper).css({width:this.element.outerWidth()+n,height:this.element.outerHeight()+n,position:"absolute",left:this.elementOffset.left-r+"px",top:this.elementOffset.top-r+"px",zIndex:++t.zIndex}),this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){return{left:this.originalPosition.left+t,width:this.originalSize.width-t}},n:function(e,t,n){return{top:this.originalPosition.top+n,height:this.originalSize.height-n}},s:function(e,t,n){return{height:this.originalSize.height+n}},se:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},sw:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,n,r]))},ne:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},nw:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,n,r]))}},_propagate:function(t,n){e.ui.plugin.call(this,t,[n,this.ui()]),t!="resize"&&this._trigger(t,n,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.extend(e.ui.resizable,{version:"1.8.9"}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("resizable").options,n=function(t){e(t).each(function(){var t=e(this);t.data("resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10),position:t.css("position")})})};typeof t.alsoResize=="object"&&!t.alsoResize.parentNode?t.alsoResize.length?(t.alsoResize=t.alsoResize[0],n(t.alsoResize)):e.each(t.alsoResize,function(e){n(e)}):n(t.alsoResize)},resize:function(t,n){var r=e(this).data("resizable");t=r.options;var i=r.originalSize,s=r.originalPosition,o={height:r.size.height-i.height||0,width:r.size.width-i.width||0,top:r.position.top-s.top||0,left:r.position.left-s.left||0},u=function(t,i){e(t).each(function(){var t=e(this),s=e(this).data("resizable-alsoresize"),u={},f=i&&i.length?i:t.parents(n.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(f,function(e,t){(e=(s[t]||0)+(o[t]||0))&&e>=0&&(u[t]=e||null)}),e.browser.opera&&/relative/.test(t.css("position"))&&(r._revertToRelativePosition=!0,t.css({position:"absolute",top:"auto",left:"auto"})),t.css(u)})};typeof t.alsoResize=="object"&&!t.alsoResize.nodeType?e.each(t.alsoResize,function(e,t){u(e,t)}):u(t.alsoResize)},stop:function(){var t=e(this).data("resizable"),n=t.options,r=function(t){e(t).each(function(){var t=e(this);t.css({position:t.data("resizable-alsoresize").position})})};t._revertToRelativePosition&&(t._revertToRelativePosition=!1,typeof n.alsoResize=="object"&&!n.alsoResize.nodeType?e.each(n.alsoResize,function(e){r(e)}):r(n.alsoResize)),e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var n=e(this).data("resizable"),r=n.options,i=n._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),o=s&&e.ui.hasScroll(i[0],"left")?0:n.sizeDiff.height;s={width:n.size.width-(s?0:n.sizeDiff.width),height:n.size.height-o},o=parseInt(n.element.css("left"),10)+(n.position.left-n.originalPosition.left)||null;var u=parseInt(n.element.css("top"),10)+(n.position.top-n.originalPosition.top)||null;n.element.animate(e.extend(s,u&&o?{top:u,left:o}:{}),{duration:r.animateDuration,easing:r.animateEasing,step:function(){var r={width:parseInt(n.element.css("width"),10),height:parseInt(n.element.css("height"),10),top:parseInt(n.element.css("top"),10),left:parseInt(n.element.css("left"),10)};i&&i.length&&e(i[0]).css({width:r.width,height:r.height}),n._updateCache(r),n._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var n=e(this).data("resizable"),r=n.element,i=n.options.containment;if(r=i instanceof e?i.get(0):/parent/.test(i)?r.parent().get(0):i){n.containerElement=e(r);if(/document/.test(i)||i==document)n.containerOffset={left:0,top:0},n.containerPosition={left:0,top:0},n.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight};else{var s=e(r),o=[];e(["Top","Right","Left","Bottom"]).each(function(e,n){o[e]=t(s.css("padding"+n))}),n.containerOffset=s.offset(),n.containerPosition=s.position(),n.containerSize={height:s.innerHeight()-o[3],width:s.innerWidth()-o[1]},i=n.containerOffset;var u=n.containerSize.height,a=n.containerSize.width;a=e.ui.hasScroll(r,"left")?r.scrollWidth:a,u=e.ui.hasScroll(r)?r.scrollHeight:u,n.parentData={element:r,left:i.left,top:i.top,width:a,height:u}}}},resize:function(t){var n=e(this).data("resizable"),r=n.options,i=n.containerOffset,s=n.position;t=n._aspectRatio||t.shiftKey;var o={top:0,left:0},u=n.containerElement;u[0]!=document&&/static/.test(u.css("position"))&&(o=i),s.left<(n._helper?i.left:0)&&(n.size.width+=n._helper?n.position.left-i.left:n.position.left-o.left,t&&(n.size.height=n.size.width/r.aspectRatio),n.position.left=r.helper?i.left:0),s.top<(n._helper?i.top:0)&&(n.size.height+=n._helper?n.position.top-i.top:n.position.top,t&&(n.size.width=n.size.height*r.aspectRatio),n.position.top=n._helper?i.top:0),n.offset.left=n.parentData.left+n.position.left,n.offset.top=n.parentData.top+n.position.top,r=Math.abs((n._helper?n.offset.left-o.left:n.offset.left-o.left)+n.sizeDiff.width),i=Math.abs((n._helper?n.offset.top-o.top:n.offset.top-i.top)+n.sizeDiff.height),s=n.containerElement.get(0)==n.element.parent().get(0),o=/relative|absolute/.test(n.containerElement.css("position")),s&&o&&(r-=n.parentData.left),r+n.size.width>=n.parentData.width&&(n.size.width=n.parentData.width-r,t&&(n.size.height=n.size.width/n.aspectRatio)),i+n.size.height>=n.parentData.height&&(n.size.height=n.parentData.height-i,t&&(n.size.width=n.size.height*n.aspectRatio))},stop:function(){var t=e(this).data("resizable"),n=t.options,r=t.containerOffset,i=t.containerPosition,s=t.containerElement,o=e(t.helper),u=o.offset(),a=o.outerWidth()-t.sizeDiff.width;o=o.outerHeight()-t.sizeDiff.height,t._helper&&!n.animate&&/relative/.test(s.css("position"))&&e(this).css({left:u.left-i.left-r.left,width:a,height:o}),t._helper&&!n.animate&&/static/.test(s.css("position"))&&e(this).css({left:u.left-i.left-r.left,width:a,height:o})}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("resizable"),n=t.options,r=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:r.height,width:r.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof n.ghost=="string"?n.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).data("resizable");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).data("resizable");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t=e(this).data("resizable"),n=t.options,r=t.size,i=t.originalSize,s=t.originalPosition,o=t.axis;n.grid=typeof n.grid=="number"?[n.grid,n.grid]:n.grid;var u=Math.round((r.width-i.width)/(n.grid[0]||1))*(n.grid[0]||1);n=Math.round((r.height-i.height)/(n.grid[1]||1))*(n.grid[1]||1),/^(se|s|e)$/.test(o)?(t.size.width=i.width+u,t.size.height=i.height+n):/^(ne)$/.test(o)?(t.size.width=i.width+u,t.size.height=i.height+n,t.position.top=s.top-n):(/^(sw)$/.test(o)?(t.size.width=i.width+u,t.size.height=i.height+n):(t.size.width=i.width+u,t.size.height=i.height+n,t.position.top=s.top-n),t.position.left=s.left-u)}});var t=function(e){return parseInt(e,10)||0},n=function(e){return!isNaN(parseInt(e,10))}}(jQuery),function(e){e.widget("ui.selectable",e.ui.mouse,{options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch"},_create:function(){var t=this;this.element.addClass("ui-selectable"),this.dragged=!1;var n;this.refresh=function(){n=e(t.options.filter,t.element[0]),n.each(function(){var t=e(this),n=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:n.left,top:n.top,right:n.left+t.outerWidth(),bottom:n.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=n.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},destroy:function(){return this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled").removeData("selectable").unbind(".selectable"),this._mouseDestroy(),this},_mouseStart:function(t){var n=this;this.opos=[t.pageX,t.pageY];if(!this.options.disabled){var r=this.options;this.selectees=e(r.filter,this.element[0]),this._trigger("start",t),e(r.appendTo).append(this.helper),this.helper.css({left:t.clientX,top:t.clientY,width:0,height:0}),r.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var r=e.data(this,"selectable-item");r.startselected=!0,t.metaKey||(r.$element.removeClass("ui-selected"),r.selected=!1,r.$element.addClass("ui-unselecting"),r.unselecting=!0,n._trigger("unselecting",t,{unselecting:r.element}))}),e(t.target).parents().andSelf().each(function(){var r=e.data(this,"selectable-item");if(r){var i=!t.metaKey||!r.$element.hasClass("ui-selected");return r.$element.removeClass(i?"ui-unselecting":"ui-selected").addClass(i?"ui-selecting":"ui-unselecting"),r.unselecting=!i,r.selecting=i,(r.selected=i)?n._trigger("selecting",t,{selecting:r.element}):n._trigger("unselecting",t,{unselecting:r.element}),!1}})}},_mouseDrag:function(t){var n=this;this.dragged=!0;if(!this.options.disabled){var r=this.options,i=this.opos[0],s=this.opos[1],o=t.pageX,u=t.pageY;if(i>o){var a=o;o=i,i=a}return s>u&&(a=u,u=s,s=a),this.helper.css({left:i,top:s,width:o-i,height:u-s}),this.selectees.each(function(){var a=e.data(this,"selectable-item");if(!!a&&a.element!=n.element[0]){var l=!1;r.tolerance=="touch"?l=!(a.left>o||a.right<i||a.top>u||a.bottom<s):r.tolerance=="fit"&&(l=a.left>i&&a.right<o&&a.top>s&&a.bottom<u),l?(a.selected&&(a.$element.removeClass("ui-selected"),a.selected=!1),a.unselecting&&(a.$element.removeClass("ui-unselecting"),a.unselecting=!1),a.selecting||(a.$element.addClass("ui-selecting"),a.selecting=!0,n._trigger("selecting",t,{selecting:a.element}))):(a.selecting&&(t.metaKey&&a.startselected?(a.$element.removeClass("ui-selecting"),a.selecting=!1,a.$element.addClass("ui-selected"),a.selected=!0):(a.$element.removeClass("ui-selecting"),a.selecting=!1,a.startselected&&(a.$element.addClass("ui-unselecting"),a.unselecting=!0),n._trigger("unselecting",t,{unselecting:a.element}))),a.selected&&!t.metaKey&&!a.startselected&&(a.$element.removeClass("ui-selected"),a.selected=!1,a.$element.addClass("ui-unselecting"),a.unselecting=!0,n._trigger("unselecting",t,{unselecting:a.element})))}}),!1}},_mouseStop:function(t){var n=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-unselecting"),r.unselecting=!1,r.startselected=!1,n._trigger("unselected",t,{unselected:r.element})}),e(".ui-selecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-selecting").addClass("ui-selected"),r.selecting=!1,r.selected=!0,r.startselected=!0,n._trigger("selected",t,{selected:r.element})}),this._trigger("stop",t),this.helper.remove(),!1}}),e.extend(e.ui.selectable,{version:"1.8.9"})}(jQuery),function(e){e.widget("ui.sortable",e.ui.mouse,{widgetEventPrefix:"sort",options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?/left|right/.test(this.items[0].item.css("float")):!1,this.offset=this.element.offset(),this._mouseInit()},destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").removeData("sortable").unbind(".sortable"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData("sortable-item");return this},_setOption:function(t,n){t==="disabled"?(this.options[t]=n,this.widget()[n?"addClass":"removeClass"]("ui-sortable-disabled")):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,n){if(this.reverting)return!1;if(this.options.disabled||this.options.type=="static")return!1;this._refreshItems(t);var r=null,i=this;e(t.target).parents().each(function(){if(e.data(this,"sortable-item")==i)return r=e(this),!1}),e.data(t.target,"sortable-item")==i&&(r=e(t.target));if(!r)return!1;if(this.options.handle&&!n){var s=!1;e(this.options.handle,r).find("*").andSelf().each(function(){this==t.target&&(s=!0)});if(!s)return!1}return this.currentItem=r,this._removeCurrentsFromItems(),!0},_mouseStart:function(t,n,r){n=this.options;var i=this;this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),n.containment&&this._setContainment(),n.cursor&&(e("body").css("cursor")&&(this._storedCursor=e("body").css("cursor")),e("body").css("cursor",n.cursor)),n.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",n.opacity)),n.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",n.zIndex)),this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions();if(!r)for(r=this.containers.length-1;r>=0;r--)this.containers[r]._trigger("activate",t,i._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);if(this.options.scroll){var n=this.options,r=!1;this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<n.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+n.scrollSpeed:t.pageY-this.overflowOffset.top<n.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-n.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<n.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+n.scrollSpeed:t.pageX-this.overflowOffset.left<n.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-n.scrollSpeed)):(t.pageY-e(document).scrollTop()<n.scrollSensitivity?r=e(document).scrollTop(e(document).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<n.scrollSensitivity&&(r=e(document).scrollTop(e(document).scrollTop()+n.scrollSpeed)),t.pageX-e(document).scrollLeft()<n.scrollSensitivity?r=e(document).scrollLeft(e(document).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<n.scrollSensitivity&&(r=e(document).scrollLeft(e(document).scrollLeft()+n.scrollSpeed))),r!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";for(n=this.items.length-1;n>=0;n--){r=this.items[n];var i=r.item[0],s=this._intersectsWithPointer(r);if(s&&i!=this.currentItem[0]&&this.placeholder[s==1?"next":"prev"]()[0]!=i&&!e.ui.contains(this.placeholder[0],i)&&(this.options.type=="semi-dynamic"?!e.ui.contains(this.element[0],i):!0)){this.direction=s==1?"down":"up";if(this.options.tolerance!="pointer"&&!this._intersectsWithSides(r))break;this._rearrange(t,r),this._trigger("change",t,this._uiHash());break}}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,n){if(t){e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t);if(this.options.revert){var r=this;n=r.placeholder.offset(),r.reverting=!0,e(this.helper).animate({left:n.left-this.offset.parent.left-r.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:n.top-this.offset.parent.top-r.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){r._clear(t)})}else this._clear(t,n);return!1}},cancel:function(){var t=this;if(this.dragging){this._mouseUp({target:null}),this.options.helper=="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("deactivate",null,t._uiHash(this)),this.containers[n].containerCache.over&&(this.containers[n]._trigger("out",null,t._uiHash(this)),this.containers[n].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.options.helper!="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},e(n).each(function(){var n=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/);n&&r.push((t.key||n[1]+"[]")+"="+(t.key&&t.expression?n[1]:n[2]))}),!r.length&&t.key&&r.push(t.key+"="),r.join("&")},toArray:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},n.each(function(){r.push(e(t.item||this).attr(t.attribute||"id")||"")}),r},_intersectsWith:function(e){var t=this.positionAbs.left,n=t+this.helperProportions.width,r=this.positionAbs.top,i=r+this.helperProportions.height,s=e.left,o=s+e.width,u=e.top,a=u+e.height,f=this.offset.click.top,l=this.offset.click.left;return f=r+f>u&&r+f<a&&t+l>s&&t+l<o,this.options.tolerance=="pointer"||this.options.forcePointerForContainers||this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?f:s<t+this.helperProportions.width/2&&n-this.helperProportions.width/2<o&&u<r+this.helperProportions.height/2&&i-this.helperProportions.height/2<a},_intersectsWithPointer:function(t){var n=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height);t=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),n=n&&t,t=this._getDragVerticalDirection();var r=this._getDragHorizontalDirection();return n?this.floating?r&&r=="right"||t=="down"?2:1:t&&(t=="down"?2:1):!1},_intersectsWithSides:function(t){var n=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height);t=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width);var r=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection();return this.floating&&i?i=="right"&&t||i=="left"&&!t:r&&(r=="down"&&n||r=="up"&&!n)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return e!=0&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return e!=0&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor==String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var n=[],r=[],i=this._connectWith();if(i&&t)for(t=i.length-1;t>=0;t--)for(var s=e(i[t]),o=s.length-1;o>=0;o--){var u=e.data(s[o],"sortable");u&&u!=this&&!u.options.disabled&&r.push([e.isFunction(u.options.items)?u.options.items.call(u.element):e(u.options.items,u.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),u])}r.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(t=r.length-1;t>=0;t--)r[t][0].each(function(){n.push(this)});return e(n)},_removeCurrentsFromItems:function(){for(var e=this.currentItem.find(":data(sortable-item)"),t=0;t<this.items.length;t++)for(var n=0;n<e.length;n++)e[n]==this.items[t].item[0]&&this.items.splice(t,1)},_refreshItems:function(t){this.items=[],this.containers=[this];var n=this.items,r=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],i=this._connectWith();if(i)for(var s=i.length-1;s>=0;s--)for(var o=e(i[s]),u=o.length-1;u>=0;u--){var a=e.data(o[u],"sortable");a&&a!=this&&!a.options.disabled&&(r.push([e.isFunction(a.options.items)?a.options.items.call(a.element[0],t,{item:this.currentItem}):e(a.options.items,a.element),a]),this.containers.push(a))}for(s=r.length-1;s>=0;s--){t=r[s][1],i=r[s][0],u=0;for(o=i.length;u<o;u++)a=e(i[u]),a.data("sortable-item",t),n.push({item:a,instance:t,width:0,height:0,left:0,top:0})}},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var n=this.items.length-1;n>=0;n--){var r=this.items[n],i=this.options.toleranceElement?e(this.options.toleranceElement,r.item):r.item;t||(r.width=i.outerWidth(),r.height=i.outerHeight()),i=i.offset(),r.left=i.left,r.top=i.top}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(n=this.containers.length-1;n>=0;n--)i=this.containers[n].element.offset(),this.containers[n].containerCache.left=i.left,this.containers[n].containerCache.top=i.top,this.containers[n].containerCache.width=this.containers[n].element.outerWidth(),this.containers[n].containerCache.height=this.containers[n].element.outerHeight();return this},_createPlaceholder:function(t){var n=t||this,r=n.options;if(!r.placeholder||r.placeholder.constructor==String){var i=r.placeholder;r.placeholder={element:function(){var t=e(document.createElement(n.currentItem[0].nodeName)).addClass(i||n.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return i||(t.style.visibility="hidden"),t},update:function(e,t){if(!i||!!r.forcePlaceholderSize)t.height()||t.height(n.currentItem.innerHeight()-parseInt(n.currentItem.css("paddingTop")||0,10)-parseInt(n.currentItem.css("paddingBottom")||0,10)),t.width()||t.width(n.currentItem.innerWidth()-parseInt(n.currentItem.css("paddingLeft")||0,10)-parseInt(n.currentItem.css("paddingRight")||0,10))}}}n.placeholder=e(r.placeholder.element.call(n.element,n.currentItem)),n.currentItem.after(n.placeholder),r.placeholder.update(n,n.placeholder)},_contactContainers:function(t){for(var n=null,r=null,i=this.containers.length-1;i>=0;i--)if(!e.ui.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(!n||!e.ui.contains(this.containers[i].element[0],n.element[0]))n=this.containers[i],r=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0);if(n)if(this.containers.length===1)this.containers[r]._trigger("over",t,this._uiHash(this)),this.containers[r].containerCache.over=1;else if(this.currentContainer!=this.containers[r]){n=1e4,i=null;for(var s=this.positionAbs[this.containers[r].floating?"left":"top"],o=this.items.length-1;o>=0;o--)if(e.ui.contains(this.containers[r].element[0],this.items[o].item[0])){var u=this.items[o][this.containers[r].floating?"left":"top"];Math.abs(u-s)<n&&(n=Math.abs(u-s),i=this.items[o])}if(i||this.options.dropOnEmpty)this.currentContainer=this.containers[r],i?this._rearrange(t,i,null,!0):this._rearrange(t,null,this.containers[r].element,!0),this._trigger("change",t,this._uiHash()),this.containers[r]._trigger("change",t,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[r]._trigger("over",t,this._uiHash(this)),this.containers[r].containerCache.over=1}},_createHelper:function(t){var n=this.options;return t=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t,this.currentItem])):n.helper=="clone"?this.currentItem.clone():this.currentItem,t.parents("body").length||e(n.appendTo!="parent"?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(t[0]),t[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(t[0].style.width==""||n.forceHelperSize)&&t.width(this.currentItem.width()),(t[0].style.height==""||n.forceHelperSize)&&t.height(this.currentItem.height()),t},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e.browser.msie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;t.containment=="parent"&&(t.containment=this.helper[0].parentNode);if(t.containment=="document"||t.containment=="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(e(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(t.containment)){var n=e(t.containment)[0];t=e(t.containment).offset();var r=e(n).css("overflow")!="hidden";this.containment=[t.left+(parseInt(e(n).css("borderLeftWidth"),10)||0)+(parseInt(e(n).css("paddingLeft"),10)||0)-this.margins.left,t.top+(parseInt(e(n).css("borderTopWidth"),10)||0)+(parseInt(e(n).css("paddingTop"),10)||0)-this.margins.top,t.left+(r?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(e(n).css("borderLeftWidth"),10)||0)-(parseInt(e(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,t.top+(r?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(e(n).css("borderTopWidth"),10)||0)-(parseInt(e(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(t,n){n||(n=this.position),t=t=="absolute"?1:-1;var r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(r[0].tagName);return{top:n.top+this.offset.relative.top*t+this.offset.parent.top*t-(e.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop())*t),left:n.left+this.offset.relative.left*t+this.offset.parent.left*t-(e.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())*t)}},_generatePosition:function(t){var n=this.options,r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(r[0].tagName);this.cssPosition=="relative"&&(this.scrollParent[0]==document||this.scrollParent[0]==this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset());var s=t.pageX,o=t.pageY;return this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(s=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(s=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),n.grid&&(o=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1],o=this.containment?o-this.offset.click.top<this.containment[1]||o-this.offset.click.top>this.containment[3]?o-this.offset.click.top<this.containment[1]?o+n.grid[1]:o-n.grid[1]:o:o,s=this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0],s=this.containment?s-this.offset.click.left<this.containment[0]||s-this.offset.click.left>this.containment[2]?s-this.offset.click.left<this.containment[0]?s+n.grid[0]:s-n.grid[0]:s:s)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(e.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(e.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_rearrange:function(e,t,n,r){n?n[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],this.direction=="down"?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var i=this,s=this.counter;window.setTimeout(function(){s==i.counter&&i.refreshPositions(!r)},0)},_clear:function(t,n){this.reverting=!1;var r=[];!this._noFinalSort&&this.currentItem[0].parentNode&&this.placeholder.before(this.currentItem),this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var i in this._storedCSS)if(this._storedCSS[i]=="auto"||this._storedCSS[i]=="static")this._storedCSS[i]="";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!n&&r.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!n&&r.push(function(e){this._trigger("update",e,this._uiHash())});if(!e.ui.contains(this.element[0],this.currentItem[0])){n||r.push(function(e){this._trigger("remove",e,this._uiHash())});for(i=this.containers.length-1;i>=0;i--)e.ui.contains(this.containers[i].element[0],this.currentItem[0])&&!n&&(r.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.containers[i])),r.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.containers[i])))}for(i=this.containers.length-1;i>=0;i--)n||r.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over&&(r.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over=0);this._storedCursor&&e("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex),this.dragging=!1;if(this.cancelHelperRemoval){if(!n){this._trigger("beforeStop",t,this._uiHash());for(i=0;i<r.length;i++)r[i].call(this,t);this._trigger("stop",t,this._uiHash())}return!1}n||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null;if(!n){for(i=0;i<r.length;i++)r[i].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var n=t||this;return{helper:n.helper,placeholder:n.placeholder||e([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:t?t.element:null}}}),e.extend(e.ui.sortable,{version:"1.8.9"})}(jQuery),jQuery.effects||function(e,t){function n(t){var n;return t&&t.constructor==Array&&t.length==3?t:(n=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(t))?[parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10)]:(n=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(t))?[parseFloat(n[1])*2.55,parseFloat(n[2])*2.55,parseFloat(n[3])*2.55]:(n=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(t))?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:(n=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(t))?[parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16),parseInt(n[3]+n[3],16)]:/rgba\(0, 0, 0, 0\)/.exec(t)?f.transparent:f[e.trim(t).toLowerCase()]}function r(t,r){var i;do{i=e.curCSS(t,r);if(i!=""&&i!="transparent"||e.nodeName(t,"body"))break;r="backgroundColor"}while(t=t.parentNode);return n(i)}function i(){var e=document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle,t={},n,r;if(e&&e.length&&e[0]&&e[e[0]])for(var i=e.length;i--;)n=e[i],typeof e[n]=="string"&&(r=n.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()}),t[r]=e[n]);else for(n in e)typeof e[n]=="string"&&(t[n]=e[n]);return t}function s(t){var n,r;for(n in t)r=t[n],(r==null||e.isFunction(r)||n in c||/scrollbar/.test(n)||!/color/i.test(n)&&isNaN(parseFloat(r)))&&delete t[n];return t}function o(e,t){var n={_:0},r;for(r in t)e[r]!=t[r]&&(n[r]=t[r]);return n}function u(t,n,r,i){typeof t=="object"&&(i=n,r=null,n=t,t=n.effect),e.isFunction(n)&&(i=n,r=null,n={});if(typeof n=="number"||e.fx.speeds[n])i=r,r=n,n={};return e.isFunction(r)&&(i=r,r=null),n=n||{},r=r||n.duration,r=e.fx.off?0:typeof r=="number"?r:r in e.fx.speeds?e.fx.speeds[r]:e.fx.speeds._default,i=i||n.complete,[t,n,r,i]}function a(t){return!t||typeof t=="number"||e.fx.speeds[t]?!0:typeof t=="string"&&!e.effects[t]?!0:!1}e.effects={},e.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","borderColor","color","outlineColor"],function(t,i){e.fx.step[i]=function(e){e.colorInit||(e.start=r(e.elem,i),e.end=n(e.end),e.colorInit=!0),e.elem.style[i]="rgb("+Math.max(Math.min(parseInt(e.pos*(e.end[0]-e.start[0])+e.start[0],10),255),0)+","+Math.max(Math.min(parseInt(e.pos*(e.end[1]-e.start[1])+e.start[1],10),255),0)+","+Math.max(Math.min(parseInt(e.pos*(e.end[2]-e.start[2])+e.start[2],10),255),0)+")"}});var f={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]},l=["add","remove","toggle"],c={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.effects.animateClass=function(t,n,r,u){return e.isFunction(r)&&(u=r,r=null),this.queue("fx",function(){var a=e(this),f=a.attr("style")||" ",c=s(i.call(this)),h,p=a.attr("className");e.each(l,function(e,n){t[n]&&a[n+"Class"](t[n])}),h=s(i.call(this)),a.attr("className",p),a.animate(o(c,h),n,r,function(){e.each(l,function(e,n){t[n]&&a[n+"Class"](t[n])}),typeof a.attr("style")=="object"?(a.attr("style").cssText="",a.attr("style").cssText=f):a.attr("style",f),u&&u.apply(this,arguments)}),c=e.queue(this),h=c.splice(c.length-1,1)[0],c.splice(1,0,h),e.dequeue(this)})},e.fn.extend({_addClass:e.fn.addClass,addClass:function(t,n,r,i){return n?e.effects.animateClass.apply(this,[{add:t},n,r,i]):this._addClass(t)},_removeClass:e.fn.removeClass,removeClass:function(t,n,r,i){return n?e.effects.animateClass.apply(this,[{remove:t},n,r,i]):this._removeClass(t)},_toggleClass:e.fn.toggleClass,toggleClass:function(n,r,i,s,o){return typeof r=="boolean"||r===t?i?e.effects.animateClass.apply(this,[r?{add:n}:{remove:n},i,s,o]):this._toggleClass(n,r):e.effects.animateClass.apply(this,[{toggle:n},r,i,s])},switchClass:function(t,n,r,i,s){return e.effects.animateClass.apply(this,[{add:n,remove:t},r,i,s])}}),e.extend(e.effects,{version:"1.8.9",save:function(e,t){for(var n=0;n<t.length;n++)t[n]!==null&&e.data("ec.storage."+t[n],e[0].style[t[n]])},restore:function(e,t){for(var n=0;n<t.length;n++)t[n]!==null&&e.css(t[n],e.data("ec.storage."+t[n]))},setMode:function(e,t){return t=="toggle"&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var n;switch(e[0]){case"top":n=0;break;case"middle":n=.5;break;case"bottom":n=1;break;default:n=e[0]/t.height}switch(e[1]){case"left":e=0;break;case"center":e=.5;break;case"right":e=1;break;default:e=e[1]/t.width}return{x:e,y:n}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var n={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},r=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0});return t.wrap(r),r=t.parent(),t.css("position")=="static"?(r.css({position:"relative"}),t.css({position:"relative"})):(e.extend(n,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,r){n[r]=t.css(r),isNaN(parseInt(n[r],10))&&(n[r]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),r.css(n).show()},removeWrapper:function(e){return e.parent().is(".ui-effects-wrapper")?e.parent().replaceWith(e):e},setTransition:function(t,n,r,i){return i=i||{},e.each(n,function(e,n){unit=t.cssUnit(n),unit[0]>0&&(i[n]=unit[0]*r+unit[1])}),i}}),e.fn.extend({effect:function(t){var n=u.apply(this,arguments),r={options:n[1],duration:n[2],callback:n[3]};n=r.options.mode;var i=e.effects[t];return e.fx.off||!i?n?this[n](r.duration,r.callback):this.each(function(){r.callback&&r.callback.call(this)}):i.call(this,r)},_show:e.fn.show,show:function(e){if(a(e))return this._show.apply(this,arguments);var t=u.apply(this,arguments);return t[1].mode="show",this.effect.apply(this,t)},_hide:e.fn.hide,hide:function(e){if(a(e))return this._hide.apply(this,arguments);var t=u.apply(this,arguments);return t[1].mode="hide",this.effect.apply(this,t)},__toggle:e.fn.toggle,toggle:function(t){if(a(t)||typeof t=="boolean"||e.isFunction(t))return this.__toggle.apply(this,arguments);var n=u.apply(this,arguments);return n[1].mode="toggle",this.effect.apply(this,n)},cssUnit:function(t){var n=this.css(t),r=[];return e.each(["em","px","%","pt"],function(e,t){n.indexOf(t)>0&&(r=[parseFloat(n),t])}),r}}),e.easing.jswing=e.easing.swing,e.extend(e.easing,{def:"easeOutQuad",swing:function(t,n,r,i,s){return e.easing[e.easing.def](t,n,r,i,s)},easeInQuad:function(e,t,n,r,i){return r*(t/=i)*t+n},easeOutQuad:function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n},easeInOutQuad:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t+n:-r/2*(--t*(t-2)-1)+n},easeInCubic:function(e,t,n,r,i){return r*(t/=i)*t*t+n},easeOutCubic:function(e,t,n,r,i){return r*((t=t/i-1)*t*t+1)+n},easeInOutCubic:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t+n:r/2*((t-=2)*t*t+2)+n},easeInQuart:function(e,t,n,r,i){return r*(t/=i)*t*t*t+n},easeOutQuart:function(e,t,n,r,i){return-r*((t=t/i-1)*t*t*t-1)+n},easeInOutQuart:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t+n:-r/2*((t-=2)*t*t*t-2)+n},easeInQuint:function(e,t,n,r,i){return r*(t/=i)*t*t*t*t+n},easeOutQuint:function(e,t,n,r,i){return r*((t=t/i-1)*t*t*t*t+1)+n},easeInOutQuint:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t*t+n:r/2*((t-=2)*t*t*t*t+2)+n},easeInSine:function(e,t,n,r,i){return-r*Math.cos(t/i*(Math.PI/2))+r+n},easeOutSine:function(e,t,n,r,i){return r*Math.sin(t/i*(Math.PI/2))+n},easeInOutSine:function(e,t,n,r,i){return-r/2*(Math.cos(Math.PI*t/i)-1)+n},easeInExpo:function(e,t,n,r,i){return t==0?n:r*Math.pow(2,10*(t/i-1))+n},easeOutExpo:function(e,t,n,r,i){return t==i?n+r:r*(-Math.pow(2,-10*t/i)+1)+n},easeInOutExpo:function(e,t,n,r,i){return t==0?n:t==i?n+r:(t/=i/2)<1?r/2*Math.pow(2,10*(t-1))+n:r/2*(-Math.pow(2,-10*--t)+2)+n},easeInCirc:function(e,t,n,r,i){return-r*(Math.sqrt(1-(t/=i)*t)-1)+n},easeOutCirc:function(e,t,n,r,i){return r*Math.sqrt(1-(t=t/i-1)*t)+n},easeInOutCirc:function(e,t,n,r,i){return(t/=i/2)<1?-r/2*(Math.sqrt(1-t*t)-1)+n:r/2*(Math.sqrt(1-(t-=2)*t)+1)+n},easeInElastic:function(e,t,n,r,i){e=1.70158;var s=0,o=r;return t==0?n:(t/=i)==1?n+r:(s||(s=i*.3),o<Math.abs(r)?(o=r,e=s/4):e=s/(2*Math.PI)*Math.asin(r/o),-(o*Math.pow(2,10*(t-=1))*Math.sin((t*i-e)*2*Math.PI/s))+n)},easeOutElastic:function(e,t,n,r,i){e=1.70158;var s=0,o=r;return t==0?n:(t/=i)==1?n+r:(s||(s=i*.3),o<Math.abs(r)?(o=r,e=s/4):e=s/(2*Math.PI)*Math.asin(r/o),o*Math.pow(2,-10*t)*Math.sin((t*i-e)*2*Math.PI/s)+r+n)},easeInOutElastic:function(e,t,n,r,i){e=1.70158;var s=0,o=r;return t==0?n:(t/=i/2)==2?n+r:(s||(s=i*.3*1.5),o<Math.abs(r)?(o=r,e=s/4):e=s/(2*Math.PI)*Math.asin(r/o),t<1?-0.5*o*Math.pow(2,10*(t-=1))*Math.sin((t*i-e)*2*Math.PI/s)+n:o*Math.pow(2,-10*(t-=1))*Math.sin((t*i-e)*2*Math.PI/s)*.5+r+n)},easeInBack:function(e,n,r,i,s,o){return o==t&&(o=1.70158),i*(n/=s)*n*((o+1)*n-o)+r},easeOutBack:function(e,n,r,i,s,o){return o==t&&(o=1.70158),i*((n=n/s-1)*n*((o+1)*n+o)+1)+r},easeInOutBack:function(e,n,r,i,s,o){return o==t&&(o=1.70158),(n/=s/2)<1?i/2*n*n*(((o*=1.525)+1)*n-o)+r:i/2*((n-=2)*n*(((o*=1.525)+1)*n+o)+2)+r},easeInBounce:function(t,n,r,i,s){return i-e.easing.easeOutBounce(t,s-n,0,i,s)+r},easeOutBounce:function(e,t,n,r,i){return(t/=i)<1/2.75?r*7.5625*t*t+n:t<2/2.75?r*(7.5625*(t-=1.5/2.75)*t+.75)+n:t<2.5/2.75?r*(7.5625*(t-=2.25/2.75)*t+.9375)+n:r*(7.5625*(t-=2.625/2.75)*t+.984375)+n},easeInOutBounce:function(t,n,r,i,s){return n<s/2?e.easing.easeInBounce(t,n*2,0,i,s)*.5+r:e.easing.easeOutBounce(t,n*2-s,0,i,s)*.5+i*.5+r}})}(jQuery),function(e){e.effects.blind=function(t){return this.queue(function(){var n=e(this),r=["position","top","bottom","left","right"],i=e.effects.setMode(n,t.options.mode||"hide"),s=t.options.direction||"vertical";e.effects.save(n,r),n.show();var o=e.effects.createWrapper(n).css({overflow:"hidden"}),u=s=="vertical"?"height":"width";s=s=="vertical"?o.height():o.width(),i=="show"&&o.css(u,0);var a={};a[u]=i=="show"?s:0,o.animate(a,t.duration,t.options.easing,function(){i=="hide"&&n.hide(),e.effects.restore(n,r),e.effects.removeWrapper(n),t.callback&&t.callback.apply(n[0],arguments),n.dequeue()})})}}(jQuery),function(e){e.effects.bounce=function(t){return this.queue(function(){var n=e(this),r=["position","top","bottom","left","right"],i=e.effects.setMode(n,t.options.mode||"effect"),s=t.options.direction||"up",o=t.options.distance||20,u=t.options.times||5,a=t.duration||250;/show|hide/.test(i)&&r.push("opacity"),e.effects.save(n,r),n.show(),e.effects.createWrapper(n);var f=s=="up"||s=="down"?"top":"left";s=s=="up"||s=="left"?"pos":"neg",o=t.options.distance||(f=="top"?n.outerHeight({margin:!0})/3:n.outerWidth({margin:!0})/3),i=="show"&&n.css("opacity",0).css(f,s=="pos"?-o:o),i=="hide"&&(o/=u*2),i!="hide"&&u--;if(i=="show"){var l={opacity:1};l[f]=(s=="pos"?"+=":"-=")+o,n.animate(l,a/2,t.options.easing),o/=2,u--}for(l=0;l<u;l++){var h={},p={};h[f]=(s=="pos"?"-=":"+=")+o,p[f]=(s=="pos"?"+=":"-=")+o,n.animate(h,a/2,t.options.easing).animate(p,a/2,t.options.easing),o=i=="hide"?o*2:o/2}i=="hide"?(l={opacity:0},l[f]=(s=="pos"?"-=":"+=")+o,n.animate(l,a/2,t.options.easing,function(){n.hide(),e.effects.restore(n,r),e.effects.removeWrapper(n),t.callback&&t.callback.apply(this,arguments)})):(h={},p={},h[f]=(s=="pos"?"-=":"+=")+o,p[f]=(s=="pos"?"+=":"-=")+o,n.animate(h,a/2,t.options.easing).animate(p,a/2,t.options.easing,function(){e.effects.restore(n,r),e.effects.removeWrapper(n),t.callback&&t.callback.apply(this,arguments)})),n.queue("fx",function(){n.dequeue()}),n.dequeue()})}}(jQuery),function(e){e.effects.clip=function(t){return this.queue(function(){var n=e(this),r=["position","top","bottom","left","right","height","width"],i=e.effects.setMode(n,t.options.mode||"hide"),s=t.options.direction||"vertical";e.effects.save(n,r),n.show();var o=e.effects.createWrapper(n).css({overflow:"hidden"});o=n[0].tagName=="IMG"?o:n;var u={size:s=="vertical"?"height":"width",position:s=="vertical"?"top":"left"};s=s=="vertical"?o.height():o.width(),i=="show"&&(o.css(u.size,0),o.css(u.position,s/2));var a={};a[u.size]=i=="show"?s:0,a[u.position]=i=="show"?0:s/2,o.animate(a,{queue:!1,duration:t.duration,easing:t.options.easing,complete:function(){i=="hide"&&n.hide(),e.effects.restore(n,r),e.effects.removeWrapper(n),t.callback&&t.callback.apply(n[0],arguments),n.dequeue()}})})}}(jQuery),function(e){e.effects.drop=function(t){return this.queue(function(){var n=e(this),r=["position","top","bottom","left","right","opacity"],i=e.effects.setMode(n,t.options.mode||"hide"),s=t.options.direction||"left";e.effects.save(n,r),n.show(),e.effects.createWrapper(n);var o=s=="up"||s=="down"?"top":"left";s=s=="up"||s=="left"?"pos":"neg";var u=t.options.distance||(o=="top"?n.outerHeight({margin:!0})/2:n.outerWidth({margin:!0})/2);i=="show"&&n.css("opacity",0).css(o,s=="pos"?-u:u);var a={opacity:i=="show"?1:0};a[o]=(i=="show"?s=="pos"?"+=":"-=":s=="pos"?"-=":"+=")+u,n.animate(a,{queue:!1,duration:t.duration,easing:t.options.easing,complete:function(){i=="hide"&&n.hide(),e.effects.restore(n,r),e.effects.removeWrapper(n),t.callback&&t.callback.apply(this,arguments),n.dequeue()}})})}}(jQuery),function(e){e.effects.explode=function(t){return this.queue(function(){var n=t.options.pieces?Math.round(Math.sqrt(t.options.pieces)):3,r=t.options.pieces?Math.round(Math.sqrt(t.options.pieces)):3;t.options.mode=t.options.mode=="toggle"?e(this).is(":visible")?"hide":"show":t.options.mode;var i=e(this).show().css("visibility","hidden"),s=i.offset();s.top-=parseInt(i.css("marginTop"),10)||0,s.left-=parseInt(i.css("marginLeft"),10)||0;for(var o=i.outerWidth(!0),u=i.outerHeight(!0),a=0;a<n;a++)for(var f=0;f<r;f++)i.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-f*(o/r),top:-a*(u/n)}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:o/r,height:u/n,left:s.left+f*(o/r)+(t.options.mode=="show"?(f-Math.floor(r/2))*(o/r):0),top:s.top+a*(u/n)+(t.options.mode=="show"?(a-Math.floor(n/2))*(u/n):0),opacity:t.options.mode=="show"?0:1}).animate({left:s.left+f*(o/r)+(t.options.mode=="show"?0:(f-Math.floor(r/2))*(o/r)),top:s.top+a*(u/n)+(t.options.mode=="show"?0:(a-Math.floor(n/2))*(u/n)),opacity:t.options.mode=="show"?1:0},t.duration||500);setTimeout(function(){t.options.mode=="show"?i.css({visibility:"visible"}):i.css({visibility:"visible"}).hide(),t.callback&&t.callback.apply(i[0]),i.dequeue(),e("div.ui-effects-explode").remove()},t.duration||500)})}}(jQuery),function(e){e.effects.fade=function(t){return this.queue(function(){var n=e(this),r=e.effects.setMode(n,t.options.mode||"hide");n.animate({opacity:r},{queue:!1,duration:t.duration,easing:t.options.easing,complete:function(){t.callback&&t.callback.apply(this,arguments),n.dequeue()}})})}}(jQuery),function(e){e.effects.fold=function(t){return this.queue(function(){var n=e(this),r=["position","top","bottom","left","right"],i=e.effects.setMode(n,t.options.mode||"hide"),s=t.options.size||15,o=!!t.options.horizFirst,u=t.duration?t.duration/2:e.fx.speeds._default/2;e.effects.save(n,r),n.show();var a=e.effects.createWrapper(n).css({overflow:"hidden"}),f=i=="show"!=o,l=f?["width","height"]:["height","width"];f=f?[a.width(),a.height()]:[a.height(),a.width()];var h=/([0-9]+)%/.exec(s);h&&(s=parseInt(h[1],10)/100*f[i=="hide"?0:1]),i=="show"&&a.css(o?{height:0,width:s}:{height:s,width:0}),o={},h={},o[l[0]]=i=="show"?f[0]:s,h[l[1]]=i=="show"?f[1]:0,a.animate(o,u,t.options.easing).animate(h,u,t.options.easing,function(){i=="hide"&&n.hide(),e.effects.restore(n,r),e.effects.removeWrapper(n),t.callback&&t.callback.apply(n[0],arguments),n.dequeue()})})}}(jQuery),function(e){e.effects.highlight=function(t){return this.queue(function(){var n=e(this),r=["backgroundImage","backgroundColor","opacity"],i=e.effects.setMode(n,t.options.mode||"show"),s={backgroundColor:n.css("backgroundColor")};i=="hide"&&(s.opacity=0),e.effects.save(n,r),n.show().css({backgroundImage:"none",backgroundColor:t.options.color||"#ffff99"}).animate(s,{queue:!1,duration:t.duration,easing:t.options.easing,complete:function(){i=="hide"&&n.hide(),e.effects.restore(n,r),i=="show"&&!e.support.opacity&&this.style.removeAttribute("filter"),t.callback&&t.callback.apply(this,arguments),n.dequeue()}})})}}(jQuery),function(e){e.effects.pulsate=function(t){return this.queue(function(){var n=e(this),r=e.effects.setMode(n,t.options.mode||"show");times=(t.options.times||5)*2-1,duration=t.duration?t.duration/2:e.fx.speeds._default/2,isVisible=n.is(":visible"),animateTo=0,isVisible||(n.css("opacity",0).show(),animateTo=1),(r=="hide"&&isVisible||r=="show"&&!isVisible)&&times--;for(r=0;r<times;r++)n.animate({opacity:animateTo},duration,t.options.easing),animateTo=(animateTo+1)%2;n.animate({opacity:animateTo},duration,t.options.easing,function(){animateTo==0&&n.hide(),t.callback&&t.callback.apply(this,arguments)}),n.queue("fx",function(){n.dequeue()}).dequeue()})}}(jQuery),function(e){e.effects.puff=function(t){return this.queue(function(){var n=e(this),r=e.effects.setMode(n,t.options.mode||"hide"),i=parseInt(t.options.percent,10)||150,s=i/100,o={height:n.height(),width:n.width()};e.extend(t.options,{fade:!0,mode:r,percent:r=="hide"?i:100,from:r=="hide"?o:{height:o.height*s,width:o.width*s}}),n.effect("scale",t.options,t.duration,t.callback),n.dequeue()})},e.effects.scale=function(t){return this.queue(function(){var n=e(this),r=e.extend(!0,{},t.options),i=e.effects.setMode(n,t.options.mode||"effect"),s=parseInt(t.options.percent,10)||(parseInt(t.options.percent,10)==0?0:i=="hide"?0:100),o=t.options.direction||"both",u=t.options.origin;i!="effect"&&(r.origin=u||["middle","center"],r.restore=!0),u={height:n.height(),width:n.width()},n.from=t.options.from||(i=="show"?{height:0,width:0}:u),s={y:o!="horizontal"?s/100:1,x:o!="vertical"?s/100:1},n.to={height:u.height*s.y,width:u.width*s.x},t.options.fade&&(i=="show"&&(n.from.opacity=0,n.to.opacity=1),i=="hide"&&(n.from.opacity=1,n.to.opacity=0)),r.from=n.from,r.to=n.to,r.mode=i,n.effect("size",r,t.duration,t.callback),n.dequeue()})},e.effects.size=function(t){return this.queue(function(){var n=e(this),r=["position","top","bottom","left","right","width","height","overflow","opacity"],i=["position","top","bottom","left","right","overflow","opacity"],s=["width","height","overflow"],o=["fontSize"],u=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],a=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],f=e.effects.setMode(n,t.options.mode||"effect"),l=t.options.restore||!1,h=t.options.scale||"both",p=t.options.origin,d={height:n.height(),width:n.width()};n.from=t.options.from||d,n.to=t.options.to||d,p&&(p=e.effects.getBaseline(p,d),n.from.top=(d.height-n.from.height)*p.y,n.from.left=(d.width-n.from.width)*p.x,n.to.top=(d.height-n.to.height)*p.y,n.to.left=(d.width-n.to.width)*p.x);var v={from:{y:n.from.height/d.height,x:n.from.width/d.width},to:{y:n.to.height/d.height,x:n.to.width/d.width}};if(h=="box"||h=="both")v.from.y!=v.to.y&&(r=r.concat(u),n.from=e.effects.setTransition(n,u,v.from.y,n.from),n.to=e.effects.setTransition(n,u,v.to.y,n.to)),v.from.x!=v.to.x&&(r=r.concat(a),n.from=e.effects.setTransition(n,a,v.from.x,n.from),n.to=e.effects.setTransition(n,a,v.to.x,n.to));(h=="content"||h=="both")&&v.from.y!=v.to.y&&(r=r.concat(o),n.from=e.effects.setTransition(n,o,v.from.y,n.from),n.to=e.effects.setTransition(n,o,v.to.y,n.to)),e.effects.save(n,l?r:i),n.show(),e.effects.createWrapper(n),n.css("overflow","hidden").css(n.from);if(h=="content"||h=="both")u=u.concat(["marginTop","marginBottom"]).concat(o),a=a.concat(["marginLeft","marginRight"]),s=r.concat(u).concat(a),n.find("*[width]").each(function(){child=e(this),l&&e.effects.save(child,s);var n={height:child.height(),width:child.width()};child.from={height:n.height*v.from.y,width:n.width*v.from.x},child.to={height:n.height*v.to.y,width:n.width*v.to.x},v.from.y!=v.to.y&&(child.from=e.effects.setTransition(child,u,v.from.y,child.from),child.to=e.effects.setTransition(child,u,v.to.y,child.to)),v.from.x!=v.to.x&&(child.from=e.effects.setTransition(child,a,v.from.x,child.from),child.to=e.effects.setTransition(child,a,v.to.x,child.to)),child.css(child.from),child.animate(child.to,t.duration,t.options.easing,function(){l&&e.effects.restore(child,s)})});n.animate(n.to,{queue:!1,duration:t.duration,easing:t.options.easing,complete:function(){n.to.opacity===0&&n.css("opacity",n.from.opacity),f=="hide"&&n.hide(),e.effects.restore(n,l?r:i),e.effects.removeWrapper(n),t.callback&&t.callback.apply(this,arguments),n.dequeue()}})})}}(jQuery),function(e){e.effects.shake=function(t){return this.queue(function(){var n=e(this),r=["position","top","bottom","left","right"];e.effects.setMode(n,t.options.mode||"effect");var i=t.options.direction||"left",s=t.options.distance||20,o=t.options.times||3,u=t.duration||t.options.duration||140;e.effects.save(n,r),n.show(),e.effects.createWrapper(n);var a=i=="up"||i=="down"?"top":"left",f=i=="up"||i=="left"?"pos":"neg";i={};var l={},h={};i[a]=(f=="pos"?"-=":"+=")+s,l[a]=(f=="pos"?"+=":"-=")+s*2,h[a]=(f=="pos"?"-=":"+=")+s*2,n.animate(i,u,t.options.easing);for(s=1;s<o;s++)n.animate(l,u,t.options.easing).animate(h,u,t.options.easing);n.animate(l,u,t.options.easing).animate(i,u/2,t.options.easing,function(){e.effects.restore(n,r),e.effects.removeWrapper(n),t.callback&&t.callback.apply(this,arguments)}),n.queue("fx",function(){n.dequeue()}),n.dequeue()})}}(jQuery),function(e){e.effects.slide=function(t){return this.queue(function(){var n=e(this),r=["position","top","bottom","left","right"],i=e.effects.setMode(n,t.options.mode||"show"),s=t.options.direction||"left";e.effects.save(n,r),n.show(),e.effects.createWrapper(n).css({overflow:"hidden"});var o=s=="up"||s=="down"?"top":"left";s=s=="up"||s=="left"?"pos":"neg";var u=t.options.distance||(o=="top"?n.outerHeight({margin:!0}):n.outerWidth({margin:!0}));i=="show"&&n.css(o,s=="pos"?isNaN(u)?"-"+u:-u:u);var a={};a[o]=(i=="show"?s=="pos"?"+=":"-=":s=="pos"?"-=":"+=")+u,n.animate(a,{queue:!1,duration:t.duration,easing:t.options.easing,complete:function(){i=="hide"&&n.hide(),e.effects.restore(n,r),e.effects.removeWrapper(n),t.callback&&t.callback.apply(this,arguments),n.dequeue()}})})}}(jQuery),function(e){e.effects.transfer=function(t){return this.queue(function(){var n=e(this),r=e(t.options.to),i=r.offset();r={top:i.top,left:i.left,height:r.innerHeight(),width:r.innerWidth()},i=n.offset();var s=e('<div class="ui-effects-transfer"></div>').appendTo(document.body).addClass(t.options.className).css({top:i.top,left:i.left,height:n.innerHeight(),width:n.innerWidth(),position:"absolute"}).animate(r,t.duration,t.options.easing,function(){s.remove(),t.callback&&t.callback.apply(n[0],arguments),n.dequeue()})})}}(jQuery),function(e){e.widget("ui.accordion",{options:{active:0,animated:"slide",autoHeight:!0,clearStyle:!1,collapsible:!1,event:"click",fillSpace:!1,header:"> li > :first-child,> :not(li):even",icons:{header:"ui-icon-triangle-1-e",headerSelected:"ui-icon-triangle-1-s"},navigation:!1,navigationFilter:function(){return this.href.toLowerCase()===location.href.toLowerCase()}},_create:function(){var t=this,n=t.options;t.running=0,t.element.addClass("ui-accordion ui-widget ui-helper-reset").children("li").addClass("ui-accordion-li-fix"),t.headers=t.element.find(n.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all").bind("mouseenter.accordion",function(){n.disabled||e(this).addClass("ui-state-hover")}).bind("mouseleave.accordion",function(){n.disabled||e(this).removeClass("ui-state-hover")}).bind("focus.accordion",function(){n.disabled||e(this).addClass("ui-state-focus")}).bind("blur.accordion",function(){n.disabled||e(this).removeClass("ui-state-focus")}),t.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom");if(n.navigation){var r=t.element.find("a").filter(n.navigationFilter).eq(0);if(r.length){var i=r.closest(".ui-accordion-header");t.active=i.length?i:r.closest(".ui-accordion-content").prev()}}t.active=t._findActive(t.active||n.active).addClass("ui-state-default ui-state-active").toggleClass("ui-corner-all").toggleClass("ui-corner-top"),t.active.next().addClass("ui-accordion-content-active"),t._createIcons(),t.resize(),t.element.attr("role","tablist"),t.headers.attr("role","tab").bind("keydown.accordion",function(e){return t._keydown(e)}).next().attr("role","tabpanel"),t.headers.not(t.active||"").attr({"aria-expanded":"false",tabIndex:-1}).next().hide(),t.active.length?t.active.attr({"aria-expanded":"true",tabIndex:0}):t.headers.eq(0).attr("tabIndex",0),e.browser.safari||t.headers.find("a").attr("tabIndex",-1),n.event&&t.headers.bind(n.event.split(" ").join(".accordion ")+".accordion",function(e){t._clickHandler.call(t,e,this),e.preventDefault()})},_createIcons:function(){var t=this.options;t.icons&&(e("<span></span>").addClass("ui-icon "+t.icons.header).prependTo(this.headers),this.active.children(".ui-icon").toggleClass(t.icons.header).toggleClass(t.icons.headerSelected),this.element.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.children(".ui-icon").remove(),this.element.removeClass("ui-accordion-icons")},destroy:function(){var t=this.options;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.unbind(".accordion").removeClass("ui-accordion-header ui-accordion-disabled ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("tabIndex"),this.headers.find("a").removeAttr("tabIndex"),this._destroyIcons();var n=this.headers.next().css("display","").removeAttr("role").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-accordion-disabled ui-state-disabled");return(t.autoHeight||t.fillHeight)&&n.css("height",""),e.Widget.prototype.destroy.call(this)},_setOption:function(t,n){e.Widget.prototype._setOption.apply(this,arguments),t=="active"&&this.activate(n),t=="icons"&&(this._destroyIcons(),n&&this._createIcons()),t=="disabled"&&this.headers.add(this.headers.next())[n?"addClass":"removeClass"]("ui-accordion-disabled ui-state-disabled")},_keydown:function(t){if(!(this.options.disabled||t.altKey||t.ctrlKey)){var n=e.ui.keyCode,r=this.headers.length,i=this.headers.index(t.target),s=!1;switch(t.keyCode){case n.RIGHT:case n.DOWN:s=this.headers[(i+1)%r];break;case n.LEFT:case n.UP:s=this.headers[(i-1+r)%r];break;case n.SPACE:case n.ENTER:this._clickHandler({target:t.target},t.target),t.preventDefault()}return s?(e(t.target).attr("tabIndex",-1),e(s).attr("tabIndex",0),s.focus(),!1):!0}},resize:function(){var t=this.options,n;if(t.fillSpace){if(e.browser.msie){var r=this.element.parent().css("overflow");this.element.parent().css("overflow","hidden")}n=this.element.parent().height(),e.browser.msie&&this.element.parent().css("overflow",r),this.headers.each(function(){n-=e(this).outerHeight(!0)}),this.headers.next().each(function(){e(this).height(Math.max(0,n-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")}else t.autoHeight&&(n=0,this.headers.next().each(function(){n=Math.max(n,e(this).height("").height())}).height(n));return this},activate:function(e){return this.options.active=e,e=this._findActive(e)[0],this._clickHandler({target:e},e),this},_findActive:function(t){return t?typeof t=="number"?this.headers.filter(":eq("+t+")"):this.headers.not(this.headers.not(t)):t===!1?e([]):this.headers.filter(":eq(0)")},_clickHandler:function(t,n){var r=this.options;if(!r.disabled)if(t.target){t=e(t.currentTarget||n),n=t[0]===this.active[0],r.active=r.collapsible&&n?!1:this.headers.index(t);if(!(this.running||!r.collapsible&&n)){var i=this.active;a=t.next(),o=this.active.next(),u={options:r,newHeader:n&&r.collapsible?e([]):t,oldHeader:this.active,newContent:n&&r.collapsible?e([]):a,oldContent:o};var s=this.headers.index(this.active[0])>this.headers.index(t[0]);this.active=n?e([]):t,this._toggle(a,o,u,n,s),i.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(r.icons.headerSelected).addClass(r.icons.header),n||(t.removeClass("ui-state-default ui-corner-all").addClass("ui-state-active ui-corner-top").children(".ui-icon").removeClass(r.icons.header).addClass(r.icons.headerSelected),t.next().addClass("ui-accordion-content-active"))}}else if(r.collapsible){this.active.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(r.icons.headerSelected).addClass(r.icons.header),this.active.next().addClass("ui-accordion-content-active");var o=this.active.next(),u={options:r,newHeader:e([]),oldHeader:r.active,newContent:e([]),oldContent:o},a=this.active=e([]);this._toggle(a,o,u)}},_toggle:function(t,n,r,i,s){var o=this,u=o.options;o.toShow=t,o.toHide=n,o.data=r;var a=function(){if(o)return o._completed.apply(o,arguments)};o._trigger("changestart",null,o.data),o.running=n.size()===0?t.size():n.size();if(u.animated){r={},r=u.collapsible&&i?{toShow:e([]),toHide:n,complete:a,down:s,autoHeight:u.autoHeight||u.fillSpace}:{toShow:t,toHide:n,complete:a,down:s,autoHeight:u.autoHeight||u.fillSpace},u.proxied||(u.proxied=u.animated),u.proxiedDuration||(u.proxiedDuration=u.duration),u.animated=e.isFunction(u.proxied)?u.proxied(r):u.proxied,u.duration=e.isFunction(u.proxiedDuration)?u.proxiedDuration(r):u.proxiedDuration,i=e.ui.accordion.animations;var f=u.duration,l=u.animated;l&&!i[l]&&!e.easing[l]&&(l="slide"),i[l]||(i[l]=function(e){this.slide(e,{easing:l,duration:f||700})}),i[l](r)}else u.collapsible&&i?t.toggle():(n.hide(),t.show()),a(!0);n.prev().attr({"aria-expanded":"false",tabIndex:-1}).blur(),t.prev().attr({"aria-expanded":"true",tabIndex:0}).focus()},_completed:function(e){this.running=e?0:--this.running,this.running||(this.options.clearStyle&&this.toShow.add(this.toHide).css({height:"",overflow:""}),this.toHide.removeClass("ui-accordion-content-active"),this.toHide.length&&(this.toHide.parent()[0].className=this.toHide.parent()[0].className),this._trigger("change",null,this.data))}}),e.extend(e.ui.accordion,{version:"1.8.9",animations:{slide:function(t,n){t=e.extend({easing:"swing",duration:300},t,n);if(t.toHide.size())if(t.toShow.size()){var r=t.toShow.css("overflow"),i=0,s={},o={},u;n=t.toShow,u=n[0].style.width,n.width(parseInt(n.parent().width(),10)-parseInt(n.css("paddingLeft"),10)-parseInt(n.css("paddingRight"),10)-(parseInt(n.css("borderLeftWidth"),10)||0)-(parseInt(n.css("borderRightWidth"),10)||0)),e.each(["height","paddingTop","paddingBottom"],function(n,r){o[r]="hide",n=(""+e.css(t.toShow[0],r)).match(/^([\d+-.]+)(.*)$/),s[r]={value:n[1],unit:n[2]||"px"}}),t.toShow.css({height:0,overflow:"hidden"}).show(),t.toHide.filter(":hidden").each(t.complete).end().filter(":visible").animate(o,{step:function(e,n){n.prop=="height"&&(i=n.end-n.start===0?0:(n.now-n.start)/(n.end-n.start)),t.toShow[0].style[n.prop]=i*s[n.prop].value+s[n.prop].unit},duration:t.duration,easing:t.easing,complete:function(){t.autoHeight||t.toShow.css("height",""),t.toShow.css({width:u,overflow:r}),t.complete()}})}else t.toHide.animate({height:"hide",paddingTop:"hide",paddingBottom:"hide"},t);else t.toShow.animate({height:"show",paddingTop:"show",paddingBottom:"show"},t)},bounceslide:function(e){this.slide(e,{easing:e.down?"easeOutBounce":"swing",duration:e.down?1e3:200})}}})}(jQuery),function(e){e.widget("ui.autocomplete",{options:{appendTo:"body",delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null},pending:0,_create:function(){var t=this,n=this.element[0].ownerDocument,r;this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(n){if(!t.options.disabled&&!t.element.attr("readonly")){r=!1;var i=e.ui.keyCode;switch(n.keyCode){case i.PAGE_UP:t._move("previousPage",n);break;case i.PAGE_DOWN:t._move("nextPage",n);break;case i.UP:t._move("previous",n),n.preventDefault();break;case i.DOWN:t._move("next",n),n.preventDefault();break;case i.ENTER:case i.NUMPAD_ENTER:t.menu.active&&(r=!0,n.preventDefault());case i.TAB:if(!t.menu.active)return;t.menu.select(n);break;case i.ESCAPE:t.element.val(t.term),t.close(n);break;default:clearTimeout(t.searching),t.searching=setTimeout(function(){t.term!=t.element.val()&&(t.selectedItem=null,t.search(null,n))},t.options.delay)}}}).bind("keypress.autocomplete",function(e){r&&(r=!1,e.preventDefault())}).bind("focus.autocomplete",function(){t.options.disabled||(t.selectedItem=null,t.previous=t.element.val())}).bind("blur.autocomplete",function(e){t.options.disabled||(clearTimeout(t.searching),t.closing=setTimeout(function(){t.close(e),t._change(e)},150))}),this._initSource(),this.response=function(){return t._response.apply(t,arguments)},this.menu=e("<ul></ul>").addClass("ui-autocomplete").appendTo(e(this.options.appendTo||"body",n)[0]).mousedown(function(n){var r=t.menu.element[0];e(n.target).closest(".ui-menu-item").length||setTimeout(function(){e(document).one("mousedown",function(n){n.target!==t.element[0]&&n.target!==r&&!e.ui.contains(r,n.target)&&t.close()})},1),setTimeout(function(){clearTimeout(t.closing)},13)}).menu({focus:function(e,n){n=n.item.data("item.autocomplete"),!1!==t._trigger("focus",e,{item:n})&&/^key/.test(e.originalEvent.type)&&t.element.val(n.value)},selected:function(e,r){var i=r.item.data("item.autocomplete"),s=t.previous;t.element[0]!==n.activeElement&&(t.element.focus(),t.previous=s,setTimeout(function(){t.previous=s,t.selectedItem=i},1)),!1!==t._trigger("select",e,{item:i})&&t.element.val(i.value),t.term=t.element.val(),t.close(e),t.selectedItem=i},blur:function(){t.menu.element.is(":visible")&&t.element.val()!==t.term&&t.element.val(t.term)}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu"),e.fn.bgiframe&&this.menu.element.bgiframe()},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup"),this.menu.element.remove(),e.Widget.prototype.destroy.call(this)},_setOption:function(t,n){e.Widget.prototype._setOption.apply(this,arguments),t==="source"&&this._initSource(),t==="appendTo"&&this.menu.element.appendTo(e(n||"body",this.element[0].ownerDocument)[0]),t==="disabled"&&n&&this.xhr&&this.xhr.abort()},_initSource:function(){var t=this,n,r;e.isArray(this.options.source)?(n=this.options.source,this.source=function(t,r){r(e.ui.autocomplete.filter(n,t.term))}):typeof this.options.source=="string"?(r=this.options.source,this.source=function(n,i){t.xhr&&t.xhr.abort(),t.xhr=e.ajax({url:r,data:n,dataType:"json",success:function(e,n,r){r===t.xhr&&i(e),t.xhr=null},error:function(e){e===t.xhr&&i([]),t.xhr=null}})}):this.source=this.options.source},search:function(e,t){e=e!=null?e:this.element.val(),this.term=this.element.val();if(e.length<this.options.minLength)return this.close(t);clearTimeout(this.closing);if(this._trigger("search",t)!==!1)return this._search(e)},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.source({term:e},this.response)},_response:function(e){!this.options.disabled&&e&&e.length?(e=this._normalize(e),this._suggest(e),this._trigger("open")):this.close(),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},close:function(e){clearTimeout(this.closing),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.deactivate(),this._trigger("close",e))},_change:function(e){this.previous!==this.element.val()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return typeof t=="string"?{label:t,value:t}:e.extend({label:t.label||t.value,value:t.value||t.label},t)})},_suggest:function(t){var n=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(n,t),this.menu.deactivate(),this.menu.refresh(),n.show(),this._resizeMenu(),n.position(e.extend({of:this.element},this.options.position))},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth(),this.element.outerWidth()))},_renderMenu:function(t,n){var r=this;e.each(n,function(e,n){r._renderItem(t,n)})},_renderItem:function(t,n){return e("<li></li>").data("item.autocomplete",n).append(e("<a></a>").text(n.label)).appendTo(t)},_move:function(e,t){this.menu.element.is(":visible")?this.menu.first()&&/^previous/.test(e)||this.menu.last()&&/^next/.test(e)?(this.element.val(this.term),this.menu.deactivate()):this.menu[e](t):this.search(null,t)},widget:function(){return this.menu.element}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},filter:function(t,n){var r=new RegExp(e.ui.autocomplete.escapeRegex(n),"i");return e.grep(t,function(e){return r.test(e.label||e.value||e)})}})}(jQuery),function(e){e.widget("ui.menu",{_create:function(){var t=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(n){e(n.target).closest(".ui-menu-item a").length&&(n.preventDefault(),t.select(n))}),this.refresh()},refresh:function(){var t=this;this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem").children("a").addClass("ui-corner-all").attr("tabindex",-1).mouseenter(function(n){t.activate(n,e(this).parent())}).mouseleave(function(){t.deactivate()})},activate:function(e,t){this.deactivate();if(this.hasScroll()){var n=t.offset().top-this.element.offset().top,r=this.element.attr("scrollTop"),i=this.element.height();n<0?this.element.attr("scrollTop",r+n):n>=i&&this.element.attr("scrollTop",r+n-i+t.height())}this.active=t.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end(),this._trigger("focus",e,{item:t})},deactivate:function(){this.active&&(this.active.children("a").removeClass("ui-state-hover").removeAttr("id"),this._trigger("blur"),this.active=null)},next:function(e){this.move("next",".ui-menu-item:first",e)},previous:function(e){this.move("prev",".ui-menu-item:last",e)},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},move:function(e,t,n){this.active?(e=this.active[e+"All"](".ui-menu-item").eq(0),e.length?this.activate(n,e):this.activate(n,this.element.children(t))):this.activate(n,this.element.children(t))},nextPage:function(t){if(this.hasScroll())if(!this.active||this.last())this.activate(t,this.element.children(".ui-menu-item:first"));else{var n=this.active.offset().top,r=this.element.height(),i=this.element.children(".ui-menu-item").filter(function(){var t=e(this).offset().top-n-r+e(this).height();return t<10&&t>-10});i.length||(i=this.element.children(".ui-menu-item:last")),this.activate(t,i)}else this.activate(t,this.element.children(".ui-menu-item").filter(!this.active||this.last()?":first":":last"))},previousPage:function(t){if(this.hasScroll())if(!this.active||this.first())this.activate(t,this.element.children(".ui-menu-item:last"));else{var n=this.active.offset().top,r=this.element.height();result=this.element.children(".ui-menu-item").filter(function(){var t=e(this).offset().top-n+r-e(this).height();return t<10&&t>-10}),result.length||(result=this.element.children(".ui-menu-item:first")),this.activate(t,result)}else this.activate(t,this.element.children(".ui-menu-item").filter(!this.active||this.first()?":last":":first"))},hasScroll:function(){return this.element.height()<this.element.attr("scrollHeight")},select:function(e){this._trigger("selected",e,{item:this.active})}})}(jQuery),function(e){var t,n=function(t){e(":ui-button",t.target.form).each(function(){var t=e(this).data("button");setTimeout(function(){t.refresh()},1)})},r=function(t){var n=t.name,r=t.form,i=e([]);return n&&(i=r?e(r).find("[name='"+n+"']"):e("[name='"+n+"']",t.ownerDocument).filter(function(){return!this.form})),i};e.widget("ui.button",{options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset.button").bind("reset.button",n),typeof this.options.disabled!="boolean"&&(this.options.disabled=this.element.attr("disabled")),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var i=this,s=this.options,o=this.type==="checkbox"||this.type==="radio",u="ui-state-hover"+(o?"":" ui-state-active");s.label===null&&(s.label=this.buttonElement.html()),this.element.is(":disabled")&&(s.disabled=!0),this.buttonElement.addClass("ui-button ui-widget ui-state-default ui-corner-all").attr("role","button").bind("mouseenter.button",function(){s.disabled||(e(this).addClass("ui-state-hover"),this===t&&e(this).addClass("ui-state-active"))}).bind("mouseleave.button",function(){s.disabled||e(this).removeClass(u)}).bind("focus.button",function(){e(this).addClass("ui-state-focus")}).bind("blur.button",function(){e(this).removeClass("ui-state-focus")}),o&&this.element.bind("change.button",function(){i.refresh()}),this.type==="checkbox"?this.buttonElement.bind("click.button",function(){if(s.disabled)return!1;e(this).toggleClass("ui-state-active"),i.buttonElement.attr("aria-pressed",i.element[0].checked)}):this.type==="radio"?this.buttonElement.bind("click.button",function(){if(s.disabled)return!1;e(this).addClass("ui-state-active"),i.buttonElement.attr("aria-pressed",!0);var t=i.element[0];r(t).not(t).map(function(){return e(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed",!1)}):(this.buttonElement.bind("mousedown.button",function(){if(s.disabled)return!1;e(this).addClass("ui-state-active"),t=this,e(document).one("mouseup",function(){t=null})}).bind("mouseup.button",function(){if(s.disabled)return!1;e(this).removeClass("ui-state-active")}).bind("keydown.button",function(t){if(s.disabled)return!1;(t.keyCode==e.ui.keyCode.SPACE||t.keyCode==e.ui.keyCode.ENTER)&&e(this).addClass("ui-state-active")}).bind("keyup.button",function(){e(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click()})),this._setOption("disabled",s.disabled)},_determineButtonType:function(){this.type=this.element.is(":checkbox")?"checkbox":this.element.is(":radio")?"radio":this.element.is("input")?"input":"button";if(this.type==="checkbox"||this.type==="radio"){this.buttonElement=this.element.parents().last().find("label[for="+this.element.attr("id")+"]"),this.element.addClass("ui-helper-hidden-accessible");var e=this.element.is(":checked");e&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.attr("aria-pressed",e)}else this.buttonElement=this.element},widget:function(){return this.buttonElement},destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass("ui-button ui-widget ui-state-default ui-corner-all ui-state-hover ui-state-active  ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only").removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title"),e.Widget.prototype.destroy.call(this)},_setOption:function(t,n){e.Widget.prototype._setOption.apply(this,arguments),t==="disabled"&&(n?this.element.attr("disabled",!0):this.element.removeAttr("disabled")),this._resetButton()},refresh:function(){var t=this.element.is(":disabled");t!==this.options.disabled&&this._setOption("disabled",t),this.type==="radio"?r(this.element[0]).each(function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed",!0):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed",!1)}):this.type==="checkbox"&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed",!0):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed",!1))},_resetButton:function(){if(this.type==="input")this.options.label&&this.element.val(this.options.label);else{var t=this.buttonElement.removeClass("ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only"),n=e("<span></span>").addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),r=this.options.icons,i=r.primary&&r.secondary;r.primary||r.secondary?(t.addClass("ui-button-text-icon"+(i?"s":r.primary?"-primary":"-secondary")),r.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+r.primary+"'></span>"),r.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+r.secondary+"'></span>"),this.options.text||(t.addClass(i?"ui-button-icons-only":"ui-button-icon-only").removeClass("ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary"),this.hasTitle||t.attr("title",n))):t.addClass("ui-button-text-only")}}}),e.widget("ui.buttonset",{options:{items:":button, :submit, :reset, :checkbox, :radio, a, :data(button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(t,n){t==="disabled"&&this.buttons.button("option",t,n),e.Widget.prototype._setOption.apply(this,arguments)},refresh:function(){this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass("ui-corner-left").end().filter(":last").addClass("ui-corner-right").end().end()},destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy"),e.Widget.prototype.destroy.call(this)}})}(jQuery),function(b,c){function f(){this.debug=!1,this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._inDialog=this._datepickerShowing=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1},b.extend(this._defaults,this.regional[""]),this.dpDiv=b('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>')}function g(e,t){b.extend(e,t);for(var n in t)if(t[n]==null||t[n]==c)e[n]=t[n];return e}b.extend(b.ui,{datepicker:{version:"1.8.9"}});var e=(new Date).getTime();b.extend(f.prototype,{markerClassName:"hasDatepicker",log:function(){this.debug&&console.log.apply("",arguments)},_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return g(this._defaults,e||{}),this},_attachDatepicker:function(a,d){var h=null;for(var i in this._defaults){var j=a.getAttribute("date:"+i);if(j){h=h||{};try{h[i]=eval(j)}catch(n){h[i]=j}}}i=a.nodeName.toLowerCase(),j=i=="div"||i=="span",a.id||(this.uuid+=1,a.id="dp"+this.uuid);var q=this._newInst(b(a),j);q.settings=b.extend({},d||{},h||{}),i=="input"?this._connectDatepicker(a,q):j&&this._inlineDatepicker(a,q)},_newInst:function(e,t){return{id:e[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:t,dpDiv:t?b('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'):this.dpDiv}},_connectDatepicker:function(e,t){var n=b(e);t.append=b([]),t.trigger=b([]),n.hasClass(this.markerClassName)||(this._attachments(n,t),n.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(e,n,r){t.settings[n]=r}).bind("getData.datepicker",function(e,n){return this._get(t,n)}),this._autoSize(t),b.data(e,"datepicker",t))},_attachments:function(e,t){var n=this._get(t,"appendText"),r=this._get(t,"isRTL");t.append&&t.append.remove(),n&&(t.append=b('<span class="'+this._appendClass+'">'+n+"</span>"),e[r?"before":"after"](t.append)),e.unbind("focus",this._showDatepicker),t.trigger&&t.trigger.remove(),n=this._get(t,"showOn"),(n=="focus"||n=="both")&&e.focus(this._showDatepicker);if(n=="button"||n=="both"){n=this._get(t,"buttonText");var i=this._get(t,"buttonImage");t.trigger=b(this._get(t,"buttonImageOnly")?b("<img/>").addClass(this._triggerClass).attr({src:i,alt:n,title:n}):b('<button type="button"></button>').addClass(this._triggerClass).html(i==""?n:b("<img/>").attr({src:i,alt:n,title:n}))),e[r?"before":"after"](t.trigger),t.trigger.click(function(){return b.datepicker._datepickerShowing&&b.datepicker._lastInput==e[0]?b.datepicker._hideDatepicker():b.datepicker._showDatepicker(e[0]),!1})}},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t=new Date(2009,11,20),n=this._get(e,"dateFormat");if(n.match(/[DM]/)){var r=function(e){for(var t=0,n=0,r=0;r<e.length;r++)e[r].length>t&&(t=e[r].length,n=r);return n};t.setMonth(r(this._get(e,n.match(/MM/)?"monthNames":"monthNamesShort"))),t.setDate(r(this._get(e,n.match(/DD/)?"dayNames":"dayNamesShort"))+20-t.getDay())}e.input.attr("size",this._formatDate(e,t).length)}},_inlineDatepicker:function(e,t){var n=b(e);n.hasClass(this.markerClassName)||(n.addClass(this.markerClassName).append(t.dpDiv).bind("setData.datepicker",function(e,n,r){t.settings[n]=r}).bind("getData.datepicker",function(e,n){return this._get(t,n)}),b.data(e,"datepicker",t),this._setDate(t,this._getDefaultDate(t),!0),this._updateDatepicker(t),this._updateAlternate(t),t.dpDiv.show())},_dialogDatepicker:function(e,t,n,r,i){return e=this._dialogInst,e||(this.uuid+=1,this._dialogInput=b('<input type="text" id="'+("dp"+this.uuid)+'" style="position: absolute; top: -100px; width: 0px; z-index: -10;"/>'),this._dialogInput.keydown(this._doKeyDown),b("body").append(this._dialogInput),e=this._dialogInst=this._newInst(this._dialogInput,!1),e.settings={},b.data(this._dialogInput[0],"datepicker",e)),g(e.settings,r||{}),t=t&&t.constructor==Date?this._formatDate(e,t):t,this._dialogInput.val(t),this._pos=i?i.length?i:[i.pageX,i.pageY]:null,this._pos||(this._pos=[document.documentElement.clientWidth/2-100+(document.documentElement.scrollLeft||document.body.scrollLeft),document.documentElement.clientHeight/2-150+(document.documentElement.scrollTop||document.body.scrollTop)]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),e.settings.onSelect=n,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),b.blockUI&&b.blockUI(this.dpDiv),b.data(this._dialogInput[0],"datepicker",e),this},_destroyDatepicker:function(e){var t=b(e),n=b.data(e,"datepicker");if(t.hasClass(this.markerClassName)){var r=e.nodeName.toLowerCase();b.removeData(e,"datepicker"),r=="input"?(n.append.remove(),n.trigger.remove(),t.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):(r=="div"||r=="span")&&t.removeClass(this.markerClassName).empty()}},_enableDatepicker:function(e){var t=b(e),n=b.data(e,"datepicker");if(t.hasClass(this.markerClassName)){var r=e.nodeName.toLowerCase();r=="input"?(e.disabled=!1,n.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):(r=="div"||r=="span")&&t.children("."+this._inlineClass).children().removeClass("ui-state-disabled"),this._disabledInputs=b.map(this._disabledInputs,function(t){return t==e?null:t})}},_disableDatepicker:function(e){var t=b(e),n=b.data(e,"datepicker");if(t.hasClass(this.markerClassName)){var r=e.nodeName.toLowerCase();r=="input"?(e.disabled=!0,n.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):(r=="div"||r=="span")&&t.children("."+this._inlineClass).children().addClass("ui-state-disabled"),this._disabledInputs=b.map(this._disabledInputs,function(t){return t==e?null:t}),this._disabledInputs[this._disabledInputs.length]=e}},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]==e)return!0;return!1},_getInst:function(e){try{return b.data(e,"datepicker")}catch(t){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,t,n){var r=this._getInst(e);if(arguments.length==2&&typeof t=="string")return t=="defaults"?b.extend({},b.datepicker._defaults):r?t=="all"?b.extend({},r.settings):this._get(r,t):null;var i=t||{};typeof t=="string"&&(i={},i[t]=n);if(r){this._curInst==r&&this._hideDatepicker();var s=this._getDateDatepicker(e,!0);g(r.settings,i),this._attachments(b(e),r),this._autoSize(r),this._setDateDatepicker(e,s),this._updateDatepicker(r)}},_changeDatepicker:function(e,t,n){this._optionDatepicker(e,t,n)},_refreshDatepicker:function(e){(e=this._getInst(e))&&this._updateDatepicker(e)},_setDateDatepicker:function(e,t){if(e=this._getInst(e))this._setDate(e,t),this._updateDatepicker(e),this._updateAlternate(e)},_getDateDatepicker:function(e,t){return(e=this._getInst(e))&&!e.inline&&this._setDateFromField(e,t),e?this._getDate(e):null},_doKeyDown:function(e){var t=b.datepicker._getInst(e.target),n=!0,r=t.dpDiv.is(".ui-datepicker-rtl");t._keyEvent=!0;if(b.datepicker._datepickerShowing)switch(e.keyCode){case 9:b.datepicker._hideDatepicker(),n=!1;break;case 13:return n=b("td."+b.datepicker._dayOverClass+":not(."+b.datepicker._currentClass+")",t.dpDiv),n[0]?b.datepicker._selectDay(e.target,t.selectedMonth,t.selectedYear,n[0]):b.datepicker._hideDatepicker(),!1;case 27:b.datepicker._hideDatepicker();break;case 33:b.datepicker._adjustDate(e.target,e.ctrlKey?-b.datepicker._get(t,"stepBigMonths"):-b.datepicker._get(t,"stepMonths"),"M");break;case 34:b.datepicker._adjustDate(e.target,e.ctrlKey?+b.datepicker._get(t,"stepBigMonths"):+b.datepicker._get(t,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&b.datepicker._clearDate(e.target),n=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&b.datepicker._gotoToday(e.target),n=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&b.datepicker._adjustDate(e.target,r?1:-1,"D"),n=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&b.datepicker._adjustDate(e.target,e.ctrlKey?-b.datepicker._get(t,"stepBigMonths"):-b.datepicker._get(t,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&b.datepicker._adjustDate(e.target,-7,"D"),n=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&b.datepicker._adjustDate(e.target,r?-1:1,"D"),n=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&b.datepicker._adjustDate(e.target,e.ctrlKey?+b.datepicker._get(t,"stepBigMonths"):+b.datepicker._get(t,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&b.datepicker._adjustDate(e.target,7,"D"),n=e.ctrlKey||e.metaKey;break;default:n=!1}else e.keyCode==36&&e.ctrlKey?b.datepicker._showDatepicker(this):n=!1;n&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var t=b.datepicker._getInst(e.target);if(b.datepicker._get(t,"constrainInput")){t=b.datepicker._possibleChars(b.datepicker._get(t,"dateFormat"));var n=String.fromCharCode(e.charCode==c?e.keyCode:e.charCode);return e.ctrlKey||e.metaKey||n<" "||!t||t.indexOf(n)>-1}},_doKeyUp:function(e){e=b.datepicker._getInst(e.target);if(e.input.val()!=e.lastVal)try{b.datepicker.parseDate(b.datepicker._get(e,"dateFormat"),e.input?e.input.val():null,b.datepicker._getFormatConfig(e))&&(b.datepicker._setDateFromField(e),b.datepicker._updateAlternate(e),b.datepicker._updateDatepicker(e))}catch(t){b.datepicker.log(t)}return!0},_showDatepicker:function(e){e=e.target||e,e.nodeName.toLowerCase()!="input"&&(e=b("input",e.parentNode)[0]);if(!b.datepicker._isDisabledDatepicker(e)&&b.datepicker._lastInput!=e){var t=b.datepicker._getInst(e);b.datepicker._curInst&&b.datepicker._curInst!=t&&b.datepicker._curInst.dpDiv.stop(!0,!0);var n=b.datepicker._get(t,"beforeShow");g(t.settings,n?n.apply(e,[e,t]):{}),t.lastVal=null,b.datepicker._lastInput=e,b.datepicker._setDateFromField(t),b.datepicker._inDialog&&(e.value=""),b.datepicker._pos||(b.datepicker._pos=b.datepicker._findPos(e),b.datepicker._pos[1]+=e.offsetHeight);var r=!1;b(e).parents().each(function(){return r|=b(this).css("position")=="fixed",!r}),r&&b.browser.opera&&(b.datepicker._pos[0]-=document.documentElement.scrollLeft,b.datepicker._pos[1]-=document.documentElement.scrollTop),n={left:b.datepicker._pos[0],top:b.datepicker._pos[1]},b.datepicker._pos=null,t.dpDiv.empty(),t.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),b.datepicker._updateDatepicker(t),n=b.datepicker._checkOffset(t,n,r),t.dpDiv.css({position:b.datepicker._inDialog&&b.blockUI?"static":r?"fixed":"absolute",display:"none",left:n.left+"px",top:n.top+"px"});if(!t.inline){n=b.datepicker._get(t,"showAnim");var i=b.datepicker._get(t,"duration"),s=function(){b.datepicker._datepickerShowing=!0;var e=t.dpDiv.find("iframe.ui-datepicker-cover");if(e.length){var n=b.datepicker._getBorders(t.dpDiv);e.css({left:-n[0],top:-n[1],width:t.dpDiv.outerWidth(),height:t.dpDiv.outerHeight()})}};t.dpDiv.zIndex(b(e).zIndex()+1),b.effects&&b.effects[n]?t.dpDiv.show(n,b.datepicker._get(t,"showOptions"),i,s):t.dpDiv[n||"show"](n?i:null,s),(!n||!i)&&s(),t.input.is(":visible")&&!t.input.is(":disabled")&&t.input.focus(),b.datepicker._curInst=t}}},_updateDatepicker:function(e){var t=this,n=b.datepicker._getBorders(e.dpDiv);e.dpDiv.empty().append(this._generateHTML(e));var r=e.dpDiv.find("iframe.ui-datepicker-cover");r.length&&r.css({left:-n[0],top:-n[1],width:e.dpDiv.outerWidth(),height:e.dpDiv.outerHeight()}),e.dpDiv.find("button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a").bind("mouseout",function(){b(this).removeClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!=-1&&b(this).removeClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!=-1&&b(this).removeClass("ui-datepicker-next-hover")}).bind("mouseover",function(){t._isDisabledDatepicker(e.inline?e.dpDiv.parent()[0]:e.input[0])||(b(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),b(this).addClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!=-1&&b(this).addClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!=-1&&b(this).addClass("ui-datepicker-next-hover"))}).end().find("."+this._dayOverClass+" a").trigger("mouseover").end(),n=this._getNumberOfMonths(e),r=n[1],r>1?e.dpDiv.addClass("ui-datepicker-multi-"+r).css("width",17*r+"em"):e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),e.dpDiv[(n[0]!=1||n[1]!=1?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e==b.datepicker._curInst&&b.datepicker._datepickerShowing&&e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&e.input.focus();if(e.yearshtml){var i=e.yearshtml;setTimeout(function(){i===e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),i=e.yearshtml=null},0)}},_getBorders:function(e){var t=function(e){return{thin:1,medium:2,thick:3}[e]||e};return[parseFloat(t(e.css("border-left-width"))),parseFloat(t(e.css("border-top-width")))]},_checkOffset:function(e,t,n){var r=e.dpDiv.outerWidth(),i=e.dpDiv.outerHeight(),s=e.input?e.input.outerWidth():0,o=e.input?e.input.outerHeight():0,u=document.documentElement.clientWidth+b(document).scrollLeft(),a=document.documentElement.clientHeight+b(document).scrollTop();return t.left-=this._get(e,"isRTL")?r-s:0,t.left-=n&&t.left==e.input.offset().left?b(document).scrollLeft():0,t.top-=n&&t.top==e.input.offset().top+o?b(document).scrollTop():0,t.left-=Math.min(t.left,t.left+r>u&&u>r?Math.abs(t.left+r-u):0),t.top-=Math.min(t.top,t.top+i>a&&a>i?Math.abs(i+o):0),t},_findPos:function(e){for(var t=this._get(this._getInst(e),"isRTL");e&&(e.type=="hidden"||e.nodeType!=1);)e=e[t?"previousSibling":"nextSibling"];return e=b(e).offset(),[e.left,e.top]},_hideDatepicker:function(e){var t=this._curInst;if(!(!t||e&&t!=b.data(e,"datepicker"))&&this._datepickerShowing){e=this._get(t,"showAnim");var n=this._get(t,"duration"),r=function(){b.datepicker._tidyDialog(t),this._curInst=null};b.effects&&b.effects[e]?t.dpDiv.hide(e,b.datepicker._get(t,"showOptions"),n,r):t.dpDiv[e=="slideDown"?"slideUp":e=="fadeIn"?"fadeOut":"hide"](e?n:null,r),e||r(),(e=this._get(t,"onClose"))&&e.apply(t.input?t.input[0]:null,[t.input?t.input.val():"",t]),this._datepickerShowing=!1,this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),b.blockUI&&(b.unblockUI(),b("body").append(this.dpDiv))),this._inDialog=!1}},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(e){b.datepicker._curInst&&(e=b(e.target),e[0].id!=b.datepicker._mainDivId&&e.parents("#"+b.datepicker._mainDivId).length==0&&!e.hasClass(b.datepicker.markerClassName)&&!e.hasClass(b.datepicker._triggerClass)&&b.datepicker._datepickerShowing&&(!b.datepicker._inDialog||!b.blockUI)&&b.datepicker._hideDatepicker())},_adjustDate:function(e,t,n){e=b(e);var r=this._getInst(e[0]);this._isDisabledDatepicker(e[0])||(this._adjustInstDate(r,t+(n=="M"?this._get(r,"showCurrentAtPos"):0),n),this._updateDatepicker(r))},_gotoToday:function(e){e=b(e);var t=this._getInst(e[0]);if(this._get(t,"gotoCurrent")&&t.currentDay)t.selectedDay=t.currentDay,t.drawMonth=t.selectedMonth=t.currentMonth,t.drawYear=t.selectedYear=t.currentYear;else{var n=new Date;t.selectedDay=n.getDate(),t.drawMonth=t.selectedMonth=n.getMonth(),t.drawYear=t.selectedYear=n.getFullYear()}this._notifyChange(t),this._adjustDate(e)},_selectMonthYear:function(e,t,n){e=b(e);var r=this._getInst(e[0]);r._selectingMonthYear=!1,r["selected"+(n=="M"?"Month":"Year")]=r["draw"+(n=="M"?"Month":"Year")]=parseInt(t.options[t.selectedIndex].value,10),this._notifyChange(r),this._adjustDate(e)},_clickMonthYear:function(e){var t=this._getInst(b(e)[0]);t.input&&t._selectingMonthYear&&setTimeout(function(){t.input.focus()},0),t._selectingMonthYear=!t._selectingMonthYear},_selectDay:function(e,t,n,r){var i=b(e);!b(r).hasClass(this._unselectableClass)&&!this._isDisabledDatepicker(i[0])&&(i=this._getInst(i[0]),i.selectedDay=i.currentDay=b("a",r).html(),i.selectedMonth=i.currentMonth=t,i.selectedYear=i.currentYear=n,this._selectDate(e,this._formatDate(i,i.currentDay,i.currentMonth,i.currentYear)))},_clearDate:function(e){e=b(e),this._getInst(e[0]),this._selectDate(e,"")},_selectDate:function(e,t){e=this._getInst(b(e)[0]),t=t!=null?t:this._formatDate(e),e.input&&e.input.val(t),this._updateAlternate(e);var n=this._get(e,"onSelect");n?n.apply(e.input?e.input[0]:null,[t,e]):e.input&&e.input.trigger("change"),e.inline?this._updateDatepicker(e):(this._hideDatepicker(),this._lastInput=e.input[0],typeof e.input[0]!="object"&&e.input.focus(),this._lastInput=null)},_updateAlternate:function(e){var t=this._get(e,"altField");if(t){var n=this._get(e,"altFormat")||this._get(e,"dateFormat"),r=this._getDate(e),i=this.formatDate(n,r,this._getFormatConfig(e));b(t).each(function(){b(this).val(i)})}},noWeekends:function(e){return e=e.getDay(),[e>0&&e<6,""]},iso8601Week:function(e){e=new Date(e.getTime()),e.setDate(e.getDate()+4-(e.getDay()||7));var t=e.getTime();return e.setMonth(0),e.setDate(1),Math.floor(Math.round((t-e)/864e5)/7)+1},parseDate:function(e,t,n){if(e==null||t==null)throw"Invalid arguments";t=typeof t=="object"?t.toString():t+"";if(t=="")return null;var r=(n?n.shortYearCutoff:null)||this._defaults.shortYearCutoff;r=typeof r!="string"?r:(new Date).getFullYear()%100+parseInt(r,10);for(var i=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,s=(n?n.dayNames:null)||this._defaults.dayNames,o=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,u=(n?n.monthNames:null)||this._defaults.monthNames,a=n=-1,f=-1,l=-1,c=!1,h=function(t){return(t=g+1<e.length&&e.charAt(g+1)==t)&&g++,t},p=function(e){var n=h(e);e=new RegExp("^\\d{1,"+(e=="@"?14:e=="!"?20:e=="y"&&n?4:e=="o"?3:2)+"}"),e=t.substring(m).match(e);if(!e)throw"Missing number at position "+m;return m+=e[0].length,parseInt(e[0],10)},d=function(e,n,r){e=h(e)?r:n;for(n=0;n<e.length;n++)if(t.substr(m,e[n].length).toLowerCase()==e[n].toLowerCase())return m+=e[n].length,n+1;throw"Unknown name at position "+m},v=function(){if(t.charAt(m)!=e.charAt(g))throw"Unexpected literal at position "+m;m++},m=0,g=0;g<e.length;g++)if(c)e.charAt(g)=="'"&&!h("'")?c=!1:v();else switch(e.charAt(g)){case"d":f=p("d");break;case"D":d("D",i,s);break;case"o":l=p("o");break;case"m":a=p("m");break;case"M":a=d("M",o,u);break;case"y":n=p("y");break;case"@":var y=new Date(p("@"));n=y.getFullYear(),a=y.getMonth()+1,f=y.getDate();break;case"!":y=new Date((p("!")-this._ticksTo1970)/1e4),n=y.getFullYear(),a=y.getMonth()+1,f=y.getDate();break;case"'":h("'")?v():c=!0;break;default:v()}n==-1?n=(new Date).getFullYear():n<100&&(n+=(new Date).getFullYear()-(new Date).getFullYear()%100+(n<=r?0:-100));if(l>-1){a=1,f=l;do{r=this._getDaysInMonth(n,a-1);if(f<=r)break;a++,f-=r}while(1)}y=this._daylightSavingAdjust(new Date(n,a-1,f));if(y.getFullYear()!=n||y.getMonth()+1!=a||y.getDate()!=f)throw"Invalid date";return y},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*24*60*60*1e7,formatDate:function(e,t,n){if(!t)return"";var r=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,i=(n?n.dayNames:null)||this._defaults.dayNames,s=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort;n=(n?n.monthNames:null)||this._defaults.monthNames;var o=function(t){return(t=c+1<e.length&&e.charAt(c+1)==t)&&c++,t},u=function(e,t,n){t=""+t;if(o(e))for(;t.length<n;)t="0"+t;return t},a=function(e,t,n,r){return o(e)?r[t]:n[t]},f="",l=!1;if(t)for(var c=0;c<e.length;c++)if(l)e.charAt(c)=="'"&&!o("'")?l=!1:f+=e.charAt(c);else switch(e.charAt(c)){case"d":f+=u("d",t.getDate(),2);break;case"D":f+=a("D",t.getDay(),r,i);break;case"o":f+=u("o",(t.getTime()-(new Date(t.getFullYear(),0,0)).getTime())/864e5,3);break;case"m":f+=u("m",t.getMonth()+1,2);break;case"M":f+=a("M",t.getMonth(),s,n);break;case"y":f+=o("y")?t.getFullYear():(t.getYear()%100<10?"0":"")+t.getYear()%100;break;case"@":f+=t.getTime();break;case"!":f+=t.getTime()*1e4+this._ticksTo1970;break;case"'":o("'")?f+="'":l=!0;break;default:f+=e.charAt(c)}return f},_possibleChars:function(e){for(var t="",n=!1,r=function(t){return(t=i+1<e.length&&e.charAt(i+1)==t)&&i++,t},i=0;i<e.length;i++)if(n)e.charAt(i)=="'"&&!r("'")?n=!1:t+=e.charAt(i);else switch(e.charAt(i)){case"d":case"m":case"y":case"@":t+="0123456789";break;case"D":case"M":return null;case"'":r("'")?t+="'":n=!0;break;default:t+=e.charAt(i)}return t},_get:function(e,t){return e.settings[t]!==c?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()!=e.lastVal){var n=this._get(e,"dateFormat"),r=e.lastVal=e.input?e.input.val():null,i,s;i=s=this._getDefaultDate(e);var o=this._getFormatConfig(e);try{i=this.parseDate(n,r,o)||s}catch(u){this.log(u),r=t?"":r}e.selectedDay=i.getDate(),e.drawMonth=e.selectedMonth=i.getMonth(),e.drawYear=e.selectedYear=i.getFullYear(),e.currentDay=r?i.getDate():0,e.currentMonth=r?i.getMonth():0,e.currentYear=r?i.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(e,t,n){var r=function(e){var t=new Date;return t.setDate(t.getDate()+e),t},i=function(t){try{return b.datepicker.parseDate(b.datepicker._get(e,"dateFormat"),t,b.datepicker._getFormatConfig(e))}catch(n){}var r=(t.toLowerCase().match(/^c/)?b.datepicker._getDate(e):null)||new Date,i=r.getFullYear(),s=r.getMonth();r=r.getDate();for(var o=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,u=o.exec(t);u;){switch(u[2]||"d"){case"d":case"D":r+=parseInt(u[1],10);break;case"w":case"W":r+=parseInt(u[1],10)*7;break;case"m":case"M":s+=parseInt(u[1],10),r=Math.min(r,b.datepicker._getDaysInMonth(i,s));break;case"y":case"Y":i+=parseInt(u[1],10),r=Math.min(r,b.datepicker._getDaysInMonth(i,s))}u=o.exec(t)}return new Date(i,s,r)};if(t=(t=t==null||t===""?n:typeof t=="string"?i(t):typeof t=="number"?isNaN(t)?n:r(t):new Date(t.getTime()))&&t.toString()=="Invalid Date"?n:t)t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0);return this._daylightSavingAdjust(t)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,n){var r=!t,i=e.selectedMonth,s=e.selectedYear;t=this._restrictMinMax(e,this._determineDate(e,t,new Date)),e.selectedDay=e.currentDay=t.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=t.getMonth(),e.drawYear=e.selectedYear=e.currentYear=t.getFullYear(),(i!=e.selectedMonth||s!=e.selectedYear)&&!n&&this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(r?"":this._formatDate(e))},_getDate:function(e){return!e.currentYear||e.input&&e.input.val()==""?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay))},_generateHTML:function(t){var n=new Date;n=this._daylightSavingAdjust(new Date(n.getFullYear(),n.getMonth(),n.getDate()));var r=this._get(t,"isRTL"),i=this._get(t,"showButtonPanel"),s=this._get(t,"hideIfNoPrevNext"),o=this._get(t,"navigationAsDateFormat"),u=this._getNumberOfMonths(t),a=this._get(t,"showCurrentAtPos"),f=this._get(t,"stepMonths"),l=u[0]!=1||u[1]!=1,c=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),h=this._getMinMaxDate(t,"min"),p=this._getMinMaxDate(t,"max");a=t.drawMonth-a;var d=t.drawYear;a<0&&(a+=12,d--);if(p){var v=this._daylightSavingAdjust(new Date(p.getFullYear(),p.getMonth()-u[0]*u[1]+1,p.getDate()));for(v=h&&v<h?h:v;this._daylightSavingAdjust(new Date(d,a,1))>v;)a--,a<0&&(a=11,d--)}t.drawMonth=a,t.drawYear=d,v=this._get(t,"prevText"),v=o?this.formatDate(v,this._daylightSavingAdjust(new Date(d,a-f,1)),this._getFormatConfig(t)):v,v=this._canAdjustMonth(t,-1,d,a)?'<a class="ui-datepicker-prev ui-corner-all" onclick="DP_jQuery_'+e+".datepicker._adjustDate('#"+t.id+"', -"+f+", 'M');\" title=\""+v+'"><span class="ui-icon ui-icon-circle-triangle-'+(r?"e":"w")+'">'+v+"</span></a>":s?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+v+'"><span class="ui-icon ui-icon-circle-triangle-'+(r?"e":"w")+'">'+v+"</span></a>";var m=this._get(t,"nextText");m=o?this.formatDate(m,this._daylightSavingAdjust(new Date(d,a+f,1)),this._getFormatConfig(t)):m,s=this._canAdjustMonth(t,1,d,a)?'<a class="ui-datepicker-next ui-corner-all" onclick="DP_jQuery_'+e+".datepicker._adjustDate('#"+t.id+"', +"+f+", 'M');\" title=\""+m+'"><span class="ui-icon ui-icon-circle-triangle-'+(r?"w":"e")+'">'+m+"</span></a>":s?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+m+'"><span class="ui-icon ui-icon-circle-triangle-'+(r?"w":"e")+'">'+m+"</span></a>",f=this._get(t,"currentText"),m=this._get(t,"gotoCurrent")&&t.currentDay?c:n,f=o?this.formatDate(f,m,this._getFormatConfig(t)):f,o=t.inline?"":'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" onclick="DP_jQuery_'+e+'.datepicker._hideDatepicker();">'+this._get(t,"closeText")+"</button>",i=i?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(r?o:"")+(this._isInRange(t,m)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" onclick="DP_jQuery_'+e+".datepicker._gotoToday('#"+t.id+"');\">"+f+"</button>":"")+(r?"":o)+"</div>":"",o=parseInt(this._get(t,"firstDay"),10),o=isNaN(o)?0:o,f=this._get(t,"showWeek"),m=this._get(t,"dayNames"),this._get(t,"dayNamesShort");var g=this._get(t,"dayNamesMin"),y=this._get(t,"monthNames"),w=this._get(t,"monthNamesShort"),E=this._get(t,"beforeShowDay"),S=this._get(t,"showOtherMonths"),x=this._get(t,"selectOtherMonths");this._get(t,"calculateWeek");for(var T=this._getDefaultDate(t),N="",C=0;C<u[0];C++){for(var k="",L=0;L<u[1];L++){var A=this._daylightSavingAdjust(new Date(d,a,t.selectedDay)),O=" ui-corner-all",M="";if(l){M+='<div class="ui-datepicker-group';if(u[1]>1)switch(L){case 0:M+=" ui-datepicker-group-first",O=" ui-corner-"+(r?"right":"left");break;case u[1]-1:M+=" ui-datepicker-group-last",O=" ui-corner-"+(r?"left":"right");break;default:M+=" ui-datepicker-group-middle",O=""}M+='">'}M+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+O+'">'+(/all|left/.test(O)&&C==0?r?s:v:"")+(/all|right/.test(O)&&C==0?r?v:s:"")+this._generateMonthYearHeader(t,a,d,h,p,C>0||L>0,y,w)+'</div><table class="ui-datepicker-calendar"><thead><tr>';var _=f?'<th class="ui-datepicker-week-col">'+this._get(t,"weekHeader")+"</th>":"";for(O=0;O<7;O++){var D=(O+o)%7;_+="<th"+((O+o+6)%7>=5?' class="ui-datepicker-week-end"':"")+'><span title="'+m[D]+'">'+g[D]+"</span></th>"}M+=_+"</tr></thead><tbody>",_=this._getDaysInMonth(d,a),d==t.selectedYear&&a==t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,_)),O=(this._getFirstDayOfMonth(d,a)-o+7)%7,_=l?6:Math.ceil((O+_)/7),D=this._daylightSavingAdjust(new Date(d,a,1-O));for(var P=0;P<_;P++){M+="<tr>";var H=f?'<td class="ui-datepicker-week-col">'+this._get(t,"calculateWeek")(D)+"</td>":"";for(O=0;O<7;O++){var B=E?E.apply(t.input?t.input[0]:null,[D]):[!0,""],j=D.getMonth()!=a,F=j&&!x||!B[0]||h&&D<h||p&&D>p;H+='<td class="'+((O+o+6)%7>=5?" ui-datepicker-week-end":"")+(j?" ui-datepicker-other-month":"")+(D.getTime()==A.getTime()&&a==t.selectedMonth&&t._keyEvent||T.getTime()==D.getTime()&&T.getTime()==A.getTime()?" "+this._dayOverClass:"")+(F?" "+this._unselectableClass+" ui-state-disabled":"")+(j&&!S?"":" "+B[1]+(D.getTime()==c.getTime()?" "+this._currentClass:"")+(D.getTime()==n.getTime()?" ui-datepicker-today":""))+'"'+((!j||S)&&B[2]?' title="'+B[2]+'"':"")+(F?"":' onclick="DP_jQuery_'+e+".datepicker._selectDay('#"+t.id+"',"+D.getMonth()+","+D.getFullYear()+', this);return false;"')+">"+(j&&!S?"&#xa0;":F?'<span class="ui-state-default">'+D.getDate()+"</span>":'<a class="ui-state-default'+(D.getTime()==n.getTime()?" ui-state-highlight":"")+(D.getTime()==c.getTime()?" ui-state-active":"")+(j?" ui-priority-secondary":"")+'" href="#">'+D.getDate()+"</a>")+"</td>",D.setDate(D.getDate()+1),D=this._daylightSavingAdjust(D)}M+=H+"</tr>"}a++,a>11&&(a=0,d++),M+="</tbody></table>"+(l?"</div>"+(u[0]>0&&L==u[1]-1?'<div class="ui-datepicker-row-break"></div>':""):""),k+=M}N+=k}return N+=i+(b.browser.msie&&parseInt(b.browser.version,10)<7&&!t.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':""),t._keyEvent=!1,N},_generateMonthYearHeader:function(t,n,r,i,s,o,u,a){var f=this._get(t,"changeMonth"),l=this._get(t,"changeYear"),c=this._get(t,"showMonthAfterYear"),h='<div class="ui-datepicker-title">',p="";if(o||!f)p+='<span class="ui-datepicker-month">'+u[n]+"</span>";else{u=i&&i.getFullYear()==r;var d=s&&s.getFullYear()==r;p+='<select class="ui-datepicker-month" onchange="DP_jQuery_'+e+".datepicker._selectMonthYear('#"+t.id+"', this, 'M');\" onclick=\"DP_jQuery_"+e+".datepicker._clickMonthYear('#"+t.id+"');\">";for(var v=0;v<12;v++)(!u||v>=i.getMonth())&&(!d||v<=s.getMonth())&&(p+='<option value="'+v+'"'+(v==n?' selected="selected"':"")+">"+a[v]+"</option>");p+="</select>"}c||(h+=p+(o||!f||!l?"&#xa0;":"")),t.yearshtml="";if(o||!l)h+='<span class="ui-datepicker-year">'+r+"</span>";else{a=this._get(t,"yearRange").split(":");var m=(new Date).getFullYear();u=function(e){return e=e.match(/c[+-].*/)?r+parseInt(e.substring(1),10):e.match(/[+-].*/)?m+parseInt(e,10):parseInt(e,10),isNaN(e)?m:e},n=u(a[0]),a=Math.max(n,u(a[1]||"")),n=i?Math.max(n,i.getFullYear()):n,a=s?Math.min(a,s.getFullYear()):a;for(t.yearshtml+='<select class="ui-datepicker-year" onchange="DP_jQuery_'+e+".datepicker._selectMonthYear('#"+t.id+"', this, 'Y');\" onclick=\"DP_jQuery_"+e+".datepicker._clickMonthYear('#"+t.id+"');\">";n<=a;n++)t.yearshtml+='<option value="'+n+'"'+(n==r?' selected="selected"':"")+">"+n+"</option>";t.yearshtml+="</select>",b.browser.mozilla?h+='<select class="ui-datepicker-year"><option value="'+r+'" selected="selected">'+r+"</option></select>":(h+=t.yearshtml,t.yearshtml=null)}return h+=this._get(t,"yearSuffix"),c&&(h+=(o||!f||!l?"&#xa0;":"")+p),h+="</div>",h},_adjustInstDate:function(e,t,n){var r=e.drawYear+(n=="Y"?t:0),i=e.drawMonth+(n=="M"?t:0);t=Math.min(e.selectedDay,this._getDaysInMonth(r,i))+(n=="D"?t:0),r=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(r,i,t))),e.selectedDay=r.getDate(),e.drawMonth=e.selectedMonth=r.getMonth(),e.drawYear=e.selectedYear=r.getFullYear(),(n=="M"||n=="Y")&&this._notifyChange(e)},_restrictMinMax:function(e,t){var n=this._getMinMaxDate(e,"min");return e=this._getMinMaxDate(e,"max"),t=n&&t<n?n:t,t=e&&t>e?e:t},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){return e=this._get(e,"numberOfMonths"),e==null?[1,1]:typeof e=="number"?[1,e]:e},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return(new Date(e,t,1)).getDay()},_canAdjustMonth:function(e,t,n,r){var i=this._getNumberOfMonths(e);return n=this._daylightSavingAdjust(new Date(n,r+(t<0?t:i[0]*i[1]),1)),t<0&&n.setDate(this._getDaysInMonth(n.getFullYear(),n.getMonth())),this._isInRange(e,n)},_isInRange:function(e,t){var n=this._getMinMaxDate(e,"min");return e=this._getMinMaxDate(e,"max"),(!n||t.getTime()>=n.getTime())&&(!e||t.getTime()<=e.getTime())},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return t=typeof t!="string"?t:(new Date).getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,n,r){return t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear),t=t?typeof t=="object"?t:this._daylightSavingAdjust(new Date(r,n,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay)),this.formatDate(this._get(e,"dateFormat"),t,this._getFormatConfig(e))}}),b.fn.datepicker=function(e){b.datepicker.initialized||(b(document).mousedown(b.datepicker._checkExternalClick).find("body").append(b.datepicker.dpDiv),b.datepicker.initialized=!0);var t=Array.prototype.slice.call(arguments,1);return typeof e!="string"||e!="isDisabled"&&e!="getDate"&&e!="widget"?e=="option"&&arguments.length==2&&typeof arguments[1]=="string"?b.datepicker["_"+e+"Datepicker"].apply(b.datepicker,[this[0]].concat(t)):this.each(function(){typeof e=="string"?b.datepicker["_"+e+"Datepicker"].apply(b.datepicker,[this].concat(t)):b.datepicker._attachDatepicker(this,e)}):b.datepicker["_"+e+"Datepicker"].apply(b.datepicker,[this[0]].concat(t))},b.datepicker=new f,b.datepicker.initialized=!1,b.datepicker.uuid=(new Date).getTime(),b.datepicker.version="1.8.9",window["DP_jQuery_"+e]=b}(jQuery),function(e,t){var n={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},r={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};e.widget("ui.dialog",{options:{autoOpen:!0,buttons:{},closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:!1,maxWidth:!1,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",collision:"fit",using:function(t){var n=e(this).css(t).offset().top;n<0&&e(this).css("top",t.top-n)}},resizable:!0,show:null,stack:!0,title:"",width:300,zIndex:1e3},_create:function(){this.originalTitle=this.element.attr("title"),typeof this.originalTitle!="string"&&(this.originalTitle=""),this.options.title=this.options.title||this.originalTitle;var t=this,n=t.options,r=n.title||"&#160;",i=e.ui.dialog.getTitleId(t.element),s=(t.uiDialog=e("<div></div>")).appendTo(document.body).hide().addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+n.dialogClass).css({zIndex:n.zIndex}).attr("tabIndex",-1).css("outline",0).keydown(function(r){n.closeOnEscape&&r.keyCode&&r.keyCode===e.ui.keyCode.ESCAPE&&(t.close(r),r.preventDefault())}).attr({role:"dialog","aria-labelledby":i}).mousedown(function(e){t.moveToTop(!1,e)});t.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(s);var o=(t.uiDialogTitlebar=e("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(s),u=e('<a href="#"></a>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role","button").hover(function(){u.addClass("ui-state-hover")},function(){u.removeClass("ui-state-hover")}).focus(function(){u.addClass("ui-state-focus")}).blur(function(){u.removeClass("ui-state-focus")}).click(function(e){return t.close(e),!1}).appendTo(o);(t.uiDialogTitlebarCloseText=e("<span></span>")).addClass("ui-icon ui-icon-closethick").text(n.closeText).appendTo(u),e("<span></span>").addClass("ui-dialog-title").attr("id",i).html(r).prependTo(o),e.isFunction(n.beforeclose)&&!e.isFunction(n.beforeClose)&&(n.beforeClose=n.beforeclose),o.find("*").add(o).disableSelection(),n.draggable&&e.fn.draggable&&t._makeDraggable(),n.resizable&&e.fn.resizable&&t._makeResizable(),t._createButtons(n.buttons),t._isOpen=!1,e.fn.bgiframe&&s.bgiframe()},_init:function(){this.options.autoOpen&&this.open()},destroy:function(){var e=this;return e.overlay&&e.overlay.destroy(),e.uiDialog.hide(),e.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body"),e.uiDialog.remove(),e.originalTitle&&e.element.attr("title",e.originalTitle),e},widget:function(){return this.uiDialog},close:function(t){var n=this,r,i;if(!1!==n._trigger("beforeClose",t))return n.overlay&&n.overlay.destroy(),n.uiDialog.unbind("keypress.ui-dialog"),n._isOpen=!1,n.options.hide?n.uiDialog.hide(n.options.hide,function(){n._trigger("close",t)}):(n.uiDialog.hide(),n._trigger("close",t)),e.ui.dialog.overlay.resize(),n.options.modal&&(r=0,e(".ui-dialog").each(function(){this!==n.uiDialog[0]&&(i=e(this).css("z-index"),isNaN(i)||(r=Math.max(r,i)))}),e.ui.dialog.maxZ=r),n},isOpen:function(){return this._isOpen},moveToTop:function(t,n){var r=this,i=r.options;return i.modal&&!t||!i.stack&&!i.modal?r._trigger("focus",n):(i.zIndex>e.ui.dialog.maxZ&&(e.ui.dialog.maxZ=i.zIndex),r.overlay&&(e.ui.dialog.maxZ+=1,r.overlay.$el.css("z-index",e.ui.dialog.overlay.maxZ=e.ui.dialog.maxZ)),t={scrollTop:r.element.attr("scrollTop"),scrollLeft:r.element.attr("scrollLeft")},e.ui.dialog.maxZ+=1,r.uiDialog.css("z-index",e.ui.dialog.maxZ),r.element.attr(t),r._trigger("focus",n),r)},open:function(){if(!this._isOpen){var t=this,n=t.options,r=t.uiDialog;return t.overlay=n.modal?new e.ui.dialog.overlay(t):null,t._size(),t._position(n.position),r.show(n.show),t.moveToTop(!0),n.modal&&r.bind("keypress.ui-dialog",function(t){if(t.keyCode===e.ui.keyCode.TAB){var n=e(":tabbable",this),r=n.filter(":first");n=n.filter(":last");if(t.target===n[0]&&!t.shiftKey)return r.focus(1),!1;if(t.target===r[0]&&t.shiftKey)return n.focus(1),!1}}),e(t.element.find(":tabbable").get().concat(r.find(".ui-dialog-buttonpane :tabbable").get().concat(r.get()))).eq(0).focus(),t._isOpen=!0,t._trigger("open"),t}},_createButtons:function(t){var n=this,r=!1,i=e("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),s=e("<div></div>").addClass("ui-dialog-buttonset").appendTo(i);n.uiDialog.find(".ui-dialog-buttonpane").remove(),typeof t=="object"&&t!==null&&e.each(t,function(){return!(r=!0)}),r&&(e.each(t,function(t,r){r=e.isFunction(r)?{click:r,text:t}:r,t=e('<button type="button"></button>').attr(r,!0).unbind("click").click(function(){r.click.apply(n.element[0],arguments)}).appendTo(s),e.fn.button&&t.button()}),i.appendTo(n.uiDialog))},_makeDraggable:function(){function t(e){return{position:e.position,offset:e.offset}}var n=this,r=n.options,i=e(document),s;n.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(i,o){s=r.height==="auto"?"auto":e(this).height(),e(this).height(e(this).height()).addClass("ui-dialog-dragging"),n._trigger("dragStart",i,t(o))},drag:function(e,r){n._trigger("drag",e,t(r))},stop:function(o,u){r.position=[u.position.left-i.scrollLeft(),u.position.top-i.scrollTop()],e(this).removeClass("ui-dialog-dragging").height(s),n._trigger("dragStop",o,t(u)),e.ui.dialog.overlay.resize()}})},_makeResizable:function(n){function r(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}n=n===t?this.options.resizable:n;var i=this,s=i.options,o=i.uiDialog.css("position");n=typeof n=="string"?n:"n,e,s,w,se,sw,ne,nw",i.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:i.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:i._minHeight(),handles:n,start:function(t,n){e(this).addClass("ui-dialog-resizing"),i._trigger("resizeStart",t,r(n))},resize:function(e,t){i._trigger("resize",e,r(t))},stop:function(t,n){e(this).removeClass("ui-dialog-resizing"),s.height=e(this).height(),s.width=e(this).width(),i._trigger("resizeStop",t,r(n)),e.ui.dialog.overlay.resize()}}).css("position",o).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var e=this.options;return e.height==="auto"?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(t){var n=[],r=[0,0],i;if(t){if(typeof t=="string"||typeof t=="object"&&"0"in t)n=t.split?t.split(" "):[t[0],t[1]],n.length===1&&(n[1]=n[0]),e.each(["left","top"],function(e,t){+n[e]===n[e]&&(r[e]=n[e],n[e]=t)}),t={my:n.join(" "),at:n.join(" "),offset:r.join(" ")};t=e.extend({},e.ui.dialog.prototype.options.position,t)}else t=e.ui.dialog.prototype.options.position;(i=this.uiDialog.is(":visible"))||this.uiDialog.show(),this.uiDialog.css({top:0,left:0}).position(e.extend({of:window},t)),i||this.uiDialog.hide()},_setOptions:function(t){var i=this,s={},o=!1;e.each(t,function(e,t){i._setOption(e,t),e in n&&(o=!0),e in r&&(s[e]=t)}),o&&this._size(),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",s)},_setOption:function(t,n){var r=this,i=r.uiDialog;switch(t){case"beforeclose":t="beforeClose";break;case"buttons":r._createButtons(n);break;case"closeText":r.uiDialogTitlebarCloseText.text(""+n);break;case"dialogClass":i.removeClass(r.options.dialogClass).addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+n);break;case"disabled":n?i.addClass("ui-dialog-disabled"):i.removeClass("ui-dialog-disabled");break;case"draggable":var s=i.is(":data(draggable)");s&&!n&&i.draggable("destroy"),!s&&n&&r._makeDraggable();break;case"position":r._position(n);break;case"resizable":(s=i.is(":data(resizable)"))&&!n&&i.resizable("destroy"),s&&typeof n=="string"&&i.resizable("option","handles",n),!s&&n!==!1&&r._makeResizable(n);break;case"title":e(".ui-dialog-title",r.uiDialogTitlebar).html(""+(n||"&#160;"))}e.Widget.prototype._setOption.apply(r,arguments)},_size:function(){var t=this.options,n,r,i=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0}),t.minWidth>t.width&&(t.width=t.minWidth),n=this.uiDialog.css({height:"auto",width:t.width}).height(),r=Math.max(0,t.minHeight-n),t.height==="auto"?e.support.minHeight?this.element.css({minHeight:r,height:"auto"}):(this.uiDialog.show(),t=this.element.css("height","auto").height(),i||this.uiDialog.hide(),this.element.height(Math.max(t,r))):this.element.height(Math.max(t.height-n,0)),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}}),e.extend(e.ui.dialog,{version:"1.8.9",uuid:0,maxZ:0,getTitleId:function(e){return e=e.attr("id"),e||(this.uuid+=1,e=this.uuid),"ui-dialog-title-"+e},overlay:function(t){this.$el=e.ui.dialog.overlay.create(t)}}),e.extend(e.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:e.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(e){return e+".dialog-overlay"}).join(" "),create:function(t){this.instances.length===0&&(setTimeout(function(){e.ui.dialog.overlay.instances.length&&e(document).bind(e.ui.dialog.overlay.events,function(t){if(e(t.target).zIndex()<e.ui.dialog.overlay.maxZ)return!1})},1),e(document).bind("keydown.dialog-overlay",function(n){t.options.closeOnEscape&&n.keyCode&&n.keyCode===e.ui.keyCode.ESCAPE&&(t.close(n),n.preventDefault())}),e(window).bind("resize.dialog-overlay",e.ui.dialog.overlay.resize));var n=(this.oldInstances.pop()||e("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),height:this.height()});return e.fn.bgiframe&&n.bgiframe(),this.instances.push(n),n},destroy:function(t){var n=e.inArray(t,this.instances);n!=-1&&this.oldInstances.push(this.instances.splice(n,1)[0]),this.instances.length===0&&e([document,window]).unbind(".dialog-overlay"),t.remove();var r=0;e.each(this.instances,function(){r=Math.max(r,this.css("z-index"))}),this.maxZ=r},height:function(){var t,n;return e.browser.msie&&e.browser.version<7?(t=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),n=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight),t<n?e(window).height()+"px":t+"px"):e(document).height()+"px"},width:function(){var t,n;return e.browser.msie&&e.browser.version<7?(t=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),n=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth),t<n?e(window).width()+"px":t+"px"):e(document).width()+"px"},resize:function(){var t=e([]);e.each(e.ui.dialog.overlay.instances,function(){t=t.add(this)}),t.css({width:0,height:0}).css({width:e.ui.dialog.overlay.width(),height:e.ui.dialog.overlay.height()})}}),e.extend(e.ui.dialog.overlay.prototype,{destroy:function(){e.ui.dialog.overlay.destroy(this.$el)}})}(jQuery),function(e){e.ui=e.ui||{};var t=/left|center|right/,n=/top|center|bottom/,r=e.fn.position,i=e.fn.offset;e.fn.position=function(i){if(!i||!i.of)return r.apply(this,arguments);i=e.extend({},i);var s=e(i.of),o=s[0],u=(i.collision||"flip").split(" "),a=i.offset?i.offset.split(" "):[0,0],l,h,p;return o.nodeType===9?(l=s.width(),h=s.height(),p={top:0,left:0}):o.setTimeout?(l=s.width(),h=s.height(),p={top:s.scrollTop(),left:s.scrollLeft()}):o.preventDefault?(i.at="left top",l=h=0,p={top:i.of.pageY,left:i.of.pageX}):(l=s.outerWidth(),h=s.outerHeight(),p=s.offset()),e.each(["my","at"],function(){var e=(i[this]||"").split(" ");e.length===1&&(e=t.test(e[0])?e.concat(["center"]):n.test(e[0])?["center"].concat(e):["center","center"]),e[0]=t.test(e[0])?e[0]:"center",e[1]=n.test(e[1])?e[1]:"center",i[this]=e}),u.length===1&&(u[1]=u[0]),a[0]=parseInt(a[0],10)||0,a.length===1&&(a[1]=a[0]),a[1]=parseInt(a[1],10)||0,i.at[0]==="right"?p.left+=l:i.at[0]==="center"&&(p.left+=l/2),i.at[1]==="bottom"?p.top+=h:i.at[1]==="center"&&(p.top+=h/2),p.left+=a[0],p.top+=a[1],this.each(function(){var t=e(this),n=t.outerWidth(),r=t.outerHeight(),s=parseInt(e.curCSS(this,"marginLeft",!0))||0,o=parseInt(e.curCSS(this,"marginTop",!0))||0,f=n+s+(parseInt(e.curCSS(this,"marginRight",!0))||0),c=r+o+(parseInt(e.curCSS(this,"marginBottom",!0))||0),d=e.extend({},p),v;i.my[0]==="right"?d.left-=n:i.my[0]==="center"&&(d.left-=n/2),i.my[1]==="bottom"?d.top-=r:i.my[1]==="center"&&(d.top-=r/2),d.left=Math.round(d.left),d.top=Math.round(d.top),v={left:d.left-s,top:d.top-o},e.each(["left","top"],function(t,s){e.ui.position[u[t]]&&e.ui.position[u[t]][s](d,{targetWidth:l,targetHeight:h,elemWidth:n,elemHeight:r,collisionPosition:v,collisionWidth:f,collisionHeight:c,offset:a,my:i.my,at:i.at})}),e.fn.bgiframe&&t.bgiframe(),t.offset(e.extend(d,{using:i.using}))})},e.ui.position={fit:{left:function(t,n){var r=e(window);r=n.collisionPosition.left+n.collisionWidth-r.width()-r.scrollLeft(),t.left=r>0?t.left-r:Math.max(t.left-n.collisionPosition.left,t.left)},top:function(t,n){var r=e(window);r=n.collisionPosition.top+n.collisionHeight-r.height()-r.scrollTop(),t.top=r>0?t.top-r:Math.max(t.top-n.collisionPosition.top,t.top)}},flip:{left:function(t,n){if(n.at[0]!=="center"){var r=e(window);r=n.collisionPosition.left+n.collisionWidth-r.width()-r.scrollLeft();var i=n.my[0]==="left"?-n.elemWidth:n.my[0]==="right"?n.elemWidth:0,s=n.at[0]==="left"?n.targetWidth:-n.targetWidth,o=-2*n.offset[0];t.left+=n.collisionPosition.left<0?i+s+o:r>0?i+s+o:0}},top:function(t,n){if(n.at[1]!=="center"){var r=e(window);r=n.collisionPosition.top+n.collisionHeight-r.height()-r.scrollTop();var i=n.my[1]==="top"?-n.elemHeight:n.my[1]==="bottom"?n.elemHeight:0,s=n.at[1]==="top"?n.targetHeight:-n.targetHeight,o=-2*n.offset[1];t.top+=n.collisionPosition.top<0?i+s+o:r>0?i+s+o:0}}}},e.offset.setOffset||(e.offset.setOffset=function(t,n){/static/.test(e.curCSS(t,"position"))&&(t.style.position="relative");var r=e(t),i=r.offset(),s=parseInt(e.curCSS(t,"top",!0),10)||0,o=parseInt(e.curCSS(t,"left",!0),10)||0;i={top:n.top-i.top+s,left:n.left-i.left+o},"using"in n?n.using.call(t,i):r.css(i)},e.fn.offset=function(t){var n=this[0];return!n||!n.ownerDocument?null:t?this.each(function(){e.offset.setOffset(this,t)}):i.call(this)})}(jQuery),function(e,t){e.widget("ui.progressbar",{options:{value:0,max:100},min:0,_create:function(){this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min,"aria-valuemax":this.options.max,"aria-valuenow":this._value()}),this.valueDiv=e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this.oldValue=this._value(),this._refreshValue()},destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove(),e.Widget.prototype.destroy.apply(this,arguments)},value:function(e){return e===t?this._value():(this._setOption("value",e),this)},_setOption:function(t,n){t==="value"&&(this.options.value=n,this._refreshValue(),this._value()===this.options.max&&this._trigger("complete")),e.Widget.prototype._setOption.apply(this,arguments)},_value:function(){var e=this.options.value;return typeof e!="number"&&(e=0),Math.min(this.options.max,Math.max(this.min,e))},_percentage:function(){return 100*this._value()/this.options.max},_refreshValue:function(){var e=this.value(),t=this._percentage();this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),this.valueDiv.toggleClass("ui-corner-right",e===this.options.max).width(t.toFixed(0)+"%"),this.element.attr("aria-valuenow",e)}}),e.extend(e.ui.progressbar,{version:"1.8.9"})}(jQuery),function(e){e.widget("ui.slider",e.ui.mouse,{widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var t=this,n=this.options;this._mouseSliding=this._keySliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),n.disabled&&this.element.addClass("ui-slider-disabled ui-disabled"),this.range=e([]),n.range&&(n.range===!0?(this.range=e("<div></div>"),n.values||(n.values=[this._valueMin(),this._valueMin()]),n.values.length&&n.values.length!==2&&(n.values=[n.values[0],n.values[0]])):this.range=e("<div></div>"),this.range.appendTo(this.element).addClass("ui-slider-range"),(n.range==="min"||n.range==="max")&&this.range.addClass("ui-slider-range-"+n.range),this.range.addClass("ui-widget-header")),e(".ui-slider-handle",this.element).length===0&&e("<a href='#'></a>").appendTo(this.element).addClass("ui-slider-handle");if(n.values&&n.values.length)for(;e(".ui-slider-handle",this.element).length<n.values.length;)e("<a href='#'></a>").appendTo(this.element).addClass("ui-slider-handle");this.handles=e(".ui-slider-handle",this.element).addClass("ui-state-default ui-corner-all"),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(e){e.preventDefault()}).hover(function(){n.disabled||e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")}).focus(function(){n.disabled?e(this).blur():(e(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),e(this).addClass("ui-state-focus"))}).blur(function(){e(this).removeClass("ui-state-focus")}),this.handles.each(function(t){e(this).data("index.ui-slider-handle",t)}),this.handles.keydown(function(n){var r=!0,i=e(this).data("index.ui-slider-handle"),s,o,u;if(!t.options.disabled){switch(n.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:r=!1;if(!t._keySliding){t._keySliding=!0,e(this).addClass("ui-state-active"),s=t._start(n,i);if(s===!1)return}}u=t.options.step,s=t.options.values&&t.options.values.length?o=t.values(i):o=t.value();switch(n.keyCode){case e.ui.keyCode.HOME:o=t._valueMin();break;case e.ui.keyCode.END:o=t._valueMax();break;case e.ui.keyCode.PAGE_UP:o=t._trimAlignValue(s+(t._valueMax()-t._valueMin())/5);break;case e.ui.keyCode.PAGE_DOWN:o=t._trimAlignValue(s-(t._valueMax()-t._valueMin())/5);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(s===t._valueMax())return;o=t._trimAlignValue(s+u);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(s===t._valueMin())return;o=t._trimAlignValue(s-u)}return t._slide(n,i,o),r}}).keyup(function(n){var r=e(this).data("index.ui-slider-handle");t._keySliding&&(t._keySliding=!1,t._stop(n,r),t._change(n,r),e(this).removeClass("ui-state-active"))}),this._refreshValue(),this._animateOff=!1},destroy:function(){return this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider"),this._mouseDestroy(),this},_mouseCapture:function(t){var n=this.options,r,i,s,o,u;return n.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),r=this._normValueFromMouse({x:t.pageX,y:t.pageY}),i=this._valueMax()-this._valueMin()+1,o=this,this.handles.each(function(t){var n=Math.abs(r-o.values(t));i>n&&(i=n,s=e(this),u=t)}),n.range===!0&&this.values(1)===n.min&&(u+=1,s=e(this.handles[u])),this._start(t,u)===!1?!1:(this._mouseSliding=!0,o._handleIndex=u,s.addClass("ui-state-active").focus(),n=s.offset(),this._clickOffset=e(t.target).parents().andSelf().is(".ui-slider-handle")?{left:t.pageX-n.left-s.width()/2,top:t.pageY-n.top-s.height()/2-(parseInt(s.css("borderTopWidth"),10)||0)-(parseInt(s.css("borderBottomWidth"),10)||0)+(parseInt(s.css("marginTop"),10)||0)}:{left:0,top:0},this.handles.hasClass("ui-state-hover")||this._slide(t,u,r),this._animateOff=!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t=this._normValueFromMouse({x:e.pageX,y:e.pageY});return this._slide(e,this._handleIndex,t),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._clickOffset=this._handleIndex=null,this._animateOff=!1},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(e){var t;return this.orientation==="horizontal"?(t=this.elementSize.width,e=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,e=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),t=e/t,t>1&&(t=1),t<0&&(t=0),this.orientation==="vertical"&&(t=1-t),e=this._valueMax()-this._valueMin(),this._trimAlignValue(this._valueMin()+t*e)},_start:function(e,t){var n={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("start",e,n)},_slide:function(e,t,n){var r;this.options.values&&this.options.values.length?(r=this.values(t?0:1),this.options.values.length===2&&this.options.range===!0&&(t===0&&n>r||t===1&&n<r)&&(n=r),n!==this.values(t)&&(r=this.values(),r[t]=n,e=this._trigger("slide",e,{handle:this.handles[t],value:n,values:r}),this.values(t?0:1),e!==!1&&this.values(t,n,!0))):n!==this.value()&&(e=this._trigger("slide",e,{handle:this.handles[t],value:n}),e!==!1&&this.value(n))},_stop:function(e,t){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("stop",e,n)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("change",e,n)}},value:function(e){return arguments.length&&(this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0)),this._value()},values:function(t,n){var r,i,s;arguments.length>1&&(this.options.values[t]=this._trimAlignValue(n),this._refreshValue(),this._change(null,t));if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();r=this.options.values,i=arguments[0];for(s=0;s<r.length;s+=1)r[s]=this._trimAlignValue(i[s]),this._change(null,s);this._refreshValue()},_setOption:function(t,n){var r,i=0;e.isArray(this.options.values)&&(i=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments);switch(t){case"disabled":n?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.attr("disabled","disabled"),this.element.addClass("ui-disabled")):(this.handles.removeAttr("disabled"),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":this._animateOff=!0,this._refreshValue();for(r=0;r<i;r+=1)this._change(null,r);this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,n;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);t=this.options.values.slice();for(n=0;n<t.length;n+=1)t[n]=this._trimAlignValue(t[n]);return t},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,n=(e-this._valueMin())%t;return alignValue=e-n,Math.abs(n)*2>=t&&(alignValue+=n>0?t:-t),parseFloat(alignValue.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t=this.options.range,n=this.options,r=this,i=this._animateOff?!1:n.animate,s,o={},u,a,f,l;this.options.values&&this.options.values.length?this.handles.each(function(t){s=(r.values(t)-r._valueMin())/(r._valueMax()-r._valueMin())*100,o[r.orientation==="horizontal"?"left":"bottom"]=s+"%",e(this).stop(1,1)[i?"animate":"css"](o,n.animate),r.options.range===!0&&(r.orientation==="horizontal"?(t===0&&r.range.stop(1,1)[i?"animate":"css"]({left:s+"%"},n.animate),t===1&&r.range[i?"animate":"css"]({width:s-u+"%"},{queue:!1,duration:n.animate})):(t===0&&r.range.stop(1,1)[i?"animate":"css"]({bottom:s+"%"},n.animate),t===1&&r.range[i?"animate":"css"]({height:s-u+"%"},{queue:!1,duration:n.animate}))),u=s}):(a=this.value(),f=this._valueMin(),l=this._valueMax(),s=l!==f?(a-f)/(l-f)*100:0,o[r.orientation==="horizontal"?"left":"bottom"]=s+"%",this.handle.stop(1,1)[i?"animate":"css"](o,n.animate),t==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[i?"animate":"css"]({width:s+"%"},n.animate),t==="max"&&this.orientation==="horizontal"&&this.range[i?"animate":"css"]({width:100-s+"%"},{queue:!1,duration:n.animate}),t==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[i?"animate":"css"]({height:s+"%"},n.animate),t==="max"&&this.orientation==="vertical"&&this.range[i?"animate":"css"]({height:100-s+"%"},{queue:!1,duration:n.animate}))}}),e.extend(e.ui.slider,{version:"1.8.9"})}(jQuery),function(e,n){function r(){return++s}function i(){return++o}var s=0,o=0;e.widget("ui.tabs",{options:{add:null,ajaxOptions:null,cache:!1,cookie:null,collapsible:!1,disable:null,disabled:[],enable:null,event:"click",fx:null,idPrefix:"ui-tabs-",load:null,panelTemplate:"<div></div>",remove:null,select:null,show:null,spinner:"<em>Loading&#8230;</em>",tabTemplate:"<li><a href='#{href}'><span>#{label}</span></a></li>"},_create:function(){this._tabify(!0)},_setOption:function(e,t){e=="selected"?this.options.collapsible&&t==this.options.selected||this.select(t):(this.options[e]=t,this._tabify())},_tabId:function(e){return e.title&&e.title.replace(/\s/g,"_").replace(/[^\w\u00c0-\uFFFF-]/g,"")||this.options.idPrefix+r()},_sanitizeSelector:function(e){return e.replace(/:/g,"\\:")},_cookie:function(){var t=this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+i());return e.cookie.apply(null,[t].concat(e.makeArray(arguments)))},_ui:function(e,t){return{tab:e,panel:t,index:this.anchors.index(e)}},_cleanup:function(){this.lis.filter(".ui-state-processing").removeClass("ui-state-processing").find("span:data(label.tabs)").each(function(){var t=e(this);t.html(t.data("label.tabs")).removeData("label.tabs")})},_tabify:function(t){function r(t,n){t.css("display",""),!e.support.opacity&&n.opacity&&t[0].style.removeAttribute("filter")}var i=this,s=this.options,o=/^#.+/;this.list=this.element.find("ol,ul").eq(0),this.lis=e(" > li:has(a[href])",this.list),this.anchors=this.lis.map(function(){return e("a",this)[0]}),this.panels=e([]),this.anchors.each(function(t,n){var r=e(n).attr("href"),u=r.split("#")[0],a;u&&(u===location.toString().split("#")[0]||(a=e("base")[0])&&u===a.href)&&(r=n.hash,n.href=r),o.test(r)?i.panels=i.panels.add(i.element.find(i._sanitizeSelector(r))):r&&r!=="#"?(e.data(n,"href.tabs",r),e.data(n,"load.tabs",r.replace(/#.*$/,"")),r=i._tabId(n),n.href="#"+r,n=i.element.find("#"+r),n.length||(n=e(s.panelTemplate).attr("id",r).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").insertAfter(i.panels[t-1]||i.list),n.data("destroy.tabs",!0)),i.panels=i.panels.add(n)):s.disabled.push(t)}),t?(this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all"),this.list.addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"),this.lis.addClass("ui-state-default ui-corner-top"),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom"),s.selected===n?(location.hash&&this.anchors.each(function(e,t){if(t.hash==location.hash)return s.selected=e,!1}),typeof s.selected!="number"&&s.cookie&&(s.selected=parseInt(i._cookie(),10)),typeof s.selected!="number"&&this.lis.filter(".ui-tabs-selected").length&&(s.selected=this.lis.index(this.lis.filter(".ui-tabs-selected"))),s.selected=s.selected||(this.lis.length?0:-1)):s.selected===null&&(s.selected=-1),s.selected=s.selected>=0&&this.anchors[s.selected]||s.selected<0?s.selected:0,s.disabled=e.unique(s.disabled.concat(e.map(this.lis.filter(".ui-state-disabled"),function(e){return i.lis.index(e)}))).sort(),e.inArray(s.selected,s.disabled)!=-1&&s.disabled.splice(e.inArray(s.selected,s.disabled),1),this.panels.addClass("ui-tabs-hide"),this.lis.removeClass("ui-tabs-selected ui-state-active"),s.selected>=0&&this.anchors.length&&(i.element.find(i._sanitizeSelector(i.anchors[s.selected].hash)).removeClass("ui-tabs-hide"),this.lis.eq(s.selected).addClass("ui-tabs-selected ui-state-active"),i.element.queue("tabs",function(){i._trigger("show",null,i._ui(i.anchors[s.selected],i.element.find(i._sanitizeSelector(i.anchors[s.selected].hash))[0]))}),this.load(s.selected)),e(window).bind("unload",function(){i.lis.add(i.anchors).unbind(".tabs"),i.lis=i.anchors=i.panels=null})):s.selected=this.lis.index(this.lis.filter(".ui-tabs-selected")),this.element[s.collapsible?"addClass":"removeClass"]("ui-tabs-collapsible"),s.cookie&&this._cookie(s.selected,s.cookie),t=0;for(var u;u=this.lis[t];t++)e(u)[e.inArray(t,s.disabled)!=-1&&!e(u).hasClass("ui-tabs-selected")?"addClass":"removeClass"]("ui-state-disabled");s.cache===!1&&this.anchors.removeData("cache.tabs"),this.lis.add(this.anchors).unbind(".tabs");if(s.event!=="mouseover"){var a=function(e,t){t.is(":not(.ui-state-disabled)")&&t.addClass("ui-state-"+e)},f=function(e,t){t.removeClass("ui-state-"+e)};this.lis.bind("mouseover.tabs",function(){a("hover",e(this))}),this.lis.bind("mouseout.tabs",function(){f("hover",e(this))}),this.anchors.bind("focus.tabs",function(){a("focus",e(this).closest("li"))}),this.anchors.bind("blur.tabs",function(){f("focus",e(this).closest("li"))})}var l,h;s.fx&&(e.isArray(s.fx)?(l=s.fx[0],h=s.fx[1]):l=h=s.fx);var p=h?function(t,n){e(t).closest("li").addClass("ui-tabs-selected ui-state-active"),n.hide().removeClass("ui-tabs-hide").animate(h,h.duration||"normal",function(){r(n,h),i._trigger("show",null,i._ui(t,n[0]))})}:function(t,n){e(t).closest("li").addClass("ui-tabs-selected ui-state-active"),n.removeClass("ui-tabs-hide"),i._trigger("show",null,i._ui(t,n[0]))},d=l?function(e,t){t.animate(l,l.duration||"normal",function(){i.lis.removeClass("ui-tabs-selected ui-state-active"),t.addClass("ui-tabs-hide"),r(t,l),i.element.dequeue("tabs")})}:function(e,t){i.lis.removeClass("ui-tabs-selected ui-state-active"),t.addClass("ui-tabs-hide"),i.element.dequeue("tabs")};this.anchors.bind(s.event+".tabs",function(){var t=this,n=e(t).closest("li"),r=i.panels.filter(":not(.ui-tabs-hide)"),o=i.element.find(i._sanitizeSelector(t.hash));if(n.hasClass("ui-tabs-selected")&&!s.collapsible||n.hasClass("ui-state-disabled")||n.hasClass("ui-state-processing")||i.panels.filter(":animated").length||i._trigger("select",null,i._ui(this,o[0]))===!1)return this.blur(),!1;s.selected=i.anchors.index(this),i.abort();if(s.collapsible){if(n.hasClass("ui-tabs-selected"))return s.selected=-1,s.cookie&&i._cookie(s.selected,s.cookie),i.element.queue("tabs",function(){d(t,r)}).dequeue("tabs"),this.blur(),!1;if(!r.length)return s.cookie&&i._cookie(s.selected,s.cookie),i.element.queue("tabs",function(){p(t,o)}),i.load(i.anchors.index(this)),this.blur(),!1}s.cookie&&i._cookie(s.selected,s.cookie);if(!o.length)throw"jQuery UI Tabs: Mismatching fragment identifier.";r.length&&i.element.queue("tabs",function(){d(t,r)}),i.element.queue("tabs",function(){p(t,o)}),i.load(i.anchors.index(this)),e.browser.msie&&this.blur()}),this.anchors.bind("click.tabs",function(){return!1})},_getIndex:function(e){return typeof e=="string"&&(e=this.anchors.index(this.anchors.filter("[href$="+e+"]"))),e},destroy:function(){var t=this.options;return this.abort(),this.element.unbind(".tabs").removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible").removeData("tabs"),this.list.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"),this.anchors.each(function(){var t=e.data(this,"href.tabs");t&&(this.href=t);var n=e(this).unbind(".tabs");e.each(["href","load","cache"],function(e,t){n.removeData(t+".tabs")})}),this.lis.unbind(".tabs").add(this.panels).each(function(){e.data(this,"destroy.tabs")?e(this).remove():e(this).removeClass("ui-state-default ui-corner-top ui-tabs-selected ui-state-active ui-state-hover ui-state-focus ui-state-disabled ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide")}),t.cookie&&this._cookie(null,t.cookie),this},add:function(t,r,i){i===n&&(i=this.anchors.length);var s=this,o=this.options;r=e(o.tabTemplate.replace(/#\{href\}/g,t).replace(/#\{label\}/g,r)),t=t.indexOf("#")?this._tabId(e("a",r)[0]):t.replace("#",""),r.addClass("ui-state-default ui-corner-top").data("destroy.tabs",!0);var u=s.element.find("#"+t);return u.length||(u=e(o.panelTemplate).attr("id",t).data("destroy.tabs",!0)),u.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"),i>=this.lis.length?(r.appendTo(this.list),u.appendTo(this.list[0].parentNode)):(r.insertBefore(this.lis[i]),u.insertBefore(this.panels[i])),o.disabled=e.map(o.disabled,function(e){return e>=i?++e:e}),this._tabify(),this.anchors.length==1&&(o.selected=0,r.addClass("ui-tabs-selected ui-state-active"),u.removeClass("ui-tabs-hide"),this.element.queue("tabs",function(){s._trigger("show",null,s._ui(s.anchors[0],s.panels[0]))}),this.load(0)),this._trigger("add",null,this._ui(this.anchors[i],this.panels[i])),this},remove:function(t){t=this._getIndex(t);var n=this.options,r=this.lis.eq(t).remove(),i=this.panels.eq(t).remove();return r.hasClass("ui-tabs-selected")&&this.anchors.length>1&&this.select(t+(t+1<this.anchors.length?1:-1)),n.disabled=e.map(e.grep(n.disabled,function(e){return e!=t}),function(e){return e>=t?--e:e}),this._tabify(),this._trigger("remove",null,this._ui(r.find("a")[0],i[0])),this},enable:function(t){t=this._getIndex(t);var n=this.options;if(e.inArray(t,n.disabled)!=-1)return this.lis.eq(t).removeClass("ui-state-disabled"),n.disabled=e.grep(n.disabled,function(e){return e!=t}),this._trigger("enable",null,this._ui(this.anchors[t],this.panels[t])),this},disable:function(e){e=this._getIndex(e);var t=this.options;return e!=t.selected&&(this.lis.eq(e).addClass("ui-state-disabled"),t.disabled.push(e),t.disabled.sort(),this._trigger("disable",null,this._ui(this.anchors[e],this.panels[e]))),this},select:function(e){e=this._getIndex(e);if(e==-1){if(!this.options.collapsible||this.options.selected==-1)return this;e=this.options.selected}return this.anchors.eq(e).trigger(this.options.event+".tabs"),this},load:function(t){t=this._getIndex(t);var n=this,r=this.options,i=this.anchors.eq(t)[0],s=e.data(i,"load.tabs");this.abort();if(!(!s||this.element.queue("tabs").length!==0&&e.data(i,"cache.tabs"))){this.lis.eq(t).addClass("ui-state-processing");if(r.spinner){var o=e("span",i);o.data("label.tabs",o.html()).html(r.spinner)}return this.xhr=e.ajax(e.extend({},r.ajaxOptions,{url:s,success:function(s,o){n.element.find(n._sanitizeSelector(i.hash)).html(s),n._cleanup(),r.cache&&e.data(i,"cache.tabs",!0),n._trigger("load",null,n._ui(n.anchors[t],n.panels[t]));try{r.ajaxOptions.success(s,o)}catch(u){}},error:function(e,s){n._cleanup(),n._trigger("load",null,n._ui(n.anchors[t],n.panels[t]));try{r.ajaxOptions.error(e,s,t,i)}catch(o){}}})),n.element.dequeue("tabs"),this}this.element.dequeue("tabs")},abort:function(){return this.element.queue([]),this.panels.stop(!1,!0),this.element.queue("tabs",this.element.queue("tabs").splice(-2,2)),this.xhr&&(this.xhr.abort(),delete this.xhr),this._cleanup(),this},url:function(e,t){return this.anchors.eq(e).removeData("cache.tabs").data("load.tabs",t),this},length:function(){return this.anchors.length}}),e.extend(e.ui.tabs,{version:"1.8.9"}),e.extend(e.ui.tabs.prototype,{rotation:null,rotate:function(e,n){var r=this,i=this.options,s=r._rotate||(r._rotate=function(t){clearTimeout(r.rotation),r.rotation=setTimeout(function(){var e=i.selected;r.select(++e<r.anchors.length?e:0)},e),t&&t.stopPropagation()});return n=r._unrotate||(r._unrotate=n?function(){t=i.selected,s()}:function(e){e.clientX&&r.rotate(null)}),e?(this.element.bind("tabsshow",s),this.anchors.bind(i.event+".tabs",n),s()):(clearTimeout(r.rotation),this.element.unbind("tabsshow",s),this.anchors.unbind(i.event+".tabs",n),delete this._rotate,delete this._unrotate),this}})}(jQuery),define("jqueryui",function(){}),function(e){function t(t){var n;return t&&t.constructor==Array&&t.length==3?t:(n=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(t))?[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])]:(n=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(t))?[parseFloat(n[1])*2.55,parseFloat(n[2])*2.55,parseFloat(n[3])*2.55]:(n=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(t))?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:(n=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(t))?[parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16),parseInt(n[3]+n[3],16)]:(n=/rgba\(0, 0, 0, 0\)/.exec(t))?r.transparent:r[e.trim(t).toLowerCase()]}function n(n,r){var i;do{i=e.curCSS(n,r);if(i!=""&&i!="transparent"||e.nodeName(n,"body"))break;r="backgroundColor"}while(n=n.parentNode);return t(i)}e.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","color","outlineColor"],function(r,i){e.fx.step[i]=function(e){e.state==0&&(e.start=n(e.elem,i),e.end=t(e.end)),e.elem.style[i]="rgb("+[Math.max(Math.min(parseInt(e.pos*(e.end[0]-e.start[0])+e.start[0]),255),0),Math.max(Math.min(parseInt(e.pos*(e.end[1]-e.start[1])+e.start[1]),255),0),Math.max(Math.min(parseInt(e.pos*(e.end[2]-e.start[2])+e.start[2]),255),0)].join(",")+")"}});var r={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]}}(jQuery),define("lib/jquery/jquery.color",function(){}),function($){function parseOptions(e){return{RADIUS:e.radius||20,DURATION:e.duration||500,TEXT_COLOR:e.textColor||"#fff",HALO_COLOR:e.haloColor||"#777"}}function currentRadius(e){return(prop=e.style["text-shadow"])?parseInt(prop.match(/0 0 (\d+)px/)):0}function stepTextShadow(e){e.state==0&&(e.start=currentRadius(e.elem)),updatedRadius=e.end.begin?Math.max(Math.min(parseInt(e.end.radius*e.pos))):Math.max(Math.min(parseInt(e.end.radius-e.end.radius*e.pos))),e.end.begin||e.state<1?e.elem.style["text-shadow"]=e.end.color+" 0 0 "+updatedRadius+"px":e.elem.style["text-shadow"]="none"}function addGlow(opts){function startGlow(){$(this).animate({color:opts.TEXT_COLOR,textShadow:{begin:!0,color:opts.HALO_COLOR,radius:opts.RADIUS}},opts.DURATION)}function startFade(){$(this).animate({color:$(this).data("glow.originColor"),textShadow:{begin:!1,color:opts.HALO_COLOR,radius:opts.RADIUS}},opts.DURATION)}var opts=parseOptions(opts||{});with($(this))bind("mouseenter",startGlow),bind("mouseleave",startFade),data("glow.originColor",css("color"));return this}function tempGlow(opts){var opts=parseOptions(opts||{}),self=this;with($(this))data("glow.originColor",css("color"));return $(self).css({color:opts.TEXT_COLOR}),$(self).animate({textShadow:{begin:!0,color:opts.HALO_COLOR,radius:opts.RADIUS}},50).delay(600).animate({color:$(self).data("glow.originColor"),textShadow:{begin:!1,color:opts.HALO_COLOR,radius:opts.RADIUS}},opts.DURATION),this}var currentRadius,multiplier;$.fx.step.textShadow=stepTextShadow,$.fn.addGlow=addGlow,$.fn.tempGlow=tempGlow}(jQuery),define("lib/jquery/jquery.glowing",function(){}),jQuery&&function(e){e.extend(e.fn,{miniColors:function(t,n){var r=function(t,n,r){var i=m(t.val());i||(i="FFFFFF");var s=E(i),f=e('<a class="miniColors-trigger" style="background-color: #'+i+'" href="#"></a>');f.insertAfter(t),t.addClass("miniColors").attr("maxlength",7).attr("autocomplete","off"),t.data("trigger",f),t.data("hsb",s),n.change&&t.data("change",n.change),n.readonly&&t.attr("readonly",!0),n.disabled&&o(t),f.bind("click.miniColors",function(e){e.preventDefault(),t.trigger("focus")}),t.bind("focus.miniColors",function(e){u(t)}),t.bind("blur.miniColors",function(e){var n=m(t.val());t.val(n?"#"+n:"")}),t.bind("keydown.miniColors",function(e){e.keyCode===9&&a(t)}),t.bind("keyup.miniColors",function(e){var n=t.val().replace(/[^A-F0-9#]/ig,"");t.val(n),p(t)||t.data("trigger").css("backgroundColor","#FFF")}),t.bind("paste.miniColors",function(e){setTimeout(function(){t.trigger("keyup")},5)})},i=function(t){a(),t=e(t),t.data("trigger").remove(),t.removeAttr("autocomplete"),t.removeData("trigger"),t.removeData("selector"),t.removeData("hsb"),t.removeData("huePicker"),t.removeData("colorPicker"),t.removeData("mousebutton"),t.removeData("moving"),t.unbind("click.miniColors"),t.unbind("focus.miniColors"),t.unbind("blur.miniColors"),t.unbind("keyup.miniColors"),t.unbind("keydown.miniColors"),t.unbind("paste.miniColors"),e(document).unbind("mousedown.miniColors"),e(document).unbind("mousemove.miniColors")},s=function(e){e.attr("disabled",!1),e.data("trigger").css("opacity",1)},o=function(e){a(e),e.attr("disabled",!0),e.data("trigger").css("opacity",.5)},u=function(t){if(t.attr("disabled"))return!1;a();var n=e('<div class="miniColors-selector"></div>');n.append('<div class="miniColors-colors" style="background-color: #FFF;"><div class="miniColors-colorPicker"></div></div>'),n.append('<div class="miniColors-hues"><div class="miniColors-huePicker"></div></div>'),n.css({top:t.is(":visible")?t.offset().top+t.outerHeight():t.data("trigger").offset().top+t.data("trigger").outerHeight(),left:t.is(":visible")?t.offset().left:t.data("trigger").offset().left,display:"none"}).addClass(t.attr("class"));var r=t.data("hsb");n.find(".miniColors-colors").css("backgroundColor","#"+S({h:r.h,s:100,b:100}));var i=t.data("colorPosition");i||(i=d(r)),n.find(".miniColors-colorPicker").css("top",i.y+"px").css("left",i.x+"px");var s=t.data("huePosition");s||(s=v(r)),n.find(".miniColors-huePicker").css("top",s.y+"px"),t.data("selector",n),t.data("huePicker",n.find(".miniColors-huePicker")),t.data("colorPicker",n.find(".miniColors-colorPicker")),t.data("mousebutton",0),e("BODY").append(n),n.fadeIn(100),n.bind("selectstart",function(){return!1}),e(document).bind("mousedown.miniColors",function(n){t.data("mousebutton",1),e(n.target).parents().andSelf().hasClass("miniColors-colors")&&(n.preventDefault(),t.data("moving","colors"),f(t,n)),e(n.target).parents().andSelf().hasClass("miniColors-hues")&&(n.preventDefault(),t.data("moving","hues"),l(t,n));if(e(n.target).parents().andSelf().hasClass("miniColors-selector")){n.preventDefault();return}if(e(n.target).parents().andSelf().hasClass("miniColors"))return;a(t)}),e(document).bind("mouseup.miniColors",function(e){t.data("mousebutton",0),t.removeData("moving")}),e(document).bind("mousemove.miniColors",function(e){t.data("mousebutton")===1&&(t.data("moving")==="colors"&&f(t,e),t.data("moving")==="hues"&&l(t,e))})},a=function(t){t||(t=".miniColors"),e(t).each(function(){var t=e(this).data("selector");e(this).removeData("selector"),e(t).fadeOut(100,function(){e(this).remove()})}),e(document).unbind("mousedown.miniColors"),e(document).unbind("mousemove.miniColors")},f=function(t,n){var r=t.data("colorPicker");r.hide();var i={x:n.clientX-t.data("selector").find(".miniColors-colors").offset().left+e(document).scrollLeft()-5,y:n.clientY-t.data("selector").find(".miniColors-colors").offset().top+e(document).scrollTop()-5};i.x<=-5&&(i.x=-5),i.x>=144&&(i.x=144),i.y<=-5&&(i.y=-5),i.y>=144&&(i.y=144),t.data("colorPosition",i),r.css("left",i.x).css("top",i.y).show();var s=Math.round((i.x+5)*.67);s<0&&(s=0),s>100&&(s=100);var o=100-Math.round((i.y+5)*.67);o<0&&(o=0),o>100&&(o=100);var u=t.data("hsb");u.s=s,u.b=o,c(t,u,!0)},l=function(t,n){var r=t.data("huePicker");r.hide();var i={y:n.clientY-t.data("selector").find(".miniColors-colors").offset().top+e(document).scrollTop()-1};i.y<=-1&&(i.y=-1),i.y>=149&&(i.y=149),t.data("huePosition",i),r.css("top",i.y).show();var s=Math.round((150-i.y-1)*2.4);s<0&&(s=0),s>360&&(s=360);var o=t.data("hsb");o.h=s,c(t,o,!0)},c=function(e,t,n){e.data("hsb",t);var r=S(t);n&&e.val("#"+r),e.data("trigger").css("backgroundColor","#"+r),e.data("selector")&&e.data("selector").find(".miniColors-colors").css("backgroundColor","#"+S({h:t.h,s:100,b:100})),e.data("change")&&e.data("change").call(e,"#"+r,g(t))},p=function(t){var n=m(t.val());if(!n)return!1;var r=E(n),i=t.data("hsb");if(r.h===i.h&&r.s===i.s&&r.b===i.b)return!0;var s=d(r),o=e(t.data("colorPicker"));o.css("top",s.y+"px").css("left",s.x+"px");var u=v(r),a=e(t.data("huePicker"));return a.css("top",u.y+"px"),c(t,r,!1),!0},d=function(e){var t=Math.ceil(e.s/.67);t<0&&(t=0),t>150&&(t=150);var n=150-Math.ceil(e.b/.67);return n<0&&(n=0),n>150&&(n=150),{x:t-5,y:n-5}},v=function(e){var t=150-e.h/2.4;return t<0&&(h=0),t>150&&(h=150),{y:t-1}},m=function(e){return e=e.replace(/[^A-Fa-f0-9]/,""),e.length==3&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),e.length===6?e:null},g=function(e){var t={},n=Math.round(e.h),r=Math.round(e.s*255/100),i=Math.round(e.b*255/100);if(r==0)t.r=t.g=t.b=i;else{var s=i,o=(255-r)*i/255,u=(s-o)*(n%60)/60;n==360&&(n=0),n<60?(t.r=s,t.b=o,t.g=o+u):n<120?(t.g=s,t.b=o,t.r=s-u):n<180?(t.g=s,t.r=o,t.b=o+u):n<240?(t.b=s,t.r=o,t.g=s-u):n<300?(t.b=s,t.g=o,t.r=o+u):n<360?(t.r=s,t.g=o,t.b=s-u):(t.r=0,t.g=0,t.b=0)}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}},y=function(t){var n=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];return e.each(n,function(e,t){t.length==1&&(n[e]="0"+t)}),n.join("")},b=function(e){var e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16);return{r:e>>16,g:(e&65280)>>8,b:e&255}},w=function(e){var t={h:0,s:0,b:0},n=Math.min(e.r,e.g,e.b),r=Math.max(e.r,e.g,e.b),i=r-n;return t.b=r,t.s=r!=0?255*i/r:0,t.s!=0?e.r==r?t.h=(e.g-e.b)/i:e.g==r?t.h=2+(e.b-e.r)/i:t.h=4+(e.r-e.g)/i:t.h=-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t},E=function(e){var t=w(b(e));return t.s===0&&(t.h=360),t},S=function(e){return y(g(e))};switch(t){case"readonly":return e(this).each(function(){e(this).attr("readonly",n)}),e(this);case"disabled":return e(this).each(function(){n?o(e(this)):s(e(this))}),e(this);case"value":return e(this).each(function(){e(this).val(n).trigger("keyup")}),e(this);case"destroy":return e(this).each(function(){i(e(this))}),e(this);default:return t||(t={}),e(this).each(function(){if(e(this)[0].tagName.toLowerCase()!=="input")return;if(e(this).data("trigger"))return;r(e(this),t,n)}),e(this)}}})}(jQuery),define("lib/jquery/jquery.miniColors.min",function(){}),!function(e){e(function(){e.support.transition=function(){var e=function(){var e,t=document.createElement("bootstrap"),n={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(e in n)if(void 0!==t.style[e])return n[e]}();return e&&{end:e}}()})}(window.jQuery),!function(e){var t='[data-dismiss="alert"]',n=function(n){e(n).on("click",t,this.close)};n.prototype.close=function(t){function n(){r.trigger("closed").remove()}var r,i=e(this),s=i.attr("data-target");s||(s=i.attr("href"),s=s&&s.replace(/.*(?=#[^\s]*$)/,"")),r=e(s),t&&t.preventDefault(),r.length||(r=i.hasClass("alert")?i:i.parent()),r.trigger(t=e.Event("close")),t.isDefaultPrevented()||(r.removeClass("in"),e.support.transition&&r.hasClass("fade")?r.on(e.support.transition.end,n):n())};var r=e.fn.alert;e.fn.alert=function(t){return this.each(function(){var r=e(this),i=r.data("alert");i||r.data("alert",i=new n(this)),"string"==typeof t&&i[t].call(r)})},e.fn.alert.Constructor=n,e.fn.alert.noConflict=function(){return e.fn.alert=r,this},e(document).on("click.alert.data-api",t,n.prototype.close)}(window.jQuery),!function(e){var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.button.defaults,n)};t.prototype.setState=function(e){var t="disabled",n=this.$element,r=n.data(),i=n.is("input")?"val":"html";e+="Text",r.resetText||n.data("resetText",n[i]()),n[i](r[e]||this.options[e]),setTimeout(function(){"loadingText"==e?n.addClass(t).attr(t,t):n.removeClass(t).removeAttr(t)},0)},t.prototype.toggle=function(){var e=this.$element.closest('[data-toggle="buttons-radio"]');e&&e.find(".active").removeClass("active"),this.$element.toggleClass("active")};var n=e.fn.button;e.fn.button=function(n){return this.each(function(){var r=e(this),i=r.data("button"),s="object"==typeof n&&n;i||r.data("button",i=new t(this,s)),"toggle"==n?i.toggle():n&&i.setState(n)})},e.fn.button.defaults={loadingText:"loading..."},e.fn.button.Constructor=t,e.fn.button.noConflict=function(){return e.fn.button=n,this},e(document).on("click.button.data-api","[data-toggle^=button]",function(t){var n=e(t.target);n.hasClass("btn")||(n=n.closest(".btn")),n.button("toggle")})}(window.jQuery),!function(e){var t=function(t,n){this.$element=e(t),this.options=n,"hover"==this.options.pause&&this.$element.on("mouseenter",e.proxy(this.pause,this)).on("mouseleave",e.proxy(this.cycle,this))};t.prototype={cycle:function(t){return t||(this.paused=!1),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},to:function(t){var n=this.$element.find(".item.active"),r=n.parent().children(),i=r.index(n),s=this;if(!(t>r.length-1||0>t))return this.sliding?this.$element.one("slid",function(){s.to(t)}):i==t?this.pause().cycle():this.slide(t>i?"next":"prev",e(r[t]))},pause:function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition.end&&(this.$element.trigger(e.support.transition.end),this.cycle()),clearInterval(this.interval),this.interval=null,this},next:function(){return this.sliding?void 0:this.slide("next")},prev:function(){return this.sliding?void 0:this.slide("prev")},slide:function(t,n){var r,i=this.$element.find(".item.active"),s=n||i[t](),o=this.interval,u="next"==t?"left":"right",a="next"==t?"first":"last",f=this;if(this.sliding=!0,o&&this.pause(),s=s.length?s:this.$element.find(".item")[a](),r=e.Event("slide",{relatedTarget:s[0]}),!s.hasClass("active")){if(e.support.transition&&this.$element.hasClass("slide")){if(this.$element.trigger(r),r.isDefaultPrevented())return;s.addClass(t),s[0].offsetWidth,i.addClass(u),s.addClass(u),this.$element.one(e.support.transition.end,function(){s.removeClass([t,u].join(" ")).addClass("active"),i.removeClass(["active",u].join(" ")),f.sliding=!1,setTimeout(function(){f.$element.trigger("slid")},0)})}else{if(this.$element.trigger(r),r.isDefaultPrevented())return;i.removeClass("active"),s.addClass("active"),this.sliding=!1,this.$element.trigger("slid")}return o&&this.cycle(),this}}};var n=e.fn.carousel;e.fn.carousel=function(n){return this.each(function(){var r=e(this),i=r.data("carousel"),s=e.extend({},e.fn.carousel.defaults,"object"==typeof n&&n),o="string"==typeof n?n:s.slide;i||r.data("carousel",i=new t(this,s)),"number"==typeof n?i.to(n):o?i[o]():s.interval&&i.cycle()})},e.fn.carousel.defaults={interval:5e3,pause:"hover"},e.fn.carousel.Constructor=t,e.fn.carousel.noConflict=function(){return e.fn.carousel=n,this},e(document).on("click.carousel.data-api","[data-slide]",function(t){var n,r=e(this),i=e(r.attr("data-target")||(n=r.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,"")),s=e.extend({},i.data(),r.data());i.carousel(s),t.preventDefault()})}(window.jQuery),!function(e){var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.collapse.defaults,n),this.options.parent&&(this.$parent=e(this.options.parent)),this.options.toggle&&this.toggle()};t.prototype={constructor:t,dimension:function(){var e=this.$element.hasClass("width");return e?"width":"height"},show:function(){var t,n,r,i;if(!this.transitioning){if(t=this.dimension(),n=e.camelCase(["scroll",t].join("-")),r=this.$parent&&this.$parent.find("> .accordion-group > .in"),r&&r.length){if(i=r.data("collapse"),i&&i.transitioning)return;r.collapse("hide"),i||r.data("collapse",null)}this.$element[t](0),this.transition("addClass",e.Event("show"),"shown"),e.support.transition&&this.$element[t](this.$element[0][n])}},hide:function(){var t;this.transitioning||(t=this.dimension(),this.reset(this.$element[t]()),this.transition("removeClass",e.Event("hide"),"hidden"),this.$element[t](0))},reset:function(e){var t=this.dimension();return this.$element.removeClass("collapse")[t](e||"auto")[0].offsetWidth,this.$element[null!==e?"addClass":"removeClass"]("collapse"),this},transition:function(t,n,r){var i=this,s=function(){"show"==n.type&&i.reset(),i.transitioning=0,i.$element.trigger(r)};this.$element.trigger(n),n.isDefaultPrevented()||(this.transitioning=1,this.$element[t]("in"),e.support.transition&&this.$element.hasClass("collapse")?this.$element.one(e.support.transition.end,s):s())},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}};var n=e.fn.collapse;e.fn.collapse=function(n){return this.each(function(){var r=e(this),i=r.data("collapse"),s="object"==typeof n&&n;i||r.data("collapse",i=new t(this,s)),"string"==typeof n&&i[n]()})},e.fn.collapse.defaults={toggle:!0},e.fn.collapse.Constructor=t,e.fn.collapse.noConflict=function(){return e.fn.collapse=n,this},e(document).on("click.collapse.data-api","[data-toggle=collapse]",function(t){var n,r=e(this),i=r.attr("data-target")||t.preventDefault()||(n=r.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,""),s=e(i).data("collapse")?"toggle":r.data();r[e(i).hasClass("in")?"addClass":"removeClass"]("collapsed"),e(i).collapse(s)})}(window.jQuery),!function(e){function t(){e(r).each(function(){n(e(this)).removeClass("open")})}function n(t){var n,r=t.attr("data-target");return r||(r=t.attr("href"),r=r&&/#/.test(r)&&r.replace(/.*(?=#[^\s]*$)/,"")),n=e(r),n.length||(n=t.parent()),n}var r="[data-toggle=dropdown]",i=function(t){var n=e(t).on("click.dropdown.data-api",this.toggle);e("html").on("click.dropdown.data-api",function(){n.parent().removeClass("open")})};i.prototype={constructor:i,toggle:function(){var r,i,s=e(this);if(!s.is(".disabled, :disabled"))return r=n(s),i=r.hasClass("open"),t(),i||r.toggleClass("open"),s.focus(),!1},keydown:function(t){var r,i,s,o,u;if(/(38|40|27)/.test(t.keyCode)&&(r=e(this),t.preventDefault(),t.stopPropagation(),!r.is(".disabled, :disabled"))){if(s=n(r),o=s.hasClass("open"),!o||o&&27==t.keyCode)return r.click();i=e("[role=menu] li:not(.divider):visible a",s),i.length&&(u=i.index(i.filter(":focus")),38==t.keyCode&&u>0&&u--,40==t.keyCode&&i.length-1>u&&u++,~u||(u=0),i.eq(u).focus())}}};var s=e.fn.dropdown;e.fn.dropdown=function(t){return this.each(function(){var n=e(this),r=n.data("dropdown");r||n.data("dropdown",r=new i(this)),"string"==typeof t&&r[t].call(n)})},e.fn.dropdown.Constructor=i,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=s,this},e(document).on("click.dropdown.data-api touchstart.dropdown.data-api",t).on("click.dropdown touchstart.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("touchstart.dropdown.data-api",".dropdown-menu",function(e){e.stopPropagation()}).on("click.dropdown.data-api touchstart.dropdown.data-api",r,i.prototype.toggle).on("keydown.dropdown.data-api touchstart.dropdown.data-api",r+", [role=menu]",i.prototype.keydown)}(window.jQuery),!function(e){var t=function(t,n){this.options=n,this.$element=e(t).delegate('[data-dismiss="modal"]',"click.dismiss.modal",e.proxy(this.hide,this)),this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};t.prototype={constructor:t,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var t=this,n=e.Event("show");this.$element.trigger(n),this.isShown||n.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.backdrop(function(){var n=e.support.transition&&t.$element.hasClass("fade");t.$element.parent().length||t.$element.appendTo(document.body),t.$element.show(),n&&t.$element[0].offsetWidth,t.$element.addClass("in").attr("aria-hidden",!1),t.enforceFocus(),n?t.$element.one(e.support.transition.end,function(){t.$element.focus().trigger("shown")}):t.$element.focus().trigger("shown")}))},hide:function(t){t&&t.preventDefault(),t=e.Event("hide"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),e(document).off("focusin.modal"),this.$element.removeClass("in").attr("aria-hidden",!0),e.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal())},enforceFocus:function(){var t=this;e(document).on("focusin.modal",function(e){t.$element[0]===e.target||t.$element.has(e.target).length||t.$element.focus()})},escape:function(){var e=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(t){27==t.which&&e.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var t=this,n=setTimeout(function(){t.$element.off(e.support.transition.end),t.hideModal()},500);this.$element.one(e.support.transition.end,function(){clearTimeout(n),t.hideModal()})},hideModal:function(){this.$element.hide().trigger("hidden"),this.backdrop()},removeBackdrop:function(){this.$backdrop.remove(),this.$backdrop=null},backdrop:function(t){var n=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var r=e.support.transition&&n;this.$backdrop=e('<div class="modal-backdrop '+n+'" />').appendTo(document.body),this.$backdrop.click("static"==this.options.backdrop?e.proxy(this.$element[0].focus,this.$element[0]):e.proxy(this.hide,this)),r&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),r?this.$backdrop.one(e.support.transition.end,t):t()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,e.proxy(this.removeBackdrop,this)):this.removeBackdrop()):t&&t()}};var n=e.fn.modal;e.fn.modal=function(n){return this.each(function(){var r=e(this),i=r.data("modal"),s=e.extend({},e.fn.modal.defaults,r.data(),"object"==typeof n&&n);i||r.data("modal",i=new t(this,s)),"string"==typeof n?i[n]():s.show&&i.show()})},e.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},e.fn.modal.Constructor=t,e.fn.modal.noConflict=function(){return e.fn.modal=n,this},e(document).on("click.modal.data-api",'[data-toggle="modal"]',function(t){var n=e(this),r=n.attr("href"),i=e(n.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),s=i.data("modal")?"toggle":e.extend({remote:!/#/.test(r)&&r},i.data(),n.data());t.preventDefault(),i.modal(s).one("hide",function(){n.focus()})})}(window.jQuery),!function(e){var t=function(e,t){this.init("tooltip",e,t)};t.prototype={constructor:t,init:function(t,n,r){var i,s;this.type=t,this.$element=e(n),this.options=this.getOptions(r),this.enabled=!0,"click"==this.options.trigger?this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this)):"manual"!=this.options.trigger&&(i="hover"==this.options.trigger?"mouseenter":"focus",s="hover"==this.options.trigger?"mouseleave":"blur",this.$element.on(i+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(s+"."+this.type,this.options.selector,e.proxy(this.leave,this))),this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(t){return t=e.extend({},e.fn[this.type].defaults,t,this.$element.data()),t.delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},enter:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);return n.options.delay&&n.options.delay.show?(clearTimeout(this.timeout),n.hoverState="in",this.timeout=setTimeout(function(){"in"==n.hoverState&&n.show()},n.options.delay.show),void 0):n.show()},leave:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);return this.timeout&&clearTimeout(this.timeout),n.options.delay&&n.options.delay.hide?(n.hoverState="out",this.timeout=setTimeout(function(){"out"==n.hoverState&&n.hide()},n.options.delay.hide),void 0):n.hide()},show:function(){var e,t,n,r,i,s,o;if(this.hasContent()&&this.enabled){switch(e=this.tip(),this.setContent(),this.options.animation&&e.addClass("fade"),s="function"==typeof this.options.placement?this.options.placement.call(this,e[0],this.$element[0]):this.options.placement,t=/in/.test(s),e.detach().css({top:0,left:0,display:"block"}).insertAfter(this.$element),n=this.getPosition(t),r=e[0].offsetWidth,i=e[0].offsetHeight,t?s.split(" ")[1]:s){case"bottom":o={top:n.top+n.height,left:n.left+n.width/2-r/2};break;case"top":o={top:n.top-i,left:n.left+n.width/2-r/2};break;case"left":o={top:n.top+n.height/2-i/2,left:n.left-r};break;case"right":o={top:n.top+n.height/2-i/2,left:n.left+n.width}}e.offset(o).addClass(s).addClass("in")}},setContent:function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},hide:function(){function t(){var t=setTimeout(function(){n.off(e.support.transition.end).detach()},500);n.one(e.support.transition.end,function(){clearTimeout(t),n.detach()})}var n=this.tip();return n.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?t():n.detach(),this},fixTitle:function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("data-original-title"))&&e.attr("data-original-title",e.attr("title")||"").removeAttr("title")},hasContent:function(){return this.getTitle()},getPosition:function(t){return e.extend({},t?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||("function"==typeof n.title?n.title.call(t[0]):n.title)},tip:function(){return this.$tip=this.$tip||e(this.options.template)},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);n[n.tip().hasClass("in")?"hide":"show"]()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};var n=e.fn.tooltip;e.fn.tooltip=function(n){return this.each(function(){var r=e(this),i=r.data("tooltip"),s="object"==typeof n&&n;i||r.data("tooltip",i=new t(this,s)),"string"==typeof n&&i[n]()})},e.fn.tooltip.Constructor=t,e.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0,html:!1},e.fn.tooltip.noConflict=function(){return e.fn.tooltip=n,this}}(window.jQuery),!function(e){var t=function(e,t){this.init("popover",e,t)};t.prototype=e.extend({},e.fn.tooltip.Constructor.prototype,{constructor:t,setContent:function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content")[this.options.html?"html":"text"](n),e.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var e,t=this.$element,n=this.options;return e=t.attr("data-content")||("function"==typeof n.content?n.content.call(t[0]):n.content)},tip:function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}});var n=e.fn.popover;e.fn.popover=function(n){return this.each(function(){var r=e(this),i=r.data("popover"),s="object"==typeof n&&n;i||r.data("popover",i=new t(this,s)),"string"==typeof n&&i[n]()})},e.fn.popover.Constructor=t,e.fn.popover.defaults=e.extend({},e.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"></div></div></div>'}),e.fn.popover.noConflict=function(){return e.fn.popover=n,this}}(window.jQuery),!function(e){function t(t,n){var r,i=e.proxy(this.process,this),s=e(t).is("body")?e(window):e(t);this.options=e.extend({},e.fn.scrollspy.defaults,n),this.$scrollElement=s.on("scroll.scroll-spy.data-api",i),this.selector=(this.options.target||(r=e(t).attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.$body=e("body"),this.refresh(),this.process()}t.prototype={constructor:t,refresh:function(){var t,n=this;this.offsets=e([]),this.targets=e([]),t=this.$body.find(this.selector).map(function(){var t=e(this),r=t.data("target")||t.attr("href"),i=/^#\w/.test(r)&&e(r);return i&&i.length&&[[i.position().top+n.$scrollElement.scrollTop(),r]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){n.offsets.push(this[0]),n.targets.push(this[1])})},process:function(){var e,t=this.$scrollElement.scrollTop()+this.options.offset,n=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,r=n-this.$scrollElement.height(),i=this.offsets,s=this.targets,o=this.activeTarget;if(t>=r)return o!=(e=s.last()[0])&&this.activate(e);for(e=i.length;e--;)o!=s[e]&&t>=i[e]&&(!i[e+1]||i[e+1]>=t)&&this.activate(s[e])},activate:function(t){var n,r;this.activeTarget=t,e(this.selector).parent(".active").removeClass("active"),r=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',n=e(r).parent("li").addClass("active"),n.parent(".dropdown-menu").length&&(n=n.closest("li.dropdown").addClass("active")),n.trigger("activate")}};var n=e.fn.scrollspy;e.fn.scrollspy=function(n){return this.each(function(){var r=e(this),i=r.data("scrollspy"),s="object"==typeof n&&n;i||r.data("scrollspy",i=new t(this,s)),"string"==typeof n&&i[n]()})},e.fn.scrollspy.Constructor=t,e.fn.scrollspy.defaults={offset:10},e.fn.scrollspy.noConflict=function(){return e.fn.scrollspy=n,this},e(window).on("load",function(){e('[data-spy="scroll"]').each(function(){var t=e(this);t.scrollspy(t.data())})})}(window.jQuery),!function(e){var t=function(t){this.element=e(t)};t.prototype={constructor:t,show:function(){var t,n,r,i=this.element,s=i.closest("ul:not(.dropdown-menu)"),o=i.attr("data-target");o||(o=i.attr("href"),o=o&&o.replace(/.*(?=#[^\s]*$)/,"")),i.parent("li").hasClass("active")||(t=s.find(".active:last a")[0],r=e.Event("show",{relatedTarget:t}),i.trigger(r),r.isDefaultPrevented()||(n=e(o),this.activate(i.parent("li"),s),this.activate(n,n.parent(),function(){i.trigger({type:"shown",relatedTarget:t})})))},activate:function(t,n,r){function i(){s.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),o?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),r&&r()}var s=n.find("> .active"),o=r&&e.support.transition&&s.hasClass("fade");o?s.one(e.support.transition.end,i):i(),s.removeClass("in")}};var n=e.fn.tab;e.fn.tab=function(n){return this.each(function(){var r=e(this),i=r.data("tab");i||r.data("tab",i=new t(this)),"string"==typeof n&&i[n]()})},e.fn.tab.Constructor=t,e.fn.tab.noConflict=function(){return e.fn.tab=n,this},e(document).on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault(),e(this).tab("show")})}(window.jQuery),!function(e){var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.typeahead.defaults,n),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.source=this.options.source,this.$menu=e(this.options.menu),this.shown=!1,this.listen()};t.prototype={constructor:t,select:function(){var e=this.$menu.find(".active").attr("data-value");return this.$element.val(this.updater(e)).change(),this.hide()},updater:function(e){return e},show:function(){var t=e.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});return this.$menu.insertAfter(this.$element).css({top:t.top+t.height,left:t.left}).show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(){var t;return this.query=this.$element.val(),!this.query||this.query.length<this.options.minLength?this.shown?this.hide():this:(t=e.isFunction(this.source)?this.source(this.query,e.proxy(this.process,this)):this.source,t?this.process(t):this)},process:function(t){var n=this;return t=e.grep(t,function(e){return n.matcher(e)}),t=this.sorter(t),t.length?this.render(t.slice(0,this.options.items)).show():this.shown?this.hide():this},matcher:function(e){return~e.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(e){for(var t,n=[],r=[],i=[];t=e.shift();)t.toLowerCase().indexOf(this.query.toLowerCase())?~t.indexOf(this.query)?r.push(t):i.push(t):n.push(t);return n.concat(r,i)},highlighter:function(e){var t=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return e.replace(RegExp("("+t+")","ig"),function(e,t){return"<strong>"+t+"</strong>"})},render:function(t){var n=this;return t=e(t).map(function(t,r){return t=e(n.options.item).attr("data-value",r),t.find("a").html(n.highlighter(r)),t[0]}),t.first().addClass("active"),this.$menu.html(t),this},next:function(){var t=this.$menu.find(".active").removeClass("active"),n=t.next();n.length||(n=e(this.$menu.find("li")[0])),n.addClass("active")},prev:function(){var e=this.$menu.find(".active").removeClass("active"),t=e.prev();t.length||(t=this.$menu.find("li").last()),t.addClass("active")},listen:function(){this.$element.on("blur",e.proxy(this.blur,this)).on("keypress",e.proxy(this.keypress,this)).on("keyup",e.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$element.on("keydown",e.proxy(this.keydown,this)),this.$menu.on("click",e.proxy(this.click,this)).on("mouseenter","li",e.proxy(this.mouseenter,this))},eventSupported:function(e){var t=e in this.$element;return t||(this.$element.setAttribute(e,"return;"),t="function"==typeof this.$element[e]),t},move:function(e){if(this.shown){switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:e.preventDefault(),this.prev();break;case 40:e.preventDefault(),this.next()}e.stopPropagation()}},keydown:function(t){this.suppressKeyPressRepeat=~e.inArray(t.keyCode,[40,38,9,13,27]),this.move(t)},keypress:function(e){this.suppressKeyPressRepeat||this.move(e)},keyup:function(e){switch(e.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}e.stopPropagation(),e.preventDefault()},blur:function(){var e=this;setTimeout(function(){e.hide()},150)},click:function(e){e.stopPropagation(),e.preventDefault(),this.select()},mouseenter:function(t){this.$menu.find(".active").removeClass("active"),e(t.currentTarget).addClass("active")}};var n=e.fn.typeahead;e.fn.typeahead=function(n){return this.each(function(){var r=e(this),i=r.data("typeahead"),s="object"==typeof n&&n;i||r.data("typeahead",i=new t(this,s)),"string"==typeof n&&i[n]()})},e.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1},e.fn.typeahead.Constructor=t,e.fn.typeahead.noConflict=function(){return e.fn.typeahead=n,this},e(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(t){var n=e(this);n.data("typeahead")||(t.preventDefault(),n.typeahead(n.data()))})}(window.jQuery),!function(e){var t=function(t,n){this.options=e.extend({},e.fn.affix.defaults,n),this.$window=e(window).on("scroll.affix.data-api",e.proxy(this.checkPosition,this)).on("click.affix.data-api",e.proxy(function(){setTimeout(e.proxy(this.checkPosition,this),1)},this)),this.$element=e(t),this.checkPosition()};t.prototype.checkPosition=function(){if(this.$element.is(":visible")){var t,n=e(document).height(),r=this.$window.scrollTop(),i=this.$element.offset(),s=this.options.offset,o=s.bottom,u=s.top,a="affix affix-top affix-bottom";"object"!=typeof s&&(o=u=s),"function"==typeof u&&(u=s.top()),"function"==typeof o&&(o=s.bottom()),t=null!=this.unpin&&r+this.unpin<=i.top?!1:null!=o&&i.top+this.$element.height()>=n-o?"bottom":null!=u&&u>=r?"top":!1,this.affixed!==t&&(this.affixed=t,this.unpin="bottom"==t?i.top-r:null,this.$element.removeClass(a).addClass("affix"+(t?"-"+t:"")))}};var n=e.fn.affix;e.fn.affix=function(n){return this.each(function(){var r=e(this),i=r.data("affix"),s="object"==typeof n&&n;i||r.data("affix",i=new t(this,s)),"string"==typeof n&&i[n]()})},e.fn.affix.Constructor=t,e.fn.affix.defaults={offset:0},e.fn.affix.noConflict=function(){return e.fn.affix=n,this},e(window).on("load",function(){e('[data-spy="affix"]').each(function(){var t=e(this),n=t.data();n.offset=n.offset||{},n.offsetBottom&&(n.offset.bottom=n.offsetBottom),n.offsetTop&&(n.offset.top=n.offsetTop),t.affix(n)})})}(window.jQuery),define("bootstrap",function(){}),define("locale",[],function(){return{}});var locale={ABBR_MONTH_NAMES:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],MONTH_NAMES:["January","February","March","April","May","June","July","August","September","October","November","December"],formats:{DATE_SHORT:"%Y-%m-%d"},strings:{}};require.config({paths:{jqueryui:"lib/jquery/jquery-ui.min",underscore:"lib/underscore/underscore",backbone:"lib/backbone/backbone",bootstrap:"lib/bootstrap/js/bootstrap.min",d3:"lib/d3/d3.v2.min",text:"lib/require/text",locale:"locale/locale.en"},shim:{underscore:{exports:"_"},backbone:{deps:["underscore","jquery"],exports:"Backbone"},d3:{exports:"d3"}}}),require(["jquery","app","jqueryui","lib/jquery/jquery.color","lib/jquery/jquery.glowing","lib/jquery/jquery.miniColors.min","bootstrap","locale"],function(e,t,n){t.initialize()}),define("main",function(){});
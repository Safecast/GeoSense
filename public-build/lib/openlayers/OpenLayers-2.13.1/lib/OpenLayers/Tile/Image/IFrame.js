/* Copyright (c) 2006-2013 by OpenLayers Contributors (see authors.txt for
 * full list of contributors). Published under the 2-clause BSD license.
 * See license.txt in the OpenLayers distribution or repository for the
 * full text of the license. */

OpenLayers.Tile.Image.IFrame={useIFrame:null,blankImageUrl:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7",draw:function(){var e=OpenLayers.Tile.Image.prototype.shouldDraw.call(this);if(e){var t=this.layer.getURL(this.bounds),n=this.useIFrame;this.useIFrame=this.maxGetUrlLength!==null&&!this.layer.async&&t.length>this.maxGetUrlLength;var r=n&&!this.useIFrame,i=!n&&this.useIFrame;if(r||i)this.imgDiv&&this.imgDiv.parentNode===this.frame&&this.frame.removeChild(this.imgDiv),this.imgDiv=null,r&&this.frame.removeChild(this.frame.firstChild)}return OpenLayers.Tile.Image.prototype.draw.apply(this,arguments)},getImage:function(){if(this.useIFrame===!0){if(!this.frame.childNodes.length){var e=document.createElement("div"),t=e.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex=1,t.backgroundImage="url("+this.blankImageUrl+")",this.frame.appendChild(e)}var n=this.id+"_iFrame",r;return parseFloat(navigator.appVersion.split("MSIE")[1])<9?(r=document.createElement('<iframe name="'+n+'">'),r.style.backgroundColor="#FFFFFF",r.style.filter="chroma(color=#FFFFFF)"):(r=document.createElement("iframe"),r.style.backgroundColor="transparent",r.name=n),r.scrolling="no",r.marginWidth="0px",r.marginHeight="0px",r.frameBorder="0",r.style.position="absolute",r.style.width="100%",r.style.height="100%",this.layer.opacity<1&&OpenLayers.Util.modifyDOMElement(r,null,null,null,null,null,null,this.layer.opacity),this.frame.appendChild(r),this.imgDiv=r,r}return OpenLayers.Tile.Image.prototype.getImage.apply(this,arguments)},createRequestForm:function(){var e=document.createElement("form");e.method="POST";var t=this.layer.params._OLSALT;t=(t?t+"_":"")+this.bounds.toBBOX(),e.action=OpenLayers.Util.urlAppend(this.layer.url,t),e.target=this.id+"_iFrame";var n=this.layer.getImageSize(),r=OpenLayers.Util.getParameters(this.url),i;for(var s in r)i=document.createElement("input"),i.type="hidden",i.name=s,i.value=r[s],e.appendChild(i);return e},setImgSrc:function(e){if(this.useIFrame===!0)if(e){var t=this.createRequestForm();this.frame.appendChild(t),t.submit(),this.frame.removeChild(t)}else this.imgDiv.parentNode===this.frame&&(this.frame.removeChild(this.imgDiv),this.imgDiv=null);else OpenLayers.Tile.Image.prototype.setImgSrc.apply(this,arguments)},onImageLoad:function(){OpenLayers.Tile.Image.prototype.onImageLoad.apply(this,arguments),this.useIFrame===!0&&(this.imgDiv.style.opacity=1,this.frame.style.opacity=this.layer.opacity)},createBackBuffer:function(){var e;return this.useIFrame===!1&&(e=OpenLayers.Tile.Image.prototype.createBackBuffer.call(this)),e}};
/* Copyright (c) 2006-2013 by OpenLayers Contributors (see authors.txt for
 * full list of contributors). Published under the 2-clause BSD license.
 * See license.txt in the OpenLayers distribution or repository for the
 * full text of the license. */

OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.eTop){this.eTop=document.createElement("div"),this.eTop.className=this.displayClass+"Top";var e=this.topInUnits.length;this.div.appendChild(this.eTop),this.topOutUnits==""||this.topInUnits==""?this.eTop.style.visibility="hidden":this.eTop.style.visibility="visible",this.eBottom=document.createElement("div"),this.eBottom.className=this.displayClass+"Bottom",this.div.appendChild(this.eBottom),this.bottomOutUnits==""||this.bottomInUnits==""?this.eBottom.style.visibility="hidden":this.eBottom.style.visibility="visible"}return this.map.events.register("moveend",this,this.update),this.update(),this.div},getBarLen:function(e){var t=parseInt(Math.log(e)/Math.log(10)),n=Math.pow(10,t),r=parseInt(e/n),i;return r>5?i=5:r>2?i=2:i=1,i*n},update:function(){var e=this.map.getResolution();if(!e)return;var t=this.map.getUnits(),n=OpenLayers.INCHES_PER_UNIT,r=this.maxWidth*e*n[t],i=1;if(this.geodesic===!0){var s=(this.map.getGeodesicPixelSize().w||1e-6)*this.maxWidth,o=r/n.km;i=s/o,r*=i}var u,a;r>1e5?(u=this.topOutUnits,a=this.bottomOutUnits):(u=this.topInUnits,a=this.bottomInUnits);var f=r/n[u],l=r/n[a],c=this.getBarLen(f),h=this.getBarLen(l);f=c/n[t]*n[u],l=h/n[t]*n[a];var p=f/e/i,d=l/e/i;this.eBottom.style.visibility=="visible"&&(this.eBottom.style.width=Math.round(d)+"px",this.eBottom.innerHTML=h+" "+a),this.eTop.style.visibility=="visible"&&(this.eTop.style.width=Math.round(p)+"px",this.eTop.innerHTML=c+" "+u)},CLASS_NAME:"OpenLayers.Control.ScaleLine"});
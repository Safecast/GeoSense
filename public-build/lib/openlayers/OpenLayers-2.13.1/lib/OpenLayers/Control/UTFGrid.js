/* Copyright (c) 2006-2013 by OpenLayers Contributors (see authors.txt for
 * full list of contributors). Published under the 2-clause BSD license.
 * See license.txt in the OpenLayers distribution or repository for the
 * full text of the license. */

OpenLayers.Control.UTFGrid=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,layers:null,defaultHandlerOptions:{delay:300,pixelTolerance:4,stopMove:!1,single:!0,"double":!1,stopSingle:!1,stopDouble:!1},handlerMode:"click",setHandler:function(e){this.handlerMode=e,this.resetHandler()},resetHandler:function(){return this.handler&&(this.handler.deactivate(),this.handler.destroy(),this.handler=null),this.handlerMode=="hover"?this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.reset},this.handlerOptions):this.handlerMode=="click"?this.handler=new OpenLayers.Handler.Click(this,{click:this.handleEvent},this.handlerOptions):this.handlerMode=="move"&&(this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.handleEvent},this.handlerOptions)),this.handler?!0:!1},initialize:function(e){e=e||{},e.handlerOptions=e.handlerOptions||this.defaultHandlerOptions,OpenLayers.Control.prototype.initialize.apply(this,[e]),this.resetHandler()},handleEvent:function(e){if(e==null){this.reset();return}var t=this.map.getLonLatFromPixel(e.xy);if(!t)return;var n=this.findLayers();if(n.length>0){var r={},i,s;for(var o=0,u=n.length;o<u;o++)i=n[o],s=OpenLayers.Util.indexOf(this.map.layers,i),r[s]=i.getFeatureInfo(t);this.callback(r,t,e.xy)}},callback:function(e){},reset:function(e){this.callback(null)},findLayers:function(){var e=this.layers||this.map.layers,t=[],n;for(var r=e.length-1;r>=0;--r)n=e[r],n instanceof OpenLayers.Layer.UTFGrid&&t.push(n);return t},CLASS_NAME:"OpenLayers.Control.UTFGrid"});
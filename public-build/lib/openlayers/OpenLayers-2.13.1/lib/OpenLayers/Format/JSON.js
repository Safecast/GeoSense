/* Copyright (c) 2006-2013 by OpenLayers Contributors (see authors.txt for
 * full list of contributors). Published under the 2-clause BSD license.
 * See license.txt in the OpenLayers distribution or repository for the
 * full text of the license. */

OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return!!window.JSON&&typeof JSON.parse=="function"&&typeof JSON.stringify=="function"}(),read:function(json,filter){var object;if(this.nativeJSON)object=JSON.parse(json,filter);else try{if(/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){object=eval("("+json+")");if(typeof filter=="function"){function walk(e,t){if(t&&typeof t=="object")for(var n in t)t.hasOwnProperty(n)&&(t[n]=walk(n,t[n]));return filter(e,t)}object=walk("",object)}}}catch(e){}return this.keepData&&(this.data=object),object},write:function(e,t){this.pretty=!!t;var n=null,r=typeof e;if(this.serialize[r])try{n=!this.pretty&&this.nativeJSON?JSON.stringify(e):this.serialize[r].apply(this,[e])}catch(i){OpenLayers.Console.error("Trouble serializing: "+i)}return n},writeIndent:function(){var e=[];if(this.pretty)for(var t=0;t<this.level;++t)e.push(this.indent);return e.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(e){if(e==null)return"null";if(e.constructor==Date)return this.serialize.date.apply(this,[e]);if(e.constructor==Array)return this.serialize.array.apply(this,[e]);var t=["{"];this.level+=1;var n,r,i,s=!1;for(n in e)e.hasOwnProperty(n)&&(r=OpenLayers.Format.JSON.prototype.write.apply(this,[n,this.pretty]),i=OpenLayers.Format.JSON.prototype.write.apply(this,[e[n],this.pretty]),r!=null&&i!=null&&(s&&t.push(","),t.push(this.writeNewline(),this.writeIndent(),r,":",this.writeSpace(),i),s=!0));return this.level-=1,t.push(this.writeNewline(),this.writeIndent(),"}"),t.join("")},array:function(e){var t,n=["["];this.level+=1;for(var r=0,i=e.length;r<i;++r)t=OpenLayers.Format.JSON.prototype.write.apply(this,[e[r],this.pretty]),t!=null&&(r>0&&n.push(","),n.push(this.writeNewline(),this.writeIndent(),t));return this.level-=1,n.push(this.writeNewline(),this.writeIndent(),"]"),n.join("")},string:function(e){var t={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(e)?'"'+e.replace(/([\x00-\x1f\\"])/g,function(e,n){var r=t[n];return r?r:(r=n.charCodeAt(),"\\u00"+Math.floor(r/16).toString(16)+(r%16).toString(16))})+'"':'"'+e+'"'},number:function(e){return isFinite(e)?String(e):"null"},"boolean":function(e){return String(e)},date:function(e){function t(e){return e<10?"0"+e:e}return'"'+e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+"T"+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"});
/* Copyright (c) 2006-2013 by OpenLayers Contributors (see authors.txt for
 * full list of contributors). Published under the 2-clause BSD license.
 * See license.txt in the OpenLayers distribution or repository for the
 * full text of the license. */

OpenLayers.Format.WMC=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"1.1.0",layerToContext:function(e){var t=this.getParser(),n={queryable:e.queryable,visibility:e.visibility,name:e.params.LAYERS,title:e.name,"abstract":e.metadata["abstract"],dataURL:e.metadata.dataURL,metadataURL:e.metadataURL,server:{version:e.params.VERSION,url:e.url},maxExtent:e.maxExtent,transparent:e.params.TRANSPARENT,numZoomLevels:e.numZoomLevels,units:e.units,isBaseLayer:e.isBaseLayer,opacity:e.opacity==1?undefined:e.opacity,displayInLayerSwitcher:e.displayInLayerSwitcher,singleTile:e.singleTile,tileSize:e.singleTile||!e.tileSize?undefined:{width:e.tileSize.w,height:e.tileSize.h},minScale:e.options.resolutions||e.options.scales||e.options.maxResolution||e.options.minScale?e.minScale:undefined,maxScale:e.options.resolutions||e.options.scales||e.options.minResolution||e.options.maxScale?e.maxScale:undefined,formats:[],styles:[],srs:e.srs,dimensions:e.dimensions};e.metadata.servertitle&&(n.server.title=e.metadata.servertitle);if(e.metadata.formats&&e.metadata.formats.length>0)for(var r=0,i=e.metadata.formats.length;r<i;r++){var s=e.metadata.formats[r];n.formats.push({value:s.value,current:s.value==e.params["FORMAT"]})}else n.formats.push({value:e.params.FORMAT,current:!0});if(e.metadata.styles&&e.metadata.styles.length>0)for(var r=0,i=e.metadata.styles.length;r<i;r++){var o=e.metadata.styles[r];o.href==e.params["SLD"]||o.body==e.params["SLD_BODY"]||o.name==e.params["STYLES"]?o.current=!0:o.current=!1,n.styles.push(o)}else n.styles.push({href:e.params.SLD,body:e.params.SLD_BODY,name:e.params.STYLES||t.defaultStyleName,title:t.defaultStyleTitle,current:!0});return n},toContext:function(e){var t={},n=e.layers;if(e.CLASS_NAME=="OpenLayers.Map"){var r=e.metadata||{};t.size=e.getSize(),t.bounds=e.getExtent(),t.projection=e.projection,t.title=e.title,t.keywords=r.keywords,t["abstract"]=r["abstract"],t.logo=r.logo,t.descriptionURL=r.descriptionURL,t.contactInformation=r.contactInformation,t.maxExtent=e.maxExtent}else OpenLayers.Util.applyDefaults(t,e),t.layers!=undefined&&delete t.layers;t.layersContext==undefined&&(t.layersContext=[]);if(n!=undefined&&OpenLayers.Util.isArray(n))for(var i=0,s=n.length;i<s;i++){var o=n[i];o instanceof OpenLayers.Layer.WMS&&t.layersContext.push(this.layerToContext(o))}return t},CLASS_NAME:"OpenLayers.Format.WMC"});
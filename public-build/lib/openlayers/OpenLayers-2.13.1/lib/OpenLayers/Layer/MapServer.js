/* Copyright (c) 2006-2013 by OpenLayers Contributors (see authors.txt for
 * full list of contributors). Published under the 2-clause BSD license.
 * See license.txt in the OpenLayers distribution or repository for the
 * full text of the license. */

OpenLayers.Layer.MapServer=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{mode:"map",map_imagetype:"png"},initialize:function(e,t,n,r){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS);if(r==null||r.isBaseLayer==null)this.isBaseLayer=this.params.transparent!="true"&&this.params.transparent!=1},clone:function(e){return e==null&&(e=new OpenLayers.Layer.MapServer(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e]),e},getURL:function(e){e=this.adjustBounds(e);var t=[e.left,e.bottom,e.right,e.top],n=this.getImageSize(),r=this.getFullRequestString({mapext:t,imgext:t,map_size:[n.w,n.h],imgx:n.w/2,imgy:n.h/2,imgxy:[n.w,n.h]});return r},getFullRequestString:function(e,t){var n=t==null?this.url:t,r=OpenLayers.Util.extend({},this.params);r=OpenLayers.Util.extend(r,e);var i=OpenLayers.Util.getParameterString(r);OpenLayers.Util.isArray(n)&&(n=this.selectUrl(i,n));var s=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(n));for(var o in r)o.toUpperCase()in s&&delete r[o];i=OpenLayers.Util.getParameterString(r);var u=n;i=i.replace(/,/g,"+");if(i!=""){var a=n.charAt(n.length-1);a=="&"||a=="?"?u+=i:n.indexOf("?")==-1?u+="?"+i:u+="&"+i}return u},CLASS_NAME:"OpenLayers.Layer.MapServer"});
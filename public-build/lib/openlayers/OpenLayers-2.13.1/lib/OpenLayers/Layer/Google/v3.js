/* Copyright (c) 2006-2013 by OpenLayers Contributors (see authors.txt for
 * full list of contributors). Published under the 2-clause BSD license.
 * See license.txt in the OpenLayers distribution or repository for the
 * full text of the license. */

OpenLayers.Layer.Google.v3={DEFAULTS:{sphericalMercator:!0,projection:"EPSG:900913"},animationEnabled:!0,loadMapObject:function(){this.type||(this.type=google.maps.MapTypeId.ROADMAP);var e,t=OpenLayers.Layer.Google.cache[this.map.id];if(t)e=t.mapObject,++t.count;else{var n=this.map.getCenter(),r=document.createElement("div");r.className="olForeignContainer",r.style.width="100%",r.style.height="100%",e=new google.maps.Map(r,{center:n?new google.maps.LatLng(n.lat,n.lon):new google.maps.LatLng(0,0),zoom:this.map.getZoom()||0,mapTypeId:this.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1});var i=document.createElement("div");i.style.width="100%",i.style.height="100%",e.controls[google.maps.ControlPosition.TOP_LEFT].push(i),t={googleControl:i,mapObject:e,count:1},OpenLayers.Layer.Google.cache[this.map.id]=t}this.mapObject=e,this.setGMapVisibility(this.visibility)},onMapResize:function(){this.visibility&&google.maps.event.trigger(this.mapObject,"resize")},setGMapVisibility:function(e){var t=OpenLayers.Layer.Google.cache[this.map.id],n=this.map;if(t){var r=this.type,i=n.layers,s;for(var o=i.length-1;o>=0;--o){s=i[o];if(s instanceof OpenLayers.Layer.Google&&s.visibility===!0&&s.inRange===!0){r=s.type,e=!0;break}}var u=this.mapObject.getDiv();if(e===!0){if(u.parentNode!==n.div)if(!t.rendered){var a=this;google.maps.event.addListenerOnce(this.mapObject,"tilesloaded",function(){t.rendered=!0,a.setGMapVisibility(a.getVisibility()),a.moveTo(a.map.getCenter())})}else n.div.appendChild(u),t.googleControl.appendChild(n.viewPortDiv),google.maps.event.trigger(this.mapObject,"resize");this.mapObject.setMapTypeId(r)}else t.googleControl.hasChildNodes()&&(n.div.appendChild(n.viewPortDiv),n.div.removeChild(u))}},getMapContainer:function(){return this.mapObject.getDiv()},getMapObjectBoundsFromOLBounds:function(e){var t=null;if(e!=null){var n=this.sphericalMercator?this.inverseMercator(e.bottom,e.left):new OpenLayers.LonLat(e.bottom,e.left),r=this.sphericalMercator?this.inverseMercator(e.top,e.right):new OpenLayers.LonLat(e.top,e.right);t=new google.maps.LatLngBounds(new google.maps.LatLng(n.lat,n.lon),new google.maps.LatLng(r.lat,r.lon))}return t},getMapObjectLonLatFromMapObjectPixel:function(e){var t=this.map.getSize(),n=this.getLongitudeFromMapObjectLonLat(this.mapObject.center),r=this.getLatitudeFromMapObjectLonLat(this.mapObject.center),i=this.map.getResolution(),s=e.x-t.w/2,o=e.y-t.h/2,u=new OpenLayers.LonLat(n+s*i,r-o*i);return this.wrapDateLine&&(u=u.wrapDateLine(this.maxExtent)),this.getMapObjectLonLatFromLonLat(u.lon,u.lat)},getMapObjectPixelFromMapObjectLonLat:function(e){var t=this.getLongitudeFromMapObjectLonLat(e),n=this.getLatitudeFromMapObjectLonLat(e),r=this.map.getResolution(),i=this.map.getExtent();return this.getMapObjectPixelFromXY(1/r*(t-i.left),1/r*(i.top-n))},setMapObjectCenter:function(e,t){if(this.animationEnabled===!1&&t!=this.mapObject.zoom){var n=this.getMapContainer();google.maps.event.addListenerOnce(this.mapObject,"idle",function(){n.style.visibility=""}),n.style.visibility="hidden"}this.mapObject.setOptions({center:e,zoom:t})},getMapObjectZoomFromMapObjectBounds:function(e){return this.mapObject.getBoundsZoomLevel(e)},getMapObjectLonLatFromLonLat:function(e,t){var n;if(this.sphericalMercator){var r=this.inverseMercator(e,t);n=new google.maps.LatLng(r.lat,r.lon)}else n=new google.maps.LatLng(t,e);return n},getMapObjectPixelFromXY:function(e,t){return new google.maps.Point(e,t)}};
/* Copyright (c) 2006-2013 by OpenLayers Contributors (see authors.txt for
 * full list of contributors). Published under the 2-clause BSD license.
 * See license.txt in the OpenLayers distribution or repository for the
 * full text of the license. */

OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(e,t,n){if(n&&n.sphericalMercator||this.sphericalMercator)n=OpenLayers.Util.extend({projection:"EPSG:900913",numZoomLevels:19},n);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e||this.name,t||this.url,{},n])},clone:function(e){return e==null&&(e=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e]),e},getURL:function(e){var t=this.getXYZ(e),n=this.url;if(OpenLayers.Util.isArray(n)){var r=""+t.x+t.y+t.z;n=this.selectUrl(r,n)}return OpenLayers.String.format(n,t)},getXYZ:function(e){var t=this.getServerResolution(),n=Math.round((e.left-this.maxExtent.left)/(t*this.tileSize.w)),r=Math.round((this.maxExtent.top-e.top)/(t*this.tileSize.h)),i=this.getServerZoom();if(this.wrapDateLine){var s=Math.pow(2,i);n=(n%s+s)%s}return{x:n,y:r,z:i}},setMap:function(e){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.XYZ"});
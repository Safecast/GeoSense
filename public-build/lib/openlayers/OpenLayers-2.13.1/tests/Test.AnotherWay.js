/**
 *  Test.AnotherWay version 0.5
 *  
 *  Copyright (c) 2005 Artem Khodush, http://straytree.org
 *  
 *  Permission is hereby granted, free of charge, to any person obtaining
 *  a copy of this software and associated documentation files (the
 *  "Software"), to deal in the Software without restriction, including
 *  without limitation the rights to use, copy, modify, merge, publish,
 *  distribute, sublicense, and/or sell copies of the Software, and to
 *  permit persons to whom the Software is furnished to do so, subject to
 *  the following conditions:
 *  
 *  The above copyright notice and this permission notice shall be
 *  included in all copies or substantial portions of the Software.
 *  
 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 *  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 *  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 *  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 *  LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 *  OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 *  WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *  
 */

typeof Test=="undefined"&&(Test={}),Test.AnotherWay={},Test.AnotherWay._g_test_iframe=null,Test.AnotherWay._g_test_frame_no_clear=!1,Test.AnotherWay._g_test_page_urls=[],Test.AnotherWay._g_test_object_for_jsan=null,Test.AnotherWay._g_pages_to_run=null,Test.AnotherWay._g_run_on_main_load=!1,Test.AnotherWay._g_run_on_list_load=!1,Test.AnotherWay._g_main_loaded=!1,Test.AnotherWay._run_pages_to_run=function(e){if(!Test.AnotherWay._g_main_loaded)Test.AnotherWay._g_run_on_main_load=!0;else{var t=Test.AnotherWay._g_pages_to_run;if(t=="all")for(var n=0;n<Test.AnotherWay._g_test_page_urls.length;++n)Test.AnotherWay._run_test_page("test"+n);else if(t!=null)for(var r=0;r<t.length;++r){var i=t[r],s=!1;for(var o=0;o<Test.AnotherWay._g_test_page_urls.length;++o)if(i==Test.AnotherWay._g_test_page_urls[o].url){Test.AnotherWay._run_test_page("test"+o,e),s=!0;break}if(!s){Test.AnotherWay._show_error("page specified to run is not found in the page list: "+i);break}}}},Test.AnotherWay._add_test_page_url=function(e,t){var n=document.getElementById("testtable"),r=document.getElementById("record_select"),i=Test.AnotherWay._g_test_page_urls.length;e.match("^(\\s*)(.*\\S)(\\s*)$")&&(e=RegExp.$2),Test.AnotherWay._g_test_page_urls[i]={url:e,convention:t};var s=n.insertRow(-1),o,u,a;o=s.insertCell(-1),u=document.createElement("input"),u.type="checkbox",u.id="checkbox"+i,u.checked="checked",u.defaultChecked="checked",o.appendChild(u),o=s.insertCell(-1),o.setAttribute("width","75%"),o.appendChild(document.createTextNode(e)),o=s.insertCell(-1),u=document.createElement("input"),u.type="button",u.id="test"+i,u.value=" run ",u.onclick=Test.AnotherWay._run_one_onclick,o.appendChild(u),o=s.insertCell(-1),o.setAttribute("width","8em"),u=document.createElement("span"),o.appendChild(u);var f=document.createElement("option");f.appendChild(document.createTextNode(e)),r.appendChild(f)},Test.AnotherWay._show_error=function(e){var t=document.getElementById("error");t.innerHTML="",t.appendChild(document.createTextNode(e)),t.style.display="block"},Test.AnotherWay._list_iframe_onload=function(){if(window.frames.list_iframe!=null&&window.frames.list_iframe.location!=""&&window.frames.list_iframe.location!="about:blank"){var e=window.frames.list_iframe.document,t=e.getElementById("testlist");if(t!=null){for(var n=0;n<t.childNodes.length;++n){var r=t.childNodes[n];if(r.nodeName=="LI"||r.nodeName=="li"){var i="anotherway";Test.AnotherWay._get_css_class(r)=="jsan"&&(i="jsan"),Test.AnotherWay._add_test_page_url(r.innerHTML,i)}}Test.AnotherWay._g_run_on_list_load&&(Test.AnotherWay._g_run_on_list_load=!1,Test.AnotherWay._run_pages_to_run())}else Test.AnotherWay._show_error("no list with id 'testlist' in a list file "+window.frames.list_iframe.location)}},Test.AnotherWay._map_checkboxes=function(e){var t=document.getElementById("testtable"),n=t.getElementsByTagName("INPUT");for(var r=0;r<n.length;++r)n[r].type=="checkbox"&&n[r].id.match(/^checkbox(\d+)$/)&&e(n[r],RegExp.$1)},Test.AnotherWay._run_all_onclick=function(){Test.AnotherWay._map_checkboxes(function(e,t){Test.AnotherWay._run_test_page("test"+t)})},Test.AnotherWay._run_selected_onclick=function(){Test.AnotherWay._map_checkboxes(function(e,t){e.checked&&Test.AnotherWay._run_test_page("test"+t)})},Test.AnotherWay._unselect_all_onclick=function(){Test.AnotherWay._map_checkboxes(function(e,t){e.checked=!1})},Test.AnotherWay._run_one_onclick=function(){Test.AnotherWay._run_test_page(this.id)},Test.AnotherWay._test_object_t=function(e){this.name=e,this.n_plan=null,this.n_ok=0,this.n_fail=0,this.exception="",this.exception_stack=[],this.assertions=[],this.wait_result_milliseconds=0,this.second_wait_msg=null,this.delay_actions=[],this.delay_action_i=null,this.delay_prev_timer_time=0,this.delay_current_milliseconds_left=0,this.delay_total_milliseconds_left=0},Test.AnotherWay._test_object_t.prototype.ok=function(e,t){e?(++this.n_ok,e=1):(++this.n_fail,e=0),this.assertions.push({ok:e,name:t})},Test.AnotherWay._test_object_t.prototype.fail=function(e){this.ok(!1,e)},Test.AnotherWay._test_object_t.prototype.plan=function(e){this.n_plan=e},Test.AnotherWay._test_object_t.prototype.wait_result=function(e){this.wait_result_milliseconds=1e3*e},Test.AnotherWay._eq_fail_msg=function(e,t,n,r){return"eq: "+e+" "+t+" differ: got "+r+", but expected "+n},Test.AnotherWay._array_eq=function(e,t,n,r){if(e.length!=t.length)return r.msg=Test.AnotherWay._eq_fail_msg(n,"array length",e.length,t.length),!1;for(var i=0;i<e.length;++i)if(!Test.AnotherWay._thing_eq(e[i],t[i],n+"["+i+"]",r))return!1;return!0},Test.AnotherWay._object_eq=function(e,t,n,r){var i;for(i in e){if(!(i in t))return r.msg=Test.AnotherWay._eq_fail_msg(n+"."+i,"properties",e[i],"undefined"),!1;if(!Test.AnotherWay._thing_eq(e[i],t[i],n+"."+i,r))return!1}for(i in t)if(!(i in e))return r.msg=Test.AnotherWay._eq_fail_msg(n+"."+i,"properties","undefined",t[i]),!1;return!0},Test.AnotherWay._constructor_name=function(e){if(e==null)return"";var t="unknown";try{t=typeof e.constructor,t!="unknown"&&(t=e.constructor.toString())}catch(n){t="unknown"}if(t=="unknown"){var r=!0,s=0;for(i in e)i!=s&&(r=!1),++s;return r?"Array":"Object"}if(t.match(/^\s*function\s+(\w+)\s*\(/))return RegExp.$1;var o="";switch(typeof e){case"string":o="String";break;case"object":o="Object";break;default:o=""}return o},Test.AnotherWay._is_array=function(e){return Test.AnotherWay._constructor_name(e)=="Array"},Test.AnotherWay._is_value_type=function(e){return cn=Test.AnotherWay._constructor_name(e),cn=="Number"||cn=="String"||cn=="Boolean"||cn=="Date"},Test.AnotherWay._thing_eq=function(e,t,n,r){if(e==null&&t==null)return!0;if(e==null&&t!=null||e!=null&&t==null)return r.msg=Test.AnotherWay._eq_fail_msg(n,"values",e,t),!1;var i=Test.AnotherWay._constructor_name(e),s=Test.AnotherWay._constructor_name(t);return i!=s?(r.msg=Test.AnotherWay._eq_fail_msg(n,"types",i,s),!1):Test.AnotherWay._is_array(e)?Test.AnotherWay._array_eq(e,t,n,r):Test.AnotherWay._is_value_type(e)?e!=t?(r.msg=Test.AnotherWay._eq_fail_msg(n,"values",e,t),!1):!0:Test.AnotherWay._object_eq(e,t,n,r)},Test.AnotherWay._test_object_t.prototype.eq=function(e,t,n){var r={};Test.AnotherWay._thing_eq(t,e,"",r)?this.ok(1,n):this.fail(n+". "+r.msg)},Test.AnotherWay._test_object_t.prototype.like=function(e,t,n){e.match(t)!=null?this.ok(1,n):this.fail(n+": got "+e+", but expected it to match: "+t)},Test.AnotherWay._g_html_eq_span=null,Test.AnotherWay._html_eq_string_to_node=function(e,t,n){return e.nodeType!=null&&(e=Test.AnotherWay._html_eq_node_to_string(e)),Test.AnotherWay._g_html_eq_span==null&&(Test.AnotherWay._g_html_eq_span=document.createElement("span")),Test.AnotherWay._g_html_eq_span.innerHTML=e,Test.AnotherWay._g_html_eq_span.childNodes.length!=1&&(n.msg="bad "+t+" html string given (should contain exactly one outermost element): "+e),Test.AnotherWay._g_html_eq_span.childNodes[0].cloneNode(!0)},Test.AnotherWay._html_eq_node_to_string=function(e){Test.AnotherWay._g_html_eq_span==null&&(Test.AnotherWay._g_html_eq_span=document.createElement("span")),Test.AnotherWay._g_html_eq_span.innerHTML="";if(e.outerHTML!=null)Test.AnotherWay._g_html_eq_span.innerHTML=e.outerHTML;else{var t=e.cloneNode(!0),e=Test.AnotherWay._g_html_eq_span;e.ownerDocument&&e.ownerDocument.importNode&&e.ownerDocument!=t.ownerDocument&&(t=e.ownerDocument.importNode(t,!0)),e.appendChild(t)}return Test.AnotherWay._g_html_eq_span.innerHTML},Test.AnotherWay._html_eq_path_msg=function(e){var t="";for(var n=0;n<e.length;++n)t+=" [node "+e[n].node,e[n].id!=null&&e[n].id!=""?t+=" id "+e[n].id:e[n].index!=null&&(t+=" at index "+e[n].index),t+="] ";return t},Test.AnotherWay._html_eq_fail_msg=function(e,t,n,r){return Test.AnotherWay._html_eq_path_msg(e)+": "+t+" differ: got "+r+", but expected "+n},Test.AnotherWay._html_eq_remove_blank=function(e){return e==null?"":e.match("^(\\s*)(.*\\S)(\\s*)$")?RegExp.$2:e.match("s*")?"":e},Test.AnotherWay._html_eq_remove_blank_nodes=function(e){var t=[];for(var n=e.firstChild;n!=null;n=n.nextSibling)if(n.nodeType==3){var r=Test.AnotherWay._html_eq_remove_blank(n.nodeValue);r==""?t.push(n):n.nodeValue=r}for(var i=0;i<t.length;++i)e.removeChild(t[i])},Test.AnotherWay._html_node_type_text=function(e){return e==1?"1 (html element)":e==3?"3 (text)":e},Test.AnotherWay._html_eq_node=function(e,t,n,r,i,s){if(e.nodeType!=t.nodeType)return r.msg=Test.AnotherWay._html_eq_fail_msg(n,"node types",Test.AnotherWay._html_node_type_text(e.nodeType),Test.AnotherWay._html_node_type_text(t.nodeType)),!1;if(e.nodeType==3){if(e.nodeValue!=t.nodeValue)return r.msg=Test.AnotherWay._html_eq_fail_msg(n,"text",e.nodeValue,t.nodeValue),!1}else if(e.nodeType==1){if(e.nodeName!=t.nodeName)return r.msg=Test.AnotherWay._html_eq_fail_msg(n,"node names",e.nodeName,t.nodeName),!1;var o={},u={},a,f;for(a=0;a<e.attributes.length;++a)f=e.attributes[a],f.specified&&(o[f.name]=1);for(a=0;a<t.attributes.length;++a)f=t.attributes[a],f.specified&&(u[f.name]=1);for(f in o)if(!(f in u))return r.msg=Test.AnotherWay._html_eq_path_msg(n)+": attribute sets differ: expected attribute "+f+" is missing",!1;for(f in u)if(!(f in o))return r.msg=Test.AnotherWay._html_eq_path_msg(n)+": attribute sets differ: got extra attribute "+f,!1;for(f in o){var l=e.getAttribute(f),c=t.getAttribute(f);if(typeof l=="string"&&typeof c=="string"){l=Test.AnotherWay._html_eq_remove_blank(l),c=Test.AnotherWay._html_eq_remove_blank(c);var h=l==c;if(!h&&(f=="href"||f=="HREF")){var p=l;i!=null&&l.substring(0,i.length)==i&&(p=l.substring(i.length));var d=c;s!=null&&c.substring(0,s.length)==s&&(d=c.substring(s.length)),h=p==d}if(!h)return r.msg=Test.AnotherWay._html_eq_fail_msg(n,"attribute "+f+" values",l,c),!1}else if(typeof l=="function"&&typeof c=="function"){l=l.toString(),c=c.toString();if(l!=c)return r.msg=Test.AnotherWay._html_eq_fail_msg(n,"attribute "+f+" values",l,c),!1}else{var v={};if(!Test.AnotherWay._thing_eq(l,c,"",v))return r.msg=Test.AnotherWay._html_eq_path_msg(n)+": attribute "+f+" values differ: "+v.msg,!1}}Test.AnotherWay._html_eq_remove_blank_nodes(e),Test.AnotherWay._html_eq_remove_blank_nodes(t);var m=e.childNodes.length,g=t.childNodes.length;if(m<g)return r.msg=Test.AnotherWay._html_eq_path_msg(n)+": got "+(g-m)+" extra child nodes",!1;if(m>g)return r.msg=Test.AnotherWay._html_eq_path_msg(n)+": expected "+(m-g)+" more child nodes",!1;for(a=0;a<m;++a){var y=e.childNodes[a];n.push({node:y.nodeName,id:y.id,index:a});var b=Test.AnotherWay._html_eq_node(y,t.childNodes[a],n,r,i,s);n.pop();if(!b)return!1}}return!0},Test.AnotherWay._html_eq_get_loc_base=function(e){var t=document.location;e.ownerDocument!=null&&(t=e.ownerDocument.location);if(t!=null){t=t.href;var n=t.lastIndexOf("/");n!=-1&&(t=t.substring(0,n+1))}return t},Test.AnotherWay._test_object_t.prototype.html_eq=function(e,t,n){var r={},i=Test.AnotherWay._html_eq_string_to_node(t,"expected",r);if(r.msg!=null)this.fail(n+" html_eq: "+r.msg);else{var s=Test.AnotherWay._html_eq_string_to_node(e,"got",r);if(r.msg!=null)this.fail(n+" html_eq: "+r.msg);else{var o=Test.AnotherWay._html_eq_get_loc_base(t),u=Test.AnotherWay._html_eq_get_loc_base(e);if(Test.AnotherWay._html_eq_node(i,s,[],r,o,u))this.ok(1,n);else{var r=n+" html_eq "+r.msg,a=Test.AnotherWay._html_eq_node_to_string(i),f=Test.AnotherWay._html_eq_node_to_string(s);r+=".\n got html: "+f,r+=".\n expected html: "+a,this.fail(r)}}}},Test.AnotherWay._debug_pane_print=function(e){var t=new Date,n=document.createElement("p");n.appendChild(document.createTextNode(t.toLocaleTimeString()+" "+e));var r=document.getElementById("debug");r.appendChild(n);var i=document.getElementById("debug_tab"),s=document.getElementById("results_tab");i.style.visibility="visible",s.style.visibility="visible"},Test.AnotherWay._test_object_t.prototype.debug_print=function(e){Test.AnotherWay._debug_pane_print(this.name+": "+e)},Test.AnotherWay._test_object_t.prototype.delay_call=function(){var e=200;for(var t=0;t<arguments.length;++t)if(typeof arguments[t]!="function")e=1e3*arguments[t];else{var n={action_kind:"call",call_delay_milliseconds:e,call_fn:arguments[t]};this.delay_total_milliseconds_left+=Test.AnotherWay._action_estimate_milliseconds(n),this.delay_actions.push(n)}},Test.AnotherWay._test_object_t.prototype.open_window=function(e,t,n){n==null&&(n=4);var r=document.getElementById("dont_close_test_windows"),i={action_kind:"window",wnd_url:e.toString()+(window.location.search||""),wnd_wnd:null,wnd_fn:t,wnd_timeout_milliseconds:n*1e3,wnd_no_close:r.checked};this.delay_total_milliseconds_left+=Test.AnotherWay._action_estimate_milliseconds(i),this.delay_actions.push(i)},Test.AnotherWay._test_object_t.prototype.replay_events=function(e,t){if(Test.AnotherWay._g_no_record_msg!=null)this.fail("replay_events: "+Test.AnotherWay._g_no_record_msg);else{var n={action_kind:"replay",replay_wnd:e,replay_events:t.events,replay_event_i:null,replay_checkpoints:t.checkpoints};this.delay_total_milliseconds_left+=Test.AnotherWay._action_estimate_milliseconds(n),this.delay_actions.push(n)}},Test.AnotherWay._action_estimate_milliseconds=function(e){var t=0;if(e.action_kind=="call")t=e.call_delay_milliseconds;else if(e.action_kind=="window")t=0;else if(e.action_kind=="replay"){t=0;for(var n=0;n<e.replay_events.length;++n)t+=e.replay_events[n].time-0}return t},Test.AnotherWay._g_timeout_granularity=200,Test.AnotherWay._g_tests_queue=[],Test.AnotherWay._run_test_page=function(e,t){e.match(/^test(\d+)/)&&(e=RegExp.$1,Test.AnotherWay._g_tests_queue.push({url:Test.AnotherWay._g_test_page_urls[e].url,convention:Test.AnotherWay._g_test_page_urls[e].convention,test_objects:[]}),Test.AnotherWay._g_tests_queue.length==1&&(t||(Test.AnotherWay._g_tests_queue[0].suppress_outside_path_correction=!0),Test.AnotherWay._start_loading_page()))},Test.AnotherWay._load_next_page=function(){Test.AnotherWay._g_tests_queue.splice(0,1),Test.AnotherWay._g_tests_queue.length>0?Test.AnotherWay._start_loading_page():Test.AnotherWay._g_test_frame_no_clear||Test.AnotherWay._g_test_iframe.location.replace("about:blank")},Test.AnotherWay._g_opera_path_correction=null,Test.AnotherWay._g_outside_path_correction=null,Test.AnotherWay._set_iframe_location=function(e,t,n){var r=t.indexOf("://");if(r!=-1){var i=window.location.href,s=t.substring(r+3).indexOf("/"),o=!1;if(s!=-1){var u=t.substring(0,r+3+s+1);i.length>=u.length&&i.substring(0,u.length)==u&&(o=!0)}if(!o)return{msg:"test pages may have only urls with the same origin as "+i}}if(window.opera!=null&&window.location.protocol=="file:"&&t.indexOf(":")==-1){var a=window.location.href,f=a.indexOf("?");f!=-1&&(a=a.substring(0,f));var l=a.lastIndexOf("/");l!=-1&&(a=a.substring(0,l+1),Test.AnotherWay._g_opera_path_correction=a,t=a+t)}if(n!=null){var c=t.indexOf(n);c==0&&(t=t.substring(n.length+1))}return e.location!=null?e.location.replace(t):e.src=t,{}},Test.AnotherWay._start_loading_page=function(){var e=Test.AnotherWay._g_tests_queue[0];e.loading_timeout_milliseconds=12e3,e.timeout_id=setTimeout(Test.AnotherWay._loading_timeout,Test.AnotherWay._g_timeout_granularity),e.wait_msg=Test.AnotherWay._print_counter_result(e.url,"loading...",e.loading_timeout_milliseconds,"loading"),e.convention=="jsan"&&(Test.AnotherWay._g_test_object_for_jsan=new Test.AnotherWay._test_object_t(e.url));var t=null;Test.AnotherWay._g_outside_path_correction!=null&&!e.suppress_outside_path_correction&&(t=Test.AnotherWay._g_outside_path_correction);var n=Test.AnotherWay._set_iframe_location(Test.AnotherWay._g_test_iframe,e.url,t);n.msg!=null&&(Test.AnotherWay._unprint_result(e.wait_msg),Test.AnotherWay._print_result(e.url,n.msg,"badtest",null),Test.AnotherWay._load_next_page())},Test.AnotherWay._loading_timeout=function(){var e=Test.AnotherWay._g_tests_queue[0];e.loading_timeout_milliseconds-=Test.AnotherWay._g_timeout_granularity,e.loading_timeout_milliseconds>0?(Test.AnotherWay._update_msg_counter(e.wait_msg,(e.loading_timeout_milliseconds/1e3).toFixed()),e.timeout_id=setTimeout(Test.AnotherWay._loading_timeout,Test.AnotherWay._g_timeout_granularity)):(Test.AnotherWay._unprint_result(e.wait_msg),Test.AnotherWay._print_result(e.url,"Unable to load test page. Timeout expired","badtest",null),Test.AnotherWay._load_next_page())},Test.AnotherWay._strip_query_and_hash=function(e){var t=e.lastIndexOf("#");return t!=-1&&(e=e.substring(0,t)),t=e.lastIndexOf("?"),t!=-1&&(e=e.substring(0,t)),e},Test.AnotherWay._is_url_loaded=function(e,t){var n=!1;if(t!=null&&t.location!=null){var r="";r+=t.location;if(r!=""){var i=t.location.pathname,s=e,o=s.lastIndexOf("#");o!=-1&&(s=s.substring(0,o)),o=s.lastIndexOf("?"),o!=-1&&(s=s.substring(0,o)),o=s.lastIndexOf("/"),o!=-1&&o!=s.length-1&&(s=s.substring(o+1)),o=i.indexOf(s);if(t.location.href==e||o!=-1&&o==i.length-s.length)if(t.document.readyState==null||t.document.readyState=="complete")n=!0}}return n},Test.AnotherWay._test_page_onload=function(){if(Test.AnotherWay._g_tests_queue.length==0)return;var e=Test.AnotherWay._g_tests_queue[0];if(!Test.AnotherWay._is_url_loaded(e.url,Test.AnotherWay._g_test_iframe))return;clearTimeout(e.timeout_id),Test.AnotherWay._unprint_result(e.wait_msg);if(e.convention=="anotherway")if(typeof Test.AnotherWay._g_test_iframe.document.scripts!="undefined")for(var t=0;t<Test.AnotherWay._g_test_iframe.document.scripts.length;++t){var n=Test.AnotherWay._g_test_iframe.document.scripts[t].text,r="function test",i=n.indexOf(r);while(i!=-1){n=n.substring(i,n.length);var s=n.indexOf("("),o=n.substring("function ".length,s),u=o.indexOf(" ");u>=0&&(o=o.substring(0,u)),e.test_objects.push(new Test.AnotherWay._test_object_t(o)),n=n.substring(s,n.length),i=n.indexOf(r)}}else for(var t in Test.AnotherWay._g_test_iframe){if(t=="innerWidth"||t=="innerHeight"||t=="sessionStorage")continue;typeof Test.AnotherWay._g_test_iframe[t]=="function"&&t.substring(0,4)=="test"&&e.test_objects.push(new Test.AnotherWay._test_object_t(t))}else e.convention=="jsan"&&e.test_objects.push(Test.AnotherWay._g_test_object_for_jsan);if(e.test_objects.length==0){Test.AnotherWay._print_result(e.url,"No test functions defined in the page","badtest",null),Test.AnotherWay._load_next_page();return}e.wait_msg=Test.AnotherWay._print_result(e.url,'running tests..<span class="counter">'+e.test_objects.length+"</span>","running",null),e.test_object_i=0,Test.AnotherWay._run_more_tests()},Test.AnotherWay._handle_exception=function(e,t,n){var r=n+": "+typeof t+": ";t.message!=null?r+=t.message:t.description!=null?r+=t.description:r+=t.toString(),e.exception=r,r=[];if(t.stack){var i=t.stack.split("\n");for(var s=0;s<i.length;++s)if(i[s].match(/(\w*)\(([^\)]*)\)@(.*):([^:]*)$/)){var o=RegExp.$1;o.length==0&&(o="<anonymous>"),r.push("in "+o+"( "+RegExp.$2+") at "+RegExp.$3+" line "+RegExp.$4+"\n")}}e.exception_stack=r},Test.AnotherWay._run_more_tests=function(){var e=Test.AnotherWay._g_tests_queue[0];while(e.test_object_i<e.test_objects.length){Test.AnotherWay._update_msg_counter(e.wait_msg,1+e.test_object_i+"/"+e.test_objects.length);var t=e.test_objects[e.test_object_i];if(e.convention=="anotherway")try{Test.AnotherWay._g_test_iframe[t.name](t)}catch(n){Test.AnotherWay._handle_exception(t,n,"")}if(t.delay_actions.length>0||t.wait_result_milliseconds>0){t.delay_total_milliseconds_left+=t.wait_result_milliseconds,Test.AnotherWay._delay_actions_timeout();return}++e.test_object_i}Test.AnotherWay._unprint_result(e.wait_msg),Test.AnotherWay._print_result(e.url,null,null,e.test_objects),Test.AnotherWay._load_next_page()},Test.AnotherWay._delay_actions_timeout=function(){var e=Test.AnotherWay._g_tests_queue[0],t=e.test_objects[e.test_object_i],n=!0;if(t.delay_action_i==null)t.delay_action_i=-1;else{var r=(new Date).getTime()-t.delay_prev_timer_time;t.delay_current_milliseconds_left-=r,t.delay_total_milliseconds_left-=r,n=Test.AnotherWay._delay_continue_action(t,r)}while(n&&t.delay_action_i<t.delay_actions.length)++t.delay_action_i,n=Test.AnotherWay._delay_start_action(t);if(t.delay_action_i<=t.delay_actions.length){t.delay_prev_timer_time=(new Date).getTime();var i=Test.AnotherWay._g_timeout_granularity;t.delay_current_milliseconds_left<i&&(i=t.delay_current_milliseconds_left),t.second_wait_msg!=null&&Test.AnotherWay._update_msg_counter(t.second_wait_msg,(t.delay_total_milliseconds_left/1e3).toFixed()),setTimeout(Test.AnotherWay._delay_actions_timeout,i)}else t.second_wait_msg!=null&&(Test.AnotherWay._unprint_result(t.second_wait_msg),t.second_wait_msg=null),++e.test_object_i,Test.AnotherWay._run_more_tests()},Test.AnotherWay._delay_start_action=function(e){var t=!1,n="";if(e.delay_action_i==e.delay_actions.length)e.wait_result_milliseconds>0?(e.delay_current_milliseconds_left=e.wait_result_milliseconds,n="waiting for results.."):++e.delay_action_i;else{var r=e.delay_actions[e.delay_action_i];r.action_kind=="call"?(e.delay_current_milliseconds_left=r.call_delay_milliseconds,n="performing delayed calls.."):r.action_kind=="window"?(Test.AnotherWay._g_opera_path_correction!=null&&r.wnd_url.indexOf(":")==-1&&(r.wnd_url=Test.AnotherWay._g_opera_path_correction+r.wnd_url),r.wnd_wnd=window.open(r.wnd_url,"_blank"),r.wnd_wnd==null?(t=!0,e.fail("unable to open window for "+r.wnd_url)):(e.delay_current_milliseconds_left=r.wnd_timeout_milliseconds,n="opening window..")):r.action_kind=="replay"&&(r.replay_events.length==0?t=!0:(r.replay_event_i=0,e.delay_current_milliseconds_left=r.replay_events[0].time,n="replaying events.."))}e.second_wait_msg!=null&&Test.AnotherWay._unprint_result(e.second_wait_msg);if(n!=""){var i=Test.AnotherWay._g_tests_queue[0];e.second_wait_msg=Test.AnotherWay._print_counter_result(i.url,n,e.delay_total_milliseconds_left,"waiting")}else e.second_wait_msg=null;return t},Test.AnotherWay._delay_continue_action=function(e,t){var n=e.delay_current_milliseconds_left<=0;if(e.delay_action_i==e.delay_actions.length)e.n_plan!=null&&e.n_plan==e.n_ok+e.n_fail&&(n=!0),n&&++e.delay_action_i;else{var r=e.delay_actions[e.delay_action_i];if(r.action_kind=="call"){if(n)try{r.call_fn()}catch(i){Test.AnotherWay._handle_exception(e,i,"in delay_call")}}else if(r.action_kind=="window"){e.delay_total_milliseconds_left+=t;if(Test.AnotherWay._is_url_loaded(r.wnd_url,r.wnd_wnd)){try{r.wnd_fn(r.wnd_wnd)}catch(i){Test.AnotherWay._handle_exception(e,i,"in open_window function call")}n=!0}else n&&e.fail("unable to open window for url '"+r.wnd_url+"'. timeout expired")}else r.action_kind=="replay"&&n&&(Test.AnotherWay._delay_replay_event(e,r.replay_wnd,r.replay_events[r.replay_event_i],r.replay_checkpoints),++r.replay_event_i,n=r.replay_event_i==r.replay_events.length,n||(e.delay_current_milliseconds_left=r.replay_events[r.replay_event_i].time))}return n},Test.AnotherWay._delay_replay_event=function(e,t,n,r){if(n.type=="_checkpoint"){var i=n.which,s=e.n_fail;r[i](e,t);var o=s==e.n_fail?"#2f2":"#f22";Test.AnotherWay._record_flash_border(o)}else if(n.type=="click"||n.type=="mouseover"||n.type=="mouseout"||n.type=="mousemove"||n.type=="mousedown"||n.type=="mouseup"){var u=Test.AnotherWay._record_node_path_to_node(n.target,t.document);if(u!=null){Test.AnotherWay._record_control_update_highlight(u,"ball",n);var a=t.document.createEvent("MouseEvents"),f=Test.AnotherWay._record_node_path_to_node(n.relatedTarget,t.document);a.initMouseEvent(n.type,n.cancelable,n.bubbles,t.document.defaultView,n.detail,n.screenX,n.screenY,n.clientX,n.clientY,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.button,Test.AnotherWay._record_node_path_to_node(n.relatedTarget,t.document)),a.passThroughRelatedTarget=f,u.dispatchEvent(a)}}else if(n.type=="keyup"||n.type=="keydown"||n.type=="keypress"){var a=t.document.createEvent("KeyboardEvents");a.initKeyboardEvent(n.type,n.cancelable,n.bubbles,t.document.defaultView,n.which,n.which,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,!1),t.document.dispatchEvent(a)}},Test.AnotherWay._print_counter_result=function(e,t,n,r){return Test.AnotherWay._print_result(e,t+'<span class="counter">'+(n/1e3).toFixed()+"</span>",r,null)},Test.AnotherWay._g_result_count=0,Test.AnotherWay._g_ok_pages=0,Test.AnotherWay._g_fail_pages=0,Test.AnotherWay._print_result=function(e,t,n,r){var i=document.getElementById("results"),s=i.appendChild(document.createElement("p"));s.id="result"+Test.AnotherWay._g_result_count,++Test.AnotherWay._g_result_count,s.onclick=Test.AnotherWay._toggle_detail;var o='<span class="bullet">&nbsp;&nbsp;&nbsp;</span>&nbsp;';e!=""&&(o+=e+":  "),t!=null&&(o+=t);if(r!=null){var u=0,a=0,f=0,l=0,c=0,h=i.appendChild(document.createElement("div"));s.id.match(/^result(\d+)$/)&&(h.id="result_detail"+RegExp.$1);for(var p=0;p<r.length;++p){var d=r[p],v,m;v=document.createElement("P"),Test.AnotherWay._set_css_class(v,"result_detail"),m=d.name,d.n_fail>0||d.exception||d.n_plan!=null&&d.n_plan!=d.n_ok+d.n_fail||d.n_plan==null&&d.n_ok==0&&d.n_fail==0?(++f,m+=' <span class="fail">',d.n_plan!=null&&d.n_plan!=d.n_ok+d.n_fail&&(m+="planned "+d.n_plan+" assertions but got "+(d.n_ok+d.n_fail)+"; "),d.n_plan==null&&d.n_ok==0&&d.n_fail==0?m+="test did not output anything":m+=" fail "+d.n_fail,m+="</span>"):++u,m+=" ok "+d.n_ok,d.n_plan==null&&(c=1,m+=' <span class="warning">no plan</span>'),v.innerHTML=m,h.appendChild(v),d.exception&&(v=document.createElement("P"),Test.AnotherWay._set_css_class(v,"result_exception_detail"),v.innerHTML='<span class="fail">exception:</span> '+d.exception,h.appendChild(v),v=document.createElement("P"),Test.AnotherWay._set_css_class(v,"result_exception_stack_detail"),v.innerHTML=d.exception_stack.join("<br/>"),h.appendChild(v));for(var g=0;g<d.assertions.length;++g){var y=d.assertions[g],b=y.ok?"ok":'<span class="fail">fail</span>';v=document.createElement("P"),Test.AnotherWay._set_css_class(v,"result_micro_detail"),v.innerHTML=b,v.appendChild(document.createTextNode(" "+y.name)),h.appendChild(v)}a+=d.n_ok,l+=d.n_fail}if(f||l)o+=" fail "+f;o+=" ok "+u+" (detailed:";if(f||l)o+=" fail "+l;o+=" ok "+a+")",c&&(o+=' <span class="warning">no plan</span>'),n=f==0?"ok":"fail",h.style.display=n=="fail"?"block":"none",h.style.cursor="text"}if(n!=null){Test.AnotherWay._set_css_class(s,n),n=="ok"?++Test.AnotherWay._g_ok_pages:(n=="fail"||n=="badtest")&&++Test.AnotherWay._g_fail_pages;var w="";Test.AnotherWay._g_fail_pages>0&&(w+=" fail "+Test.AnotherWay._g_fail_pages),w+=" ok "+Test.AnotherWay._g_ok_pages,Test.AnotherWay._openlayers_sum_total_detail_ok=Test.AnotherWay._openlayers_sum_total_detail_ok||0,Test.AnotherWay._openlayers_sum_total_detail_ok+=a||0,Test.AnotherWay._openlayers_sum_total_detail_fail=Test.AnotherWay._openlayers_sum_total_detail_fail||0,Test.AnotherWay._openlayers_sum_total_detail_fail+=l||0,w+=" (detailed: fail "+Test.AnotherWay._openlayers_sum_total_detail_fail+" | ok "+Test.AnotherWay._openlayers_sum_total_detail_ok+")",Test.AnotherWay._update_results_total(w)}s.innerHTML=o,i.scrollHeight!=null&&i.scrollTop!=null&&i.offsetHeight!=null&&(i.scrollTop=i.scrollHeight-i.offsetHeight);if(r!=null)for(var p=0;p<r.length;++p){var E=r[p].delay_actions;for(var S=0;S<E.length;++S){var x=E[S];x.action_kind=="window"&&x.wnd_wnd!=null&&!x.wnd_no_close&&(x.wnd_wnd.close(),x.wnd_wnd=null)}}return s},Test.AnotherWay._unprint_result=function(e){var t=document.getElementById("results");t.removeChild(e)},Test.AnotherWay._toggle_detail=function(){if(this.id.match(/^result(\d+)$/)){var e=document.getElementById("result_detail"+RegExp.$1);e!=null&&(e.style.display=="none"?e.style.display="block":e.style.display=="block"&&(e.style.display="none"))}},Test.AnotherWay._update_msg_counter=function(e,t){for(var n=0;n<e.childNodes.length;++n){var r=e.childNodes[n];r.nodeName=="SPAN"&&Test.AnotherWay._get_css_class(r)=="counter"&&(r.innerHTML=t)}},Test.AnotherWay._update_results_total=function(e){var t=document.getElementById("total");t&&(t.innerHTML=e)},Test.AnotherWay._results_clear_onclick=function(){var e=document.getElementById("results");e.innerHTML="",Test.AnotherWay._update_results_total(""),Test.AnotherWay._g_ok_pages=0,Test.AnotherWay._g_fail_pages=0,Test.AnotherWay._openlayers_sum_total_detail_ok=0,Test.AnotherWay._openlayers_sum_total_detail_fail=0;var t=document.getElementById("debug");t.innerHTML="",Test.AnotherWay.reset_running_time()},Test.AnotherWay._get_css_class=function(e){var t=e.getAttribute("className");if(t==null||t=="")t=e.getAttribute("class");return t},Test.AnotherWay._set_css_class=function(e,t){e.setAttribute("className",t),e.setAttribute("class",t)},Test.AnotherWay._tab_onclick=function(){var e=this,t=[document.getElementById("debug_tab"),document.getElementById("results_tab")],n=[document.getElementById("debug"),document.getElementById("results")];for(var r=0;r<t.length;++r)e==t[r]?(Test.AnotherWay._set_css_class(t[r],"active_tab"),n[r].style.display="block"):(Test.AnotherWay._set_css_class(t[r],"inactive_tab"),n[r].style.display="none")},Test.AnotherWay._tab_mouseover=function(){Test.AnotherWay._get_css_class(this)=="inactive_tab"&&Test.AnotherWay._set_css_class(this,"inactive_mouseover_tab")},Test.AnotherWay._tab_mouseout=function(){Test.AnotherWay._get_css_class(this)=="inactive_mouseover_tab"&&Test.AnotherWay._set_css_class(this,"inactive_tab")},Test.AnotherWay._record_check_onfocus=function(){var e=this,t=e.type!="text",n=document.getElementById("record_div"),r=n.getElementsByTagName("input");for(var i=0;i<r.length;++i){var s=r[i];s.type=="radio"&&(s.value=="select"?s.checked=t:s.value=="input"&&(s.checked=!t))}},Test.AnotherWay._g_no_record_msg=null,Test.AnotherWay._g_record_timeout_cnt=0,Test.AnotherWay._g_record_url=null,Test.AnotherWay._g_record_wnd=null,Test.AnotherWay._g_record_random_id=null,Test.AnotherWay._g_record_keydown=null,Test.AnotherWay._g_record_ctrl_keydown=!1,Test.AnotherWay._g_record_shift_keydown=!1,Test.AnotherWay._g_record_control_visible=!0,Test.AnotherWay._g_record_started,Test.AnotherWay._g_record_paused,Test.AnotherWay._g_record_include_mousemove=!1,Test.AnotherWay._g_record_start_time,Test.AnotherWay._g_record_pause_start_time,Test.AnotherWay._g_record_update_time_interval,Test.AnotherWay._g_record_waiting_for_results=!1,Test.AnotherWay._g_record_events,Test.AnotherWay._g_record_under_cursor,Test.AnotherWay._g_record_checkpoint_count,Test.AnotherWay._g_record_mouse_over_record_control,Test.AnotherWay._g_record_highlighted_element={element:null,x:null,y:null},Test.AnotherWay._record_control_get_element=function(e){return Test.AnotherWay._g_record_wnd!=null&&Test.AnotherWay._g_record_wnd.document!=null?Test.AnotherWay._g_record_wnd.document.getElementById(e+Test.AnotherWay._g_record_random_id):null},Test.AnotherWay._record_start_onclick=function(){if(Test.AnotherWay._g_no_record_msg!=null){alert(Test.AnotherWay._g_no_record_msg);return}if(Test.AnotherWay._g_record_timeout_cnt>0||Test.AnotherWay._g_record_wnd!=null&&Test.AnotherWay._g_record_wnd.closed!=null&&!Test.AnotherWay._g_record_wnd.closed){alert("there is already window opened for recording input for a page "+Test.AnotherWay._g_record_url);return}var e=document.getElementById("record_div"),t=e.getElementsByTagName("input"),n=null;for(var r=0;r<t.length;++r){var i=t[r];if(i.type=="radio")if(i.value=="select"&&i.checked){var s=document.getElementById("record_select").selectedIndex;s>0&&(n=Test.AnotherWay._g_test_page_urls[s-1].url)}else i.value=="input"&&i.checked&&(n=document.getElementById("record_input").value)}n!=null&&(Test.AnotherWay._g_record_url=n,Test.AnotherWay._g_record_wnd=window.open(n,"_blank"),Test.AnotherWay._g_record_wnd==null?alert("unable to open new window for a page: "+n):(Test.AnotherWay._g_record_timeout_cnt=50,setTimeout(Test.AnotherWay._record_window_timeout,100)))},Test.AnotherWay._record_window_timeout=function(){Test.AnotherWay._is_url_loaded(Test.AnotherWay._g_record_url,Test.AnotherWay._g_record_wnd)?Test.AnotherWay._record_window_setup(Test.AnotherWay._g_record_wnd):--Test.AnotherWay._g_record_timeout_cnt>0?setTimeout(Test.AnotherWay._record_window_timeout,100):(alert("timeout expired while opening new window for a page: "+Test.AnotherWay._g_record_url),Test.AnotherWay._g_record_wnd=null,Test.AnotherWay._g_record_url=null,Test.AnotherWay._g_record_timeout_cnt=0)},Test.AnotherWay._record_control_randomize_id=function(e,t){e.id!=""&&(e.id=e.id+t);for(var n=e.firstChild;n!=null;n=n.nextSibling)Test.AnotherWay._record_control_randomize_id(n,t)},Test.AnotherWay._record_window_setup=function(e){Test.AnotherWay._g_record_timeout_cnt=0;var t=document.getElementById("record_control"),n=e.document.importNode(t,!0);Test.AnotherWay._g_record_random_id=(1e3*Math.random()).toFixed(),Test.AnotherWay._record_control_randomize_id(n,Test.AnotherWay._g_record_random_id),Test.AnotherWay._g_record_control_visible=!0,Test.AnotherWay._g_record_started=!1,Test.AnotherWay._g_record_paused=!1,Test.AnotherWay._g_record_checkpoint_count=0,Test.AnotherWay._g_record_mouse_over_record_control=!1;var r=e.document;r.body.appendChild(n),window.opera&&(cursor_over_indicator=Test.AnotherWay._record_control_get_element("record_cursor_over"),cursor_over_indicator.style.width="18em",cursor_over_indicator.style.height="2em",cursor_over_indicator.style.fontSize="7pt"),r.addEventListener("keydown",Test.AnotherWay._record_control_keydown,!0),r.addEventListener("keyup",Test.AnotherWay._record_control_keyup,!0),r.body.addEventListener("mousemove",Test.AnotherWay._record_on_mousemove,!0),r.body.addEventListener("click",Test.AnotherWay._record_event,!0),r.body.addEventListener("mouseover",Test.AnotherWay._record_event,!0),r.body.addEventListener("mouseout",Test.AnotherWay._record_event,!0),r.body.addEventListener("mousedown",Test.AnotherWay._record_event,!0),r.body.addEventListener("mouseup",Test.AnotherWay._record_event,!0)},Test.AnotherWay._record_control_key_disabled=function(e){return e=="c"?!Test.AnotherWay._g_record_started:e=="p"?!Test.AnotherWay._g_record_started:e=="s"?Test.AnotherWay._g_record_waiting_for_results:!1},Test.AnotherWay._record_control_update_ui=function(){var e="#fff",t="#aaa",n="#adf",r="#fdf",i={};i[!1]="none",i[!0]="inline";var s=Test.AnotherWay._record_control_get_element("record_s"),o=Test.AnotherWay._record_control_get_element("record_on"),u=Test.AnotherWay._record_control_get_element("record_off");s.style.backgroundColor=Test.AnotherWay._record_control_key_disabled("s")?t:Test.AnotherWay._g_record_keydown=="s"?e:Test.AnotherWay._g_record_started?r:n,o.style.display=i[!Test.AnotherWay._g_record_started],u.style.display=i[Test.AnotherWay._g_record_started];var a=Test.AnotherWay._record_control_get_element("record_h");a.style.backgroundColor=Test.AnotherWay._g_record_keydown=="h"?e:n;var f=Test.AnotherWay._record_control_get_element("record_p"),l=Test.AnotherWay._record_control_get_element("record_pause_on"),c=Test.AnotherWay._record_control_get_element("record_pause_off");f.style.backgroundColor=Test.AnotherWay._record_control_key_disabled("p")?t:Test.AnotherWay._g_record_keydown=="p"?e:Test.AnotherWay._g_record_paused?r:n,l.style.display=i[!Test.AnotherWay._g_record_paused],c.style.display=i[Test.AnotherWay._g_record_paused];var h=Test.AnotherWay._record_control_get_element("record_m"),p=Test.AnotherWay._record_control_get_element("record_include_mousemove"),d=Test.AnotherWay._record_control_get_element("record_omit_mousemove");h.style.backgroundColor=Test.AnotherWay._g_record_keydown=="m"?e:Test.AnotherWay._g_record_include_mousemove?r:n,p.style.display=i[!Test.AnotherWay._g_record_include_mousemove],d.style.display=i[Test.AnotherWay._g_record_include_mousemove];var v=Test.AnotherWay._record_control_get_element("record_c");v.style.backgroundColor=Test.AnotherWay._record_control_key_disabled("c")?t:Test.AnotherWay._g_record_keydown=="c"?e:n;var m=Test.AnotherWay._record_control_get_element("record_indicator");m.style.display=i[Test.AnotherWay._g_record_started];var g=Test.AnotherWay._record_control_get_element("record_pause_indicator");g.style.display=i[Test.AnotherWay._g_record_paused];var y=Test.AnotherWay._record_control_get_element("record_control");y.style.display=Test.AnotherWay._g_record_control_visible?"block":"none";var b=Test.AnotherWay._record_control_get_element("record_shift_key");b.style.backgroundColor=Test.AnotherWay._g_record_shift_keydown?e:n;var w=Test.AnotherWay._record_control_get_element("record_ctrl_key");w.style.backgroundColor=Test.AnotherWay._g_record_ctrl_keydown?e:n},Test.AnotherWay._record_format_time=function(e){e=new Date(e);var t=e.getMinutes(),n=e.getSeconds(),r=t==0?"":t+"m ";return r+=n+"s.",r},Test.AnotherWay._record_control_update_time=function(){var e=Test.AnotherWay._record_control_get_element("record_time");e!=null&&(e.innerHTML=Test.AnotherWay._record_format_time((new Date).getTime()-Test.AnotherWay._g_record_start_time))},Test.AnotherWay._record_control_update_highlight=function(e,t,n){if(e==null)Test.AnotherWay._record_highlight_border(null);else{var r=Test.AnotherWay._get_page_coords(e);if(t=="ball"||e!=Test.AnotherWay._g_record_highlighted_element.element||r.x!=Test.AnotherWay._g_record_highlighted_element.x||r.y!=Test.AnotherWay._g_record_highlighted_element.y)Test.AnotherWay._g_record_highlighted_element={element:e,x:r.x,y:r.y},Test.AnotherWay._record_highlight_border(e,t,n)}},Test.AnotherWay._record_decode_key=function(e){var t=null;return e==null?t=Test.AnotherWay._g_record_wnd.event.keyCode:t=e.which,t==83?"s":t==72?"h":t==73?"i":t==80?"p":t==67?"c":t==77?"m":t==16?"shift":t==17?"ctrl":t==18?"alt":t==19?"pause":t==123?"f12":""},Test.AnotherWay._record_control_keydown=function(e){var t=!1,n=Test.AnotherWay._record_decode_key(e);n=="shift"?Test.AnotherWay._g_record_shift_keydown=!0:n=="ctrl"?Test.AnotherWay._g_record_ctrl_keydown=!0:n==""||Test.AnotherWay._g_record_keydown!=null&&Test.AnotherWay._g_record_keydown!=n?Test.AnotherWay._g_record_keydown="":Test.AnotherWay._g_record_ctrl_keydown&&Test.AnotherWay._g_record_shift_keydown&&!Test.AnotherWay._record_control_key_disabled(n)&&(Test.AnotherWay._g_record_keydown=n,t=!0),Test.AnotherWay._record_control_update_ui(),!t;return},Test.AnotherWay._record_control_keyup=function(e){var t=!1,n=Test.AnotherWay._record_decode_key(e);if(n=="shift")Test.AnotherWay._g_record_shift_keydown=!1;else if(n=="ctrl")Test.AnotherWay._g_record_ctrl_keydown=!1;else if(n!=""&&n==Test.AnotherWay._g_record_keydown&&Test.AnotherWay._g_record_ctrl_keydown&&Test.AnotherWay._g_record_shift_keydown)if(n=="s"){Test.AnotherWay._g_record_started=!Test.AnotherWay._g_record_started;if(Test.AnotherWay._g_record_started)Test.AnotherWay._g_record_events=[],Test.AnotherWay._g_record_start_time=(new Date).getTime(),Test.AnotherWay._record_control_update_time(),Test.AnotherWay._g_record_update_time_interval=window.setInterval(Test.AnotherWay._record_control_update_time,200);else{Test.AnotherWay._record_control_update_highlight(null),Test.AnotherWay._g_record_paused||window.clearInterval(Test.AnotherWay._g_record_update_time_interval),Test.AnotherWay._g_record_waiting_for_results=!0,Test.AnotherWay._g_record_paused=!1;var r=window.location;r=r.protocol+"//"+r.host+r.pathname+"?recording_results="+Test.AnotherWay._g_record_random_id,window.open(r,"_blank")==null&&alert("unable to open new window for results")}t=!0}else if(n=="h")Test.AnotherWay._g_record_control_visible=!Test.AnotherWay._g_record_control_visible,t=!0;else if(n=="p"){Test.AnotherWay._g_record_paused=!Test.AnotherWay._g_record_paused;if(Test.AnotherWay._g_record_paused)Test.AnotherWay._g_record_pause_start_time=(new Date).getTime(),Test.AnotherWay._g_record_started&&window.clearInterval(Test.AnotherWay._g_record_update_time_interval),Test.AnotherWay._record_control_update_highlight(null);else{var i=(new Date).getTime()-Test.AnotherWay._g_record_pause_start_time;Test.AnotherWay._g_record_start_time+=i,Test.AnotherWay._g_record_update_time_interval=window.setInterval(Test.AnotherWay._record_control_update_time,200)}t=!0}else if(n=="m")Test.AnotherWay._g_record_include_mousemove=!Test.AnotherWay._g_record_include_mousemove,t=!0;else if(n=="c"){var s=Test.AnotherWay._record_checkpoint();Test.AnotherWay._record_display_checkpoint(s),Test.AnotherWay._record_flash_border("#24d"),t=!0}Test.AnotherWay._g_record_keydown=null,Test.AnotherWay._record_control_update_ui(),!t;return},Test.AnotherWay._record_html_node_path=function(e){if(e==null)return null;var t=[];for(;;){if(e.id!=null&&e.id!=""){t.unshift("#"+e.id+" "+e.nodeName);break}var n=e.parentNode;if(n==null)return[];var r=0,i=!1;for(var s=n.firstChild;s!=null;s=s.nextSibling){if(s==e){i=!0;break}s.nodeType==1&&++r}i||(r=-1),t.unshift(r+" "+e.nodeName);if(n.nodeName=="BODY"||n.nodeName=="body")break;e=n}return t},Test.AnotherWay._record_node_path_to_string=function(e){var t="";if(e!=null)for(var n=0;n<e.length;++n){t+=n==0?"":", ";var r=e[n].split(" ");r[0].charAt(0)=="#"?t+=r[1]+" "+r[0]:t+=r[1]+" ["+r[0]+"]"}return t},Test.AnotherWay._record_node_path_to_node=function(e,t){if(e==null)return null;var n=e.split(","),r=t.body;for(var i=0;i<n.length;++i){var s=n[i].split(" ")[0];if(s.charAt(0)=="#")r=t.getElementById(s.substring(1));else if(s<0||s>=r.childNodes.length)r=null;else{r=r.firstChild;while(r!=null){if(r.nodeType==1){if(s==0)break;--s}r=r.nextSibling}}if(r==null)return null}return r},Test.AnotherWay._record_control_contains_id=function(e){return e.match(/^#record_[\w_]+/)&&e.match(Test.AnotherWay._g_record_random_id)},Test.AnotherWay._record_checkpoint=function(){var e={type:"_checkpoint",time:(new Date).getTime()-Test.AnotherWay._g_record_start_time,which:Test.AnotherWay._g_record_checkpoint_count++,target:Test.AnotherWay._record_html_node_path(Test.AnotherWay._g_record_under_cursor)};return Test.AnotherWay._g_record_events.push(e),e},Test.AnotherWay._record_event=function(e){var t=["rangeOffset","eventPhase","timeStamp","isTrusted","popupWindowFeatures","rangeOffset"];if(Test.AnotherWay._g_record_started&&!Test.AnotherWay._g_record_paused){var n={};for(var r in e){var i=!r.match(/^[A-Z0-9_]+$/);if(i){for(var s=0;s<t.length;++s)if(t[s]==r){i=!1;break}if(i){var o=e[r];if(typeof o!="object"&&typeof o!="function")n[r]=o;else if(r=="target"||r=="relatedTarget")n[r]=Test.AnotherWay._record_html_node_path(o)}}}n.time=(new Date).getTime()-Test.AnotherWay._g_record_start_time;var u=n["target"]!=null&&n["target"][0]!=null&&Test.AnotherWay._record_control_contains_id(n.target[0]);u||Test.AnotherWay._g_record_events.push(n)}return!0},Test.AnotherWay._record_on_mousemove=function(e){var t=Test.AnotherWay._record_html_node_path(e.target),n=t!=null&&t[0]!=null&&Test.AnotherWay._record_control_contains_id(t[0]);n!=Test.AnotherWay._g_record_mouse_over_record_control&&(Test.AnotherWay._g_record_mouse_over_record_control=n,Test.AnotherWay._record_control_update_ui());if(e.target!=null&&e.target!=Test.AnotherWay._g_record_under_cursor){Test.AnotherWay._g_record_under_cursor=e.target;var r="";if(t==null||t[0]==null||!Test.AnotherWay._record_control_contains_id(t[0]))r=Test.AnotherWay._record_node_path_to_string(t);r==""&&(r="&nbsp;");var i=Test.AnotherWay._record_control_get_element("record_cursor_over");i.innerHTML=r}var s=null;return!Test.AnotherWay._g_record_mouse_over_record_control&&Test.AnotherWay._g_record_started&&!Test.AnotherWay._g_record_paused&&(s=e.target),Test.AnotherWay._g_record_include_mousemove&&Test.AnotherWay._record_event(e),!0},Test.AnotherWay._record_display_checkpoint=function(e){var t=Test.AnotherWay._record_control_get_element("record_checkpoints"),n=t.appendChild(t.ownerDocument.createElement("div"));n.style.marginTop="3px",n.style.font="normal normal 8pt sans-serif",n.style.color="#000",n.style.textAligh="left",n.style.position="relative",n.style.width="100%";var r="";r+="#"+(e.which+1),r+="  "+Test.AnotherWay._record_format_time(e.time),e.target!=null&&(r+=Test.AnotherWay._record_node_path_to_string(e.target)),n.appendChild(n.ownerDocument.createTextNode(r))},Test.AnotherWay._record_save_results=function(e){var t=function(t){e.write("<div>"+t+"</div>")};t("/* paste this data into your javascript and pass it as an argument to replay_events method */"),t("{ checkpoints: [");var n=!0;for(var r=0;r<Test.AnotherWay._g_record_events.length;++r){var i=Test.AnotherWay._g_record_events[r];if(i.type=="_checkpoint"){var s=n?"":"}, ";s+="function( tst, wnd ) { // #"+i.which+" time "+Test.AnotherWay._record_format_time(i.time)+" cursor was over "+Test.AnotherWay._record_node_path_to_string(i.target),t(s),n=!1}}n||t("}"),t("], events: [ ");var o=0;for(var r=0;r<Test.AnotherWay._g_record_events.length;++r){var i=Test.AnotherWay._g_record_events[r],u="";u+="{";var a=!0;for(var f in i){if(f=="time"){var l=i[f]-0;i[f]=l-o,o=l}u+=a?f:", "+f,u+=":",i[f]==null?u+="null":u+='"'+i[f]+'"',a=!1}u+=r==Test.AnotherWay._g_record_events.length-1?"}":"},",t(u)}t("] }"),t(";")},Test.AnotherWay._g_record_border,Test.AnotherWay._g_record_border_flashes=[],Test.AnotherWay._g_record_border_flashing=!1,Test.AnotherWay._g_record_border_normal_color="#d4b",Test.AnotherWay._record_flash_border_timeout=function(){var e=Test.AnotherWay._g_record_border_normal_color,t=null;Test.AnotherWay._g_record_border_flashes.length!=0&&(e=Test.AnotherWay._g_record_border_flashes[0].color,t=Test.AnotherWay._g_record_border_flashes[0].timeout,Test.AnotherWay._g_record_border_flashes.splice(0,1));if(Test.AnotherWay._g_record_border!=null)for(var n=0;n<Test.AnotherWay._g_record_border.length;++n)Test.AnotherWay._g_record_border[n].style.backgroundColor=e;t!=null?setTimeout(Test.AnotherWay._record_flash_border_timeout,t):Test.AnotherWay._g_record_border_flashing=!1},Test.AnotherWay._get_page_coords=function(e){var t={x:0,y:0};while(e)t.x+=e.offsetLeft,t.y+=e.offsetTop,e=e.offsetParent;return t},Test.AnotherWay._set_page_coords=function(e,t,n){var r={x:0,y:0};e.offsetParent&&(r=Test.AnotherWay._get_page_coords(e.offsetParent));var i=t-r.x;i<0&&(i=0),e.style.left=i+"px";var s=n-r.y;s<0&&(s=0),e.style.top=s+"px"},Test.AnotherWay._record_setup_highlight_positions=function(e,t,n,r){if(t=="border"){var i=e.clientWidth,s=e.clientHeight,o=0,u=2,a=4;r.push({x:n.x-o-u,y:n.y-o-u,width:i+2*o+2*u+a,height:u}),r.push({x:n.x+i+o+a,y:n.y-o-u,width:u,height:s+2*o+2*u+a}),r.push({x:r[0].x,y:r[0].y,width:r[0].width,height:r[0].height}),r.push({x:r[1].x,y:r[1].y,width:r[1].width,height:r[1].height}),r[2].y+=s+u+2*o+a,r[3].x-=i+u+2*o+a}else t=="ball"&&(r.push({x:n.x+2,y:n.y,width:2,height:6}),r.push({x:n.x,y:n.y+2,width:6,height:2}),r.push({x:n.x+1,y:n.y+1,width:4,height:4}))},Test.AnotherWay._record_highlight_border=function(e,t,n){if(e!=null){if(Test.AnotherWay._g_record_border==null||Test.AnotherWay._g_record_border[0].ownerDocument!=e.ownerDocument){Test.AnotherWay._g_record_border=[];var r=t=="border"?4:t=="ball"?3:0;for(var i=0;i<4;++i){var s=e.ownerDocument.createElement("div");s.style.position="absolute",s.style.zIndex="1",s.style.backgroundColor=Test.AnotherWay._g_record_border_normal_color,e.ownerDocument.body.appendChild(s),Test.AnotherWay._g_record_border.push(s)}}var o=null;if(t=="border")o=Test.AnotherWay._get_page_coords(e);else if(t=="ball"&&n!=null)if(n.pageX!=null&&n.pageY!=null)o={x:n.pageX-0,y:n.pageY-0};else if(n.clientX!=null&&n.clientY!=null){var u=e.ownerDocument;u!=null&&(o={x:n.clientX-0+u.body.scrollLeft,y:n.clientY-0+u.body.scrollTop})}if(o!=null&&e.clientWidth!=null&&e.clientHeight!=null){var a=[];Test.AnotherWay._record_setup_highlight_positions(e,t,o,a);for(var i=0;i<a.length;++i){var s=Test.AnotherWay._g_record_border[i],f=a[i];Test.AnotherWay._set_page_coords(s,f.x,f.y),s.style.width=f.width+"px",s.style.height=f.height+"px",s.style.display="block"}}}else if(Test.AnotherWay._g_record_border!=null)for(var i=0;i<Test.AnotherWay._g_record_border.length;++i)Test.AnotherWay._g_record_border[i].style.display="none"},Test.AnotherWay._record_flash_border=function(e){Test.AnotherWay._g_record_border_flashing?(Test.AnotherWay._g_record_border_flashes.push({color:Test.AnotherWay._g_record_border_normal_color,timeout:300}),Test.AnotherWay._g_record_border_flashes.push({color:e,timeout:600})):(Test.AnotherWay._g_record_border_flashing=!0,Test.AnotherWay._g_record_border_flashes.push({color:e,timeout:600}),Test.AnotherWay._record_flash_border_timeout())},Test.AnotherWay._record_prepare_doc_for_results=function(){document.open(),document.write('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">'),document.write("<html><head><title> Input recording results</title>"),document.write('<style type="text/css">'),document.write("body { font: normal normal smaller sans-serif; }"),document.write("div { margin-top: 3px; }"),document.write("</style></head><body>"),typeof window.opener.Test!="undefined"&&typeof window.opener.Test.AnotherWay!="undefined"?(window.opener.Test.AnotherWay._record_save_results(document),window.opener.Test.AnotherWay._g_record_waiting_for_results=!1,window.opener.Test.AnotherWay._record_control_update_ui()):typeof window.opener.opener.Test!="undefined"&&typeof window.opener.opener.Test.AnotherWay!="undefined"&&(window.opener.opener.Test.AnotherWay._record_save_results(document),window.opener.opener.Test.AnotherWay._g_record_waiting_for_results=!1,window.opener.opener.Test.AnotherWay._record_control_update_ui()),document.write("</body>"),document.close()},onload=function(){if(window.opera){var e=typeof window.opera.version=="function";e=e&&window.opera.version().match(/^\s*(\d+)/),e=e&&RegExp.$1>=8}var t=document.createElement("SPAN");t.innerHTML="<!--[if IE]><br /><![endif]-->";var n=t.getElementsByTagName("BR").length>0;Test.AnotherWay._g_test_iframe=window.frames.test_iframe;var r=window.location.search;r.charAt(0)=="?"&&(r=r.substring(1));var i="list-tests.html",s=!1;if(r!=""){var o=[r];r.indexOf(";")!=-1?o=r.split(";"):r.indexOf("&")!=-1&&(o=r.split("&"));for(var u=0;u<o.length;++u){var a=o[u].split("=");if(a[0]=="recording_results"){if(window.opener!=null){Test.AnotherWay._record_prepare_doc_for_results();return}}else if(a[0]=="testpage")Test.AnotherWay._add_test_page_url(decodeURIComponent(a[1]),"anotherway");else if(a[0]=="jsantestpage")Test.AnotherWay._add_test_page_url(decodeURIComponent(a[1]),"jsan");else if(a[0]=="testlist")i=decodeURIComponent(a[1]);else if(a[0]=="testframe")if(window.opera&&!e)Test.AnotherWay._show_error("testframe parameter does not work in versions of Opera prior to 8.0. Sorry (pathches are welcome).");else{var f=a[1].split("."),l=top;for(var c=0;c<f.length;++c)l=l[f[c]];l==null?Test.AnotherWay._show_error("unable to find frame specified for loading test pages: "+a[1]):(l.frameElement!=null&&(l=l.frameElement),Test.AnotherWay._g_test_iframe=l)}else if(a[0]=="testframe_no_clear")Test.AnotherWay._g_test_frame_no_clear=!0;else if(a[0]=="windows")a[1]=="none"&&(Test.AnotherWay._test_object_t.prototype.open_window=null);else if(a[0]=="run"){s=!0;if(a[1]=="all")Test.AnotherWay._g_pages_to_run="all";else{if(Test.AnotherWay._g_pages_to_run==null||Test.AnotherWay._g_pages_to_run=="all")Test.AnotherWay._g_pages_to_run=[];var h=a[1].split(",");for(var p=0;p<h.length;++p)Test.AnotherWay._g_pages_to_run.push(h[p])}}}}if(Test.AnotherWay._g_test_page_urls.length==0){var d=Test.AnotherWay._set_iframe_location(window.frames.list_iframe,i);d.msg!=null&&Test.AnotherWay._show_error(d.msg),Test.AnotherWay._g_run_on_list_load=s}else Test.AnotherWay._g_run_on_main_load=s;var v=Test.AnotherWay._g_test_iframe;try{v.attachEvent!=null?v.attachEvent("onload",Test.AnotherWay._test_page_onload):v.onload=Test.AnotherWay._test_page_onload,Test.AnotherWay._g_test_iframe.nodeType!=null&&Test.AnotherWay._g_test_iframe.contentWindow!=null&&(Test.AnotherWay._g_test_iframe=Test.AnotherWay._g_test_iframe.contentWindow)}catch(m){}var g={run_all:{onclick:Test.AnotherWay._run_all_onclick},run_selected:{onclick:Test.AnotherWay._run_selected_onclick},unselect_all:{onclick:Test.AnotherWay._unselect_all_onclick},record_select:{onfocus:Test.AnotherWay._record_check_onfocus},record_input:{onfocus:Test.AnotherWay._record_check_onfocus},record_start:{onclick:Test.AnotherWay._record_start_onclick},clear_btn:{onclick:Test.AnotherWay._results_clear_onclick},results_tab:{onclick:Test.AnotherWay._tab_onclick,onmouseover:Test.AnotherWay._tab_mouseover,onmouseout:Test.AnotherWay._tab_mouseout},debug_tab:{onclick:Test.AnotherWay._tab_onclick,onmouseover:Test.AnotherWay._tab_mouseover,onmouseout:Test.AnotherWay._tab_mouseout}};for(var y in g){var b=document.getElementById(y);if(b!=null)for(var w in g[y])b[w]=g[y][w];else Test.AnotherWay._show_error("unable to set "+w+" handler: id "+y+" not found")}window.opera&&!e&&(Test.AnotherWay._g_no_record_msg="Input events recording and replaying is not available in opera versions prior to 8.0."),n&&(Test.AnotherWay._g_no_record_msg="Input events recording and replaying is not available in internet explorer.");if(Test.AnotherWay._g_no_record_msg!=null){var E=document.getElementById("record_not_supported");E.style.display="block",E.appendChild(document.createTextNode(Test.AnotherWay._g_no_record_msg))}Test.AnotherWay._g_main_loaded=!0,Test.AnotherWay._g_run_on_main_load&&(Test.AnotherWay._g_run_on_main_load=!1,Test.AnotherWay._run_pages_to_run())};
function init(){function a(n){n.object.events.unregister("loadend",null,a);var r=map.baseLayer.grid[0][0];try{var i=r.getCanvasContext();i?i.canvas.toDataURL():t.innerHTML="Canvas not supported. Try a different browser."}catch(s){map.setBaseLayer(map.layers[1]),n.object.destroy(),e.destroy()}}function f(e){window.localStorage?t.innerHTML=localStorage.length+" entries in cache.":t.innerHTML="Local storage not supported. Try a different browser.",e&&e.tile.url.substr(0,5)==="data:"&&r++,n.innerHTML=r+" cache hits."}function l(){this.checked?p():(cacheRead1.deactivate(),cacheRead2.deactivate())}function c(){cacheWrite[cacheWrite.active?"deactivate":"activate"]()}function h(){OpenLayers.Control.CacheWrite.clearCache(),f()}function p(){u.checked?cacheRead1.activate():cacheRead2.activate()}function d(){var e=map.baseLayer,t=map.getZoom();i={zoom:t,extent:map.getExtent(),center:map.getCenter(),cacheWriteActive:cacheWrite.active,buffer:e.buffer,layer:e},map.zoomTo(t===e.numZoomLevels-1?t-1:t+1),cacheWrite.activate(),cacheRead1.deactivate(),cacheRead2.deactivate(),e.events.register("loadend",null,v),map.setCenter(i.center,t)}function v(){var e=i.layer,t=e.tileSize.w,n=map.getZoom()+1,r=i.extent.getWidth()/map.getResolutionForZoom(n);e.buffer=Math.ceil((r/t-map.getSize().w/t)/2),map.zoomIn(),n===e.numZoomLevels-1&&m()}function m(){i.layer.events.unregister("loadend",null,v),i.layer.buffer=i.buffer,map.setCenter(i.center,i.zoom),i.cacheWriteActive||cacheWrite.deactivate(),s.checked&&p(),i=!1}map=new OpenLayers.Map({div:"map",projection:"EPSG:900913",layers:[new OpenLayers.Layer.OSM("OpenStreetMap (CORS)",null,{eventListeners:{tileloaded:f,loadend:a}}),new OpenLayers.Layer.WMS("OSGeo (same origin - proxied)","http://vmap0.tiles.osgeo.org/wms/vmap0",{layers:"basic"},{eventListeners:{tileloaded:f}})],center:[0,0],zoom:1}),cacheRead1=new OpenLayers.Control.CacheRead({eventListeners:{activate:function(){cacheRead2.deactivate()}}}),cacheRead2=new OpenLayers.Control.CacheRead({autoActivate:!1,fetchEvent:"tileerror",eventListeners:{activate:function(){cacheRead1.deactivate()}}}),cacheWrite=new OpenLayers.Control.CacheWrite({imageFormat:"image/jpeg",eventListeners:{cachefull:function(){i&&m(),t.innerHTML="Cache full."}}});var e=new OpenLayers.Control.LayerSwitcher;map.addControls([cacheRead1,cacheRead2,cacheWrite,e]),e.maximizeControl();var t=document.getElementById("status"),n=document.getElementById("hits"),r=0,i=!1,s=document.getElementById("read");s.checked=!0,s.onclick=l;var o=document.getElementById("write");o.checked=!1,o.onclick=c,document.getElementById("clear").onclick=h;var u=document.getElementById("tileloadstart");u.checked="checked",u.onclick=p,document.getElementById("tileerror").onclick=p,document.getElementById("seed").onclick=d}OpenLayers.ProxyHost="proxy.cgi?url=";var map,cacheWrite,cacheRead1,cacheRead2;
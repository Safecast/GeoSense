OpenLayers.Strategy.AttributeCluster=OpenLayers.Class(OpenLayers.Strategy.Cluster,{attribute:null,shouldCluster:function(e,t){var n=e.cluster[0].attributes[this.attribute],r=t.attributes[this.attribute],i=OpenLayers.Strategy.Cluster.prototype;return n===r&&i.shouldCluster.apply(this,arguments)},CLASS_NAME:"OpenLayers.Strategy.AttributeCluster"}),OpenLayers.Strategy.RuleCluster=OpenLayers.Class(OpenLayers.Strategy.Cluster,{rule:null,shouldCluster:function(e,t){var n=OpenLayers.Strategy.Cluster.prototype;return this.rule.evaluate(e.cluster[0])&&this.rule.evaluate(t)&&n.shouldCluster.apply(this,arguments)},CLASS_NAME:"OpenLayers.Strategy.RuleCluster"});var map,vectorlayer,features,stylemap,select;(function(){var e=function(e){var t=e.feature,n="Last hovered feature:<br>";if(t.cluster){n+="&nbsp;&nbsp;Cluster of "+t.attributes.count+" features:";var r={1:0,2:0,3:0,4:0};for(var i=0;i<t.attributes.count;i++){var s=t.cluster[i];r[s.attributes.clazz]++}for(var o=1;o<=4;o++){var u=r[o]!==1?"s":"";n+="<br>&nbsp;&nbsp;&nbsp;&nbsp;&bull;&nbsp;clazz "+o+": "+r[o]+" feature"+u}}else n+="&nbsp;&nbsp;Single feature of clazz = "+t.attributes.clazz;document.getElementById("info").innerHTML=n},t=function(){var e="Currently "+vectorlayer.features.length+" points are shown on the map.";document.getElementById("generalinfo").innerHTML=e};map=new OpenLayers.Map("map");var n=new OpenLayers.Layer.WMS("OpenLayers WMS","http://vmap0.tiles.osgeo.org/wms/vmap0",{layers:"basic"}),r={getColor:function(e){var t="#aaaaaa";if(e.attributes.clazz&&e.attributes.clazz===4)t="#ee0000";else if(e.cluster){var n=!0;for(var r=0;r<e.cluster.length;r++)n&&e.cluster[r].attributes.clazz!==4&&(n=!1);n===!0&&(t="#ee0000")}return t}};stylemap=new OpenLayers.StyleMap({"default":new OpenLayers.Style({pointRadius:5,fillColor:"${getColor}",fillOpacity:.7,strokeColor:"#666666",strokeWidth:1,strokeOpacity:1,graphicZIndex:1},{context:r}),select:new OpenLayers.Style({pointRadius:5,fillColor:"#ffff00",fillOpacity:1,strokeColor:"#666666",strokeWidth:1,strokeOpacity:1,graphicZIndex:2})}),vectorlayer=new OpenLayers.Layer.Vector("Vectorlayer",{styleMap:stylemap,strategies:[]}),select=new OpenLayers.Control.SelectFeature(vectorlayer,{hover:!0}),map.addControl(select),select.activate(),vectorlayer.events.on({featureselected:e}),map.addLayers([n,vectorlayer]),map.addControl(new OpenLayers.Control.LayerSwitcher),map.zoomToMaxExtent(),features=[];for(var i=0;i<700;i++){var s=Math.random(),o=Math.random(),u=Math.random(),a=Math.random(),f=s*180*(o<.5?-1:1),l=u*90*(a<.5?-1:1),c=new OpenLayers.Geometry.Point(f,l),h=i%10===0?4:Math.ceil(a*3),p=new OpenLayers.Feature.Vector(c,{clazz:h});features.push(p)}vectorlayer.addFeatures(features),t();var d=function(){var n=[];switch(this.value){case"cluster":n.push(new OpenLayers.Strategy.Cluster);break;case"attribute-cluster":n.push(new OpenLayers.Strategy.AttributeCluster({attribute:"clazz"}));break;case"rule-cluster":n.push(new OpenLayers.Strategy.RuleCluster({rule:new OpenLayers.Rule({filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN,property:"clazz",value:4})})}))}map.removeLayer(vectorlayer),map.removeControl(select),vectorlayer=new OpenLayers.Layer.Vector("Vectorlayer",{styleMap:stylemap,strategies:n}),map.addLayer(vectorlayer),vectorlayer.addFeatures(features),select=new OpenLayers.Control.SelectFeature(vectorlayer,{hover:!0}),map.addControl(select),select.activate(),vectorlayer.events.on({featureselected:e}),t()},v=document.getElementsByTagName("input");for(var m=0;m<v.length;m++){var g=v[m];g.name==="strategy"&&(g.onclick=d)}})();
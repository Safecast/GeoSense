var style={fillColor:"#000",fillOpacity:.1,strokeWidth:0},map=new OpenLayers.Map("map"),layer=new OpenLayers.Layer.OSM("Simple OSM Map"),vector=new OpenLayers.Layer.Vector("vector");map.addLayers([layer,vector]),map.setCenter((new OpenLayers.LonLat(-71.147,42.472)).transform(new OpenLayers.Projection("EPSG:4326"),map.getProjectionObject()),12);var pulsate=function(e){var t=e.geometry.getCentroid(),n=e.geometry.getBounds(),r=Math.abs((n.right-n.left)/2),i=0,s="up",o=function(){i>16&&clearInterval(window.resizeInterval);var n=r*.03,o=n/r;switch(i){case 4:case 12:s="down";break;case 8:s="up"}s!=="up"&&(o=-Math.abs(o)),e.geometry.resize(1+o,t),vector.drawFeature(e),i++};window.resizeInterval=window.setInterval(o,50,t,r)},geolocate=new OpenLayers.Control.Geolocate({bind:!1,geolocationOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:7e3}});map.addControl(geolocate);var firstGeolocation=!0;geolocate.events.register("locationupdated",geolocate,function(e){vector.removeAllFeatures();var t=new OpenLayers.Feature.Vector(OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(e.point.x,e.point.y),e.position.coords.accuracy/2,40,0),{},style);vector.addFeatures([new OpenLayers.Feature.Vector(e.point,{},{graphicName:"cross",strokeColor:"#f00",strokeWidth:2,fillOpacity:0,pointRadius:10}),t]),firstGeolocation&&(map.zoomToExtent(vector.getDataExtent()),pulsate(t),firstGeolocation=!1,this.bind=!0)}),geolocate.events.register("locationfailed",this,function(){OpenLayers.Console.log("Location detection failed")}),document.getElementById("locate").onclick=function(){vector.removeAllFeatures(),geolocate.deactivate(),document.getElementById("track").checked=!1,geolocate.watch=!1,firstGeolocation=!0,geolocate.activate()},document.getElementById("track").onclick=function(){vector.removeAllFeatures(),geolocate.deactivate(),this.checked&&(geolocate.watch=!0,firstGeolocation=!0,geolocate.activate())},document.getElementById("track").checked=!1;
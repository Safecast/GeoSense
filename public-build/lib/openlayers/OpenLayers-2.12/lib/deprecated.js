/*
 * Copyright 2007, Google Inc.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *  1. Redistributions of source code must retain the above copyright notice,
 *     this list of conditions and the following disclaimer.
 *  2. Redistributions in binary form must reproduce the above copyright notice,
 *     this list of conditions and the following disclaimer in the documentation
 *     and/or other materials provided with the distribution.
 *  3. Neither the name of Google Inc. nor the names of its contributors may be
 *     used to endorse or promote products derived from this software without
 *     specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR IMPLIED
 * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
 * EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
 * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
 * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
 * OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
 * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Sets up google.gears.*, which is *the only* supported way to access Gears.
 *
 * Circumvent this file at your own risk!
 *
 * In the future, Gears may automatically define google.gears.* without this
 * file. Gears may use these objects to transparently fix bugs and compatibility
 * issues. Applications that use the code below will continue to work seamlessly
 * when that happens.
 */

OpenLayers.Class.isPrototype=function(){},OpenLayers.Class.create=function(){return function(){arguments&&arguments[0]!=OpenLayers.Class.isPrototype&&this.initialize.apply(this,arguments)}},OpenLayers.Class.inherit=function(e){var t=function(){e.call(this)},n=[t].concat(Array.prototype.slice.call(arguments));return OpenLayers.inherit.apply(null,n),t.prototype},OpenLayers.Util.clearArray=function(e){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"array = []"})),e.length=0},OpenLayers.Util.setOpacity=function(e,t){OpenLayers.Util.modifyDOMElement(e,null,null,null,null,null,null,t)},OpenLayers.Util.safeStopPropagation=function(e){OpenLayers.Event.stop(e,!0)},OpenLayers.Util.getArgs=function(e){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Util.getParameters"})),OpenLayers.Util.getParameters(e)},OpenLayers.nullHandler=function(e){OpenLayers.Console.userError(OpenLayers.i18n("unhandledRequest",{statusText:e.statusText}))},OpenLayers.loadURL=function(e,t,n,r,i){typeof t=="string"&&(t=OpenLayers.Util.getParameters(t));var s=r?r:OpenLayers.nullHandler,o=i?i:OpenLayers.nullHandler;return OpenLayers.Request.GET({url:e,params:t,success:s,failure:o,scope:n})},OpenLayers.parseXMLString=function(e){var t=e.indexOf("<");t>0&&(e=e.substring(t));var n=OpenLayers.Util.Try(function(){var t=new ActiveXObject("Microsoft.XMLDOM");return t.loadXML(e),t},function(){return(new DOMParser).parseFromString(e,"text/xml")},function(){var t=new XMLHttpRequest;return t.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(e),!1),t.overrideMimeType&&t.overrideMimeType("text/xml"),t.send(null),t.responseXML});return n},OpenLayers.Ajax={emptyFunction:function(){},getTransport:function(){return OpenLayers.Util.Try(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||!1},activeRequestCount:0},OpenLayers.Ajax.Responders={responders:[],register:function(e){for(var t=0;t<this.responders.length;t++)if(e==this.responders[t])return;this.responders.push(e)},unregister:function(e){OpenLayers.Util.removeItem(this.reponders,e)},dispatch:function(e,t,n){var r;for(var i=0;i<this.responders.length;i++){r=this.responders[i];if(r[e]&&typeof r[e]=="function")try{r[e].apply(r,[t,n])}catch(s){}}}},OpenLayers.Ajax.Responders.register({onCreate:function(){OpenLayers.Ajax.activeRequestCount++},onComplete:function(){OpenLayers.Ajax.activeRequestCount--}}),OpenLayers.Ajax.Base=OpenLayers.Class({initialize:function(e){this.options={method:"post",asynchronous:!0,contentType:"application/xml",parameters:""},OpenLayers.Util.extend(this.options,e||{}),this.options.method=this.options.method.toLowerCase(),typeof this.options.parameters=="string"&&(this.options.parameters=OpenLayers.Util.getParameters(this.options.parameters))}}),OpenLayers.Ajax.Request=OpenLayers.Class(OpenLayers.Ajax.Base,{_complete:!1,initialize:function(e,t){OpenLayers.Ajax.Base.prototype.initialize.apply(this,[t]),OpenLayers.ProxyHost&&OpenLayers.String.startsWith(e,"http")&&(e=OpenLayers.ProxyHost+encodeURIComponent(e)),this.transport=OpenLayers.Ajax.getTransport(),this.request(e)},request:function(e){this.url=e,this.method=this.options.method;var t=OpenLayers.Util.extend({},this.options.parameters);this.method!="get"&&this.method!="post"&&(t._method=this.method,this.method="post"),this.parameters=t;if(t=OpenLayers.Util.getParameterString(t))this.method=="get"?this.url+=(this.url.indexOf("?")>-1?"&":"?")+t:/Konqueror|Safari|KHTML/.test(navigator.userAgent)&&(t+="&_=");try{var n=new OpenLayers.Ajax.Response(this);this.options.onCreate&&this.options.onCreate(n),OpenLayers.Ajax.Responders.dispatch("onCreate",this,n),this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous),this.options.asynchronous&&window.setTimeout(OpenLayers.Function.bind(this.respondToReadyState,this,1),10),this.transport.onreadystatechange=OpenLayers.Function.bind(this.onStateChange,this),this.setRequestHeaders(),this.body=this.method=="post"?this.options.postBody||t:null,this.transport.send(this.body),!this.options.asynchronous&&this.transport.overrideMimeType&&this.onStateChange()}catch(r){this.dispatchException(r)}},onStateChange:function(){var e=this.transport.readyState;e>1&&(e!=4||!this._complete)&&this.respondToReadyState(this.transport.readyState)},setRequestHeaders:function(){var e={"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*",OpenLayers:!0};this.method=="post"&&(e["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:""),this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005&&(e.Connection="close"));if(typeof this.options.requestHeaders=="object"){var t=this.options.requestHeaders;if(typeof t.push=="function")for(var n=0,r=t.length;n<r;n+=2)e[t[n]]=t[n+1];else for(var n in t)e[n]=t[n]}for(var i in e)this.transport.setRequestHeader(i,e[i])},success:function(){var e=this.getStatus();return!e||e>=200&&e<300},getStatus:function(){try{return this.transport.status||0}catch(e){return 0}},respondToReadyState:function(e){var t=OpenLayers.Ajax.Request.Events[e],n=new OpenLayers.Ajax.Response(this);if(t=="Complete"){try{this._complete=!0,(this.options["on"+n.status]||this.options["on"+(this.success()?"Success":"Failure")]||OpenLayers.Ajax.emptyFunction)(n)}catch(r){this.dispatchException(r)}var i=n.getHeader("Content-type")}try{(this.options["on"+t]||OpenLayers.Ajax.emptyFunction)(n),OpenLayers.Ajax.Responders.dispatch("on"+t,this,n)}catch(r){this.dispatchException(r)}t=="Complete"&&(this.transport.onreadystatechange=OpenLayers.Ajax.emptyFunction)},getHeader:function(e){try{return this.transport.getResponseHeader(e)}catch(t){return null}},dispatchException:function(e){var t=this.options.onException;if(t)t(this,e),OpenLayers.Ajax.Responders.dispatch("onException",this,e);else{var n=!1,r=OpenLayers.Ajax.Responders.responders;for(var i=0;i<r.length;i++)if(r[i].onException){n=!0;break}if(!n)throw e;OpenLayers.Ajax.Responders.dispatch("onException",this,e)}}}),OpenLayers.Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"],OpenLayers.Ajax.Response=OpenLayers.Class({status:0,statusText:"",initialize:function(e){this.request=e;var t=this.transport=e.transport,n=this.readyState=t.readyState;if(n>2&&(!window.attachEvent||!!window.opera)||n==4)this.status=this.getStatus(),this.statusText=this.getStatusText(),this.responseText=t.responseText==null?"":String(t.responseText);if(n==4){var r=t.responseXML;this.responseXML=r===undefined?null:r}},getStatus:OpenLayers.Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(e){return""}},getHeader:OpenLayers.Ajax.Request.prototype.getHeader,getResponseHeader:function(e){return this.transport.getResponseHeader(e)}}),OpenLayers.Ajax.getElementsByTagNameNS=function(e,t,n,r){var i=null;return e.getElementsByTagNameNS?i=e.getElementsByTagNameNS(t,r):i=e.getElementsByTagName(n+":"+r),i},OpenLayers.Ajax.serializeXMLToString=function(e){var t=new XMLSerializer,n=t.serializeToString(e);return n},OpenLayers.Util.extend(OpenLayers.Element,{hide:function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"element.style.display = 'none';"}));for(var e=0,t=arguments.length;e<t;e++){var n=OpenLayers.Util.getElement(arguments[e]);n&&(n.style.display="none")}},show:function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"element.style.display = '';"}));for(var e=0,t=arguments.length;e<t;e++){var n=OpenLayers.Util.getElement(arguments[e]);n&&(n.style.display="")}},getDimensions:function(e){e=OpenLayers.Util.getElement(e);if(OpenLayers.Element.getStyle(e,"display")!="none")return{width:e.offsetWidth,height:e.offsetHeight};var t=e.style,n=t.visibility,r=t.position,i=t.display;t.visibility="hidden",t.position="absolute",t.display="";var s=e.clientWidth,o=e.clientHeight;return t.display=i,t.position=r,t.visibility=n,{width:s,height:o}}}),String.prototype.startsWith||(String.prototype.startsWith=function(e){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.startsWith"})),OpenLayers.String.startsWith(this,e)}),String.prototype.contains||(String.prototype.contains=function(e){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.contains"})),OpenLayers.String.contains(this,e)}),String.prototype.trim||(String.prototype.trim=function(){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.trim"})),OpenLayers.String.trim(this)}),String.prototype.camelize||(String.prototype.camelize=function(){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.camelize"})),OpenLayers.String.camelize(this)}),Function.prototype.bind||(Function.prototype.bind=function(){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bind"})),Array.prototype.unshift.apply(arguments,[this]),OpenLayers.Function.bind.apply(null,arguments)}),Function.prototype.bindAsEventListener||(Function.prototype.bindAsEventListener=function(e){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bindAsEventListener"})),OpenLayers.Function.bindAsEventListener(this,e)});if(window.Event)OpenLayers.Util.applyDefaults(window.Event,OpenLayers.Event);else var Event=OpenLayers.Event;OpenLayers.Util.extend(OpenLayers.Tile.prototype,{getBoundsFromBaseLayer:function(e){var t=OpenLayers.i18n("reprojectDeprecated",{layerName:this.layer.name});OpenLayers.Console.warn(t);var n=this.layer.map.getLonLatFromLayerPx(e),r=e.clone();r.x+=this.size.w,r.y+=this.size.h;var i=this.layer.map.getLonLatFromLayerPx(r);n.lon>i.lon&&(n.lon<0?n.lon=-180-(n.lon+180):i.lon=180+i.lon+180);var s=new OpenLayers.Bounds(n.lon,i.lat,i.lon,n.lat);return s}}),OpenLayers.Control.MouseDefaults=OpenLayers.Class(OpenLayers.Control,{performedDrag:!1,wheelObserver:null,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.handler&&this.handler.destroy(),this.handler=null,this.map.events.un({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this}),OpenLayers.Event.stopObserving(window,"DOMMouseScroll",this.wheelObserver),OpenLayers.Event.stopObserving(window,"mousewheel",this.wheelObserver),OpenLayers.Event.stopObserving(document,"mousewheel",this.wheelObserver),this.wheelObserver=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){this.map.events.on({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this}),this.registerWheelEvents()},registerWheelEvents:function(){this.wheelObserver=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this),OpenLayers.Event.observe(window,"DOMMouseScroll",this.wheelObserver),OpenLayers.Event.observe(window,"mousewheel",this.wheelObserver),OpenLayers.Event.observe(document,"mousewheel",this.wheelObserver)},defaultClick:function(e){if(!OpenLayers.Event.isLeftClick(e))return;var t=!this.performedDrag;return this.performedDrag=!1,t},defaultDblClick:function(e){var t=this.map.getLonLatFromViewPortPx(e.xy);return this.map.setCenter(t,this.map.zoom+1),OpenLayers.Event.stop(e),!1},defaultMouseDown:function(e){if(!OpenLayers.Event.isLeftClick(e))return;this.mouseDragStart=e.xy.clone(),this.performedDrag=!1,e.shiftKey&&(this.map.div.style.cursor="crosshair",this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.mouseDragStart,null,null,"absolute","2px solid red"),this.zoomBox.style.backgroundColor="white",this.zoomBox.style.filter="alpha(opacity=50)",this.zoomBox.style.opacity="0.50",this.zoomBox.style.fontSize="1px",this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.viewPortDiv.appendChild(this.zoomBox)),document.onselectstart=OpenLayers.Function.False,OpenLayers.Event.stop(e)},defaultMouseMove:function(e){this.mousePosition=e.xy.clone();if(this.mouseDragStart!=null){if(this.zoomBox){var t=Math.abs(this.mouseDragStart.x-e.xy.x),n=Math.abs(this.mouseDragStart.y-e.xy.y);this.zoomBox.style.width=Math.max(1,t)+"px",this.zoomBox.style.height=Math.max(1,n)+"px",e.xy.x<this.mouseDragStart.x&&(this.zoomBox.style.left=e.xy.x+"px"),e.xy.y<this.mouseDragStart.y&&(this.zoomBox.style.top=e.xy.y+"px")}else{var t=this.mouseDragStart.x-e.xy.x,n=this.mouseDragStart.y-e.xy.y,r=this.map.getSize(),i=new OpenLayers.Pixel(r.w/2+t,r.h/2+n),s=this.map.getLonLatFromViewPortPx(i);this.map.setCenter(s,null,!0),this.mouseDragStart=e.xy.clone(),this.map.div.style.cursor="move"}this.performedDrag=!0}},defaultMouseUp:function(e){if(!OpenLayers.Event.isLeftClick(e))return;this.zoomBox?this.zoomBoxEnd(e):this.performedDrag&&this.map.setCenter(this.map.center),document.onselectstart=null,this.mouseDragStart=null,this.map.div.style.cursor=""},defaultMouseOut:function(e){this.mouseDragStart!=null&&OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv)&&(this.zoomBox&&this.removeZoomBox(),this.mouseDragStart=null)},defaultWheelUp:function(e){this.map.getZoom()<=this.map.getNumZoomLevels()&&this.map.setCenter(this.map.getLonLatFromPixel(e.xy),this.map.getZoom()+1)},defaultWheelDown:function(e){this.map.getZoom()>0&&this.map.setCenter(this.map.getLonLatFromPixel(e.xy),this.map.getZoom()-1)},zoomBoxEnd:function(e){if(this.mouseDragStart!=null){if(Math.abs(this.mouseDragStart.x-e.xy.x)>5||Math.abs(this.mouseDragStart.y-e.xy.y)>5){var t=this.map.getLonLatFromViewPortPx(this.mouseDragStart),n=this.map.getLonLatFromViewPortPx(e.xy),r=Math.max(t.lat,n.lat),i=Math.min(t.lat,n.lat),s=Math.min(t.lon,n.lon),o=Math.max(t.lon,n.lon),u=new OpenLayers.Bounds(s,i,o,r);this.map.zoomToExtent(u)}else{var n=this.map.getLonLatFromViewPortPx(e.xy);this.map.setCenter(new OpenLayers.LonLat(n.lon,n.lat),this.map.getZoom()+1)}this.removeZoomBox()}},removeZoomBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox),this.zoomBox=null},onWheelEvent:function(e){var t=!1,n=OpenLayers.Event.element(e);while(n!=null){if(this.map&&n==this.map.div){t=!0;break}n=n.parentNode}if(t){var r=0;e||(e=window.event),e.wheelDelta?(r=e.wheelDelta/120,window.opera&&window.opera.version()<9.2&&(r=-r)):e.detail&&(r=-e.detail/3),r&&(e.xy=this.mousePosition,r<0?this.defaultWheelDown(e):this.defaultWheelUp(e)),OpenLayers.Event.stop(e)}},CLASS_NAME:"OpenLayers.Control.MouseDefaults"}),OpenLayers.Control.MouseToolbar=OpenLayers.Class(OpenLayers.Control.MouseDefaults,{mode:null,buttons:null,direction:"vertical",buttonClicked:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.position=new OpenLayers.Pixel(OpenLayers.Control.MouseToolbar.X,OpenLayers.Control.MouseToolbar.Y),e&&(this.position=e),t&&(this.direction=t),this.measureDivs=[]},destroy:function(){for(var e in this.buttons){var t=this.buttons[e];t.map=null,t.events.destroy()}OpenLayers.Control.MouseDefaults.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments),OpenLayers.Control.MouseDefaults.prototype.draw.apply(this,arguments),this.buttons={};var e=new OpenLayers.Size(28,28),t=new OpenLayers.Pixel(OpenLayers.Control.MouseToolbar.X,0);return this._addButton("zoombox","drag-rectangle-off.png","drag-rectangle-on.png",t,e,"Shift->Drag to zoom to area"),t=t.add(this.direction=="vertical"?0:e.w,this.direction=="vertical"?e.h:0),this._addButton("pan","panning-hand-off.png","panning-hand-on.png",t,e,"Drag the map to pan."),t=t.add(this.direction=="vertical"?0:e.w,this.direction=="vertical"?e.h:0),this.switchModeTo("pan"),this.div},_addButton:function(e,t,n,r,i,s){var o=OpenLayers.Util.getImageLocation(t),u=OpenLayers.Util.getImageLocation(n),a=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MouseToolbar_"+e,r,i,o,"absolute");return this.div.appendChild(a),a.imgLocation=o,a.activeImgLocation=u,a.events=new OpenLayers.Events(this,a,null,!0),a.events.on({mousedown:this.buttonDown,mouseup:this.buttonUp,dblclick:OpenLayers.Event.stop,scope:this}),a.action=e,a.title=s,a.alt=s,a.map=this.map,this.buttons[e]=a,a},buttonDown:function(e){if(!OpenLayers.Event.isLeftClick(e))return;this.buttonClicked=e.element.action,OpenLayers.Event.stop(e)},buttonUp:function(e){if(!OpenLayers.Event.isLeftClick(e))return;this.buttonClicked!=null&&(this.buttonClicked==e.element.action&&this.switchModeTo(e.element.action),OpenLayers.Event.stop(e),this.buttonClicked=null)},defaultDblClick:function(e){this.switchModeTo("pan"),this.performedDrag=!1;var t=this.map.getLonLatFromViewPortPx(e.xy);return this.map.setCenter(t,this.map.zoom+1),OpenLayers.Event.stop(e),!1},defaultMouseDown:function(e){if(!OpenLayers.Event.isLeftClick(e))return;this.mouseDragStart=e.xy.clone(),this.performedDrag=!1,this.startViaKeyboard=!1,e.shiftKey&&this.mode!="zoombox"?(this.switchModeTo("zoombox"),this.startViaKeyboard=!0):e.altKey&&this.mode!="measure"?this.switchModeTo("measure"):this.mode||this.switchModeTo("pan");switch(this.mode){case"zoombox":this.map.div.style.cursor="crosshair",this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.mouseDragStart,null,null,"absolute","2px solid red"),this.zoomBox.style.backgroundColor="white",this.zoomBox.style.filter="alpha(opacity=50)",this.zoomBox.style.opacity="0.50",this.zoomBox.style.fontSize="1px",this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.viewPortDiv.appendChild(this.zoomBox),this.performedDrag=!0;break;case"measure":var t="";if(this.measureStart){var n=this.map.getLonLatFromViewPortPx(this.mouseDragStart);t=OpenLayers.Util.distVincenty(this.measureStart,n),t=Math.round(t*100)/100,t+="km",this.measureStartBox=this.measureBox}this.measureStart=this.map.getLonLatFromViewPortPx(this.mouseDragStart),this.measureBox=OpenLayers.Util.createDiv(null,this.mouseDragStart.add(-2-parseInt(this.map.layerContainerDiv.style.left),-2-parseInt(this.map.layerContainerDiv.style.top)),null,null,"absolute"),this.measureBox.style.width="4px",this.measureBox.style.height="4px",this.measureBox.style.fontSize="1px",this.measureBox.style.backgroundColor="red",this.measureBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.layerContainerDiv.appendChild(this.measureBox),t&&(this.measureBoxDistance=OpenLayers.Util.createDiv(null,this.mouseDragStart.add(-2-parseInt(this.map.layerContainerDiv.style.left),2-parseInt(this.map.layerContainerDiv.style.top)),null,null,"absolute"),this.measureBoxDistance.innerHTML=t,this.measureBoxDistance.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.layerContainerDiv.appendChild(this.measureBoxDistance),this.measureDivs.push(this.measureBoxDistance)),this.measureBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.layerContainerDiv.appendChild(this.measureBox),this.measureDivs.push(this.measureBox);break;default:this.map.div.style.cursor="move"}document.onselectstart=OpenLayers.Function.False,OpenLayers.Event.stop(e)},switchModeTo:function(e){if(e!=this.mode){this.mode&&this.buttons[this.mode]&&OpenLayers.Util.modifyAlphaImageDiv(this.buttons[this.mode],null,null,null,this.buttons[this.mode].imgLocation);if(this.mode=="measure"&&e!="measure"){for(var t=0,n=this.measureDivs.length;t<n;t++)this.measureDivs[t]&&this.map.layerContainerDiv.removeChild(this.measureDivs[t]);this.measureDivs=[],this.measureStart=null}this.mode=e,this.buttons[e]&&OpenLayers.Util.modifyAlphaImageDiv(this.buttons[e],null,null,null,this.buttons[e].activeImgLocation);switch(this.mode){case"zoombox":this.map.div.style.cursor="crosshair";break;default:this.map.div.style.cursor=""}}},leaveMode:function(){this.switchModeTo("pan")},defaultMouseMove:function(e){if(this.mouseDragStart!=null){switch(this.mode){case"zoombox":var t=Math.abs(this.mouseDragStart.x-e.xy.x),n=Math.abs(this.mouseDragStart.y-e.xy.y);this.zoomBox.style.width=Math.max(1,t)+"px",this.zoomBox.style.height=Math.max(1,n)+"px",e.xy.x<this.mouseDragStart.x&&(this.zoomBox.style.left=e.xy.x+"px"),e.xy.y<this.mouseDragStart.y&&(this.zoomBox.style.top=e.xy.y+"px");break;default:var t=this.mouseDragStart.x-e.xy.x,n=this.mouseDragStart.y-e.xy.y,r=this.map.getSize(),i=new OpenLayers.Pixel(r.w/2+t,r.h/2+n),s=this.map.getLonLatFromViewPortPx(i);this.map.setCenter(s,null,!0),this.mouseDragStart=e.xy.clone()}this.performedDrag=!0}},defaultMouseUp:function(e){if(!OpenLayers.Event.isLeftClick(e))return;switch(this.mode){case"zoombox":this.zoomBoxEnd(e),this.startViaKeyboard&&this.leaveMode();break;case"pan":this.performedDrag&&this.map.setCenter(this.map.center)}document.onselectstart=null,this.mouseDragStart=null,this.map.div.style.cursor="default"},defaultMouseOut:function(e){this.mouseDragStart!=null&&OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv)&&(this.zoomBox&&(this.removeZoomBox(),this.startViaKeyboard&&this.leaveMode()),this.mouseDragStart=null,this.map.div.style.cursor="default")},defaultClick:function(e){if(this.performedDrag)return this.performedDrag=!1,!1},CLASS_NAME:"OpenLayers.Control.MouseToolbar"}),OpenLayers.Control.MouseToolbar.X=6,OpenLayers.Control.MouseToolbar.Y=300,OpenLayers.Util.extend(OpenLayers.Layer.Grid.prototype,{getGridBounds:function(){var e="The getGridBounds() function is deprecated. It will be removed in 3.0. Please use getTilesBounds() instead.";return OpenLayers.Console.warn(e),this.getTilesBounds()}}),OpenLayers.Util.extend(OpenLayers.Format.XML.prototype,{concatChildValues:function(e,t){var n="",r=e.firstChild,i;while(r)i=r.nodeValue,i&&(n+=i),r=r.nextSibling;return n==""&&t!=undefined&&(n=t),n}}),OpenLayers.Layer.WMS.Post=OpenLayers.Class(OpenLayers.Layer.WMS,{unsupportedBrowsers:["mozilla","firefox","opera"],SUPPORTED_TRANSITIONS:[],usePost:null,initialize:function(e,t,n,r){var i=[];i.push(e,t,n,r),OpenLayers.Layer.WMS.prototype.initialize.apply(this,i),this.usePost=OpenLayers.Util.indexOf(this.unsupportedBrowsers,OpenLayers.BROWSER_NAME)==-1},addTile:function(e,t){return new OpenLayers.Tile.Image(this,t,e,null,this.tileSize,{maxGetUrlLength:this.usePost?0:null})},CLASS_NAME:"OpenLayers.Layer.WMS.Post"}),OpenLayers.Layer.WMS.Untiled=OpenLayers.Class(OpenLayers.Layer.WMS,{singleTile:!0,initialize:function(e,t,n,r){OpenLayers.Layer.WMS.prototype.initialize.apply(this,arguments);var i="The OpenLayers.Layer.WMS.Untiled class is deprecated and will be removed in 3.0. Instead, you should use the normal OpenLayers.Layer.WMS class, passing it the option 'singleTile' as true.";OpenLayers.Console.warn(i)},clone:function(e){return e==null&&(e=new OpenLayers.Layer.WMS.Untiled(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.WMS.prototype.clone.apply(this,[e]),e},CLASS_NAME:"OpenLayers.Layer.WMS.Untiled"}),OpenLayers.Layer.MapServer.Untiled=OpenLayers.Class(OpenLayers.Layer.MapServer,{singleTile:!0,initialize:function(e,t,n,r){OpenLayers.Layer.MapServer.prototype.initialize.apply(this,arguments);var i="The OpenLayers.Layer.MapServer.Untiled class is deprecated and will be removed in 3.0. Instead, you should use the normal OpenLayers.Layer.MapServer class, passing it the option 'singleTile' as true.";OpenLayers.Console.warn(i)},clone:function(e){return e==null&&(e=new OpenLayers.Layer.MapServer.Untiled(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.MapServer.prototype.clone.apply(this,[e]),e},CLASS_NAME:"OpenLayers.Layer.MapServer.Untiled"}),OpenLayers.Tile.WFS=OpenLayers.Class(OpenLayers.Tile,{features:null,url:null,request:null,initialize:function(e,t,n,r,i){OpenLayers.Tile.prototype.initialize.apply(this,arguments),this.url=r,this.features=[]},destroy:function(){OpenLayers.Tile.prototype.destroy.apply(this,arguments),this.destroyAllFeatures(),this.features=null,this.url=null,this.request&&(this.request.abort(),this.request=null)},clear:function(){this.destroyAllFeatures()},draw:function(){OpenLayers.Tile.prototype.draw.apply(this,arguments)&&(this.isLoading?this.events.triggerEvent("reload"):(this.isLoading=!0,this.events.triggerEvent("loadstart")),this.loadFeaturesForRegion(this.requestSuccess))},loadFeaturesForRegion:function(e,t){this.request&&this.request.abort(),this.request=OpenLayers.Request.GET({url:this.url,success:e,failure:t,scope:this})},requestSuccess:function(e){if(this.features){var t=e.responseXML;if(!t||!t.documentElement)t=e.responseText;if(this.layer.vectorMode)this.layer.addFeatures(this.layer.formatObject.read(t));else{var n=new OpenLayers.Format.XML;typeof t=="string"&&(t=n.read(t));var r=n.getElementsByTagNameNS(t,"http://www.opengis.net/gml","featureMember");this.addResults(r)}}this.events&&this.events.triggerEvent("loadend"),this.request=null},addResults:function(e){for(var t=0;t<e.length;t++){var n=new this.layer.featureClass(this.layer,e[t]);this.features.push(n)}},destroyAllFeatures:function(){while(this.features.length>0){var e=this.features.shift();e.destroy()}},CLASS_NAME:"OpenLayers.Tile.WFS"}),OpenLayers.Feature.WFS=OpenLayers.Class(OpenLayers.Feature,{initialize:function(e,t){var n=arguments,r=this.processXMLNode(t);n=new Array(e,r.lonlat,r),OpenLayers.Feature.prototype.initialize.apply(this,n),this.createMarker(),this.layer.addMarker(this.marker)},destroy:function(){this.marker!=null&&this.layer.removeMarker(this.marker),OpenLayers.Feature.prototype.destroy.apply(this,arguments)},processXMLNode:function(e){var t=OpenLayers.Ajax.getElementsByTagNameNS(e,"http://www.opengis.net/gml","gml","Point"),n=OpenLayers.Util.getXmlNodeValue(OpenLayers.Ajax.getElementsByTagNameNS(t[0],"http://www.opengis.net/gml","gml","coordinates")[0]),r=n.split(",");return{lonlat:new OpenLayers.LonLat(parseFloat(r[0]),parseFloat(r[1])),id:null}},CLASS_NAME:"OpenLayers.Feature.WFS"}),OpenLayers.Layer.WFS=OpenLayers.Class(OpenLayers.Layer.Vector,OpenLayers.Layer.Markers,{isBaseLayer:!1,tile:null,ratio:2,DEFAULT_PARAMS:{service:"WFS",version:"1.0.0",request:"GetFeature"},featureClass:null,format:null,formatObject:null,formatOptions:null,vectorMode:!0,encodeBBOX:!1,extractAttributes:!1,initialize:function(e,t,n,r){r==undefined&&(r={});if(r.featureClass||!OpenLayers.Layer.Vector||!OpenLayers.Feature.Vector)this.vectorMode=!1;n=OpenLayers.Util.upperCaseObject(n),OpenLayers.Util.extend(r,{reportError:!1});var i=[];i.push(e,r),OpenLayers.Layer.Vector.prototype.initialize.apply(this,i);if(!this.renderer||!this.vectorMode)this.vectorMode=!1,r.featureClass||(r.featureClass=OpenLayers.Feature.WFS),OpenLayers.Layer.Markers.prototype.initialize.apply(this,i);this.params&&this.params.typename&&!this.options.typename&&(this.options.typename=this.params.typename),this.options.geometry_column||(this.options.geometry_column="the_geom"),this.params=OpenLayers.Util.applyDefaults(n,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),this.url=t},destroy:function(){this.vectorMode?OpenLayers.Layer.Vector.prototype.destroy.apply(this,arguments):OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments),this.tile&&this.tile.destroy(),this.tile=null,this.ratio=null,this.featureClass=null,this.format=null,this.formatObject&&this.formatObject.destroy&&this.formatObject.destroy(),this.formatObject=null,this.formatOptions=null,this.vectorMode=null,this.encodeBBOX=null,this.extractAttributes=null},setMap:function(e){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);var t={extractAttributes:this.extractAttributes};OpenLayers.Util.extend(t,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(t.externalProjection=this.projection,t.internalProjection=this.map.getProjectionObject()),this.formatObject=this.format?new this.format(t):new OpenLayers.Format.GML(t)}else OpenLayers.Layer.Markers.prototype.setMap.apply(this,arguments)},moveTo:function(e,t,n){this.vectorMode?OpenLayers.Layer.Vector.prototype.moveTo.apply(this,arguments):OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);if(n)return!1;t&&this.vectorMode&&this.renderer.clear();if(this.options.minZoomLevel){OpenLayers.Console.warn(OpenLayers.i18n("minZoomLevelError"));if(this.map.getZoom()<this.options.minZoomLevel)return null}e==null&&(e=this.map.getExtent());var r=this.tile==null,i=!r&&!this.tile.bounds.containsBounds(e);if(t||r||!n&&i){var s=e.getCenterLonLat(),o=e.getWidth()*this.ratio,u=e.getHeight()*this.ratio,a=new OpenLayers.Bounds(s.lon-o/2,s.lat-u/2,s.lon+o/2,s.lat+u/2),f=this.map.getSize();f.w=f.w*this.ratio,f.h=f.h*this.ratio;var l=new OpenLayers.LonLat(a.left,a.top),c=this.map.getLayerPxFromLonLat(l),h=this.getFullRequestString(),p=null,d=this.params.filter||this.params.FILTER;d?p={FILTER:d}:p={BBOX:this.encodeBBOX?a.toBBOX():a.toArray()};if(this.map&&!this.projection.equals(this.map.getProjectionObject())){var v=a.clone();v.transform(this.map.getProjectionObject(),this.projection),d||(p.BBOX=this.encodeBBOX?v.toBBOX():v.toArray())}h+="&"+OpenLayers.Util.getParameterString(p),this.tile?(this.vectorMode?(this.destroyFeatures(),this.renderer.clear()):this.clearMarkers(),this.removeTileMonitoringHooks(this.tile),this.tile.destroy(),this.tile=null,this.tile=new OpenLayers.Tile.WFS(this,c,a,h,f),this.addTileMonitoringHooks(this.tile),this.tile.draw()):(this.tile=new OpenLayers.Tile.WFS(this,c,a,h,f),this.addTileMonitoringHooks(this.tile),this.tile.draw())}},addTileMonitoringHooks:function(e){e.onLoadStart=function(){this==this.layer.tile&&this.layer.events.triggerEvent("loadstart")},e.events.register("loadstart",e,e.onLoadStart),e.onLoadEnd=function(){this==this.layer.tile&&(this.layer.events.triggerEvent("tileloaded"),this.layer.events.triggerEvent("loadend"))},e.events.register("loadend",e,e.onLoadEnd),e.events.register("unload",e,e.onLoadEnd)},removeTileMonitoringHooks:function(e){e.unload(),e.events.un({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,scope:e})},onMapResize:function(){this.vectorMode?OpenLayers.Layer.Vector.prototype.onMapResize.apply(this,arguments):OpenLayers.Layer.Markers.prototype.onMapResize.apply(this,arguments)},display:function(){this.vectorMode?OpenLayers.Layer.Vector.prototype.display.apply(this,arguments):OpenLayers.Layer.Markers.prototype.display.apply(this,arguments)},mergeNewParams:function(e){var t=OpenLayers.Util.upperCaseObject(e),n=[t];return OpenLayers.Layer.HTTPRequest.prototype.mergeNewParams.apply(this,n)},clone:function(e){return e==null&&(e=new OpenLayers.Layer.WFS(this.name,this.url,this.params,this.getOptions())),this.vectorMode?e=OpenLayers.Layer.Vector.prototype.clone.apply(this,[e]):e=OpenLayers.Layer.Markers.prototype.clone.apply(this,[e]),e},getFullRequestString:function(e,t){var n=this.projection.getCode()||this.map.getProjection();return this.params.SRS=n=="none"?null:n,OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},commit:function(){if(!this.writer){var e={};this.map&&!this.projection.equals(this.map.getProjectionObject())&&(e.externalProjection=this.projection,e.internalProjection=this.map.getProjectionObject()),this.writer=new OpenLayers.Format.WFS(e,this)}var t=this.writer.write(this.features);OpenLayers.Request.POST({url:this.url,data:t,success:this.commitSuccess,failure:this.commitFailure,scope:this})},commitSuccess:function(e){var t=e.responseText;if(t.indexOf("SUCCESS")!=-1){this.commitReport(OpenLayers.i18n("commitSuccess",{response:t}));for(var n=0;n<this.features.length;n++)this.features[n].state=null}else(t.indexOf("FAILED")!=-1||t.indexOf("Exception")!=-1)&&this.commitReport(OpenLayers.i18n("commitFailed",{response:t}))},commitFailure:function(e){},commitReport:function(e,t){OpenLayers.Console.userError(e)},refresh:function(){this.tile&&(this.vectorMode?(this.renderer.clear(),this.features.length=0):(this.clearMarkers(),this.markers.length=0),this.tile.draw())},getDataExtent:function(){var e;return this.vectorMode?e=OpenLayers.Layer.Vector.prototype.getDataExtent.apply(this):e=OpenLayers.Layer.Markers.prototype.getDataExtent.apply(this),e},setOpacity:function(e){this.vectorMode?OpenLayers.Layer.Vector.prototype.setOpacity.apply(this,[e]):OpenLayers.Layer.Markers.prototype.setOpacity.apply(this,[e])},CLASS_NAME:"OpenLayers.Layer.WFS"}),OpenLayers.Layer.VirtualEarth=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:1,MAX_ZOOM_LEVEL:19,RESOLUTIONS:[1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.00034332275390625,.000171661376953125,858306884765625e-19,4291534423828125e-20,2145767211914062e-20,1072883605957031e-20,536441802978515e-20],type:null,wrapDateLine:!0,sphericalMercator:!1,animationEnabled:!0,initialize:function(e,t){OpenLayers.Layer.EventPane.prototype.initialize.apply(this,arguments),OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,arguments),this.sphericalMercator&&(OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator),this.initMercatorParameters())},loadMapObject:function(){var e=OpenLayers.Util.createDiv(this.name),t=this.map.getSize();e.style.width=t.w+"px",e.style.height=t.h+"px",this.div.appendChild(e);try{this.mapObject=new VEMap(this.name)}catch(n){}if(this.mapObject!=null){try{this.mapObject.LoadMap(null,null,this.type,!0),this.mapObject.AttachEvent("onmousedown",OpenLayers.Function.True)}catch(n){}this.mapObject.HideDashboard(),typeof this.mapObject.SetAnimationEnabled=="function"&&this.mapObject.SetAnimationEnabled(this.animationEnabled)}if(!this.mapObject||!this.mapObject.vemapcontrol||!this.mapObject.vemapcontrol.PanMap||typeof this.mapObject.vemapcontrol.PanMap!="function")this.dragPanMapObject=null},onMapResize:function(){this.mapObject.Resize(this.map.size.w,this.map.size.h)},getWarningHTML:function(){return OpenLayers.i18n("getLayerWarning",{layerType:"VE",layerLib:"VirtualEarth"})},setMapObjectCenter:function(e,t){this.mapObject.SetCenterAndZoom(e,t)},getMapObjectCenter:function(){return this.mapObject.GetCenter()},dragPanMapObject:function(e,t){this.mapObject.vemapcontrol.PanMap(e,-t)},getMapObjectZoom:function(){return this.mapObject.GetZoomLevel()},getMapObjectLonLatFromMapObjectPixel:function(e){return typeof VEPixel!="undefined"?this.mapObject.PixelToLatLong(e):this.mapObject.PixelToLatLong(e.x,e.y)},getMapObjectPixelFromMapObjectLonLat:function(e){return this.mapObject.LatLongToPixel(e)},getLongitudeFromMapObjectLonLat:function(e){return this.sphericalMercator?this.forwardMercator(e.Longitude,e.Latitude).lon:e.Longitude},getLatitudeFromMapObjectLonLat:function(e){return this.sphericalMercator?this.forwardMercator(e.Longitude,e.Latitude).lat:e.Latitude},getMapObjectLonLatFromLonLat:function(e,t){var n;if(this.sphericalMercator){var r=this.inverseMercator(e,t);n=new VELatLong(r.lat,r.lon)}else n=new VELatLong(t,e);return n},getXFromMapObjectPixel:function(e){return e.x},getYFromMapObjectPixel:function(e){return e.y},getMapObjectPixelFromXY:function(e,t){return typeof VEPixel!="undefined"?new VEPixel(e,t):new Msn.VE.Pixel(e,t)},CLASS_NAME:"OpenLayers.Layer.VirtualEarth"}),function(){if(window.google&&google.gears)return;var e=null;if(typeof GearsFactory!="undefined")e=new GearsFactory;else try{e=new ActiveXObject("Gears.Factory"),e.getBuildInfo().indexOf("ie_mobile")!=-1&&e.privateSetGlobalObject(this)}catch(t){typeof navigator.mimeTypes!="undefined"&&navigator.mimeTypes["application/x-googlegears"]&&(e=document.createElement("object"),e.style.display="none",e.width=0,e.height=0,e.type="application/x-googlegears",document.documentElement.appendChild(e))}if(!e)return;window.google||(google={}),google.gears||(google.gears={factory:e})}(),OpenLayers.Protocol.SQL=OpenLayers.Class(OpenLayers.Protocol,{databaseName:"ol",tableName:"ol_vector_features",postReadFiltering:!0,initialize:function(e){OpenLayers.Protocol.prototype.initialize.apply(this,[e])},destroy:function(){OpenLayers.Protocol.prototype.destroy.apply(this)},supported:function(){return!1},evaluateFilter:function(e,t){return t&&this.postReadFiltering?t.evaluate(e):!0},CLASS_NAME:"OpenLayers.Protocol.SQL"}),OpenLayers.Protocol.SQL.Gears=OpenLayers.Class(OpenLayers.Protocol.SQL,{FID_PREFIX:"__gears_fid__",NULL_GEOMETRY:"__gears_null_geometry__",NULL_FEATURE_STATE:"__gears_null_feature_state__",jsonParser:null,wktParser:null,fidRegExp:null,saveFeatureState:!0,typeOfFid:"string",db:null,initialize:function(e){if(!this.supported())return;OpenLayers.Protocol.SQL.prototype.initialize.apply(this,[e]),this.jsonParser=new OpenLayers.Format.JSON,this.wktParser=new OpenLayers.Format.WKT,this.fidRegExp=new RegExp("^"+this.FID_PREFIX),this.initializeDatabase()},initializeDatabase:function(){this.db=google.gears.factory.create("beta.database"),this.db.open(this.databaseName),this.db.execute("CREATE TABLE IF NOT EXISTS "+this.tableName+" (fid TEXT UNIQUE, geometry TEXT, properties TEXT,"+"  state TEXT)")},destroy:function(){this.db.close(),this.db=null,this.jsonParser=null,this.wktParser=null,OpenLayers.Protocol.SQL.prototype.destroy.apply(this)},supported:function(){return!!window.google&&!!google.gears},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments),e=OpenLayers.Util.applyDefaults(e,this.options);var t,n=[],r=this.db.execute("SELECT * FROM "+this.tableName);while(r.isValidRow())t=this.unfreezeFeature(r),this.evaluateFilter(t,e.filter)&&(e.noFeatureStateReset||(t.state=null),n.push(t)),r.next();r.close();var i=new OpenLayers.Protocol.Response({code:OpenLayers.Protocol.Response.SUCCESS,requestType:"read",features:n});return e&&e.callback&&e.callback.call(e.scope,i),i},unfreezeFeature:function(e){var t,n=e.fieldByName("geometry");n==this.NULL_GEOMETRY?t=new OpenLayers.Feature.Vector:t=this.wktParser.read(n),t.attributes=this.jsonParser.read(e.fieldByName("properties")),t.fid=this.extractFidFromField(e.fieldByName("fid"));var r=e.fieldByName("state");return r==this.NULL_FEATURE_STATE&&(r=null),t.state=r,t},extractFidFromField:function(e){return!e.match(this.fidRegExp)&&this.typeOfFid=="number"&&(e=parseFloat(e)),e},create:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var n=this.createOrUpdate(e);return n.requestType="create",t&&t.callback&&t.callback.call(t.scope,n),n},update:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var n=this.createOrUpdate(e);return n.requestType="update",t&&t.callback&&t.callback.call(t.scope,n),n},createOrUpdate:function(e){OpenLayers.Util.isArray(e)||(e=[e]);var t,n=e.length,r,i=new Array(n);for(t=0;t<n;t++){r=e[t];var s=this.freezeFeature(r);this.db.execute("REPLACE INTO "+this.tableName+" (fid, geometry, properties, state)"+" VALUES (?, ?, ?, ?)",s);var o=r.clone();o.fid=this.extractFidFromField(s[0]),i[t]=o}return new OpenLayers.Protocol.Response({code:OpenLayers.Protocol.Response.SUCCESS,features:i,reqFeatures:e})},freezeFeature:function(e){e.fid=e.fid!=null?""+e.fid:OpenLayers.Util.createUniqueID(this.FID_PREFIX);var t=e.geometry!=null?e.geometry.toString():this.NULL_GEOMETRY,n=this.jsonParser.write(e.attributes),r=this.getFeatureStateForFreeze(e);return[e.fid,t,n,r]},getFeatureStateForFreeze:function(e){var t;return this.saveFeatureState?this.createdOffline(e)?t=OpenLayers.State.INSERT:t=e.state:t=this.NULL_FEATURE_STATE,t},"delete":function(e,t){OpenLayers.Util.isArray(e)||(e=[e]),t=OpenLayers.Util.applyDefaults(t,this.options);var n,r,i;for(n=0,r=e.length;n<r;n++){i=e[n];if(this.saveFeatureState&&!this.createdOffline(i)){var s=i.clone();s.fid=i.fid,s.geometry&&(s.geometry.destroy(),s.geometry=null),s.state=i.state,this.createOrUpdate(s)}else this.db.execute("DELETE FROM "+this.tableName+" WHERE fid = ?",[i.fid])}var o=new OpenLayers.Protocol.Response({code:OpenLayers.Protocol.Response.SUCCESS,requestType:"delete",reqFeatures:e});return t&&t.callback&&t.callback.call(t.scope,o),o},createdOffline:function(e){return typeof e.fid=="string"&&!!e.fid.match(this.fidRegExp)},commit:function(e,t){function o(e){++s<i&&(e.last=!1),this.callUserCallback(t,e)}var n,r=[],i=0,s=0,u,a=[],f=[],l=[];for(var c=e.length-1;c>=0;c--){u=e[c];switch(u.state){case OpenLayers.State.INSERT:a.push(u);break;case OpenLayers.State.UPDATE:f.push(u);break;case OpenLayers.State.DELETE:l.push(u)}}return a.length>0&&(i++,n=OpenLayers.Util.applyDefaults({callback:o,scope:this},t.create),r.push(this.create(a,n))),f.length>0&&(i++,n=OpenLayers.Util.applyDefaults({callback:o,scope:this},t.update),r.push(this.update(f,n))),l.length>0&&(i++,n=OpenLayers.Util.applyDefaults({callback:o,scope:this},t["delete"]),r.push(this["delete"](l,n))),r},clear:function(){this.db.execute("DELETE FROM "+this.tableName)},callUserCallback:function(e,t){var n=e[t.requestType];n&&n.callback&&n.callback.call(n.scope,t),t.last&&e.callback&&e.callback.call(e.scope)},CLASS_NAME:"OpenLayers.Protocol.SQL.Gears"}),OpenLayers.Layer.Yahoo=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:17,RESOLUTIONS:[1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.00034332275390625,.000171661376953125,858306884765625e-19,4291534423828125e-20,2145767211914062e-20,1072883605957031e-20],type:null,wrapDateLine:!0,sphericalMercator:!1,initialize:function(e,t){OpenLayers.Layer.EventPane.prototype.initialize.apply(this,arguments),OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,arguments),this.sphericalMercator&&(OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator),this.initMercatorParameters())},loadMapObject:function(){try{var e=this.getMapObjectSizeFromOLSize(this.map.getSize());this.mapObject=new YMap(this.div,this.type,e),this.mapObject.disableKeyControls(),this.mapObject.disableDragMap();if(!this.mapObject.moveByXY||typeof this.mapObject.moveByXY!="function")this.dragPanMapObject=null}catch(t){}},onMapResize:function(){try{var e=this.getMapObjectSizeFromOLSize(this.map.getSize());this.mapObject.resizeTo(e)}catch(t){}},setMap:function(e){OpenLayers.Layer.EventPane.prototype.setMap.apply(this,arguments),this.map.events.register("moveend",this,this.fixYahooEventPane)},fixYahooEventPane:function(){var e=OpenLayers.Util.getElement("ygddfdiv");e!=null&&(e.parentNode!=null&&e.parentNode.removeChild(e),this.map.events.unregister("moveend",this,this.fixYahooEventPane))},getWarningHTML:function(){return OpenLayers.i18n("getLayerWarning",{layerType:"Yahoo",layerLib:"Yahoo"})},getOLZoomFromMapObjectZoom:function(e){var t=null;return e!=null&&(t=OpenLayers.Layer.FixedZoomLevels.prototype.getOLZoomFromMapObjectZoom.apply(this,[e]),t=18-t),t},getMapObjectZoomFromOLZoom:function(e){var t=null;return e!=null&&(t=OpenLayers.Layer.FixedZoomLevels.prototype.getMapObjectZoomFromOLZoom.apply(this,[e]),t=18-t),t},setMapObjectCenter:function(e,t){this.mapObject.drawZoomAndCenter(e,t)},getMapObjectCenter:function(){return this.mapObject.getCenterLatLon()},dragPanMapObject:function(e,t){this.mapObject.moveByXY({x:-e,y:t})},getMapObjectZoom:function(){return this.mapObject.getZoomLevel()},getMapObjectLonLatFromMapObjectPixel:function(e){return this.mapObject.convertXYLatLon(e)},getMapObjectPixelFromMapObjectLonLat:function(e){return this.mapObject.convertLatLonXY(e)},getLongitudeFromMapObjectLonLat:function(e){return this.sphericalMercator?this.forwardMercator(e.Lon,e.Lat).lon:e.Lon},getLatitudeFromMapObjectLonLat:function(e){return this.sphericalMercator?this.forwardMercator(e.Lon,e.Lat).lat:e.Lat},getMapObjectLonLatFromLonLat:function(e,t){var n;if(this.sphericalMercator){var r=this.inverseMercator(e,t);n=new YGeoPoint(r.lat,r.lon)}else n=new YGeoPoint(t,e);return n},getXFromMapObjectPixel:function(e){return e.x},getYFromMapObjectPixel:function(e){return e.y},getMapObjectPixelFromXY:function(e,t){return new YCoordPoint(e,t)},getMapObjectSizeFromOLSize:function(e){return new YSize(e.w,e.h)},CLASS_NAME:"OpenLayers.Layer.Yahoo"}),OpenLayers.Layer.GML=OpenLayers.Class(OpenLayers.Layer.Vector,{loaded:!1,format:null,formatOptions:null,initialize:function(e,t,n){var r=[];r.push(e,n),OpenLayers.Layer.Vector.prototype.initialize.apply(this,r),this.url=t},setVisibility:function(e,t){OpenLayers.Layer.Vector.prototype.setVisibility.apply(this,arguments),this.visibility&&!this.loaded&&this.loadGML()},moveTo:function(e,t,n){OpenLayers.Layer.Vector.prototype.moveTo.apply(this,arguments),this.visibility&&!this.loaded&&this.loadGML()},loadGML:function(){this.loaded||(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.url,success:this.requestSuccess,failure:this.requestFailure,scope:this}),this.loaded=!0)},setUrl:function(e){this.url=e,this.destroyFeatures(),this.loaded=!1,this.loadGML()},requestSuccess:function(e){var t=e.responseXML;if(!t||!t.documentElement)t=e.responseText;var n={};OpenLayers.Util.extend(n,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(n.externalProjection=this.projection,n.internalProjection=this.map.getProjectionObject());var r=this.format?new this.format(n):new OpenLayers.Format.GML(n);this.addFeatures(r.read(t)),this.events.triggerEvent("loadend")},requestFailure:function(e){OpenLayers.Console.userError("Error in loading GML file "+this.url),this.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Layer.GML"}),OpenLayers.Geometry.Rectangle=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,width:null,height:null,initialize:function(e,t,n,r){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.x=e,this.y=t,this.width=n,this.height=r},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x+this.width,this.y+this.height)},getLength:function(){var e=2*this.width+2*this.height;return e},getArea:function(){var e=this.width*this.height;return e},CLASS_NAME:"OpenLayers.Geometry.Rectangle"}),OpenLayers.Renderer.NG=OpenLayers.Class(OpenLayers.Renderer.Elements,{labelNodeType:null,updateDimensions:function(e){var t=this.map.getExtent(),n=t.scale(3);this.setExtent(n,!0);var r=this.getResolution(),i=this.rendererRoot.parentNode,s=parseFloat(i.parentNode.style.left),o=parseFloat(i.parentNode.style.top);i.style.left=(n.left-t.left)/r-s+"px",i.style.top=(t.top-n.top)/r-o+"px"},setSize:function(){this.map.getExtent()&&this.updateDimensions()},drawFeature:function(e,t){t==null&&(t=e.style);if(e.geometry){var n=this.drawGeometry(e.geometry,t,e.id);if(n!==!1&&t.label){var r=e.geometry.getCentroid();this.drawText(e.id,t,r)}else this.removeText(e.id);return n}},drawText:function(e,t,n){var r;typeof e!="string"?r=e:(r=this.nodeFactory(e+this.LABEL_ID_SUFFIX,this.labelNodeType),r._featureId=e),r._style=t,r._x=n.x,r._y=n.y;if(t.labelXOffset||t.labelYOffset){var i=isNaN(t.labelXOffset)?0:t.labelXOffset,s=isNaN(t.labelYOffset)?0:t.labelYOffset,o=this.getResolution();n.move(i*o,s*o)}return r.parentNode!==this.textRoot&&this.textRoot.appendChild(r),r},CLASS_NAME:"OpenLayers.Renderer.NG"}),function(){var e=OpenLayers.Layer.Vector.prototype.moveTo;OpenLayers.Layer.Vector.prototype.moveTo=function(t,n,r){if(OpenLayers.Renderer.NG&&this.renderer instanceof OpenLayers.Renderer.NG){OpenLayers.Layer.prototype.moveTo.apply(this,arguments),r||this.renderer.updateDimensions(n);if(!this.drawn){this.drawn=!0;var i;for(var s=0,o=this.features.length;s<o;s++)this.renderer.locked=s!==o-1,i=this.features[s],this.drawFeature(i)}}else e.apply(this,arguments)};var t=OpenLayers.Layer.Vector.prototype.redraw;OpenLayers.Layer.Vector.prototype.redraw=function(){OpenLayers.Renderer.NG&&this.renderer instanceof OpenLayers.Renderer.NG&&(this.drawn=!1),t.apply(this,arguments)}}(),OpenLayers.Renderer.SVG2=OpenLayers.Class(OpenLayers.Renderer.NG,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",symbolMetrics:null,labelNodeType:"g",initialize:function(e){if(!this.supported())return;OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.symbolMetrics={}},supported:function(){var e="http://www.w3.org/TR/SVG11/feature#";return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(e+"SVG","1.1")||document.implementation.hasFeature(e+"BasicStructure","1.1"))},updateDimensions:function(e){OpenLayers.Renderer.NG.prototype.updateDimensions.apply(this,arguments);var t=this.getResolution(),n=this.extent.getWidth(),r=this.extent.getHeight(),i=[this.extent.left,-this.extent.top,n,r].join(" ");this.rendererRoot.setAttributeNS(null,"viewBox",i),this.rendererRoot.setAttributeNS(null,"width",n/t),this.rendererRoot.setAttributeNS(null,"height",r/t);if(e===!0){var s,o,u=this.vectorRoot.childNodes;for(s=0,o=u.length;s<o;++s)this.setStyle(u[s]);var a=this.textRoot.childNodes,f;for(s=0,o=a.length;s<o;++s)f=a[s],this.drawText(f,f._style,new OpenLayers.Geometry.Point(f._x,f._y))}},getNodeType:function(e,t){var n=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":t.externalGraphic?n="image":this.isComplexSymbol(t.graphicName)?n="svg":n="circle";break;case"OpenLayers.Geometry.Rectangle":n="rect";break;case"OpenLayers.Geometry.LineString":n="polyline";break;case"OpenLayers.Geometry.LinearRing":n="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":n="path";break;default:}return n},setStyle:function(e,t,n){t=t||e._style,n=n||e._options;var r=this.getResolution(),i=e._radius,s=r;if(e._geometryClass=="OpenLayers.Geometry.Point"&&i){e.style.visibility="";if(t.graphic===!1)e.style.visibility="hidden";else if(t.externalGraphic){if(t.graphicTitle){e.setAttributeNS(null,"title",t.graphicTitle);var o=e.getElementsByTagName("title");if(o.length>0)o[0].firstChild.textContent=t.graphicTitle;else{var u=this.nodeFactory(null,"title");u.textContent=t.graphicTitle,e.appendChild(u)}}t.graphicWidth&&t.graphicHeight&&e.setAttributeNS(null,"preserveAspectRatio","none");var a=t.graphicWidth||t.graphicHeight,f=t.graphicHeight||t.graphicWidth;a=a?a:t.pointRadius*2,f=f?f:t.pointRadius*2,a*=r,f*=r;var l=t.graphicXOffset!=undefined?t.graphicXOffset*r:-(.5*a),c=t.graphicYOffset!=undefined?t.graphicYOffset*r:-(.5*f),h=t.graphicOpacity||t.fillOpacity;e.setAttributeNS(null,"x",e._x+l),e.setAttributeNS(null,"y",e._y+c),e.setAttributeNS(null,"width",a),e.setAttributeNS(null,"height",f),e.setAttributeNS(this.xlinkns,"href",t.externalGraphic),e.setAttributeNS(null,"style","opacity: "+h),e.onclick=OpenLayers.Renderer.SVG2.preventDefault}else if(this.isComplexSymbol(t.graphicName)){var p=t.pointRadius*3*r,d=p*2,v=this.importSymbol(t.graphicName);s=this.symbolMetrics[v.id].size*3/d*r;var m=e.parentNode,g=e.nextSibling;m&&m.removeChild(e),e.firstChild&&e.removeChild(e.firstChild),e.appendChild(v.firstChild.cloneNode(!0)),e.setAttributeNS(null,"viewBox",v.getAttributeNS(null,"viewBox")),e.setAttributeNS(null,"width",d),e.setAttributeNS(null,"height",d),e.setAttributeNS(null,"x",e._x-p),e.setAttributeNS(null,"y",e._y-p),g?m.insertBefore(e,g):m&&m.appendChild(e)}else e.setAttributeNS(null,"r",t.pointRadius*r);var y=t.rotation;if(y!==undefined||e._rotation!==undefined){e._rotation=y,y|=0;if(e.nodeName!=="svg")e.setAttributeNS(null,"transform",["rotate(",y,e._x,e._y,")"].join(" "));else{var b=this.symbolMetrics[v.id];e.firstChild.setAttributeNS(null,"transform",["rotate(",y,b.x,b.y,")"].join(" "))}}}return n.isFilled?(e.setAttributeNS(null,"fill",t.fillColor),e.setAttributeNS(null,"fill-opacity",t.fillOpacity)):e.setAttributeNS(null,"fill","none"),n.isStroked?(e.setAttributeNS(null,"stroke",t.strokeColor),e.setAttributeNS(null,"stroke-opacity",t.strokeOpacity),e.setAttributeNS(null,"stroke-width",t.strokeWidth*s),e.setAttributeNS(null,"stroke-linecap",t.strokeLinecap||"round"),e.setAttributeNS(null,"stroke-linejoin","round"),t.strokeDashstyle&&e.setAttributeNS(null,"stroke-dasharray",this.dashStyle(t,s))):e.setAttributeNS(null,"stroke","none"),t.pointerEvents&&e.setAttributeNS(null,"pointer-events",t.pointerEvents),t.cursor!=null&&e.setAttributeNS(null,"cursor",t.cursor),e},dashStyle:function(e,t){var n=e.strokeWidth*t,r=e.strokeDashstyle;switch(r){case"solid":return"none";case"dot":return[t,4*n].join();case"dash":return[4*n,4*n].join();case"dashdot":return[4*n,4*n,t,4*n].join();case"longdash":return[8*n,4*n].join();case"longdashdot":return[8*n,4*n,t,4*n].join();default:var i=OpenLayers.String.trim(r).split(/\s+/g);for(var s=0,o=i.length;s<o;s++)i[s]=i[s]*t;return i.join()}},createNode:function(e,t){var n=document.createElementNS(this.xmlns,e);return t&&n.setAttributeNS(null,"id",t),n},nodeTypeCompare:function(e,t){return t==e.nodeName},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_svgRoot","svg")},createRoot:function(e){return this.nodeFactory(this.container.id+e,"g")},createDefs:function(){var e=this.nodeFactory(this.container.id+"_defs","defs");return this.rendererRoot.appendChild(e),e},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,n){var r=t.x,i=-t.y;return e.setAttributeNS(null,"cx",r),e.setAttributeNS(null,"cy",i),e._x=r,e._y=i,e._radius=n,e},drawLineString:function(e,t){var n=this.getComponentsString(t.components);return e.setAttributeNS(null,"points",n),e},drawLinearRing:function(e,t){var n=this.getComponentsString(t.components);return e.setAttributeNS(null,"points",n),e},drawPolygon:function(e,t){var n=[],r=!0,i=!0,s,o;for(var u=0,a=t.components.length;u<a;u++)n.push("M"),o=this.getComponentsString(t.components[u].components," "),n.push(o);return n.push("z"),e.setAttributeNS(null,"d",n.join(" ")),e.setAttributeNS(null,"fill-rule","evenodd"),e},drawRectangle:function(e,t){return e.setAttributeNS(null,"x",t.x),e.setAttributeNS(null,"y",-t.y),e.setAttributeNS(null,"width",t.width),e.setAttributeNS(null,"height",t.height),e},drawText:function(e,t,n){var r=OpenLayers.Renderer.NG.prototype.drawText.apply(this,arguments),i=r.firstChild||this.nodeFactory(e+this.LABEL_ID_SUFFIX+"_text","text"),s=this.getResolution();i.setAttributeNS(null,"x",n.x/s),i.setAttributeNS(null,"y",-n.y/s),r.setAttributeNS(null,"transform","scale("+s+")"),t.fontColor&&i.setAttributeNS(null,"fill",t.fontColor),t.fontOpacity&&i.setAttributeNS(null,"opacity",t.fontOpacity),t.fontFamily&&i.setAttributeNS(null,"font-family",t.fontFamily),t.fontSize&&i.setAttributeNS(null,"font-size",t.fontSize),t.fontWeight&&i.setAttributeNS(null,"font-weight",t.fontWeight),t.fontStyle&&i.setAttributeNS(null,"font-style",t.fontStyle),t.labelSelect===!0?(i.setAttributeNS(null,"pointer-events","visible"),i._featureId=e):i.setAttributeNS(null,"pointer-events","none");var o=t.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;i.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG2.LABEL_ALIGN[o[0]]||"middle"),OpenLayers.IS_GECKO===!0&&i.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG2.LABEL_ALIGN[o[1]]||"central");var u=t.label.split("\n"),a=u.length;while(i.childNodes.length>a)i.removeChild(i.lastChild);for(var f=0;f<a;f++){var l=i.childNodes[f]||this.nodeFactory(e+this.LABEL_ID_SUFFIX+"_tspan_"+f,"tspan");t.labelSelect===!0&&(l._featureId=e),OpenLayers.IS_GECKO===!1&&l.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG2.LABEL_VSHIFT[o[1]]||"-35%"),l.setAttribute("x",n.x/s);if(f==0){var c=OpenLayers.Renderer.SVG2.LABEL_VFACTOR[o[1]];c==null&&(c=-0.5),l.setAttribute("dy",c*(a-1)+"em")}else l.setAttribute("dy","1em");l.textContent=u[f]===""?" ":u[f],l.parentNode||i.appendChild(l)}return i.parentNode||r.appendChild(i),r},getComponentsString:function(e,t){var n=e.length,r=new Array(n);for(var i=0;i<n;i++)r[i]=this.getShortString(e[i]);return r.join(t||",")},getShortString:function(e){return e.x+","+ -e.y},importSymbol:function(e){this.defs||(this.defs=this.createDefs());var t=this.container.id+"-"+e,n=document.getElementById(t);if(n!=null)return n;var r=OpenLayers.Renderer.symbol[e];if(!r)throw new Error(e+" is not a valid symbol name");var i=this.nodeFactory(t,"symbol"),s=this.nodeFactory(null,"polygon");i.appendChild(s);var o=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),u=[],a,f;for(var l=0,c=r.length;l<c;l+=2)a=r[l],f=r[l+1],o.left=Math.min(o.left,a),o.bottom=Math.min(o.bottom,f),o.right=Math.max(o.right,a),o.top=Math.max(o.top,f),u.push(a,",",f);s.setAttributeNS(null,"points",u.join(" "));var h=o.getWidth(),p=o.getHeight(),d=[o.left-h,o.bottom-p,h*3,p*3];return i.setAttributeNS(null,"viewBox",d.join(" ")),this.symbolMetrics[t]={size:Math.max(h,p),x:o.getCenterLonLat().lon,y:o.getCenterLonLat().lat},this.defs.appendChild(i),i},getFeatureIdFromEvent:function(e){var t=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!t){var n=e.target;t=n.parentNode&&n!=this.rendererRoot?n.parentNode._featureId:undefined}return t},CLASS_NAME:"OpenLayers.Renderer.SVG2"}),OpenLayers.Renderer.SVG2.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"},OpenLayers.Renderer.SVG2.LABEL_VSHIFT={t:"-70%",b:"0"},OpenLayers.Renderer.SVG2.LABEL_VFACTOR={t:0,b:-1},OpenLayers.Renderer.SVG2.preventDefault=function(e){e.preventDefault&&e.preventDefault()};
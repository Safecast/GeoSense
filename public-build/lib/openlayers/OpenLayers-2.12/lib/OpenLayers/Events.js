/* Copyright (c) 2006-2012 by OpenLayers Contributors (see authors.txt for 
 * full list of contributors). Published under the 2-clause BSD license.
 * See license.txt in the OpenLayers distribution or repository for the
 * full text of the license. */

OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(e){return e.target||e.srcElement},isSingleTouch:function(e){return e.touches&&e.touches.length==1},isMultiTouch:function(e){return e.touches&&e.touches.length>1},isLeftClick:function(e){return e.which&&e.which==1||e.button&&e.button==1},isRightClick:function(e){return e.which&&e.which==3||e.button&&e.button==2},stop:function(e,t){t||(e.preventDefault?e.preventDefault():e.returnValue=!1),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},findElement:function(e,t){var n=OpenLayers.Event.element(e);while(n.parentNode&&(!n.tagName||n.tagName.toUpperCase()!=t.toUpperCase()))n=n.parentNode;return n},observe:function(e,t,n,r){var i=OpenLayers.Util.getElement(e);r=r||!1,t=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||i.attachEvent)&&(t="keydown"),this.observers||(this.observers={});if(!i._eventCacheID){var s="eventCacheID_";i.id&&(s=i.id+"_"+s),i._eventCacheID=OpenLayers.Util.createUniqueID(s)}var o=i._eventCacheID;this.observers[o]||(this.observers[o]=[]),this.observers[o].push({element:i,name:t,observer:n,useCapture:r}),i.addEventListener?i.addEventListener(t,n,r):i.attachEvent&&i.attachEvent("on"+t,n)},stopObservingElement:function(e){var t=OpenLayers.Util.getElement(e),n=t._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[n])},_removeElementObservers:function(e){if(e)for(var t=e.length-1;t>=0;t--)var n=e[t],r=new Array(n.element,n.name,n.observer,n.useCapture),i=OpenLayers.Event.stopObserving.apply(this,r)},stopObserving:function(e,t,n,r){r=r||!1;var i=OpenLayers.Util.getElement(e),s=i._eventCacheID;t=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||i.detachEvent)&&(t="keydown");var o=!1,u=OpenLayers.Event.observers[s];if(u){var a=0;while(!o&&a<u.length){var f=u[a];if(f.name==t&&f.observer==n&&f.useCapture==r){u.splice(a,1),u.length==0&&delete OpenLayers.Event.observers[s],o=!0;break}a++}}return o&&(i.removeEventListener?i.removeEventListener(t,n,r):i&&i.detachEvent&&i.detachEvent("on"+t,n)),o},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var e in OpenLayers.Event.observers){var t=OpenLayers.Event.observers[e];OpenLayers.Event._removeElementObservers.apply(this,[t])}OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"},OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1),OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown"],listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(e,t,n,r,i){OpenLayers.Util.extend(this,i),this.object=e,this.fallThrough=r,this.listeners={},this.extensions={},this.extensionCount={},t!=null&&this.attachToElement(t)},destroy:function(){for(var e in this.extensions)typeof this.extensions[e]!="boolean"&&this.extensions[e].destroy();this.extensions=null,this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)),this.element=null,this.listeners=null,this.object=null,this.fallThrough=null,this.eventHandler=null},addEventType:function(e){},attachToElement:function(e){this.element?OpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this)),this.element=e;for(var t=0,n=this.BROWSER_EVENTS.length;t<n;t++)OpenLayers.Event.observe(e,this.BROWSER_EVENTS[t],this.eventHandler);OpenLayers.Event.observe(e,"dragstart",OpenLayers.Event.stop)},on:function(e){for(var t in e)t!="scope"&&e.hasOwnProperty(t)&&this.register(t,e.scope,e[t])},register:function(e,t,n,r){e in OpenLayers.Events&&!this.extensions[e]&&(this.extensions[e]=new OpenLayers.Events[e](this));if(n!=null){t==null&&(t=this.object);var i=this.listeners[e];i||(i=[],this.listeners[e]=i,this.extensionCount[e]=0);var s={obj:t,func:n};r?(i.splice(this.extensionCount[e],0,s),typeof r=="object"&&r.extension&&this.extensionCount[e]++):i.push(s)}},registerPriority:function(e,t,n){this.register(e,t,n,!0)},un:function(e){for(var t in e)t!="scope"&&e.hasOwnProperty(t)&&this.unregister(t,e.scope,e[t])},unregister:function(e,t,n){t==null&&(t=this.object);var r=this.listeners[e];if(r!=null)for(var i=0,s=r.length;i<s;i++)if(r[i].obj==t&&r[i].func==n){r.splice(i,1);break}},remove:function(e){this.listeners[e]!=null&&(this.listeners[e]=[])},triggerEvent:function(e,t){var n=this.listeners[e];if(!n||n.length==0)return undefined;t==null&&(t={}),t.object=this.object,t.element=this.element,t.type||(t.type=e),n=n.slice();var r;for(var i=0,s=n.length;i<s;i++){var o=n[i];r=o.func.apply(o.obj,[t]);if(r!=undefined&&r==0)break}return this.fallThrough||OpenLayers.Event.stop(t,!0),r},handleBrowserEvent:function(e){var t=e.type,n=this.listeners[t];if(!n||n.length==0)return;var r=e.touches;if(r&&r[0]){var i=0,s=0,o=r.length,u;for(var a=0;a<o;++a)u=r[a],i+=u.clientX,s+=u.clientY;e.clientX=i/o,e.clientY=s/o}this.includeXY&&(e.xy=this.getMousePosition(e)),this.triggerEvent(t,e)},clearMouseCache:function(){this.element.scrolls=null,this.element.lefttop=null;var e=document.body;e&&(e.scrollTop==0&&e.scrollLeft==0||!navigator.userAgent.match(/iPhone/i))&&(this.element.offsets=null)},getMousePosition:function(e){this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache();if(!this.element.scrolls){var t=OpenLayers.Util.getViewportElement();this.element.scrolls=[t.scrollLeft,t.scrollTop]}return this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element)),new OpenLayers.Pixel(e.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],e.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},CLASS_NAME:"OpenLayers.Events"});
/* Copyright (c) 2006-2012 by OpenLayers Contributors (see authors.txt for 
 * full list of contributors). Published under the 2-clause BSD license.
 * See license.txt in the OpenLayers distribution or repository for the
 * full text of the license. */

OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(e,t){var n=!1,r=this.components.pop();if(t!=null||!e.equals(r))n=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments);var i=this.components[0];return OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[i]),n},removeComponent:function(e){var t=this.components&&this.components.length>3;if(t){this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var n=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[n])}return t},move:function(e,t){for(var n=0,r=this.components.length;n<r-1;n++)this.components[n].move(e,t)},rotate:function(e,t){for(var n=0,r=this.components.length;n<r-1;++n)this.components[n].rotate(e,t)},resize:function(e,t,n){for(var r=0,i=this.components.length;r<i-1;++r)this.components[r].resize(e,t,n);return this},transform:function(e,t){if(e&&t){for(var n=0,r=this.components.length;n<r-1;n++){var i=this.components[n];i.transform(e,t)}this.bounds=null}return this},getCentroid:function(){if(this.components&&this.components.length>2){var e=0,t=0;for(var n=0;n<this.components.length-1;n++){var r=this.components[n],i=this.components[n+1];e+=(r.x+i.x)*(r.x*i.y-i.x*r.y),t+=(r.y+i.y)*(r.x*i.y-i.x*r.y)}var s=-1*this.getArea(),o=e/(6*s),u=t/(6*s);return new OpenLayers.Geometry.Point(o,u)}return null},getArea:function(){var e=0;if(this.components&&this.components.length>2){var t=0;for(var n=0,r=this.components.length;n<r-1;n++){var i=this.components[n],s=this.components[n+1];t+=(i.x+s.x)*(s.y-i.y)}e=-t/2}return e},getGeodesicArea:function(e){var t=this;if(e){var n=new OpenLayers.Projection("EPSG:4326");n.equals(e)||(t=this.clone().transform(e,n))}var r=0,i=t.components&&t.components.length;if(i>2){var s,o;for(var u=0;u<i-1;u++)s=t.components[u],o=t.components[u+1],r+=OpenLayers.Util.rad(o.x-s.x)*(2+Math.sin(OpenLayers.Util.rad(s.y))+Math.sin(OpenLayers.Util.rad(o.y)));r=r*6378137*6378137/2}return r},containsPoint:function(e){function s(e,t,n,r,i){return(e-i)*((r-t)/(i-n))+r}var t=OpenLayers.Number.limitSigDigs,n=14,r=t(e.x,n),i=t(e.y,n),o=this.components.length-1,u,a,f,l,c,h,p,d,v=0;for(var m=0;m<o;++m){u=this.components[m],f=t(u.x,n),l=t(u.y,n),a=this.components[m+1],c=t(a.x,n),h=t(a.y,n);if(l==h){if(i==l)if(f<=c&&r>=f&&r<=c||f>=c&&r<=f&&r>=c){v=-1;break}continue}p=t(s(i,f,l,c,h),n);if(p==r)if(l<h&&i>=l&&i<=h||l>h&&i<=l&&i>=h){v=-1;break}if(p<=r)continue;if(f!=c&&(p<Math.min(f,c)||p>Math.max(f,c)))continue;(l<h&&i>=l&&i<h||l>h&&i<l&&i>=h)&&++v}var g=v==-1?1:!!(v&1);return g},intersects:function(e){var t=!1;if(e.CLASS_NAME=="OpenLayers.Geometry.Point")t=this.containsPoint(e);else if(e.CLASS_NAME=="OpenLayers.Geometry.LineString")t=e.intersects(this);else if(e.CLASS_NAME=="OpenLayers.Geometry.LinearRing")t=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[e]);else for(var n=0,r=e.components.length;n<r;++n){t=e.components[n].intersects(this);if(t)break}return t},getVertices:function(e){return e===!0?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});
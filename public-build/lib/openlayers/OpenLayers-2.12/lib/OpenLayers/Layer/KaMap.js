/* Copyright (c) 2006-2012 by OpenLayers Contributors (see authors.txt for 
 * full list of contributors). Published under the 2-clause BSD license.
 * See license.txt in the OpenLayers distribution or repository for the
 * full text of the license. */

OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(e,t,n,r){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(e){e=this.adjustBounds(e);var t=this.map.getResolution(),n=Math.round(this.map.getScale()*1e4)/1e4,r=Math.round(e.left/t),i=-Math.round(e.top/t);return this.getFullRequestString({t:i,l:r,s:n})},calculateGridLayout:function(e,t,n){var r=n*this.tileSize.w,i=n*this.tileSize.h,s=e.left,o=Math.floor(s/r)-this.buffer,u=s/r-o,a=-u*this.tileSize.w,f=o*r,l=e.top,c=Math.ceil(l/i)+this.buffer,h=c-l/i,p=-(h+1)*this.tileSize.h,d=c*i;return{tilelon:r,tilelat:i,tileoffsetlon:f,tileoffsetlat:d,tileoffsetx:a,tileoffsety:p}},clone:function(e){return e==null&&(e=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e]),this.tileSize!=null&&(e.tileSize=this.tileSize.clone()),e.grid=[],e},getTileBounds:function(e){var t=this.getResolution(),n=t*this.tileSize.w,r=t*this.tileSize.h,i=this.getLonLatFromViewPortPx(e),s=n*Math.floor(i.lon/n),o=r*Math.floor(i.lat/r);return new OpenLayers.Bounds(s,o,s+n,o+r)},CLASS_NAME:"OpenLayers.Layer.KaMap"});
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script>
      function init() {
        function debug(string) {
          var element = document.getElementById("debug");
          var p = document.createElement("p");
          p.appendChild(document.createTextNode(string));
          element.appendChild(p);
        }

        var Socket = "MozWebSocket" in window ? MozWebSocket : WebSocket;
        var ws = new Socket("ws://18.85.58.21:8080/");
        var receivedMilli = [];
        var sampleSize = 50;

        ws.onmessage = function(evt) { 
          //debug("Message: " + evt.data); 
          d = new Date();
          var ms = Date.UTC(d.getYear(), d.getMonth(), d.getDay(), d.getHours(), d.getMinutes(), d.getSeconds(), d.getMilliseconds());
          receivedMilli.push(ms);
          if (receivedMilli.length > sampleSize) {
            receivedMilli.shift();
          }

          var obj = $.parseJSON(evt.data);

          var html = '';
          for (var key in obj) {
              html += key + ': ' + obj[key].loc + '\n';
          }
          document.getElementById("monitor").innerHTML = html;

          //debug(evt.data);
          //console.log($.parseJSON(evt.data));
        };
        ws.onerror = function() { debug("socket error"); };
        ws.onclose = function() { debug("socket closed"); };
        ws.onopen = function() {
          debug("socket connected...");
          ws.send('watch Object-01')
          ws.send('watch Object-02')
          ws.send('watch Object-03')
          ws.send('watch Object-04')
          ws.send('watch Object-05')
          ws.send('watch Object-06')
        };

        var displayFps = function() {
          if (receivedMilli.length > 1 ) {
            fps = receivedMilli.length / ((receivedMilli[receivedMilli.length - 1] - receivedMilli[0]) / 1000.0);
            document.getElementById("fps").innerHTML = Math.round(fps) + ' fps';
          }
          setTimeout(displayFps, 500);
        };
        displayFps();

      };
    </script>
  </head>
  <body onload="init();">
    <pre id="fps">&nbsp;</pre>
    <pre id="debug"></pre>
    <pre id="monitor"></pre>

  </body>
</html>
